{"mappings":"IGKI,EADJ,IAAI,EAAW,SAAS,aAAa,CAAC,WAGtC,OAAM,EACF,YAAY,CAAK,CAAE,CAAE,IAAI,CAAC,MAAM,CAAG,CAAM,CACzC,UAAW,CAAE,OAAO,IAAI,CAAC,MAAM,AAAC,CAChC,SAAU,CAAE,OAAO,IAAI,CAAC,MAAM,AAAC,CACnC,CAEO,IAAI,EAAM,IAAI,MACjB,SAAS,CAAI,CAAE,CACX,EAAS,SAAS,CAAG,EAAK,IAAI,GAC9B,IAAI,EAAO,EAAS,OAAO,CAC3B,OAAO,EAAK,QAAQ,CAAC,MAAM,CAAG,EAAI,EAAO,EAAK,QAAQ,CAAC,EAAE,AAC7D,CACA,SAAS,CAAE,CAAE,CAAG,CAAE,CACd,EAAG,SAAS,CAAC,GAAG,CAAC,EACrB,CACA,SAAS,CAAE,CAAE,CAAG,CAAE,CACV,aAAe,OACf,EAAG,SAAS,CAAG,EAAG,SAAS,CAAC,OAAO,CAAC,EAAK,IAEzC,EAAG,SAAS,CAAC,MAAM,CAAC,EAE5B,CACA,SAAS,CAAE,CAAE,CAAG,CAAE,CACd,OAAO,EAAG,SAAS,CAAC,QAAQ,CAAC,EACjC,CACA,UAAU,CAAE,CAAE,CAAI,CAAE,CAAO,CAAE,CAAQ,CAAE,CACnC,EAAG,SAAS,CAAC,MAAM,CAAC,EAAS,CAAC,CAAC,GAC3B,GACA,EAAG,SAAS,CAAC,MAAM,CAAC,EAAU,CAAC,EAEvC,CACA,YAAY,CAAE,CAAE,GAAG,CAAI,CAAE,CACrB,EAAG,SAAS,CAAC,MAAM,IAAI,EAC3B,CACA,MAAM,CAAE,CAAE,CACN,GAAM,EAAG,MAAM,EACnB,CACA,GAAG,CAAO,CAAE,CAAK,CAAE,CAAO,CAAE,CAAO,CAAE,CAC7B,AAAgB,UAAhB,OAAO,EACP,EAAQ,gBAAgB,CAAC,EAAO,EAAS,GAAW,CAAC,GAErD,OAAO,IAAI,CAAC,GAAO,OAAO,CAAC,AAAA,GAAM,EAAI,EAAE,CAAC,EAAS,EAAI,CAAK,CAAC,EAAG,CAAE,GAAW,CAAC,GAEpF,CACA,IAAI,CAAO,CAAE,CAAK,CAAE,CAAO,CAAE,CAAO,CAAE,CAC9B,AAAgB,UAAhB,OAAO,EACP,EAAQ,mBAAmB,CAAC,EAAO,EAAS,GAAW,CAAC,GAExD,OAAO,IAAI,CAAC,GAAO,OAAO,CAAC,AAAA,GAAM,EAAI,GAAG,CAAC,EAAS,EAAI,CAAK,CAAC,EAAG,CAAE,GAAW,CAAC,GAErF,CACA,UAAU,CAAG,CAAE,CAKX,OAJA,SAAS,IAAI,CAAC,WAAW,CAAC,GACtB,GACA,CAAA,EAAQ,SAAS,CAAG,CADxB,EAGO,CACX,CACA,YAAa,CACT,EAAQ,MAAM,EAClB,CACA,SAAS,CAAE,CAAE,CAAE,CAAE,CACb,IAAI,EAAM,EAAG,qBAAqB,GAClC,MAAO,CACH,EAAG,EAAG,OAAO,CAAG,EAAI,IAAI,CACxB,EAAG,EAAG,OAAO,CAAG,EAAI,GAAG,AAC3B,CACJ,CACA,OAAO,CAAG,CAAE,EAAM,EAAI,YAAY,CAAE,CAChC,IAAI,EAAS,EAAI,qBAAqB,GAClC,EAAS,EAAI,qBAAqB,GACtC,MAAO,CACH,EAAG,EAAO,IAAI,CAAG,EAAO,IAAI,CAC5B,EAAG,EAAO,GAAG,CAAG,EAAO,GAAG,AAC9B,CACJ,CACA,WAAW,CAAG,CAAE,CACZ,OAAO,aAAe,EAAO,EAAI,GAC1B,AAAA,CAAA,EAAI,EAAA,EAAI,OAAO,CAAC,KAAM,SACxB,OAAO,CAAC,QAAS,UACjB,OAAO,CAAC,QAAS,UACjB,OAAO,CAAC,KAAM,QACd,OAAO,CAAC,KAAM,QACd,OAAO,CAAC,UAAW,SAC5B,CACA,SAAS,CAAG,CAAE,CACV,OAAO,IAAI,EAAI,EACnB,CACJ,EAEM,EAAW,CAAE,KAAM,IAAO,CAAA,CAAE,KAAM,CAAA,CAAK,CAAA,CAAG,EAEnC,EAAM,IAAI,MACnB,IAAM,IAAK,AACX,CAAA,IAAM,IAAI,AAAC,AACX,CAAA,UAAW,CAAE,MAAO,KAAM,CAC1B,SAAU,CAAE,OAAO,IAAK,CACxB,CAAC,OAAO,QAAQ,CAAC,EAAG,CAAE,OAAO,CAAS,CACtC,IAAI,QAAS,CAAE,OAAO,CAAE,CAC5B,CAEO,OAAM,EACT,YAAY,CAAG,CAAE,EAAM,CAAG,CAAE,CACxB,IAAI,CAAC,GAAG,CAAG,EACX,IAAI,CAAC,GAAG,CAAG,CACf,CACA,CAAC,OAAO,QAAQ,CAAC,EAAG,CAChB,IAAI,EAAI,IAAI,CACZ,MAAO,CACH,OACI,GAAI,IAAM,EAAK,MAAO,CAAE,KAAM,CAAA,CAAK,EACnC,IAAI,EAAQ,EAAE,GAAG,CAEjB,OADA,EAAI,EAAE,GAAG,CACF,CAAE,MAAA,CAAM,CACnB,CACJ,CACJ,CACA,IAAI,QAAS,CACT,IAAI,EAAI,IAAI,CAAE,EAAQ,EACtB,KAAO,IAAM,GAAK,EAAE,EAAO,EAAI,EAAE,GAAG,CACpC,OAAO,CACX,CACJ,CAEA,EAAU,EAAI,QAAQ,CAAC,4FAEhB,OAAM,EACT,YAAY,CAAO,CAAE,CACjB,IAAI,CAAC,YAAY,CAAG,OAAO,MAAM,CAAC,MAClC,IAAI,CAAC,CAAC,CAAG,OAAO,MAAM,CAAC,OAAO,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,EAAI,MAAO,EAC5E,CACA,iBAAiB,CAAK,CAAE,CAAO,CAAE,CAC7B,GAAI,AAAgB,UAAhB,OAAO,EAAmB,CAC1B,IAAI,EAAI,IAAI,CAAC,YAAY,CAAC,GAC1B,EAAO,EAAG,GACV,EAAE,IAAI,CAAC,EACX,MACI,OAAO,IAAI,CAAC,GAAO,OAAO,CAAC,AAAA,GAAM,IAAI,CAAC,gBAAgB,CAAC,EAAI,CAAK,CAAC,EAAG,EAE5E,CACA,oBAAoB,CAAK,CAAE,CAAO,CAAE,CAC5B,AAAgB,UAAhB,OAAO,EACP,EAAO,IAAI,CAAC,YAAY,CAAC,GAAQ,GAEjC,OAAO,IAAI,CAAC,GAAO,OAAO,CAAC,AAAA,GAAM,IAAI,CAAC,mBAAmB,CAAC,EAAI,CAAK,CAAC,EAAG,EAE/E,CACA,WAAW,CAAK,CAAE,CAAO,CAAE,CACvB,IAAI,CAAC,gBAAgB,CAAC,EAAO,SAAS,EAAG,GAAG,CAAI,EAE5C,OADA,IAAI,CAAC,mBAAmB,CAAC,EAAO,GACzB,EAAQ,KAAK,CAAC,IAAI,CAAE,EAC/B,EACJ,CACA,UAAU,CAAE,CAAE,GAAG,CAAI,CAAE,CACnB,IAAI,CAAC,YAAY,CAAC,GAAI,OAAO,CAAC,AAAA,GAAK,EAAE,KAAK,CAAC,IAAI,CAAE,GACrD,CACA,SAAU,CACN,IAAI,CAAC,SAAS,CAAC,YACnB,CACA,aAAa,CAAE,CAAE,CACb,OAAO,IAAI,CAAC,YAAY,CAAC,EAAG,EAAK,CAAA,IAAI,CAAC,YAAY,CAAC,EAAG,CAAG,EAAE,AAAF,CAC7D,CACJ,CAEO,MAAM,UAAe,EACxB,YAAY,GAAG,CAAI,CAAE,CACjB,KAAK,IAAI,GACT,IAAI,CAAC,aAAa,EACtB,CACA,eAAgB,CACZ,IAAI,EAAK,SAAS,aAAa,CAAC,OAIhC,OAHA,EAAG,SAAS,CAAG,IAAI,CAAC,aAAa,GACjC,EAAG,aAAa,CAAG,IAAI,CACvB,IAAI,CAAC,EAAE,CAAG,EACH,CACX,CACA,eAAgB,CACZ,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,AAChC,CACA,mBAAoB,CAChB,OAAO,IAAI,CAAC,EAAE,AAClB,CACA,YAAa,CACT,OAAO,IAAI,CAAC,EAAE,AAClB,CACA,IAAI,CAAK,CAAE,CACH,aAAiB,GACjB,CAAA,EAAQ,EAAM,UAAU,EAD5B,EAGA,IAAI,CAAC,iBAAiB,GAAG,WAAW,CAAC,EACzC,CACA,SAAS,CAAG,CAAE,CACV,EAAI,QAAQ,CAAC,IAAI,CAAC,UAAU,GAAI,EACpC,CACA,SAAS,CAAG,CAAE,CACV,EAAI,QAAQ,CAAC,IAAI,CAAC,UAAU,GAAI,EACpC,CACA,SAAS,CAAG,CAAE,CACV,OAAO,EAAI,QAAQ,CAAC,IAAI,CAAC,UAAU,GAAI,EAC3C,CACA,UAAU,CAAI,CAAE,CAAO,CAAE,CAAQ,CAAE,CAC/B,EAAI,SAAS,CAAC,IAAI,CAAC,UAAU,GAAI,EAAM,EAAS,EACpD,CACA,YAAY,GAAG,CAAI,CAAE,CACjB,EAAI,WAAW,CAAC,IAAI,CAAC,UAAU,MAAO,EAC1C,CACA,WAAW,CAAI,CAAE,CACb,IAAI,CAAC,iBAAiB,GAAG,SAAS,CAAG,CACzC,CACA,SAAS,CAAI,CAAE,CAAG,CAAE,CAChB,IAAI,EAAQ,IAAI,CAAC,UAAU,GAAG,KAAK,AAC/B,AAAe,CAAA,UAAf,OAAO,EACP,CAAK,CAAC,EAAK,CAAG,EAEd,OAAO,MAAM,CAAC,EAAO,EAE7B,CACA,QAAS,CACL,OAAO,IAAI,CAAC,UAAU,GAAG,qBAAqB,EAClD,CACA,SAAU,CACN,EAAI,KAAK,CAAC,IAAI,CAAC,UAAU,IACzB,KAAK,CAAC,WAAW,UACrB,CACJ,CAEO,SAAS,EAAO,CAAK,CAAE,CAAO,EACjC,IAAI,EAAM,EACV,KAAQ,AAAA,CAAA,EAAM,EAAM,OAAO,CAAC,EAAS,EAAA,GAAS,GAC1C,EAAM,MAAM,CAAC,EAAK,EAE1B,CAEO,SAAS,EAAQ,CAAE,CAAE,EAAU,CAAC,CAAE,CAAG,CAAE,GAAG,CAAI,EAC7C,UAAU,MAAM,CAAG,GACnB,CAAA,EAAK,EAAG,IAAI,CAAC,KAAQ,EADzB,EAGA,IAAI,EAAQ,KACZ,OAAO,WACH,aAAa,GACb,EAAQ,WAAW,EAAI,EAC3B,CACJ,CAGO,SAAS,EAAY,CAAM,CAAE,CAAK,EACrC,IAAiB,EAAM,EAAnB,EAAK,QAeT,CAdI,EAHE,KAIF,EAAO,IACA,EALO,SAMd,GANE,KAOF,EAAO,KACA,EARyB,YAShC,GATc,QAUd,EAAO,KACA,EAX2C,gBAYlD,GAZgC,WAahC,EAAO,KAGX,EAAI,KAAK,KAAK,CAAC,GACX,GAAS,GAAM,GACR,EAAG,OAAO,CAAC,GAAS,EAEpB,EAAI,CACnB,CAYO,SAAS,EAAG,CAAG,EAClB,OAAO,EAAI,IAAI,GAAG,KAAK,CAAC,MAC5B,CAEO,SAAS,EAAO,CAAG,EACtB,OAAO,EAAG,GAAK,MAAM,CAAC,CAAC,EAAG,EAAK,IAAO,CAAA,CAAC,CAAC,EAAI,CAAG,EAAI,EAAG,CAAA,EAAI,OAAO,MAAM,CAAC,MAC5E,CAEO,SAAS,EAAW,CAAC,CAAE,CAAI,EAE9B,MADI,AAAY,UAAZ,OAAO,GAAe,CAAA,EAAI,EAAG,EAAjC,EACO,AAAI,OAAO,KAAO,EAAE,IAAI,CAAC,KAAO,KAAM,EACjD,CE9RO,MAAM,EAET,YAAY,CAAA,IACR,EAAM,IAAA,CAAA,OACN,EAAS,IAAA,CAAA,OACT,EAAS,CAAA,CAAA,CAAA,KACT,EAAO,IAAA,CACV,CAAG,CAAC,CAAC,CAAE,CACJ,IAAI,CAAC,QAAQ,CAAG,EAChB,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,IAAI,CAAG,EAEZ,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAC7B,IAAI,CAAC,MAAM,CAAG,KACd,IAAI,CAAC,QAAQ,CAAG,EAAE,AACtB,CAEA,SAAU,CACN,AAAA,EAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAE,IAAI,EAChC,IAAI,CAAC,MAAM,CAAG,IAClB,CAEA,aAAa,CAAG,CAAE,CAAI,CAAE,CAAG,CAAE,CACzB,IAAI,EAAI,IAAI,CAAC,QAAQ,AACjB,CAAA,IAAI,CAAC,MAAM,EACX,EAAE,EACM,GAAR,GAAa,GAAO,IACpB,IAAI,CAAC,MAAM,CAAG,KACd,IAAI,CAAC,QAAQ,EAAI,EACb,IAAI,CAAC,QAAQ,CAAG,GAChB,CAAA,IAAI,CAAC,QAAQ,CAAG,CADpB,EAEA,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,QAAQ,EAEnD,CAEA,UAAU,CAAC,CAAE,CAAG,CAAE,CACd,IAAK,IAAI,EAAI,EAAE,MAAM,CAAE,EAAE,GAAK,GAC1B,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAE,EAC/B,CAEA,aAAc,CACV,OAAO,IAAI,CAAC,QAAQ,AACxB,CAEA,SAAU,CACN,OAAO,IAAI,CAAC,QAAQ,AACxB,CAEA,YAAY,CAAG,CAAE,CAAO,CAAE,CAAK,CAAE,CACzB,CAAA,GAAS,IAAI,CAAC,QAAQ,EAAI,CAAA,IAC1B,IAAI,CAAC,MAAM,CAAG,KACd,IAAI,CAAC,QAAQ,CAAG,EACZ,AAAC,GACD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,QAAQ,EAEvD,CAEA,WAAY,CACR,OAAO,IAAI,CAAC,MAAM,EAAK,CAAA,IAAI,CAAC,MAAM,CAAG,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,IAAI,CAAC,QAAQ,CAAA,CACpF,CAEA,KAAK,CAAK,CAAE,CAAO,CAAE,CAAK,CAAE,CACxB,IAAI,EAAM,IAAI,CAAC,WAAW,GAC1B,IAAI,CAAC,WAAW,CAAC,EAAM,WAAW,GAAI,EAAS,GAC/C,EAAM,WAAW,CAAC,EAAK,EAAS,EACpC,CAEJ,CCzEA,IAAI,EAAU,OAAO,MAAM,CAAC,KAErB,OAAM,EAET,YAAY,CAAI,CAAE,CACd,IAAI,CAAC,WAAW,CAAG,OAAO,MAAM,CAAC,MACjC,IAAI,CAAC,UAAU,CAAC,EACpB,CAEA,OAAO,OAAO,CAAI,CAAE,CAAI,CAAE,CACtB,IAAI,EAAM,GAAQ,CAAO,CAAC,EAAK,CAQ/B,MAPI,CAAC,IACD,EAAM,aAAgB,IAAI,CAAG,EAAO,IAAI,IAAI,CAAC,GACzC,IACA,CAAO,CAAC,EAAK,CAAG,EAChB,EAAI,IAAI,CAAG,IAGZ,CACX,CAEA,OAAO,IAAI,CAAI,CAAE,CACb,OAAO,CAAO,CAAC,EAAK,AACxB,CAEA,OAAO,SAAS,CAAI,CAAE,CAClB,IAAI,EAAM,CAAE,IAAK,EAAG,EAChB,EAAI,EACR,OAAS,CACL,IAAI,EAAI,YAAY,IAAI,CAAC,GACzB,GAAI,EACI,AAAQ,KAAR,CAAC,CAAC,EAAE,EAAS,CAAA,EAAI,OAAO,CAAG,CAAA,CAA/B,EACI,AAAQ,KAAR,CAAC,CAAC,EAAE,EAAS,CAAA,EAAI,OAAO,CAAG,CAAA,CAA/B,EACI,AAAQ,KAAR,CAAC,CAAC,EAAE,EAAS,CAAA,EAAI,QAAQ,CAAG,CAAA,CAAhC,EACA,EAAI,EAAE,MAAM,CAAC,OACV,CACH,EAAI,GAAG,CAAG,AAAK,SAAL,EAAe,IACnB,AAAY,GAAZ,EAAE,MAAM,CAAQ,EAAE,WAAW,GAC7B,EACN,KACJ,CACJ,CAKA,OAJI,EAAI,OAAO,EAAE,CAAA,EAAI,GAAG,EAAI,IAA5B,EACI,EAAI,OAAO,EAAE,CAAA,EAAI,GAAG,EAAI,IAA5B,EACI,EAAI,QAAQ,EAAE,CAAA,EAAI,GAAG,EAAI,IAA7B,EACA,EAAI,GAAG,EAAI,EACJ,CACX,CAEA,OAAO,WAAW,CAAE,CAAE,CAClB,IAAI,EAAK,EAAI,EAAE,CAiBf,MAhBI,eAAgB,EAChB,EAAM,EAAG,UAAU,CAAG,EAAI,UAAY,aAGlC,CAAA,AAAO,KADX,CAAA,EAAM,EAAG,GAAG,AAAH,GACU,AAAO,gBAAP,GAAyB,AAAW,SAAX,EAAG,IAAI,AAAI,GACnD,CAAA,EAAM,OADV,EAEI,AAAc,GAAd,EAAI,MAAM,EAAO,CAAA,EAAM,EAAI,WAAW,EAA1C,GAEA,EAAG,OAAO,EACV,EAAE,IAAI,CAAC,KACP,CAAA,EAAG,MAAM,EAAI,EAAG,SAAS,AAAT,GAChB,EAAE,IAAI,CAAC,KACP,EAAG,QAAQ,EAAK,CAAA,EAAI,MAAM,CAAG,GAAK,EAAI,WAAW,IAAM,EAAI,WAAW,EAAA,GACtE,EAAE,IAAI,CAAC,KACX,EAAE,IAAI,GACN,EAAE,IAAI,CAAC,GACA,EAAE,IAAI,CAAC,IAClB,CAEA,UAAU,CAAG,CAAE,CAAI,CAAE,CAAI,CAAE,CAMvB,GALI,aAAgB,QAChB,EAAO,EAAK,KAAK,CAAC,GAClB,EAAO,CAAI,CAAC,EAAE,EAGd,AADJ,CAAA,EAAM,EAAI,IAAI,GAAG,KAAK,CAAC,WAAvB,EACQ,MAAM,CAAG,EACb,EAAI,OAAO,CAAC,AAAA,GAAO,IAAI,CAAC,SAAS,CAAC,EAAK,EAAM,QAC1C,CACH,EAAM,CAAG,CAAC,EAAE,CAAC,IAAI,GACjB,IAAI,EAAM,IAAI,CAAC,WAAW,CAC1B,GAAI,EAAI,OAAO,CAAC,MAAQ,EAAG,CACvB,IAAI,EAAI,EAAI,KAAK,CAAC,OAClB,EAAM,EAAE,GAAG,GACX,EAAE,OAAO,CAAC,AAAA,IAEF,AAAC,CAAG,CADR,EAAM,IAAI,CAAC,QAAQ,CAAC,GAAK,GAAG,CACf,EACT,CAAA,CAAG,CAAC,EAAI,CAAG,CAAC,CAAA,EAChB,EAAM,CAAG,CAAC,EAAI,AAClB,EACJ,CAEA,CAAG,CAAC,AADJ,CAAA,EAAM,IAAI,CAAC,QAAQ,CAAC,EAApB,EACQ,GAAG,CAAC,CAAG,CAAE,EAAM,EAAM,AACjC,CACJ,CAEA,WAAW,CAAG,CAAE,CACZ,OAAO,IAAI,CAAC,GAAK,OAAO,CAAC,AAAA,GAAO,IAAI,CAAC,SAAS,CAAC,EAAK,CAAG,CAAC,EAAI,EAChE,CAEA,WAAW,CAAI,CAAE,CACb,IAAI,EAAU,KAAM,EAAM,IAAI,CAAC,WAAW,CAC1C,IAAK,IAAI,KAAO,EAAM,CAClB,IAAI,EAAM,EAAU,CAAO,CAAC,EAAI,CAAG,CAAG,CAAC,EAAI,CAC3C,GAAI,EAEA,CAAA,GAAI,MAAM,OAAO,CADjB,EAAU,GAEN,KADJ,KAGG,CACH,EAAU,KACV,KACJ,CACJ,CACA,OAAO,CACX,CAEA,UAAU,CAAC,CACX,UAAU,CAAC,CAEf,CGxHO,SAAS,EAAgB,CAAG,EAC/B,IAAI,CAAC,OAAO,CAAG,CACnB,CDiBO,SAAS,EAAkB,CAAI,CAAE,CAAI,EACxC,GAAI,AAAoB,GAApB,UAAU,MAAM,CAChB,EAAO,EACP,EAAO,SACJ,CACH,IAAI,EACE,aAAgB,WAClB,EAAgB,EAChB,EAAO,SAAS,CAAC,EAAE,CACnB,EAAK,QAAQ,CAAG,EAExB,CAEA,GADA,EAAK,gBAAgB,CAAG,CAAA,EACpB,AAAQ,MAAR,EAAc,CACd,GAAI,CAAC,MAAM,OAAO,CAAC,GAAO,CACtB,IAAI,EAAI,aAAa,IAAI,CAAC,GACtB,IACA,EAAI,CAAC,CAAC,EAAE,CACR,EAAO,EAAK,MAAM,CAAC,EAAE,MAAM,EACvB,EAAE,OAAO,CAAC,MAAQ,GAClB,CAAA,EAAK,eAAe,CAAG,CAAA,CAD3B,EAGI,EAAE,OAAO,CAAC,MAAQ,GAClB,CAAA,EAAK,iBAAiB,CAAG,CAAA,CAD7B,EAGI,EAAE,OAAO,CAAC,MAAQ,GAClB,CAAA,EAAK,gBAAgB,CAAG,CAAA,CAD5B,GAIA,GACA,CAAA,EAAO,EAAK,KAAK,CAAC,MADtB,CAEJ,CACA,GAAI,EAAM,CAEN,IADI,EACA,EAAU,SAAS,GAAG,CAAI,EAE1B,OADA,EAAU,EAAQ,MAAM,CAAC,GAClB,IAAI,CAAC,iBAAiB,CAAC,EAAM,EAAS,CAAA,EACjD,EACA,KAAO,EAAK,MAAM,CAAG,GAAG,CACpB,IAAI,EAAO,EACX,EAAU,AAwL1B,SAAgC,CAAG,CAAE,CAAI,EACrC,IAAI,EAAS,CAAW,CAAC,EAAI,MAAM,CAAC,GAAG,CAEvC,OADA,EAAM,EAAI,MAAM,CAAC,GACV,WACH,OAAO,EAAO,IAAI,CAAC,IAAI,CAAE,EAAK,EAClC,CACJ,EA9LiD,EAAK,GAAG,GAAI,SAAS,GAAG,CAAI,EAEzD,OADA,EAAU,EAAQ,MAAM,CAAC,GAClB,EAAK,IAAI,CAAC,IAAI,CACzB,EACJ,CACA,EAAK,sBAAsB,CAAG,WAE1B,OADA,EAAU,EAAE,CACL,EAAQ,IAAI,CAAC,IAAI,CAC5B,CACJ,CACJ,CACA,OAAO,CACX,CAEO,SAAS,EAAoB,CAAI,EACpC,OAAO,EAAkB,IAAK,SAAS,CAAC,EAEpC,IADI,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACZ,KAAM,GAAG,EAAK,IAAI,CAAC,IAAI,CAClC,EACJ,CF4CA,EAAa,SAAS,CAAC,QAAQ,CAAG,EAAa,QAAQ,CE1CvD,IAAI,EAAS,WAAW,EAMxB,SAAS,EAAO,CAAG,EACf,IAAI,EAAK,IAAI,CAAC,YAAY,CAAC,CAAA,GAI3B,OAHI,GACA,CAAA,EAAM,EAAK,IAAM,CADrB,EAGO,IAAI,CAAC,GAAG,CAAC,oBAAqB,EACzC,CAsDA,SAAS,EAAoB,CAAG,CAAE,CAAI,EAElC,OADA,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,yBAA0B,KAAM,EACpD,CAEA,SAAS,EAAY,CAAG,CAAE,CAAI,EAE1B,OADA,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,yBAA0B,EAC9C,CAzEA,EAAM,QAAQ,CAAG,WAAa,MAAO,EAAG,EACxC,EAAM,KAAK,CAAG,CAAA,EAkId,IAAI,EAAc,CACd,EAvHJ,SAA4B,CAAG,CAAE,CAAI,EAGjC,OAFA,QAAQ,GAAG,CAAC,qBAAsB,GAClC,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,2BAA4B,EAEhD,EAmHI,EAjHJ,SAAmC,CAAG,CAAE,CAAI,EAExC,OADA,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,yBAA0B,EAE9C,EA8GI,EA5GJ,SAA0B,CAAG,CAAE,CAAI,EAE/B,OADA,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,yBAA0B,EAC9C,EA0GI,EAxGJ,SAAwB,CAAG,CAAE,CAAI,EAEjC,EAuGI,EArGJ,SAA2B,CAAG,CAAE,CAAI,EAEhC,OADA,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,0BAA2B,EAE/C,EAkGI,EAhGJ,SAAmB,CAAG,CAAE,CAAI,EACxB,OAAO,EAAK,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,KAAK,GACrC,EA+FI,EA7FJ,SAAyB,CAAG,CAAE,CAAI,EAElC,EA4FI,EA1FJ,SAAoB,CAAG,CAAE,CAAI,EACzB,OAAO,EAAK,IAAI,CAAC,IAAI,CAAE,KAC3B,EAyFI,EAvFJ,SAA2B,CAAG,CAAE,CAAI,EAEpC,EAsFI,EApFJ,SAA4B,CAAG,CAAE,CAAI,EAErC,EAmFI,EAjFJ,SAAkB,CAAG,CAAE,CAAI,EACvB,OAAO,EAAK,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,UAAU,CAAC,WAAW,GACtD,EAgFI,EAAG,EACH,EAAG,EACH,EAtEJ,SAA+B,CAAG,CAAE,CAAI,EACpC,IAAI,EAAI,SAAS,IAAI,CAAC,YAAY,GAAI,WACtC,AAAK,MAAM,GAGA,EAAY,IAAI,CAAC,IAAI,CAAE,EAAK,GAF5B,EAAK,IAAI,CAAC,IAAI,CAAE,EAG/B,EAiEI,EA/DJ,SAA4B,CAAG,CAAE,CAAI,EACjC,IAAI,EAAI,SAAS,IAAI,CAAC,YAAY,GAAI,IAGtC,OAFI,MAAM,IACN,CAAA,EAAI,IADR,EAEO,EAAK,IAAI,CAAC,IAAI,CAAE,EAC3B,EA2DI,EAzDJ,SAAwB,CAAG,CAAE,CAAI,EAI7B,MAFI,AAAQ,KADZ,CAAA,EAAM,IAAI,CAAC,YAAY,EAAvB,GAEI,CAAA,EAAM,CADV,EAEO,EAAK,IAAI,CAAC,IAAI,CAAE,EAC3B,EAqDI,EAnDJ,SAA4B,CAAG,CAAE,CAAI,EACjC,IAAI,EAAI,IAAI,CAAC,SAAS,GACtB,OAAO,EAAK,IAAI,CAAC,IAAI,CAAE,EAAE,KAAK,CAAE,EAAE,GAAG,CACzC,EAiDI,EAAG,EACH,EAhDJ,SAA4B,CAAG,CAAE,CAAI,EAErC,EA+CI,EA7CJ,SAA4B,CAAG,CAAE,CAAI,EAEjC,OADA,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,2BAA4B,EAChD,EA4CI,EA1CJ,SAAiC,CAAG,CAAE,CAAI,EAEtC,OADA,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,gCAAiC,EACrD,EAwCI,EAtCJ,SAAwB,CAAG,CAAE,CAAI,EAE7B,OADA,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,uBAAwB,EAC5C,EAoCI,EAlCJ,SAAqC,CAAG,CAAE,CAAI,EAE1C,OADA,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,oCAAqC,EACzD,EAgCI,EA9BJ,SAAsC,CAAG,CAAE,CAAI,EAE3C,OADA,EAAO,IAAI,CAAC,IAAI,CAAE,GACX,IAAI,CAAC,GAAG,CAAC,4BAA6B,EACjD,CA+BA,ED9LA,IAAI,EAAkB,CAElB,qBAA4C,gBAC5C,qBAA4C,eAC5C,KAA4C,mCAC5C,aAA4C,cAC5C,MAA4C,oBAC5C,gBAA4C,sBAC5C,eAA4C,gBAC5C,sBAA4C,eAC5C,qBAA4C,gBAG5C,2BAA4C,qBAC5C,2BAA4C,oBAC5C,2BAA4C,oBAC5C,2BAA4C,qBAC5C,SAA4C,wCAC5C,QAA4C,yBAC5C,iBAA4C,mBAC5C,WAA4C,2BAC5C,UAA4C,qBAG5C,UAA4C,uBAC5C,gBAA4C,cAC5C,kBAA4C,YAC5C,yCAA4C,qBAC5C,MAA4C,YAC5C,kBAA4C,OAC5C,MAA4C,WAC5C,UAA4C,mBAC5C,UAA4C,0BAC5C,MAA4C,cAC5C,MAA4C,kBAC5C,MAA4C,kBAC5C,MAA4C,sBAC5C,MAA4C,kBAC5C,MAA4C,cAC5C,MAA4C,gBAC5C,IAA4C,2BAC5C,6BAA4C,OAC5C,OAA4C,iBAC5C,MAA4C,iBAC5C,MAA4C,gBAC5C,OAA4C,gBAK5C,eAA4C,6BAC5C,QAA4C,4BAE5C,QAA4C,qBAC5C,cAA4C,6BAC5C,WAA4C,oBAE5C,QAA4C,sBAChD,EAEI,EAAa,OAAO,MAAM,CAAC,CAAC,EAAG,EAAiB,CAEhD,qBAA4C,gBAC5C,qBAA4C,eAC5C,qBAA4C,gBAC5C,qBAA4C,eAC5C,KAA4C,mCAC5C,aAA4C,cAC5C,MAA4C,oBAC5C,gBAA4C,sBAC5C,eAA4C,gBAC5C,sBAA4C,eAC5C,qBAA4C,gBAC5C,cAA4C,oBAC5C,YAA4C,qBAC5C,MAA4C,iBAC5C,MAA4C,sBAC5C,OAA4C,iBAC5C,SAA4C,mBAC5C,QAA4C,YAC5C,UAA4C,cAG5C,2BAA4C,qBAC5C,2BAA4C,oBAC5C,2BAA4C,qBAC5C,2BAA4C,oBAC5C,2BAA4C,oBAC5C,2BAA4C,qBAC5C,gBAA4C,yBAC5C,cAA4C,0BAC5C,SAA4C,wCAC5C,QAA4C,yBAC5C,iBAA4C,mBAC5C,WAA4C,2BAC5C,UAA4C,qBAG5C,UAA4C,uBAC5C,gBAA4C,cAC5C,eAA4C,UAC5C,kBAA4C,YAC5C,yCAA4C,qBAC5C,MAA4C,YAC5C,kBAA4C,OAC5C,MAA4C,WAC5C,UAA4C,mBAC5C,UAA4C,0BAC5C,MAA4C,cAC5C,MAA4C,kBAC5C,MAA4C,kBAC5C,UAA4C,kBAC5C,MAA4C,sBAC5C,MAA4C,kBAC5C,MAA4C,cAC5C,MAA4C,gBAC5C,IAA4C,2BAC5C,IAA4C,cAC5C,SAA4C,gBAC5C,MAA4C,iBAC5C,6BAA4C,OAC5C,OAA4C,iBAC5C,MAA4C,cAC5C,MAA4C,iBAC5C,MAA4C,kBAC5C,MAA4C,mBAC5C,QAA4C,4BAC5C,QAA4C,yBAC5C,QAA4C,0BAC5C,MAA4C,gBAC5C,QAA4C,uBAC5C,MAA4C,qBAC5C,MAA4C,YAC5C,QAA4C,oBAC5C,MAA4C,gBAC5C,MAA4C,qBAC5C,MAA4C,eAC5C,QAA4C,uBAC5C,QAA4C,kBAC5C,WAA4C,mBAG5C,UAA4C,mBAC5C,UAA4C,kBAC5C,UAA4C,iBAC5C,UAA4C,iBAG5C,8CAAmD,cACnD,8CAAmD,kBACnD,QAAmD,mBACnD,QAAmD,cAGnD,QAA4C,eAC5C,QAA4C,sBAC5C,QAA4C,yBAC5C,QAA4C,2BAC5C,eAA4C,cAC5C,QAA4C,sBAG5C,MAA4C,2BAE5C,eAA4C,6BAC5C,QAA4C,4BAG5C,QAA4C,aAC5C,QAA4C,qBAC5C,cAA4C,6BAC5C,WAA4C,oBAC5C,QAA4C,wBAC5C,UAA4C,uBAC5C,QAA4C,eAC5C,OAA4C,cAC5C,cAA4C,CAAE,WAAY,OAAQ,CAClE,eAA4C,CAAE,WAAY,QAAS,CACnE,YAA4C,CAAE,WAAY,KAAM,CAChE,cAA4C,CAAE,WAAY,OAAQ,CAElE,QAA4C,4BAC5C,QAA4C,qBAC5C,QAA4C,mBAG5C,UAA4C,YAC5C,UAA4C,aAC5C,UAA4C,cAC5C,QAA4C,oBAE5C,UAA4C,mCAC5C,UAA4C,mBAE5C,QAA4C,eAChD,GAEI,EAAoB,AAAA,EAAa,MAAM,CAAC,WAAY,EACxD,CAAA,EAAkB,cAAc,CAAG,CAAE,sBAAuB,CAE5D,IAAI,EAAe,AAAA,EAAa,MAAM,CAAC,QAAS,EAChD,CAAA,EAAa,cAAc,CAAG,CAAE,sBAAuB,CAEvD,IAAI,EAAuB,AAAA,EAAa,MAAM,CAAC,gBAAiB,CAAC,EACjE,CAAA,EAAqB,cAAc,CAAG,CAAE,AAAA,EAAkB,IAAK,WAC3D,IAAI,EAAK,IAAI,CAAC,gBAAgB,GAC1B,EAAK,EAAG,GAAG,CACX,EAAS,IAAI,CAAC,YAAY,CAAC,CAAA,SAC/B,AAAK,CAAA,UAAU,IAAI,CAAC,IAAQ,CAAA,AAAO,MAAP,GAAc,AAAW,KAAX,CAAW,GAAS,EAAG,MAAM,EAAK,EAAG,OAAO,EAUtF,IAAI,CAAC,SAAS,CAAC,GACR,CAAA,IAVH,GAAU,EACV,IAAI,CAAC,YAAY,CAAC,GACd,AAAC,IAAI,CAAC,YAAY,EAClB,IAAI,CAAC,cAAc,CAAC,SAAS,CAAE,EAC3B,EAAG,GAAG,CAAC,SAAU,IAAK,EAC1B,GAEG,CAAA,EAIf,GAAI,CACJ,EAAqB,QAAQ,CAAG,AAAA,GAAU,EAAO,YAAY,CAAC,GG9QvD,OAAM,UAA8B,EAEvC,YAAY,CAAA,OAAE,CAAM,CAAE,CAAE,CACpB,KAAK,IAAI,WACT,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,KAAK,EACd,CAEA,OAAQ,CACJ,IAAI,CAAC,KAAK,CAAG,EAAE,AACnB,CAEA,WAAW,CAAG,CAAE,CACR,IAAI,CAAC,KAAK,CAAC,MAAM,CAAG,EACpB,IAAI,CAAC,KAAK,CAAC,EAAI,CAAG,KAElB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAAK,EAAG,KAElC,CAEA,WAAW,CAAG,CAAE,CACZ,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAAK,EAC3B,CAEA,YAAY,CAAG,CAAE,CAAI,CAAE,CACnB,IAAI,EAAI,IAAI,CAAC,KAAK,CAAC,EAAI,AACnB,CAAA,GAAK,EAAE,MAAM,CAAG,EAAK,MAAM,EAE3B,EAAE,MAAM,CAAC,EAAK,MAAM,CAE5B,CAEA,aAAa,CAAG,CAAE,CAAC,CAAE,CAAC,CAAE,CAAI,CAAE,CAAG,CAAE,CAC/B,IAAoB,EAAhB,EAAI,IAAI,CAAC,KAAK,CAAK,EAAU,CAAA,EACjC,GAAI,EAAI,EAAG,CAEP,IADA,EAAI,CAAC,CAAC,EAAI,EAAK,CAAA,CAAC,CAAC,EAAI,CAAG,EAAC,AAAD,EACjB,EAAI,GAEH,AADJ,CAAA,EAAI,CAAC,CAAC,EAAE,EAAK,CAAA,CAAC,CAAC,EAAE,CAAG,CAAC,CAAA,CAAA,CAChB,CAAC,EAAK,EAAI,GACX,CAAA,EAAU,CAAA,CADd,EAEA,CAAC,CAAC,EAAK,CAAG,EACV,EAAE,CAEF,CAAA,GACA,IAAI,CAAC,SAAS,CAAC,WAAY,EACnC,CACA,OAAO,CACX,CAEA,gBAAgB,CAAG,CAAE,CAAC,CAAE,CAAC,CAAE,CAAI,CAAE,CAC7B,IAAyB,EAArB,EAAI,IAAI,CAAC,KAAK,CAAC,EAAI,CAAK,EAAU,CAAA,EACtC,GAAI,GAAK,EAAI,EAAG,CACZ,KAAO,EAAI,GACP,CAAA,EAAI,CAAC,CAAC,EAAE,AAAF,GACG,KAAQ,IACb,EAAU,CAAA,EACV,OAAO,CAAC,CAAC,EAAK,EAElB,EAAE,CAEF,CAAA,GACA,IAAI,CAAC,SAAS,CAAC,WAAY,EACnC,CACA,OAAO,CACX,CAEA,gBAAgB,CAAG,CAAE,CAAC,CAAE,CAAI,CAAE,CAC1B,IAAI,EAAI,IAAI,CAAC,KAAK,CAAC,EAAI,CACnB,IACI,EAAO,EACP,EAAE,MAAM,CAAC,EAAG,KAAM,AAAI,MAAM,IACrB,EAAO,GACd,EAAE,MAAM,CAAC,EAAG,CAAC,GAGzB,CAYA,YAAY,CAAG,CAAE,CAAI,CAAE,CAAK,CAAE,CAC1B,IAAI,EAAI,IAAI,CAAC,KAAK,CAAC,EAAI,CACvB,GAAI,AAAU,OAAV,EAAgB,CAChB,GAAI,AAAQ,IAAR,EACA,MAAO,QACX,GAAI,CAAC,GAAK,AAAY,GAAZ,EAAE,MAAM,CACd,OAAO,AAAA,EAAI,UAAU,CAAC,EAE9B,KAAO,CACH,GAAI,AAAQ,IAAR,EACA,MAAO,0CACX,GAAI,CAAC,GAAK,AAAY,GAAZ,EAAE,MAAM,QACd,AAAI,IAAU,EAAK,MAAM,CACd,AAAA,EAAI,UAAU,CAAC,GAAQ,0CAC3B,AAAA,EAAI,UAAU,CAAC,EAAK,MAAM,CAAC,EAAG,IACjC,6BACA,AAAA,EAAI,UAAU,CAAC,EAAK,MAAM,CAAC,IAC3B,UACA,AAAA,EAAI,UAAU,CAAC,EAAK,MAAM,CAAC,EAAQ,GAE/C,CAEA,IADA,IAAyC,EAAa,EAAlD,EAAI,EAAG,EAAI,EAAK,MAAM,CAAE,EAAO,KAAS,EAAM,GAC3C,EAAI,GAAG,CAMV,GAJA,EAAI,AADJ,CAAA,EAAI,CAAC,CAAC,EAAE,AAAF,GACG,EAAE,GAAG,CACV,IAAM,GACN,CAAA,EAAI,EAAI,EAAI,eAAiB,aADjC,EAGI,GAAK,GAAK,EAAM,CACZ,GACA,CAAA,GAAO,MADX,EAEA,GAAO,MACP,IAAI,EAAO,EACX,EAAI,EAAE,OAAO,CAAC,kBAAmB,SAAS,CAAC,CAAE,CAAC,EAE1C,OADI,GAAG,CAAA,GAAO,CAAC,MAAM,EAAE,EAAE,EAAE,CAAC,AAAD,EACpB,EACX,GACA,GAAO,UAAY,EAAI,KACvB,EAAI,CACR,KACS,CAAC,GAAK,GACX,CAAA,GAAO,MAFX,EASA,OALA,EAAO,EAIP,EAAK,EAAK,MAAM,CAAC,IAEf,IAAK,IAAM,GAAO,OAAQ,KAC1B,KAAK,IAAM,GAAO,OAAQ,KAC1B,KAAK,IAAM,GAAO,QAAS,KAC3B,SAAW,GAAO,CACpB,CACA,EAAE,CACN,CAOA,OANI,GACA,CAAA,GAAO,MADX,EAEI,IAAM,GAEN,CAAA,GAAO,yCAAP,EAEG,CACX,CAEJ,CNlJA,IAAI,EAAc,CACd,iBAA8B,KAC9B,aAA8B,CAAA,EAC9B,4BAA8B,EAC9B,YAA8B,GAC9B,UAA8B,EAC9B,aAA8B,EAC9B,YAA8B,CAAA,EAG9B,YAA8B,kBAC9B,uBAA8B,kCAC9B,oBAA8B,oBAC9B,iBAA8B,oBAC9B,qBAA8B,sBAClC,EAIA,SAAS,EAAK,CAAG,CAAE,CAAG,EAClB,GAAI,AAAc,UAAd,OAAO,EAOP,OANI,AAAQ,KAAA,IAAR,EACA,OAAO,IAAI,CAAC,EAAI,CAEhB,IAAI,CAAC,EAAI,CAAG,EACZ,aAAe,UACf,CAAA,EAAI,YAAY,CAAG,CADvB,EAEO,EAEP,IAAI,EAAU,OAAO,MAAM,CAAC,MAC5B,IAAK,IAAI,KAAK,EACV,CAAO,CAAC,EAAE,CAAG,IAAI,CAAC,EAAE,CACpB,EAAK,IAAI,CAAC,IAAI,CAAE,EAAG,CAAG,CAAC,EAAE,EAE7B,OAAO,CAEf,CAEA,SAAS,EAAI,CAAC,EACV,OAAO,aAAa,EAAe,EAAE,WAAW,GAAK,CACzD,CAEO,MAAM,UAAqB,EAE9B,OAAO,QAAU,CACb,KAAe,YACf,KAAe,GACf,MAAe,KACf,UAAe,IACnB,CAAE,AAEF,QAAO,SAAW,OAAO,MAAM,CAAC,KAAM,AAEtC,QAAO,YAAY,GAAG,CAAI,CAAE,CACxB,OAAO,EAAK,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAE,EACrC,CAEA,OAAO,gBAAgB,CAAI,CAAE,CACzB,IAAI,CAAC,QAAQ,CAAG,OAAO,MAAM,CAAC,OAAO,MAAM,CAAC,MAAO,IAAI,CAAC,QAAQ,EAChE,IAAI,EAAe,OAAO,MAAM,CAAC,MAQjC,OAPA,OAAO,IAAI,CAAC,GAAM,OAAO,CAAC,AAAA,IACtB,IAAI,EAAS,CAAI,CAAC,EAAO,AACrB,AAAiB,CAAA,UAAjB,OAAO,GACP,CAAA,EAAS,IAAI,CAAC,QAAQ,CAAC,EAAO,AAAP,EAE3B,CAAY,CAAC,EAAO,CAAG,CAC3B,GACO,IAAI,CAAC,WAAW,CAAC,EAC5B,CAEA,OAAO,QAAQ,CAAI,CAAE,CAAQ,CAAE,CAC3B,IAAI,EAAU,IAAM,EAAO,IAAK,EAAU,EAAU,QACpD,EAAa,SAAS,CAAC,EAAS,EAAE,EAClC,IAAI,CAAC,QAAQ,CAAC,EAAK,CAAG,AAAA,EAAkB,IAAK,SAAS,CAAK,EACvD,IAAI,EAAS,IAAI,CAAC,IAAI,CAAC,GACvB,GAAI,EAEc,CAAA,IAAV,IAEA,IAAI,CAAC,IAAI,CAAC,GAAS,OAAO,CAAC,AAAA,GAAQ,EAAK,IAAI,CAAC,IAAI,CAAE,CAAA,IAC/C,aAAkB,UAElB,EAAO,IAAI,CAAC,IAAI,EAEpB,IAAI,CAAC,IAAI,CAAC,EAAS,MACnB,AAAA,EAAO,IAAI,CAAC,KAAK,CAAE,SAKvB,GAAI,AAAU,CAAA,IAAV,EAAiB,CACjB,IAAI,EAAM,EAAS,KAAK,CAAC,IAAI,CAAE,UAC3B,CAAE,aAAe,UACjB,CAAA,EAAM,CAAA,CADV,EAEA,IAAI,CAAC,IAAI,CAAC,EAAS,GACnB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAChB,IAAI,CAAC,IAAI,CAAC,GAAS,OAAO,CAAC,AAAA,GAAQ,EAAK,IAAI,CAAC,IAAI,CAAE,CAAA,GACvD,CAEJ,OAAO,CACX,EACJ,CAEA,OAAO,YAAY,CAAG,CAAE,CACpB,OAAO,CAAW,CAAC,EAAI,AAC3B,CAEA,OAAO,aAAc,CACjB,OAAO,EAAK,KAAK,CAAC,EAAa,UACnC,CAEA,YAAY,GAAG,CAAI,CAAE,CACjB,KAAK,IAAI,GAET,IAAI,CAAC,YAAY,CAAG,IAAI,YAAY,EACpC,IAAI,CAAC,QAAQ,CAAG,OAAO,MAAM,CAAC,OAAO,MAAM,CAAC,MAAO,IAAI,CAAC,QAAQ,EAChE,IAAI,CAAC,IAAI,CAAG,IAAI,CAAC,CAAC,CAAC,IAAI,CACvB,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,CAAC,CAAC,KAAK,CACzB,IAAI,CAAC,SAAS,CAAG,IAAI,CAAC,CAAC,CAAC,SAAS,CAEjC,IAAI,CAAC,iBAAiB,CAAG,EACzB,IAAI,CAAC,gBAAgB,CAAG,EACxB,IAAI,CAAC,aAAa,CAAG,EACrB,IAAI,CAAC,gBAAgB,CAAG,EACxB,IAAI,CAAC,YAAY,CAAG,EAAE,CACtB,IAAI,CAAC,WAAW,CAAG,EAAE,CACrB,IAAI,CAAC,aAAa,CAAG,EAErB,IAAI,CAAC,OAAO,CAAG,EAAE,CACjB,IAAI,CAAC,WAAW,CAAG,IAAI,CAAC,YAAY,CAAC,EAAG,CAAA,EAAO,SAC/C,IAAI,CAAC,UAAU,CAAG,IAAI,CAAC,YAAY,CAAC,EAAG,CAAA,EAAM,QAC7C,IAAI,CAAC,SAAS,CAAG,EAAE,CACnB,IAAI,CAAC,eAAe,CAAG,KACvB,IAAI,CAAC,cAAc,CAAG,KACtB,IAAI,CAAC,WAAW,CAAG,EAAE,CAErB,IAAI,CAAC,SAAS,CAAG,OAAO,MAAM,CAAC,MAC/B,IAAI,CAAC,eAAe,CAAG,EACvB,IAAI,CAAC,KAAK,CAAG,EAAE,CAEf,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAG,EACvC,IAAI,CAAC,OAAO,CAAG,IAAI,CAAC,WAAW,CAAC,SAAS,GAErC,AAAC,IAAI,CAAC,gBAAgB,EACtB,IAAI,CAAC,SAAS,CAAC,gBAAiB,IAAI,CAAC,OAAO,CAAE,IAAI,CAAC,KAAK,GAEhE,GAEA,IAAI,CAAC,gBAAgB,CAAG,CACpB,aAAgB,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,IAAI,CAC1D,EAEA,IAAI,CAAC,eAAe,CAAG,IAAI,EAAsB,CAAE,OAAQ,IAAI,AAAC,GAChE,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,WAAY,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,IAAI,GAEzF,IAAI,CAAC,MAAM,CAAG,EAAE,CAChB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,iBAAiB,IACtC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EACxB,IAAI,CAAC,mBAAmB,CAAG,CAC/B,CAEA,YAAY,CAAI,CAAE,CAAI,CAAE,CAChB,AAAe,UAAf,OAAO,GACP,CAAA,EAAO,IAAI,CAAC,QAAQ,CAAC,EAAK,AAAL,EAEzB,IAAI,CAAC,IAAI,CADK,IAAM,EAAO,UACR,UAAU,CAAC,EAClC,CAEA,eAAe,CAAI,CAAE,CAAI,CAAE,CACnB,AAAe,UAAf,OAAO,GACP,CAAA,EAAO,IAAI,CAAC,QAAQ,CAAC,EAAK,AAAL,EAEzB,AAAA,EAAO,IAAI,CAAC,IAAI,CADF,IAAM,EAAO,UACA,EAC/B,CAEA,cAAc,CAAI,CAAE,CAAI,CAAE,CACtB,IAAI,EAAQ,IAAI,CAAC,SAAS,AAC1B,CAAA,IAAI,CAAC,SAAS,CAAG,OAAO,MAAM,CAAC,OAAO,MAAM,CAAC,IAAI,CAAC,SAAS,EAAG,GAC9D,GAAI,CACA,GAAI,aAAgB,SAChB,OAAO,EAAK,KAAK,CAAC,IAAI,CAAE,IAAI,UAAU,CAAC,KAAK,CAAC,IAE7C,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAM,IAAI,UAAU,CAAC,KAAK,CAAC,GAExD,QAAU,CACN,IAAI,CAAC,SAAS,CAAG,CACrB,CACJ,CAEA,aAAa,CAAI,CAAE,CAAI,CAAE,CACrB,IAAI,EAAQ,IAAI,CAAC,QAAQ,AACzB,CAAA,IAAI,CAAC,QAAQ,CAAG,OAAO,MAAM,CAAC,OAAO,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAG,GAC5D,GAAI,CACA,GAAI,aAAgB,SAChB,OAAO,EAAK,KAAK,CAAC,IAAI,CAAE,IAAI,UAAU,CAAC,KAAK,CAAC,IAE7C,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAM,IAAI,UAAU,CAAC,KAAK,CAAC,GAExD,QAAU,CACN,IAAI,CAAC,QAAQ,CAAG,CACpB,CACJ,CAEA,YAAY,CAAI,CAAE,CACd,OAAQ,KAAQ,IAAI,CAAC,SAAS,CACxB,IAAI,CAAC,SAAS,CAAC,EAAK,CACpB,CAAW,CAAC,EAAK,AAC3B,CAEA,aAAc,CACV,OAAO,EAAK,KAAK,CAAC,IAAI,CAAC,SAAS,CAAE,UACtC,CAIA,kBAAkB,CAAG,CAAE,CAAE,CAAE,CAAK,CAAE,EAAQ,CAAC,CAAE,KAGrC,EACJ,IAHI,AAAC,EAAG,MAAM,EAAE,CAAA,EAAK,AAAI,OAAO,EAAG,MAAM,CAAE,EAAG,KAAK,CAAG,IAAtD,EACA,EAAG,SAAS,CAAG,IAEF,CACT,IAAI,EAAM,EAAG,SAAS,CAClB,EAAI,EAAG,IAAI,CAAC,GAChB,GAAI,CAAC,GAAK,EAAG,SAAS,CAAG,EAAO,MAGhC,GADA,AADA,CAAA,EAAQ,CAAA,EACF,KAAK,CAAG,EAAG,SAAS,CACtB,EAAG,SAAS,EAAI,EAAK,CAKrB,IAAI,EAAU,OACd,CAAA,EAAQ,SAAS,CAAG,EAAG,SAAS,CAChC,EAAQ,IAAI,CAAC,GACb,EAAG,SAAS,CAAG,EAAQ,SAAS,AACpC,CACJ,CACA,GAAI,EACA,OAAO,IAAI,CAAC,SAAS,CAAG,CAEhC,CAEA,WAAW,CAAM,CAAE,CACX,aAAkB,MAClB,EAAO,OAAO,CAAC,IAAI,CAAC,UAAU,CAAE,IAAI,GAEpC,IAAI,CAAC,SAAS,CAAC,GACf,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GACjB,EAAO,QAAQ,CAAC,IAAI,EAE5B,CAEA,UAAU,CAAM,CAAE,CACd,AAAA,EAAO,IAAI,CAAC,MAAM,CAAE,GACpB,EAAO,QAAQ,CAAC,IAAI,CACxB,CAEA,mBAAoB,CAChB,OAAO,IAAI,CAAC,YAAY,CAAG,EAA0B,CACzD,CAEA,YAAY,CAAI,CAAE,CAAM,CAAE,CAAO,CAAE,CAE/B,IAAI,CAAC,KAAK,CAAC,aAAa,GACxB,IAAI,CAAC,SAAS,CAAC,YAAa,CAAE,KAAM,QAAS,KAAA,EAAM,OAAA,EAAQ,QAAA,CAAQ,EACvE,CAEA,WAAW,CAAI,CAAE,CAAM,CAAE,CAAO,CAAE,CAC9B,IAAI,CAAC,SAAS,CAAC,YAAa,CAAE,KAAM,OAAQ,KAAA,EAAM,OAAA,EAAQ,QAAA,CAAQ,EACtE,CAEA,aAAa,CAAI,CAAE,CACf,IAAI,CAAC,SAAS,CAAC,YAAa,EAChC,CAEA,aAAa,CAAG,CAAE,CAAM,CAAE,CAAI,CAAE,CAG5B,OAFI,AAAO,MAAP,GACA,CAAA,EAAM,IAAI,CAAC,KAAK,EADpB,EAEO,IAAI,EAAa,CAAE,OAAQ,IAAI,CAAE,IAAK,EAAK,KAAM,EAAM,OAAQ,CAAO,EACjF,CAEA,OAAQ,CACJ,OAAO,IAAI,CAAC,WAAW,CAAC,WAAW,EACvC,CAEA,MAAM,CAAK,CAAE,CAST,OARa,MAAT,IACA,IAAI,CAAC,SAAS,CAAG,EAKjB,IAAI,CAAC,cAAc,IAEhB,IAAI,CAAC,SAAS,AACzB,CAEA,QAAQ,CAAI,CAAE,CAEV,IAAI,CAAC,KAAK,CAAC,CAAA,GACX,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,MAAM,CAAG,EAAK,MAAM,CACzB,IAAI,CAAC,WAAW,CAAG,EAAE,CACrB,IAAI,CAAC,aAAa,CAAG,EACrB,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,AAAA,GAAK,EAAE,WAAW,CAAC,EAAG,CAAA,EAAM,CAAA,IAC7C,IAAI,CAAC,IAAI,CAAG,EAAK,KAAK,CAAC,MACvB,IAAI,CAAC,eAAe,CAAC,KAAK,GACtB,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,SAAS,CAAC,KAAK,GAExB,IAAI,CAAC,SAAS,CAAC,cAAe,IAAI,CAAC,IAAI,EACvC,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,EAAG,CAAA,EAAO,CAAA,GACvC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,EAAG,CAAA,GAC/B,IAAI,CAAC,YAAY,CAAC,AAAA,IACd,EAAM,kBAAkB,GACxB,EAAM,uBAAuB,EACjC,EACJ,CAEA,aAAa,CAAG,CAAE,CACV,AAAkB,MAAlB,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,IAAI,CAAC,gBAAgB,EAE5D,IAAI,CAAC,SAAS,CAAG,EACb,GACA,EAAI,gBAAgB,CAAC,IAAI,CAAC,gBAAgB,EAC1C,EAAI,KAAK,KAET,IAAI,CAAC,eAAe,CAAC,KAAK,GAC1B,IAAI,CAAC,SAAS,CAAC,cAAe,IAAI,CAAC,IAAI,EAE/C,CAEA,SAAU,CACN,OAAO,IAAI,CAAC,MAAM,EAAK,CAAA,IAAI,CAAC,MAAM,CAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAA,CACxD,CAEA,aAAc,CACV,GAAI,IAAI,CAAC,MAAM,CACX,OAAO,IAAI,CAAC,MAAM,CAEtB,IADA,IAAI,EAAI,IAAI,CAAC,IAAI,CAAC,MAAM,CAAE,EAAO,EAAI,EAAI,GAAK,EACvC,EAAE,GAAK,GACV,GAAQ,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAG,EAClC,OAAO,IAAI,CAAC,MAAM,CAAG,CACzB,CAEA,QAAQ,CAAG,CAAE,CAGT,OAFI,AAAO,MAAP,GACA,CAAA,EAAM,IAAI,CAAC,OAAO,CAAC,GAAG,AAAH,EAChB,IAAI,CAAC,IAAI,CAAC,EAAI,AACzB,CAEA,aAAa,CAAG,CAAE,CAAG,CAAE,CACnB,IAAI,EAAI,IAAI,CAAC,IAAI,CAAC,MAAM,CACxB,GAAI,GAAO,IAAK,OAAO,KACvB,IAAI,EAAO,IAAI,CAAC,IAAI,CAAC,EAAI,QACzB,AAAI,GAAO,EAAK,MAAM,CACX,GAAO,EAAI,KAAO,KACtB,EAAK,MAAM,CAAC,EACvB,CAEA,OAAO,CAAK,CAAE,CACN,AAAS,MAAT,EACA,EAAQ,IAAI,CAAC,KAAK,GAGd,AADJ,CAAA,EAAQ,EAAI,EAAZ,EACY,GACR,CAAA,GAAS,IAAI,CAAC,KAAK,EADvB,EAGJ,IAAI,EAAK,IAAI,CAAC,iBAAiB,CAAC,GAChC,OAAO,IAAI,CAAC,YAAY,CAAC,EAAG,GAAG,CAAE,EAAG,GAAG,CAC3C,CAEA,kBAAkB,CAAI,CAAE,CAAI,CAAE,CAAS,CAAE,KAEjC,EAOJ,GARI,AAAC,GAAM,CAAA,EAAO,EAAE,AAAF,EAEZ,aAAgB,SAIlB,EAAM,EAAK,YAAY,EAAI,MAH3B,EAAM,EACN,EAAO,IAAI,CAAC,QAAQ,CAAC,EAAK,EAI1B,EAAK,sBAAsB,EAAI,CAAC,EAMhC,OAAO,EAAK,sBAAsB,CAAC,KAAK,CAAC,IAAI,CAAE,EAEnD,CAAA,IAAI,CAAC,cAAc,CAAG,EAClB,IAAI,CAAC,eAAe,EAAI,GACxB,IAAI,CAAC,gBAAgB,CAAC,GAClB,AAAO,QAAP,GACA,IAAI,CAAC,kBAAkB,IAEpB,CAAA,AAAO,uBAAP,GAAgC,IAAI,CAAC,gBAAgB,GAAK,IAAM,CAAA,GACnE,AAAO,QAAP,GACA,IAAI,CAAC,kBAAkB,GAG/B,IAAI,CAAC,cAAc,GACnB,GAAI,CAKA,OAJA,IAAI,CAAC,SAAS,CAAC,2BAA4B,EAAK,GAC5C,AAAC,EAAK,eAAe,EAAK,IAAI,CAAC,IAAI,CAAC,gBACpC,IAAI,CAAC,kBAAkB,GAEpB,EAAK,KAAK,CAAC,IAAI,CAAE,EAC5B,CAAE,MAAM,EAAI,CACR,GAAI,aAAc,EACd,IAAI,CAAC,WAAW,CAAC,EAAG,OAAO,OAE3B,MAAM,CAEd,QAAU,CACF,IAAI,CAAC,IAAI,CAAC,gBACV,IAAI,CAAC,mBAAmB,GAExB,AAAO,QAAP,GACA,CAAA,IAAI,CAAC,aAAa,CAAG,IAAI,CAAC,WAAW,CAAC,MAAM,AAAN,EAE1C,IAAI,CAAC,aAAa,GAClB,IAAI,CAAC,SAAS,CAAC,0BAA2B,EAAK,GAC/C,IAAI,CAAC,eAAe,CAAG,EACvB,IAAI,CAAC,gBAAgB,CAAC,GAClB,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,SAAS,CAAC,KAAK,EAE5B,CACJ,CAEA,mBAAmB,CAAE,CAAE,CACf,AAAoB,GAApB,UAAU,MAAM,EAChB,CAAA,EAAK,IAAI,CAAC,aAAa,AAAb,EACd,IAAI,CAAC,SAAS,CAAC,kBAAmB,IAAI,CAAC,aAAa,CAAG,CAAC,GACxD,IAAI,CAAC,UAAU,CAAC,EAAK,cAAgB,iBACzC,CAEA,eAAgB,CACZ,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAK,EAAI,OAAO,EAAM,UAAU,AAAE,EACrE,CAEA,oBAAqB,CACjB,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAK,EAAI,OAAO,EAAM,gBAAgB,AAAE,EAC3E,CAEA,cAAc,CAAI,CAAE,CAChB,IAAI,CAAC,cAAc,CAAC,SAAS,CAAE,EAC3B,EAAG,OAAO,CAAC,GACX,EAAG,GAAG,CAAC,gBACX,EACJ,CAEA,IAAI,CAAG,CAAE,GAAG,CAAI,CAAE,CACd,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAI,CAAC,KAAK,CAAC,IAAI,CAAE,EAC1C,CAEA,SAAS,CAAG,CAAE,CAAI,CAAE,CAChB,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAI,CAAC,KAAK,CAAC,IAAI,CAAE,EAC1C,CAEA,YAAY,CAAI,CAAE,EAAQ,IAAI,CAAC,UAAU,EAAE,CAAE,EAAM,IAAI,CAAC,KAAK,EAAE,CAAE,CAG7D,GAFA,EAAQ,EAAI,GAER,AADJ,CAAA,EAAM,EAAI,EAAV,EACU,EAAO,CAAE,IAAI,EAAM,EAAO,EAAQ,EAAK,EAAM,CAAK,CAC5D,EAAQ,IAAI,CAAC,iBAAiB,CAAC,GAC/B,EAAM,IAAI,CAAC,iBAAiB,CAAC,GAC7B,IAAK,IAAI,EAAI,EAAM,GAAG,CAAE,GAAK,EAAI,GAAG,CAAE,EAAE,EAAG,CACvC,IAAI,EAAK,GAAK,EAAM,GAAG,CAAG,EAAM,GAAG,CAAG,EAClC,EAAK,GAAK,EAAI,GAAG,CAAG,EAAI,GAAG,CAAG,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CACxD,EAAK,EAAG,EAAI,EAChB,CACJ,CAEA,gBAAiB,CACb,OAAO,IAAI,CAAC,SAAS,CAAC,iBAC1B,CAgBA,KAAK,CAAI,CAAE,CAAI,CAAE,GAAG,CAAI,CAAE,CAEtB,GAAI,AAAQ,MADZ,CAAA,EAAO,IAAI,CAAC,EAAK,EAAI,IAAI,CAAC,IAAI,CAAC,EAA/B,EAEI,GAAI,aAAgB,SAChB,OAAO,EAAK,IAAI,CAAC,IAAI,CAAE,QAEvB,OAAO,CAAI,CAAC,EAAK,CAAC,KAAK,CAAC,EAAM,EAG1C,CAGA,iBAAkB,CACd,IAAI,EAAK,IAAI,CAAC,cAAc,GAC5B,GAAI,EAAG,MAAM,GAAK,IAAI,CAAE,CACpB,IAAI,CAAC,WAAW,CAAG,EACnB,IAAI,EAAI,CAAC,iBAAkB,UAAU,CACrC,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAE,EACjC,CACI,IAAI,CAAC,WAAW,CAAG,IAE3B,CAEA,aAAa,CAAI,CAAE,CACX,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,IAAI,EAAE,OAAO,CAAC,EACjD,CAEA,WAAY,CACR,IAAI,EAAI,CAAC,WAAY,UAAU,CAC/B,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAE,EACjC,CAEA,eAAe,CAAI,CAAE,CAIjB,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAK,EAChC,GAAI,EAAM,UAAU,CAChB,OAAO,EAAK,IAAI,CAAC,IAAI,CAAE,EAAM,UAAU,CAC/C,EACJ,CAEA,YAAY,CAAI,CAAE,GAAG,CAAI,CAAE,CACvB,IAAI,EAAI,EAAK,GAAG,CAAC,AAAA,GAAO,IAAI,CAAC,YAAY,CAAC,IAC1C,GAAI,CACA,OAAO,EAAK,KAAK,CAAC,IAAI,CAAE,EAC5B,QAAU,CACN,EAAE,OAAO,CAAC,AAAA,GAAK,EAAE,OAAO,GAC5B,CACJ,CAEA,gBAAiB,CACb,EAAE,IAAI,CAAC,gBAAgB,AAC3B,CAEA,eAAgB,CACP,AAAmE,GAAnE,CAAA,IAAI,CAAC,gBAAgB,CAAG,KAAK,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAG,EAAG,EAAA,GAC7D,IAAI,CAAC,gBAAgB,EAE7B,CAEA,UAAU,EAAQ,IAAI,CAAC,WAAW,CAAE,EAAM,IAAI,CAAC,UAAU,CAAE,CAGvD,GAFA,EAAQ,EAAI,GAER,AADJ,CAAA,EAAM,EAAI,EAAV,EACU,EAAO,CAAE,IAAI,EAAM,EAAO,EAAQ,EAAK,EAAM,CAAK,CAC5D,MAAO,CAAE,MAAO,EAAO,IAAK,CAAI,CACpC,CAEA,kBAAmB,CACf,IAAI,CAAC,SAAS,CAAC,gBACf,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,EAAM,KACzB,GACA,IAAI,CAAC,SAAS,CAAC,eAAgB,EAEvC,GACA,IAAI,CAAC,YAAY,CAAG,EAAE,CACtB,IAAI,CAAC,SAAS,CAAC,cACnB,CAEA,WAAW,CAAI,CAAE,CAAK,CAAE,CACpB,IAAI,CAAC,SAAS,CAAC,kBAAmB,EAAM,EAC5C,CAEA,cAAc,CAAI,CAAE,CAChB,IAAI,CAAC,SAAS,CAAC,kBAAmB,EACtC,CAEA,QAAQ,EAAM,IAAI,CAAC,KAAK,EAAE,CAAE,CACxB,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,EAChC,CAEA,qBAAsB,CAClB,IAAuB,EAAnB,EAAK,IAAI,CAAC,OAAO,AAChB,CAAA,IAAI,CAAC,eAAe,GACrB,IAAI,CAAC,eAAe,CAAG,IAAI,CAAC,YAAY,GACxC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,IACtC,EAAK,GAEL,AAAC,GACD,CAAA,EAAK,IAAI,CAAC,eAAe,CAAC,SAAS,EADvC,EAEA,IAAI,CAAC,UAAU,CAAC,YAAa,CACzB,MAAQ,EAAG,GAAG,CACd,KAAQ,EAAG,GAAG,CACd,MAAQ,EAAG,GAAG,CACd,KAAQ,EAAG,GAAG,AAClB,EACJ,CAEA,oBAAqB,CACb,IAAI,CAAC,eAAe,GACpB,IAAI,CAAC,eAAe,CAAC,OAAO,GAC5B,IAAI,CAAC,eAAe,CAAG,KACvB,IAAI,CAAC,aAAa,CAAC,aACnB,IAAI,CAAC,IAAI,CAAC,cAAe,CAAA,GAEjC,CAEA,uBAAwB,CACpB,GAAI,IAAI,CAAC,eAAe,CAIpB,OAHA,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAE,IAAI,CAAC,eAAe,EACvD,IAAI,CAAC,kBAAkB,GACvB,IAAI,CAAC,kBAAkB,GAChB,CAAA,CAEf,CAEA,OAAO,CAAA,CAAiB,CAAG,CAAE,AAC7B,CAAA,iBAAiB,CAAI,CAAE,QACnB,AAAI,AAAQ,MAAR,EAAqB,EAAa,CAAA,CAAiB,CACnD,AAAQ,GAAR,EAAkB,EAAa,CAAA,CAAiB,CAAG,EAChD,EAAa,CAAA,CAAiB,EAAI,CAC7C,CAEA,OAAO,CAAA,CAAa,CAAG,IAAK,AAC5B,CAAA,iBAAiB,CAAE,CAAE,QACjB,AAAI,AAAoB,GAApB,UAAU,MAAM,CACT,EAAa,CAAA,CAAa,CAC9B,EAAa,CAAA,CAAa,CAAG,CACxC,CAEA,aAAa,CAAS,CAAE,CACpB,IAAI,EAAM,IAAI,CAAC,IAAI,CAAC,oBAMpB,MALI,CAAC,GAAa,AAAQ,KAAA,IAAR,IACd,IAAI,CAAC,IAAI,CAAC,mBAAoB,KAAA,GAC1B,AAAC,IAAI,CAAC,YAAY,EAClB,IAAI,CAAC,aAAa,CAAC,KAEpB,CACX,CAEA,aAAa,CAAG,CAAE,CACd,OAAO,IAAI,CAAC,IAAI,CAAC,mBAAoB,EACzC,CAEA,gBAAiB,CACb,IAAI,CAAC,SAAS,CAAC,mBACnB,CAEA,sBAAsB,CAAE,CAAE,CAAO,CAAE,CAC/B,IAAI,EAAM,AAAA,CAAA,IAAI,CAAC,KAAK,GAAK,KAAO,IAAA,EAC5B,CAAC,mCAAmC,EAAE,AAAA,EAAI,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CACxE,KAAO,EAAU,OAAS,AAAA,EAAY,IAAI,CAAC,WAAW,GAAI,GAAG,WAAW,GAFlE,MAGC,CAAA,EAAG,GAAG,CAAG,CAAA,EAAK,IAAM,EAAG,GAAG,CAAG,KACpC,EAAS,IAAI,CAAC,IAAI,CAAC,2BAKvB,OAJI,GACA,CAAA,EAAS,EAAO,IAAI,CAAC,IAAI,CAAE,IAAI,CAAE,EAAjC,GACY,CAAA,GAAM,IAAM,EAAS,IAAjC,EAEG,CACX,CAMA,cAAc,CAAI,CAAE,CAAG,CAAE,CAAG,CAAE,CAAI,CAAE,CAChC,GAAI,EAAM,EAAG,CACT,IAAI,EAAI,IAAI,CAAC,WAAW,AACnB,CAAA,IAAI,CAAC,aAAa,CAYnB,EAAE,OAAO,CAAC,AAAA,IACF,AAAU,GAAV,EAAE,IAAI,CACN,EAAE,OAAO,CAAC,OAAO,CAAC,AAAA,IACV,CAAC,CAAC,EAAE,EAAI,GACR,CAAA,CAAC,CAAC,EAAE,EAAI,AAAQ,GAAR,EAAY,EAAM,CAAC,CAD/B,CAGJ,GACO,EAAE,GAAG,EAAI,GAChB,CAAA,EAAE,GAAG,EAAI,AAAQ,GAAR,EAAY,EAAM,CAAC,CADzB,CAGX,IArBA,EAAE,IAAI,CAAC,CACH,KAAQ,EACR,IAAQ,EACR,IAAQ,EACR,KAAQ,EACR,MAAQ,IAAI,CAAC,KAAK,EACtB,GACI,EAAE,MAAM,CArpBH,KAspBL,EAAE,KAAK,GACX,IAAI,CAAC,KAAK,CAAC,CAAA,GAcnB,CACJ,CAEA,oBAAqB,CACjB,IAAI,EAAI,IAAI,CAAC,WAAW,CACpB,EAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,AAAA,GAAK,CAAE,EAAG,EAAE,WAAW,GAAI,EAChD,EAAO,EAAE,EAAE,CAAC,GACZ,CAAC,GAAQ,AAAa,GAAb,EAAK,IAAI,CAGlB,EAAK,OAAO,CAAG,EAFf,EAAE,IAAI,CAAC,CAAE,KAAM,EAAG,QAAS,CAAE,EAIrC,CAEA,eAAgB,CACZ,IAAI,EAAI,IAAI,CAAC,WAAW,CACxB,GAAI,AAAY,GAAZ,EAAE,MAAM,CAAO,MAAO,CAAA,CAC1B,GAAE,IAAI,CAAC,gBAAgB,CAEvB,IADA,IAAmB,EAAf,EAAQ,CAAA,EACL,EAAE,IAAI,CAAC,aAAa,EAAI,GAAG,CAE9B,GAAI,AAAe,GAAf,AADJ,CAAA,EAAS,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,AAAD,EAClB,IAAI,CAAO,CAGlB,GADA,EAAO,OAAO,CAAC,OAAO,CAAC,AAAA,GAAK,CAAC,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,GAC7C,CAAC,EAAO,SACZ,KACJ,CACA,EAAQ,CAAA,EACR,IAAI,EAAM,EAAO,GAAG,CACpB,OAAQ,EAAO,IAAI,EACjB,KAAK,EACH,IAAI,CAAC,WAAW,CAAC,EAAK,EAAM,EAAO,GAAG,EACtC,KACF,MAAK,EACH,IAAI,CAAC,WAAW,CAAC,EAAO,IAAI,CAAE,EAElC,CACA,IAAI,CAAC,KAAK,CAAC,EAAO,KAAK,CAC3B,CAEA,MADA,EAAE,IAAI,CAAC,gBAAgB,CAChB,CACX,CAIA,aAAa,CAAG,CAAE,CAAI,CAAE,CACpB,IAAI,CAAC,IAAI,CAAC,EAAI,CAAG,EACjB,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,EAAK,GACjC,IAAI,CAAC,gBAAgB,CAGtB,IAAI,CAAC,YAAY,CAAC,EAAI,CAAG,CAAA,EAFzB,IAAI,CAAC,SAAS,CAAC,eAAgB,EAIvC,CAEA,YAAY,CAAG,CAAE,CACb,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAK,GACtB,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,GAC5B,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,GACnC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAK,GAC9B,IAAI,CAAC,SAAS,CAAC,eAAgB,EACnC,CAEA,YAAY,CAAG,CAAE,CAAI,CAAE,CACnB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAK,EAAG,GACzB,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,GAC5B,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,GACnC,IAAI,EAAS,CAAC,IAAI,CAAC,gBAAgB,CACnC,IAAI,CAAC,SAAS,CAAC,eAAgB,EAAK,GAC/B,IACG,IAAI,CAAC,YAAY,CAAC,MAAM,EAAI,EAC5B,IAAI,CAAC,YAAY,CAAC,EAAI,CAAG,CAAA,EAEzB,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAK,EAAG,CAAA,GAE7C,CAEA,YAAY,CAAI,CAAE,CAAG,CAAE,CACnB,GAAI,AAAe,GAAf,EAAK,MAAM,EAEX,AAAO,MAAP,GACA,CAAA,EAAM,IAAI,CAAC,WAAW,CAAC,WAAW,EADtC,EAEA,EAAM,EAAI,GAEV,IAAI,CAAC,aAAa,CAAC,EAAG,EAAK,EAAK,MAAM,EACtC,IAAI,EAAK,GAAO,IAAI,CAAC,KAAK,GAAK,IAAI,CAAC,OAAO,CAAG,IAAI,CAAC,iBAAiB,CAAC,GACjE,EAAI,EAAG,GAAG,CACd,GAAI,QAAQ,IAAI,CAAC,IAAS,AAAU,GAAV,EAAG,GAAG,CAK5B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAK,MAAM,CAAE,EAAE,EAC/B,IAAI,CAAC,WAAW,CAAC,EAAI,EAAG,QAEzB,CACH,IAAI,EAAQ,EAAK,KAAK,CAAC,MAAO,EAAK,IAAI,CAAC,IAAI,CAAC,EAAE,CAAE,EAAO,EAAG,MAAM,CAAC,EAAG,GAAG,CACpE,CAAA,EAAM,MAAM,CAAG,GACf,IAAI,CAAC,YAAY,CAAC,EAAG,EAAG,MAAM,CAAC,EAAG,EAAG,GAAG,EAAI,EAAM,KAAK,IACvD,EAAM,OAAO,CAAC,AAAA,GAAQ,IAAI,CAAC,WAAW,CAAC,EAAE,EAAG,IAC5C,IAAI,CAAC,YAAY,CAAC,EAAG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAG,IAEpC,IAAI,CAAC,YAAY,CAAC,EAAG,EAAG,MAAM,CAAC,EAAG,EAAG,GAAG,EAAI,CAAK,CAAC,EAAE,CAAG,EAAG,MAAM,CAAC,EAAG,GAAG,EAE/E,CACA,IAAI,CAAC,cAAc,CAAC,EAAK,EAAK,MAAM,EACpC,IAAI,CAAC,SAAS,CAAC,WAAY,EAAG,EAAK,GACvC,CAEA,YAAY,CAAK,CAAE,CAAG,CAAE,CAGpB,GAFA,EAAQ,IAAI,CAAC,cAAc,CAAC,EAAI,IAChC,EAAM,IAAI,CAAC,cAAc,CAAC,EAAI,IAC1B,GAAS,GAEb,GAAI,EAAM,EAAO,CAAE,IAAI,EAAM,EAAO,EAAQ,EAAK,EAAM,CAAK,CAE5D,IAAI,CAAC,aAAa,CAAC,EAAG,EAAO,EAAM,EAAO,IAAI,CAAC,gBAAgB,CAAC,EAAO,IACvE,IAAI,EAAM,IAAI,CAAC,iBAAiB,CAAC,GAC7B,EAAM,IAAI,CAAC,iBAAiB,CAAC,GAC7B,EAAO,IAAI,CAAC,IAAI,CAAC,EAAI,GAAG,CAAC,CAC7B,GAAI,EAAI,GAAG,EAAI,EAAI,GAAG,CAElB,EAAO,EAAK,MAAM,CAAC,EAAG,EAAI,GAAG,EAAI,EAAK,MAAM,CAAC,EAAI,GAAG,EACpD,IAAI,CAAC,YAAY,CAAC,EAAI,GAAG,CAAE,OACxB,CAEH,EAAO,EAAK,MAAM,CAAC,EAAG,EAAI,GAAG,EAAI,IAAI,CAAC,IAAI,CAAC,EAAI,GAAG,CAAC,CAAC,MAAM,CAAC,EAAI,GAAG,EAClE,IAAI,CAAC,YAAY,CAAC,EAAI,GAAG,CAAE,GAE3B,EAAO,EAAI,GAAG,CAAG,EACjB,IAAK,IAAI,EAAI,EAAI,GAAG,CAAG,EAAI,GAAG,CAAE,KAAM,GAAI,IAAI,CAAC,WAAW,CAAC,EAC/D,CACA,IAAI,CAAC,cAAc,CAAC,EAAO,EAAQ,EAAK,GACxC,IAAI,CAAC,SAAS,CAAC,WAAY,EAAG,EAAO,GACzC,CAEA,aAAa,CAAK,CAAE,CAAG,CAAE,CAAI,CAAE,CAC3B,IAAI,CAAC,WAAW,CAAC,EAAO,GACxB,IAAI,CAAC,WAAW,CAAC,EAAM,EAC3B,CAEA,WAAW,CAAC,CAAE,CAEV,IAAI,EAAK,AADT,CAAA,EAAI,EAAE,GAAG,CAAC,GAAK,IAAI,CAAC,CAAC,EAAG,IAAM,EAAI,EAAlC,CACU,CAAC,EAAE,CACT,EAAK,CAAC,CAAC,EAAE,CACT,EAAK,CAAC,CAAC,EAAE,CACT,EAAK,CAAC,CAAC,EAAE,CACT,EAAK,IAAI,CAAC,gBAAgB,CAAC,EAAI,GAC/B,EAAK,IAAI,CAAC,gBAAgB,CAAC,EAAI,GAGnC,OAFA,IAAI,CAAC,YAAY,CAAC,EAAI,EAAI,GAC1B,IAAI,CAAC,YAAY,CAAC,EAAI,EAAI,GACnB,CACX,CAEA,iBAAiB,CAAK,CAAE,CAAG,CAAE,CAOzB,GANmB,EAAf,AAAS,MAAT,EAAuB,IAAI,CAAC,KAAK,GACxB,EAAI,GAKb,CAHa,EAAb,AAAO,MAAP,EAAmB,IAAI,CAAC,WAAW,GAC5B,EAAI,IAEL,EAAO,CAAE,IAAI,EAAM,EAAO,EAAQ,EAAK,EAAM,CAAK,CAS5D,OAAO,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC,EAAO,EAC3C,CAEA,eAAe,CAAE,CAAE,CAAE,CAAE,CAAO,CAAE,CAAQ,CAAE,CACtC,EAAK,EAAI,GACT,EAAK,EAAI,GACT,IAAI,EAAO,IAAI,CAAC,gBAAgB,CAAC,EAAI,GACrC,IAAI,CAAC,eAAe,CAAC,EAAM,GACvB,AAAC,GACD,IAAI,CAAC,WAAW,CAAC,EAAI,GACzB,IAAI,CAAC,kBAAkB,EAC3B,CAEA,gBAAgB,CAAI,CAAE,CAAO,CAAE,CAK3B,GAJI,AAAC,IAAI,CAAC,mBAAmB,EACzB,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAC/B,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,EAAM,GAChC,IAAI,CAAC,mBAAmB,GACpB,IAAI,CAAC,gBAAgB,GAAI,GAAI,CAC7B,UAAU,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,GACzD,CAAE,KAAM,CAAC,CACb,CAEA,kBAAkB,CAAG,CAAE,CAEnB,IADA,IAAI,EAAO,EAAG,EAAI,IAAI,CAAC,IAAI,CAAE,EAAI,EAAE,MAAM,CAClC,EAAM,GAAK,EAAO,GAAG,CACxB,IAAI,EAAM,CAAC,CAAC,EAAK,CAAC,MAAM,CACxB,GAAI,GAAO,EACP,MACJ,GAAO,EAAM,EACb,GACJ,CACA,MAAO,CAAE,IAAK,EAAM,IAAK,CAAI,CACjC,CAEA,kBAAkB,CAAG,CAAE,CAAG,CAAE,CACxB,IAAI,EAAM,EAAG,EAAI,IAAI,CAAC,IAAI,CAAE,EAAI,KAAK,GAAG,CAAC,EAAK,EAAE,MAAM,CAAG,GAAI,EAAI,EACjE,GAAI,EAAI,EACJ,OAAO,EACX,KAAO,EAAE,GAAK,GACV,GAAO,CAAC,CAAC,EAAE,CAAC,MAAM,CAAG,EACzB,OAAO,EAAM,KAAK,GAAG,CAAC,EAAK,CAAC,CAAC,EAAE,CAAC,MAAM,CAC1C,CAEA,eAAe,CAAG,CAAE,QAChB,AAAI,EAAM,EACC,EACJ,KAAK,GAAG,CAAC,EAAK,IAAI,CAAC,WAAW,GACzC,CAEA,iBAAiB,CAAG,CAAE,CAClB,IAAI,EAAI,IAAI,CAAC,WAAW,CAAC,WAAW,GAMpC,OALI,AAAO,MAAP,GACA,CAAA,EAAM,CAAA,EACV,EAAM,EAAI,GACV,EAAM,IAAI,CAAC,cAAc,CAAC,GAC1B,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,GACtB,GAAO,CAClB,CAEA,eAAe,CAAM,CAAE,CAAK,CAAE,EAAM,CAAC,CAAE,CAMnC,GALA,IAAI,CAAC,MAAM,CAAG,KACd,IAAI,CAAC,MAAM,CAAG,KAEd,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,AAAA,GAAK,EAAE,YAAY,CAAC,EAAQ,EAAO,IAEhD,IAAI,CAAC,SAAS,CAAE,CAChB,IAAI,EAAM,IAAI,CAAC,iBAAiB,CAAC,KAAK,GAAG,CAAC,EAAQ,EAAS,IAAQ,GAAG,CACtE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,EAC5B,CACJ,CAEA,eAAe,CAAI,CAAE,CAAY,CAAE,CAC/B,IAAI,EAAM,IAAI,CAAC,YAAY,CAAC,KAAM,EAClC,GAAE,IAAI,CAAC,iBAAiB,CACxB,GAAI,CACA,OAAO,EAAK,IAAI,CAAC,IAAI,CACzB,QAAU,CACN,EAAE,IAAI,CAAC,iBAAiB,CACxB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAK,CAAA,EAAO,CAAA,GAClC,EAAI,OAAO,EACf,CACJ,CAEA,aAAa,CAAI,CAAE,CACf,EAAE,IAAI,CAAC,aAAa,CACpB,GAAI,CACA,OAAO,EAAK,IAAI,CAAC,IAAI,CACzB,QAAU,CACN,EAAE,IAAI,CAAC,aAAa,AACxB,CACJ,CAEA,gBAAgB,CAAE,CAAE,CAChB,IAAI,EAAU,CAAA,EACd,IAAI,CAAC,gBAAgB,CAAC,GACtB,IAAI,EAAO,IAAI,CAAC,mBAAmB,AAE/B,CAAA,IAAI,CAAC,YAAY,EACjB,CAAA,EAAG,SAAS,CAAG,CAAA,CADnB,EAEA,IAAI,CAAC,YAAY,CAAG,CAAA,EAEpB,IAAI,EAAM,AAAA,EAAa,UAAU,CAAC,GAC9B,EAAK,IAAI,CAAC,WAAW,CACrB,EAAc,CAAA,EAClB,EAAG,IAAI,CAAC,GAER,IAAK,IAAI,EAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAE,EAAE,GAAK,GAAI,CACxC,IAAI,EAAK,IAAI,CAAC,MAAM,CAAC,EAAE,CACnB,EAAI,EAAG,UAAU,CAAC,GAWtB,GAVI,aAAa,OACb,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,EAAE,CAAE,CAAC,CAAC,EAAE,EACjC,EAAU,CAAA,GAEL,EACL,EAAU,EAAc,CAAA,EAEnB,EAAG,cAAc,EAAI,AAAa,GAAb,EAAG,MAAM,EACnC,CAAA,EAAU,IAAI,CAAC,iBAAiB,CAAC,EAAG,cAAc,CAAC,EAAE,CAAE,EAAG,cAAc,CAAC,EAAE,CAAA,EAE3E,EACA,KACR,CAsBA,OApBK,IACG,CAAC,GACG,EAAG,MAAM,CAAG,IACZ,IAAI,CAAC,WAAW,CAAC,EAAG,IAAI,CAAC,KAAK,IAAI,GAAK,gBAAiB,CAAA,GACxD,EAAU,CAAA,GAGlB,EAAG,MAAM,CAAC,EAAG,EAAG,MAAM,GAGtB,IAAI,CAAC,mBAAmB,EAAI,GAAQ,AAAkB,UAAlB,OAAO,GAAwB,IAAI,CAAC,YAAY,EAEpF,CAAA,IAAI,CAAC,mBAAmB,CAAG,CAAA,EAG/B,IAAI,CAAC,SAAS,CAAC,gBAAiB,GAChC,IAAI,CAAC,gBAAgB,CAAC,MAIf,GAAW,IAAI,CAAC,YAAY,AACvC,CAEA,wBAAwB,CAAG,CAAE,CAAE,CAAE,CAAE,CAAE,CAAI,CAAE,CACnC,EACA,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,EAAK,EAAI,EAAI,MAAO,GAEtD,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,EAAK,EAAI,EAAI,MAE1D,CAEA,yBAAyB,CAAG,CAAE,CACrB,IAAI,CAAC,gBAAgB,CAGtB,IAAI,CAAC,YAAY,CAAC,EAAI,CAAG,CAAA,EAFzB,IAAI,CAAC,SAAS,CAAC,eAAgB,EAIvC,CAEA,eAAe,CAAG,CAAE,CAAK,CAAE,CACvB,IAAI,EAAK,IAAI,CAAC,OAAO,CAIrB,OAHI,aAAiB,GACjB,CAAA,EAAK,EAAM,SAAS,EADxB,EAEA,EAAQ,GAAO,EAAG,GAAG,CAAG,EAAG,GAAG,CAAG,KAC1B,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,EAAK,IAAI,CAAC,IAAI,CAAC,EAAI,CAAE,EACjE,CAEA,WAAW,CAAM,CAAE,CACf,IAAI,EAAW,IAAI,CAAC,OAAO,GAC3B,GAAI,aAAkB,OAAQ,CAC1B,IAAI,EAAM,EAAO,SAAS,CAAG,IAAI,CAAC,KAAK,GACnC,EAAM,EAAO,IAAI,CAAC,GACtB,GAAI,GAAO,EAAI,KAAK,EAAI,EAEpB,OADA,EAAI,KAAK,CAAG,EAAO,SAAS,CACrB,IAAI,CAAC,SAAS,CAAG,CAEhC,MAAO,GAAI,AAAiB,UAAjB,OAAO,EAEd,OAAO,EAAS,MAAM,CAAC,IAAI,CAAC,KAAK,GAAI,EAAO,MAAM,GAAK,CAE/D,CAEA,aAAa,CAAM,CAAE,CACjB,IAAI,EAAW,IAAI,CAAC,OAAO,GAC3B,GAAI,aAAkB,OAAQ,CAC1B,IAAI,EAAI,IAAI,CAAC,iBAAiB,CAAC,EAAU,EAAQ,IAAI,CAAC,KAAK,IAC3D,GAAI,GAAK,EAAE,KAAK,EAAI,IAAI,CAAC,KAAK,GAC1B,OAAO,CACf,MAAO,GAAI,AAAiB,UAAjB,OAAO,EAEd,OAAO,EAAS,MAAM,CAAC,IAAI,CAAC,KAAK,GAAK,EAAO,MAAM,CAAE,EAAO,MAAM,GAAK,CAE/E,CAEA,WAAW,CAAG,CAAE,CACZ,OAAO,EAAI,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,0BACV,CAAC,EAAG,EAAG,IAAM,EAAE,WAAW,GAAK,EAAE,WAAW,GACnE,CACJ,CAGA,EAAa,SAAS,CAAC,QAAQ,CAAG,EAAa,QAAQ,CACvD,EAAa,SAAS,CAAC,WAAW,CAAG,EAAa,WAAW,CAC7D,EAAa,SAAS,CAAC,eAAe,CAAG,EAAa,eAAe,CACrE,EAAa,SAAS,CAAC,OAAO,CAAG,EAAa,OAAO,CACrD,EAAa,SAAS,CAAC,WAAW,CAAG,EAAa,WAAW,CAC7D,EAAa,SAAS,CAAC,cAAc,CAAG,EAAa,cAAc,CACnE,EAAa,IAAI,CACb,EAAa,SAAS,CACtB,EAAa,SAAS,CAAC,SAAS,CAAG,EAAa,WAAW,CAC/D,EAAa,SAAS,CAAC,IAAI,CAAG,EAAa,SAAS,CAAC,WAAW,CAChE,EAAa,SAAS,CAAC,IAAI,CAAG,EAAa,SAAS,CAAC,WAAW,CAChE,EAAa,IAAI,CAAG,EAAa,WAAW,AAErC,OAAM,UAAyB,EAClC,YAAY,GAAG,CAAI,CAAE,CACjB,KAAK,IAAI,GACT,IAAI,CAAC,YAAY,CAAG,IAAI,CAAC,YAAY,CAAC,EAAG,CAAA,EAAM,UAC/C,IAAI,CAAC,IAAI,CAAC,wBAAyB,AAAA,GAAY,CAAA,EACnD,CAYA,OAAO,CAAI,CAAE,CACT,EAAO,EAAK,IAAI,GAAK,IACrB,IAAI,CAAC,YAAY,CAAC,KACd,IAAI,EAAM,IAAI,CAAC,YAAY,CAAC,WAAW,GACvC,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,EAAG,CAAA,EAAM,CAAA,GACvC,IAAI,CAAC,YAAY,CAAC,EAAG,EAAK,GAC1B,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,EAAK,MAAM,CAAE,CAAA,EAAM,CAAA,GACjD,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,EAAG,EAAG,EAAK,MAAM,CAAG,GACzD,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,EAAG,EAAG,EAAK,MAAM,CAAG,EAAG,MAAO,oBACpE,EACJ,CAEA,eAAe,CAAG,CAAE,CAChB,OAAO,KAAK,GAAG,CAAC,EAAI,IAAI,CAAC,YAAY,EACrB,KAAK,GAAG,CAAC,EAAK,IAAI,CAAC,WAAW,IAClD,CACJ,COjmCA,IAAI,EAAO,OAAO,OAEX,OAAM,UAAoB,EAC7B,OAAO,QAAU,CAAC,CAAE,AAEpB,aAAY,GAAG,CAAI,CAAE,CACjB,KAAK,IAAI,GACT,IAAI,CAAC,KAAK,CAAG,AAAA,EAAI,QAAQ,CAAC,kCAC1B,IAAI,CAAC,UAAU,GAAG,WAAW,CAAC,IAAI,CAAC,KAAK,CAC5C,CAEA,mBAAoB,CAChB,OAAO,IAAI,CAAC,KAAK,AACrB,CAEA,eAAgB,CACZ,MAAO,aACX,CAEJ,CAEA,IAAI,EAAqB,AAAA,EAAa,MAAM,CAAC,KAAM,CAC/C,mBAAqB,EACrB,iBAAqB,EACrB,SAAqB,EACrB,OAAqB,EACrB,eA+EJ,WAEe,AADE,IAAI,AACA,CAAC,EAAK,CACvB,EAFa,IAAI,CAEF,GACnB,EAlFI,gBAwEJ,WAEe,AADE,IAAI,AACA,CAAC,EAAK,CACvB,EAFa,IAAI,CAEF,EACnB,EA3EI,MAAqB,EACrB,OA0FJ,WAGI,AADW,AADE,IAAI,AACA,CAAC,EAAK,CAClB,IAAI,EACb,CA7FA,GAyDA,SAAS,IAGL,EAFa,IAAI,CAEF,AADJ,AADE,IAAI,AACA,CAAC,EAAK,CACH,aAAa,CAAG,EACxC,CAEA,SAAS,IAGL,EAFa,IAAI,CAEF,AADJ,AADE,IAAI,AACA,CAAC,EAAK,CACH,aAAa,CAAG,EACxC,CAcA,SAAS,IAEL,IAAI,EAAO,AADE,IAAI,AACA,CAAC,EAAK,AACjB,AAAsC,EAAA,IAAtC,EAAK,QAAQ,CAAC,EAAK,aAAa,GAClC,EAAK,IAAI,EAEjB,CAQA,SAAS,EAAO,CAAM,CAAE,CAAK,EACzB,IAAI,EAAO,CAAM,CAAC,EAAK,CAEnB,EAAW,IAAI,AADR,EAAK,MAAM,CAAC,iBAAiB,GAChB,gBAAgB,CAAC,oBAAoB,CACzD,EAAI,EAAS,MAAM,CACvB,EAAQ,EAAK,aAAa,CAAI,AAAA,CAAA,EAAS,EAAK,CAAA,EAAK,EACjD,EAAS,OAAO,CAAC,AAAA,IACb,IAAI,EAAU,EAAG,OAAO,CAAC,KAAK,EAAI,CAC9B,CAAA,GAAS,CAAA,EAAK,YAAY,CAAG,CAAjC,EACA,AAAA,EAAI,SAAS,CAAC,EAAI,EAAS,WAC/B,GACA,EAAK,YAAY,CAAC,cAAc,CAAC,CAAE,MAAO,SAAU,EACxD,CAzGA,EAAmB,cAAc,CAAG,CAAE,WAIlC,OADA,AADW,AADE,IAAI,AACA,CAAC,EAAK,CAClB,IAAI,GACF,CAAA,CACX,EAAG,CAsGH,AAAA,EAAa,WAAW,CAAC,CACrB,WAAY,SAAS,CAAI,EACrB,EAAK,MAAM,CAAG,IAAI,CAClB,AAvGD,SAAmB,CAAA,OACtB,CAAM,CAAA,MACN,CAAK,CAAA,SACL,CAAQ,CACX,CAAG,CAAC,CAAC,EACF,IAAI,EAAa,IAAI,EACrB,EAAW,QAAQ,CAAC,cACpB,EAAM,OAAO,CAAC,CAAC,EAAO,KAClB,IAAI,EAAQ,CACQ,CAAA,UAAhB,OAAO,IACP,EAAQ,EAAM,KAAK,CACnB,EAAQ,EAAM,KAAK,EAEvB,IAAI,EAAK,AAAA,EAAI,QAAQ,CAAC,CAAC,yCAAyC,EAAE,AAAA,EAAI,UAAU,CAAC,GAAO;AAC1C,sDAAA,EAAE,EAAM,EAAE,EAAE,AAAA,EAAI,UAAU,CAAC,GAAO,MAAM,CAAC,EACvF,EAAW,GAAG,CAAC,EACnB,GAEA,CAAM,CAAC,EAAK,CAAG,CACX,MAAO,EACP,OAAQ,EACR,SAAU,EACV,OACI,EAAW,OAAO,GAClB,CAAM,CAAC,EAAK,CAAG,IACnB,CACJ,EAEA,IAAI,EAAgB,SAAS,aAAa,CACtC,EAAQ,EAAO,KAAK,CACxB,AAAA,EAAI,EAAE,CAAC,EAAW,iBAAiB,GAAI,CACnC,MAAO,AAAA,IACH,EAAc,KAAK,GACnB,IAAI,EAAO,EAAG,MAAM,CACf,AAAA,EAAI,QAAQ,CAAC,EAAM,qBACxB,EAAO,EAAQ,CAAC,EAAK,OAAO,CAAC,KAAK,EAClC,EAAa,IAAI,CAAC,GACtB,CACJ,GACA,EAAM,aAAa,CAAC,EAAW,UAAU,IACzC,EAAO,EAAQ,GAEf,EAAO,UAAU,CAAC,GAClB,EAAW,gBAAgB,CAAC,YAAa,KACrC,EAAO,SAAS,CAAC,EACrB,EACJ,EAyDkB,EACd,CACJ,GC1HA,IAAI,EAAc,EAAG,EAAoB,KACzC,SAAS,IAAsB,EAAc,IAAK,CAElD,IAAI,EAAW,AAAA,EAAI,QAAQ,CAAC,iCAExB,EAAQ,CAEL,OAAM,UAAoB,EAE7B,OAAO,QAAU,CACb,OAAuB,KACvB,MAAuB,KACvB,aAAuB,CAAA,EACvB,MAAuB,IAC3B,CAAE,AAEF,aAAY,GAAG,CAAI,CAAE,CACjB,KAAK,IAAI,GAET,IAAI,CAAC,MAAM,CAAG,IAAI,CAAC,CAAC,CAAC,MAAM,CAC3B,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,CAAC,CAAC,KAAK,CACzB,IAAI,CAAC,YAAY,CAAG,IAAI,CAAC,CAAC,CAAC,YAAY,CAEvC,IAAI,CAAC,EAAE,CAAG,CAAC,YAAY,EAAE,EAAE,EAAA,CAAO,CAClC,IAAI,CAAC,SAAS,CAAG,CAAC,YAAY,EAAE,EAAA,CAAO,CACvC,IAAI,CAAC,uBAAuB,CAAG,AAAA,EAAQ,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,GAEpE,IAAI,CAAC,UAAU,GAAG,QAAQ,CAAG,EAC7B,IAAI,CAAC,UAAU,GAAG,SAAS,CAAG,oHAK9B,IAAI,CAAC,gBAAgB,CAAC,CAClB,UAAe,IAAI,CAAC,WAAW,AACnC,GAEA,IAAI,CAAC,mBAAmB,CAAG,CACvB,UAAY,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,IAAI,EAClD,QAAY,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,CACpD,EAEA,IAAI,CAAC,aAAa,CAAG,CACjB,aAA2B,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,EAC9D,aAA2B,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,EAC9D,aAA2B,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,EAC9D,cAA2B,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,EAC/D,YAA2B,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,EAC7D,gBAA2B,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,IAAI,EACjE,iBAA2B,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,IAAI,EAClE,yBAA2B,IAAI,CAAC,kCAAkC,CAAC,IAAI,CAAC,IAAI,EAC5E,wBAA2B,IAAI,CAAC,iCAAiC,CAAC,IAAI,CAAC,IAAI,EAC3E,gBAA2B,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,IAAI,EACjE,gBAA2B,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,IAAI,CACrE,EAEA,IAAI,CAAC,iBAAiB,CAAG,CACrB,UAA0B,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,EAC1D,wBAA0B,AAAA,CAAA,WAClB,IAAI,CAAC,oBAAoB,EACzB,IAAI,CAAC,kBAAkB,EAC/B,CAAA,EAAE,IAAI,CAAC,IAAI,CACf,EAEA,IAAI,EAAS,IAAI,CAAC,MAAM,AACxB,CAAA,IAAI,CAAC,MAAM,CAAG,KACV,GACA,IAAI,CAAC,SAAS,CAAC,EAAQ,IAAI,CAAC,CAAC,CAAC,KAAK,EAEvC,AAAA,EAAI,EAAE,CAAC,IAAI,CAAC,oBAAoB,GAAI,SAAU,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,GACvE,AAAA,EAAI,EAAE,CAAC,IAAI,CAAC,UAAU,GAAI,CACtB,UAAc,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,IAAI,EACpD,MAAc,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EACtC,KAAc,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EACrC,QAAc,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,EACxC,MAAc,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EACtC,MAAc,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAC/C,EACJ,CAEA,eAAgB,CACZ,MAAO,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC,CAAC,YAAY,CAAG,oBAAsB,GAAA,CAAI,AACzE,CAEA,MAAM,CAAW,CAAE,CACf,IAAI,CAAC,UAAU,GAAG,KAAK,EAW3B,CAEA,KAAK,CAAK,CAAE,CAGZ,CAEA,sBAAuB,CACnB,OAAO,IAAI,CAAC,UAAU,GAAG,UAAU,AACvC,CAEA,oBAAqB,CACjB,OAAO,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,EAAE,AAC1C,CAEA,mBAAoB,CAChB,OAAO,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,UAAU,AAClD,CAEA,iBAAkB,CACd,OAAO,SAAS,cAAc,CAAC,IAAI,CAAC,SAAS,CACjD,CAEA,kBAAkB,CAAG,CAAE,CACnB,OAAO,IAAI,CAAC,iBAAiB,GAAG,UAAU,CAAC,EAAI,EAAI,IACvD,CAEA,oBAAqB,CAEjB,IAAI,EAAM,IAAI,CAAC,oBAAoB,GAC/B,EAAK,EAAI,SAAS,CACtB,IAAI,CAAC,WAAW,GAChB,IAAI,EAAQ,IAAI,CAAC,eAAe,GAOhC,OANI,IACA,EAAM,cAAc,CAAC,CAAE,MAAO,UAAW,OAAQ,SAAU,GACvD,EAAM,UAAU,CAAG,EAAI,WAAW,CAAG,GACrC,CAAA,EAAI,UAAU,CAAG,CAAA,GAGlB,GAAM,EAAI,SAAS,AAC9B,CAEA,aAAc,CACV,OAAO,SAAS,aAAa,GAAK,IAAI,CAAC,UAAU,EACrD,CAEA,UAAU,CAAM,CAAE,CAAK,CAAE,CACjB,IAAW,IAAI,CAAC,MAAM,GACtB,IAAI,CAAC,MAAM,GACP,IAAI,CAAC,WAAW,EAAI,CAAC,IAAI,CAAC,CAAC,CAAC,YAAY,GACxC,IAAI,CAAC,WAAW,CAAC,OAAO,GACxB,IAAI,CAAC,WAAW,CAAG,MAEvB,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,IAAI,CAAC,aAAa,EAClD,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,IAAI,CAAC,iBAAiB,GAE1D,IAAI,CAAC,MAAM,CAAG,EACV,IACA,EAAO,gBAAgB,CAAC,IAAI,CAAC,aAAa,EACtC,IAAI,CAAC,WAAW,IAChB,EAAO,gBAAgB,CAAC,IAAI,CAAC,iBAAiB,EAE9C,IAAI,CAAC,CAAC,CAAC,YAAY,CACnB,IAAI,CAAC,WAAW,CAAG,EAAO,WAAW,CAErC,IAAI,CAAC,WAAW,CAAG,EAAO,YAAY,CAAC,GAAS,CAAC,EAAO,WAAW,CAAE,CAAA,EAAO,cAEhF,IAAI,CAAC,aAAa,GAClB,IAAI,CAAC,WAAW,CAAC,CAAA,GACjB,IAAI,CAAC,aAAa,IAE1B,CAEA,kBAAkB,EAAM,CAAC,CAAE,CACvB,IAAI,EAAM,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAC7B,EAAO,IAAI,CAAC,iBAAiB,CAAC,GAC9B,EAAM,IAAI,CAAC,oBAAoB,GAC/B,EAAS,KAAK,KAAK,CAAC,EAAK,SAAS,CAAG,EAAI,YAAY,CAAG,EAAI,EAAK,YAAY,CAAG,GAChF,EAAM,KAAK,KAAK,CAAC,EAAK,SAAS,EAC/B,EAAS,KAAK,KAAK,CAAC,EAAK,SAAS,CAAG,EAAI,YAAY,CAAG,EAAK,YAAY,CACzE,AAAO,CAAA,GAAP,EAAU,EAAI,SAAS,CAAG,EACrB,AAAO,GAAP,EAAU,EAAI,SAAS,CAAG,EAC9B,EAAI,SAAS,CAAG,CACzB,CAEA,eAAgB,CACZ,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAC7C,CAEA,aAAa,CAAG,CAAE,CACd,IAAI,EAAO,IAAI,CAAC,iBAAiB,CAAC,GAAM,EAAM,IAAI,CAAC,oBAAoB,EACvE,CAAA,EAAI,SAAS,CAAG,KAAK,KAAK,CAAC,EAAK,SAAS,CAAG,EAAI,YAAY,CAAG,EAAI,EAAK,YAAY,CAAG,EAE3F,CAEA,mBAAmB,CAAI,CAAE,CACrB,IAAI,CAAC,kBAAkB,GAAG,SAAS,CAAG,CAC1C,CAEA,mBAAoB,CAChB,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,CACjC,CAEA,aAAc,CACV,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,IAAI,CAC/B,CAEA,OAAO,CAAK,CAAE,CACV,IAAI,EAAQ,IAAI,CAAC,oBAAoB,GACjC,EAAS,EAAM,SAAS,CACxB,EAAK,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAE,OAAQ,IAAI,CAAC,MAAM,AAAC,GAClD,EAAK,IAAI,EAAgB,CAAE,MAAO,CAAM,GAM5C,OALA,IAAI,CAAC,UAAU,GAAG,WAAW,CAAC,EAAG,UAAU,IAC3C,EAAG,QAAQ,CAAC,IAAI,CAAE,GAClB,EAAM,SAAS,CAAG,EAClB,EAAG,oBAAoB,GAAG,SAAS,CAAG,EACtC,IAAI,CAAC,KAAK,GACH,CACX,CAEA,QAAS,CACL,OAAO,IAAI,CAAC,MAAM,CAAC,CAAA,EACvB,CAEA,OAAO,CAAO,CAAE,CACZ,OAAO,IAAI,CAAC,MAAM,CAAC,CAAA,EACvB,CAEA,aAAc,CACV,AAAA,EAAI,QAAQ,CAAC,IAAI,CAAC,eAAe,GAAI,cACzC,CAEA,YAAY,CAAK,CAAE,CACX,IAAI,CAAC,CAAC,CAAC,YAAY,EAAE,CAAA,EAAQ,CAAA,CAAjC,EACA,IAAI,EAAW,IAAI,CAAC,KAAK,CAAC,cAAc,KAAO,IAAI,CACnD,GAAI,AAAC,GAAU,GAGX,GAAY,CAAC,IAAI,CAAC,CAAC,CAAC,YAAY,EAAI,IAAI,CAAC,WAAW,IACpD,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,WAAW,IAEpE,IAAI,EAAK,IAAI,CAAC,MAAM,CAAC,OAAO,CAI5B,IAAI,IAAI,CAAC,UAAU,GAAG,gBAAgB,CAAC,kBAAoB,IAAI,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,AAAA,IAChF,EAAG,EAAE,CAAG,GACR,EAAG,SAAS,CAAG,EACnB,GAGI,AAAwB,MAAxB,IAAI,CAAC,eAAe,EACpB,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,eAAe,EAI9C,IAAI,CAAC,eAAe,EAAI,EAAG,GAAG,GAC9B,IAAI,CAAC,eAAe,CAAG,EAAG,GAAG,CAC7B,IAAI,CAAC,oBAAoB,CAAC,EAAG,GAAG,GAGpC,IAAI,CAAC,SAAS,CAAC,gBAAiB,EAAG,GAAG,CAAE,EAAG,GAAG,EAC9C,IAAI,CAAC,uBAAuB,CAAC,GACjC,CAEA,aAAa,CAAG,CAAE,CACd,IAAI,EAAO,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,EAAK,IAAI,CAAC,WAAW,EAGvD,EAAM,EAAK,OAAO,CAAC,iBAMvB,OALI,GAAO,GACP,CAAA,EAAO,EAAK,MAAM,CAAC,EAAG,EAAM,IACtB,QAAU,IAAI,CAAC,SAAS,CAAG,IAC3B,EAAK,MAAM,CAAC,EAAM,GAH5B,EAKO,CACX,CAEA,eAAgB,CACZ,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAM,IACxC,CAAC,kBAAkB,EAAE,IAAI,CAAC,YAAY,CAAC,GAAG,MAAM,CAAC,EACnD,IAAI,CAAC,IACX,CAEA,oBAAoB,CAAC,CAAE,CAAC,CAAE,CA0BtB,IAAI,EAAO,IAAI,CACX,EAAM,AA1BV,SAAS,EAAS,CAAE,CAAE,CAAE,EACpB,GAAI,GAAM,EACN,OAAO,EACX,IAAI,EAAM,KAAK,KAAK,CAAC,AAAC,CAAA,EAAK,CAAA,EAAM,GAC7B,EAAM,EAAK,iBAAiB,CAAC,GAC7B,EAAM,EAAI,SAAS,QAEvB,AAAI,AADM,EAAK,EAAI,YAAY,CACtB,EACE,EAAS,EAAM,EAAG,GACzB,EAAI,EACG,EAAS,EAAI,EAAM,GACvB,CACX,EAcmB,EAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAG,GAC5C,EAAM,AAdV,SAAS,EAAQ,CAAE,CAAE,CAAE,EACnB,GAAI,GAAM,EACN,OAAO,EACX,IAAI,EAAM,KAAK,KAAK,CAAC,AAAC,CAAA,EAAK,CAAA,EAAM,GAC7B,EAAK,EAAK,WAAW,CAAC,EAAK,UAE/B,AAAI,AADK,EAAK,WAAW,CAAC,EAAK,EAAM,GAC9B,CAAC,CAAG,EACA,EAAQ,EAAM,EAAG,GACxB,EAAI,EAAG,CAAC,CACD,EAAQ,EAAI,EAAM,GACtB,CACX,EAGkB,EAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAI,CAAC,MAAM,EACjD,MAAO,CAAE,IAAK,EAAK,IAAK,CAAI,CAChC,CAEA,YAAY,CAAG,CAAE,CAAG,CAAE,CAClB,IAAI,EAAM,IAAI,CAAC,iBAAiB,GAAG,qBAAqB,GACpD,EAAM,IAAI,CAAC,iBAAiB,CAAC,GACjC,MAAO,CACH,EAAG,AApVf,SAAkB,CAAG,CAAE,CAAG,EACtB,IAAI,EAAQ,SAAS,WAAW,GAChC,EAAM,kBAAkB,CAAC,GACzB,IAAI,EAAa,SAAS,gBAAgB,CAAC,EAAK,WAAW,SAAS,EAChE,EAAM,EACV,KAAO,EAAW,QAAQ,IAAI,CAC1B,IAAI,EAAO,EAAW,WAAW,CAC7B,EAAO,EAAK,SAAS,CAAC,MAAM,CAChC,GAAI,EAAM,GAAQ,EAAK,CACnB,EAAM,QAAQ,CAAC,EAAM,EAAM,GAC3B,EAAM,MAAM,CAAC,EAAM,EAAM,GACzB,KACJ,CACA,GAAO,CACX,CACA,OAAO,EAAM,qBAAqB,GAAG,KAAK,AAC9C,EAoUwB,EAAK,GAAO,EAAI,IAAI,CAChC,EAAG,EAAI,SAAS,CAChB,EAAG,EAAI,YAAY,AACvB,CACJ,CAEA,eAAgB,CACZ,OAAO,KAAK,KAAK,CAAC,IAAI,CAAC,oBAAoB,GAAG,YAAY,CAAG,IAAI,CAAC,iBAAiB,GAAG,UAAU,CAAC,YAAY,CACjH,CAEA,eAAe,CAAE,CAAE,CACX,AAAC,GAAI,CAAA,EAAK,IAAI,CAAC,WAAW,CAAC,SAAS,EAAxC,EACA,IAAI,EAAU,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAG,EACpC,EAAY,IAAI,CAAC,gBAAgB,GACjC,EAAW,IAAI,CAAC,eAAe,GAC/B,EAAU,AAAa,GAAb,EACR,MACA,GAAY,EACZ,MACA,KAAK,KAAK,CAAC,EAAW,EAAU,KAAO,IAC7C,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,MAAM,CAAC,qBAAqB,CAAC,EAAI,GAClE,CAIA,qBAAqB,CAAG,CAAE,CACtB,IAAI,EAAM,IAAI,CAAC,iBAAiB,CAAC,EAC7B,CAAA,GAGA,CAAA,EAAI,SAAS,CAAG,IAAI,CAAC,YAAY,CAAC,EAAlC,CAER,CAEA,qBAAqB,CAAG,CAAE,CAAM,CAAE,CAC9B,IAAI,EAAM,EAAS,SAAS,CAAC,CAAA,GAC7B,IAAI,CAAC,iBAAiB,GAAG,YAAY,CAAC,EAAK,IAAI,CAAC,iBAAiB,CAAC,IAC9D,GACA,CAAA,EAAI,SAAS,CAAG,IAAI,CAAC,YAAY,CAAC,EADtC,CAGJ,CAEA,qBAAqB,CAAG,CAAE,CACtB,AAAA,EAAI,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,GACrC,CAEA,sBAAsB,CAAE,CAAE,CAAG,CAAE,CAC3B,IAAI,CAAC,WAAW,EACpB,CAEA,qBAAsB,CAClB,IAAI,CAAC,aAAa,EACtB,CAEA,wBAAwB,CAAE,CAAE,CACxB,IAAI,CAAC,SAAS,CAAC,EAAI,uBACvB,CAEA,kBAAkB,CAAI,CAAE,CACpB,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,EAC5B,CAEA,oCAAqC,CACjC,IAAI,CAAC,oBAAoB,CAAG,CAAA,EAC5B,IAAI,CAAC,KAAK,CAAC,iBAAiB,EAChC,CAEA,mCAAoC,CAAC,CAErC,0BAA2B,CACvB,IAAI,CAAC,uBAAuB,CAAC,KACjC,CAEA,aAAa,CAAI,CAAE,CACf,OAAO,IAAI,CAAC,EAAE,CAAG,QAAU,CAC/B,CAEA,eAAe,CAAI,CAAE,CAAK,CAAE,CACxB,IAAI,EAAM,GAuCV,OAtCA,EAAM,OAAO,CAAC,AAAA,IACV,GAAI,EAAE,KAAK,EAAI,EAAE,KAAK,EAAI,EAAE,IAAI,EAAI,EAAE,IAAI,EAG1C,EApZD,CADY,EAqZO,GApZjB,KAAK,CAAG,EAAE,KAAK,EAAK,EAAE,KAAK,EAAI,EAAE,KAAK,EAAI,EAAE,IAAI,CAAG,EAAE,IAAI,CAC9D,CAAE,MAAO,EAAE,KAAK,CAAE,KAAM,EAAE,IAAI,CAAE,MAAO,EAAE,KAAK,CAAE,KAAM,EAAE,IAAI,AAAC,EAAI,EAoZ7D,IAtZW,EAsZP,EAAK,IAAI,CAAC,WAAW,CAAC,EAAE,KAAK,CAAE,EAAE,IAAI,EACrC,EAAK,IAAI,CAAC,WAAW,CAAC,EAAE,KAAK,CAAE,EAAE,IAAI,EACrC,EAAK,AAAU,GAAV,EAAE,IAAI,CAAQ,EAAK,IAAI,CAAC,WAAW,CAAC,EAAE,KAAK,CAAE,EAClD,CAAA,EAAE,KAAK,EAAI,EAAE,KAAK,CAClB,GAAO,CAAC,YAAY,EAAE,EAAK;AAClB,yBAAA,EAAE,EAAG,CAAC,CAAC;AACN,0BAAA,EAAE,EAAG,CAAC,CAAC;AACL,4BAAA,EAAE,EAAG,CAAC,CAAC;AACR,2BAAA,EAAE,EAAG,CAAC,CAAG,EAAG,CAAC,CAAC;AACjB,wBAAA,CAAC,EAET,GAAO,CAAC,YAAY,EAAE,EAAK;AAClB,yBAAA,EAAE,EAAG,CAAC,CAAC;AACN,0BAAA,EAAE,EAAG,CAAC,CAAC;AACL,4BAAA,EAAE,EAAE,IAAI,CAAG,EAAI,EAAG,CAAC,CAAG,EAAG,CAAC,CAAG,EAAG,CAAC,CAAC;AACtC,wBAAA,CAAC,CACL,EAAE,IAAI,CAAG,GAAK,EAAE,KAAK,CAAG,EAAE,KAAK,CAAG,GAClC,CAAA,GAAO,CAAC,YAAY,EAAE,EAAK;AAClB,6BAAA,EAAE,EAAG,CAAC,CAAG,EAAG,CAAC,CAAC;AACb,8BAAA,EAAE,EAAG,CAAC,CAAC;AACL,gCAAA,EAAE,EAAG,CAAC,CAAG,EAAG,CAAC,CAAG,EAAG,CAAC,CAAC;AACzB,4BAAA,CAAC,AAAD,EAER,EAAE,IAAI,CAAG,GACT,CAAA,GAAO,CAAC,YAAY,EAAE,EAAK;AAClB,6BAAA,EAAE,EAAG,CAAC,CAAC;AACN,8BAAA,EAAE,EAAG,CAAC,CAAC;AACL,gCAAA,EAAE,EAAG,CAAC,CAAC;AACR,+BAAA,EAAE,EAAG,CAAC,CAAG,EAAG,CAAC,CAAC;AACjB,4BAAA,CAAC,AAAD,GAGpB,GACO,EAAM,CAAC,SAAS,EAAE,IAAI,CAAC,YAAY,CAAC,GAAM,sBAAsB,EAAE,EAAK,uBAAuB,EAAE,EAAK,EAAE,EAAE,EAAI,MAAM,CAAC,CAAG,IAClI,CAEA,kBAAmB,CACf,OAAO,IAAI,CAAC,oBAAoB,GAAG,UAAU,CAAC,MAAM,CAAG,CAC3D,CAEA,wBAAwB,CAAI,CAAE,CAAK,CAAE,CACjC,IAAI,EAAO,IAAI,CAAC,cAAc,CAAC,EAAM,MAAM,OAAO,CAAC,GAAS,EAAQ,CAAE,EAAO,EAC7E,GAAI,EAAM,CACN,IAAI,EAAM,AAAA,EAAI,QAAQ,CAAC,GACnB,EAAM,SAAS,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,GACpD,CAAA,EAAM,EAAI,WAAW,CAAC,GAAO,IAAI,CAAC,oBAAoB,GAAG,WAAW,CAAC,GACrE,IAAI,CAAC,kBAAkB,EAC3B,MACI,IAAI,CAAC,uBAAuB,CAAC,EAErC,CAEA,wBAAwB,CAAI,CAAE,CAC1B,AAAA,EAAI,KAAK,CAAC,SAAS,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,KACpD,IAAI,CAAC,kBAAkB,EAC3B,CAEA,oBAAqB,CACjB,IAAI,EAAQ,IACL,IAAI,CAAC,oBAAoB,GAAG,gBAAgB,CAAC,iCACnD,CAAC,GAAG,CAAC,AAAA,GAAM,EAAG,OAAO,CAAC,YAAY,EACnC,IAAI,CAAC,SAAS,CAAC,EAAM,MAAM,CAAG,EAAG,2BACjC,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,aAAa,CAAG,EAAM,IAAI,CAAC,IACzD,CAIA,aAAc,CACV,IAAI,CAAC,SAAS,CAAC,KACnB,CAEA,WAAY,CACR,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,IAAI,CAAE,CAAA,GAC5B,AAAC,IAAI,CAAC,CAAC,CAAC,YAAY,EACpB,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,WAAW,CAAC,WAAW,IAE7D,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,iBAAiB,CACvD,CAEA,UAAW,CACH,AAAC,IAAI,CAAC,CAAC,CAAC,YAAY,EACpB,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,WAAW,IAEpE,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,IAAI,CAAC,iBAAiB,CAC1D,CAEA,wBAAwB,CAAE,CAAE,CACxB,GAAI,EAAG,OAAO,EAAI,EAAG,QAAQ,CACzB,OACJ,GAAI,AAAa,GAAb,EAAG,MAAM,CAAO,YAChB,WAAW,IAAM,IAAI,CAAC,KAAK,IAG/B,IAAI,CAAC,KAAK,GACV,EAAG,eAAe,GAClB,EAAG,cAAc,GAEjB,aAAa,GACb,IACA,EAAoB,WAAW,EApfjB,KAsfd,IAAI,EAAM,AAAA,EAAI,QAAQ,CAAC,EAAI,IAAI,CAAC,iBAAiB,IAC7C,EAAK,IAAI,CAAC,mBAAmB,CAAC,EAAI,CAAC,CAAE,EAAI,CAAC,EAC1C,EAAM,IAAI,CAAC,MAAM,CAErB,WAAW,KACP,EAAI,kBAAkB,GACtB,EAAI,GAAG,CAAC,YAAa,EAAI,iBAAiB,CAAC,EAAG,GAAG,CAAE,EAAG,GAAG,GACzD,EAAI,iBAAiB,CAAC,iBAClB,AAAe,GAAf,GACA,EAAI,mBAAmB,GACvB,AAAA,EAAI,EAAE,CAAC,OAAQ,IAAI,CAAC,mBAAmB,GAElC,AAAe,GAAf,GACL,EAAI,GAAG,CAAC,gBACR,EAAI,GAAG,CAAC,iBACR,EAAI,GAAG,CAAC,sBAEH,AAAe,GAAf,GACL,EAAI,GAAG,CAAC,qBACR,EAAI,GAAG,CAAC,qBAEY,GAAf,IACL,EAAI,GAAG,CAAC,sBACR,EAAI,GAAG,CAAC,sBACR,EAAI,GAAG,CAAC,qBACR,EAAI,GAAG,CAAC,0BAEhB,EACJ,CAEA,wBAAwB,CAAE,CAAE,CACxB,IAAI,EAAM,AAAA,EAAI,QAAQ,CAAC,EAAI,IAAI,CAAC,iBAAiB,IAC7C,EAAK,IAAI,CAAC,mBAAmB,CAAC,EAAI,CAAC,CAAE,EAAI,CAAC,EAC9C,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,EAAG,GAAG,CAAE,EAAG,GAAG,GACzE,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAC/B,IAAI,CAAC,kBAAkB,EAC3B,CAEA,sBAAsB,CAAE,CAAE,CACtB,AAAA,EAAI,GAAG,CAAC,OAAQ,IAAI,CAAC,mBAAmB,CAC5C,CAEA,YAAY,CAAE,CAAE,KAgDA,EAAA,EA/CI,EAAG,GAAG,CAAlB,CAgDD,4GAA4G,IAAI,CAAC,IA/C5G,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,KAC3B,EAAG,cAAc,GACjB,EAAG,eAAe,GAG9B,CAEA,UAAU,CAAE,CAAE,CACd,CAEA,YAAa,CACT,IAAI,CAAC,uBAAuB,EAChC,CAEA,eAAe,CAAE,CAAE,CACf,EAAG,cAAc,GACjB,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,EAChC,CAEA,kBAAmB,CACf,IAAI,EAAM,IAAI,CAAC,oBAAoB,GACnC,OAAO,IAAI,CAAC,mBAAmB,CAAC,EAAG,EAAI,SAAS,CAAG,GAAG,GAAG,AAC7D,CAEA,iBAAkB,CACd,IAAI,EAAM,IAAI,CAAC,oBAAoB,GACnC,OAAO,IAAI,CAAC,mBAAmB,CAAC,EAAI,WAAW,CAAG,EAAG,EAAI,SAAS,CAAG,EAAI,YAAY,CAAG,GAAG,GAAG,AAClG,CAEA,SAAS,CAAK,CAAE,CACZ,IAAI,EAAM,IAAI,CAAC,oBAAoB,GAC/B,EAAO,KAAK,GAAG,CAAC,IAAI,CAAC,gBAAgB,GAAK,EAAO,EAErD,CAAA,EAAI,SAAS,CAAG,AADhB,CAAA,EAAO,IAAI,CAAC,iBAAiB,CAAC,EAA9B,EACqB,SAAS,CAC9B,IAAI,CAAC,oBAAoB,CAAG,CAAA,CAChC,CAEA,WAAW,CAAK,CAAE,CACd,IAAI,EAAM,IAAI,CAAC,oBAAoB,GAC/B,EAAO,KAAK,GAAG,CAAC,IAAI,CAAC,gBAAgB,GAAK,EAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAG,EAE/E,CAAA,EAAI,SAAS,CAAG,AADhB,CAAA,EAAO,IAAI,CAAC,iBAAiB,CAAC,EAA9B,EACqB,SAAS,CAC9B,IAAI,CAAC,oBAAoB,CAAG,CAAA,CAChC,CACJ,CAMO,MAAM,UAAwB,EACjC,OAAO,QAAU,CACb,MAAO,CAAA,CACX,CAAE,AACF,EAAA,CAAc,CAAG,IAAK,AACtB,CAAA,eAAgB,CACZ,MAAO,mBAAsB,CAAA,IAAI,CAAC,CAAC,CAAC,KAAK,CAAG,QAAU,MAAA,CAC1D,CACA,eAAgB,CACZ,KAAK,CAAC,gBACN,IAAI,CAAC,aAAa,CAAG,CACjB,UAAY,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EACvC,QAAY,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CACzC,EACA,IAAI,CAAC,GAAG,CAAG,AAAA,EAAI,QAAQ,CAAC,wCACxB,AAAA,EAAI,EAAE,CAAC,IAAI,CAAC,GAAG,CAAE,YAAa,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EAC7D,CACA,SAAS,CAAC,CAAE,CAAC,CAAE,CAAI,CAAE,CAIjB,GAHA,IAAI,CAAC,GAAG,CAAC,GACT,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,EACjB,IAAI,CAAC,GAAG,CAAC,GACL,AAAQ,MAAR,EAAc,CACd,IAAI,EAAO,IAAI,CAAC,UAAU,EACtB,CAAA,IAAI,CAAC,CAAC,CAAC,KAAK,CACZ,EAAK,KAAK,CAAC,gBAAgB,CAAG,CAAA,EAAG,EAAK,QAAQ,EAAE,EAAE,EAAK,EAAE,CAAC,CAE1D,EAAK,KAAK,CAAC,mBAAmB,CAAG,CAAA,EAAG,EAAK,QAAQ,EAAE,EAAE,EAAK,EAAE,CAAC,AAErE,CACJ,CACA,aAAa,CAAE,CAAE,CAEb,GADA,IAAI,CAAC,CAAA,CAAc,CAAG,SAAS,aAAa,CACxC,EAAG,MAAM,GAAK,IAAI,CAAC,GAAG,CAAE,CACxB,IAAI,EAAQ,IAAI,CAAC,iBAAiB,GAAG,QAAQ,CAAC,EAAE,AAChD,CAAA,IAAI,CAAC,MAAM,CAAG,IAAI,CAAC,CAAC,CAAC,KAAK,CAAG,EAAG,OAAO,CAAG,EAAG,OAAO,CACpD,IAAI,CAAC,QAAQ,CAAG,IAAI,CAAC,CAAC,CAAC,KAAK,CAAG,EAAM,YAAY,CAAG,EAAM,WAAW,CACrE,IAAI,CAAC,QAAQ,CAAC,YACd,EAAG,eAAe,GAClB,AAAA,EAAI,EAAE,CAAC,OAAQ,IAAI,CAAC,aAAa,EACjC,AAAA,EAAI,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAG,qBAAuB,oBACxD,MAAW,IAAI,CAAC,CAAA,CAAc,EAC1B,IAAI,CAAC,CAAA,CAAc,CAAC,KAAK,EAEjC,CACA,WAAW,CAAE,CAAE,CACX,AAAA,EAAI,GAAG,CAAC,OAAQ,IAAI,CAAC,aAAa,EAClC,IAAI,CAAC,QAAQ,CAAC,YACd,AAAA,EAAI,UAAU,GACV,IAAI,CAAC,CAAA,CAAc,EACnB,IAAI,CAAC,CAAA,CAAc,CAAC,KAAK,GAE7B,IAAI,CAAC,CAAA,CAAc,CAAG,IAC1B,CACA,aAAa,CAAE,CAAE,CACb,IAAI,EAAO,IAAI,CAAC,UAAU,GACtB,EAAM,IAAI,CAAC,CAAC,CAAC,KAAK,CAAG,EAAK,YAAY,CAAG,EAAK,WAAW,CACzD,EAAO,AAAC,CAAA,IAAI,CAAC,CAAC,CAAC,KAAK,CAAG,EAAG,OAAO,CAAG,EAAG,OAAM,AAAN,EAAW,IAAI,CAAC,MAAM,CAE7D,EAAO,KAAK,GAAG,CAAC,GAAK,KAAK,GAAG,CAAC,GAAK,AAD1B,KAAK,GAAG,CAAC,EAAK,KAAK,GAAG,CAAC,EAAG,IAAI,CAAC,QAAQ,CAAG,IACP,GAC5C,CAAA,IAAI,CAAC,CAAC,CAAC,KAAK,CACZ,EAAK,KAAK,CAAC,gBAAgB,CAAG,CAAA,EAAG,EAAK,QAAQ,EAAE,EAAE,EAAK,EAAE,CAAC,CAE1D,EAAK,KAAK,CAAC,mBAAmB,CAAG,CAAA,EAAG,EAAK,QAAQ,EAAE,EAAE,EAAK,EAAE,CAAC,AAErE,CACJ,CVxqBA,SAAS,EAAW,CAAK,CAAE,CAAC,CAAE,CAAG,CAAE,CAAM,EACrC,GAAI,AAAgB,GAAhB,EAAM,MAAM,CACZ,OAAO,KAEX,IADA,IAA0E,EAAtE,EAAI,EAAG,EAAQ,CAAK,CAAC,EAAE,CAAE,EAAW,EAAE,IAAI,CAAC,EAAK,GAAQ,EAAW,EAChE,EAAE,EAAI,EAAM,MAAM,EAAO,CAAA,EAAM,EAAE,IAAI,CAAC,EAAK,CAAK,CAAC,EAAE,CAAA,EAAK,IAC3D,EAAW,EACX,EAAW,EACX,EAAQ,CAAK,CAAC,EAAE,EAIpB,OAFI,GACA,EAAM,MAAM,CAAC,EAAU,GACpB,CACX,CAEA,SAAS,EAAoB,CAAG,CAAE,CAAG,EACjC,GAAI,EAAI,MAAM,CAAG,EAAG,CAEhB,IADA,IAAI,EAAI,EAAI,EAAE,CAAC,IAAI,MAAM,GAAG,IAAI,CAAE,EAAI,CAAE,EAAI,GAAG,GAAI,CAC5C,EAAI,MAAM,CAAG,GAAK,EAAI,EAAE,CAAC,IAAI,MAAM,GAAG,IAAI,EAAI,GACjD,EAAE,IAAI,CAAC,EAAI,GAAG,IAClB,OAAO,EAAW,EAAG,SAAS,CAAC,EAC3B,OAAO,KAAK,GAAG,CAAC,EAAI,GAAG,CAAG,EAAE,MAAM,GAAG,GAAG,CAAG,EAAE,MAAM,GAAG,MAAM,CAAC,EACjE,EACJ,CACJ,CAEA,SAAS,EAAoB,CAAG,CAAE,CAAG,EACjC,GAAI,EAAI,MAAM,CAAG,EAAG,CAEhB,IADA,IAAI,EAAI,EAAI,EAAE,CAAC,IAAI,MAAM,GAAG,GAAG,CAAE,EAAI,CAAE,EAAI,GAAG,GAAI,CAC3C,EAAI,MAAM,CAAG,GAAK,EAAI,EAAE,CAAC,IAAI,MAAM,GAAG,GAAG,EAAI,GAChD,EAAE,IAAI,CAAC,EAAI,GAAG,IAClB,OAAO,EAAW,EAAG,SAAS,CAAC,EAC3B,OAAO,KAAK,GAAG,CAAC,EAAI,IAAI,CAAG,EAAE,MAAM,GAAG,IAAI,CAAG,EAAE,MAAM,GAAG,KAAK,CAAC,EAClE,EACJ,CACJ,CAEO,MAAM,WAAc,EAEvB,OAAO,QAAU,CACb,QAAgB,EAAE,CAClB,OAAgB,EAAE,CAClB,cAAgB,OAAO,MAAM,CAAC,MAC9B,WAAgB,QACpB,CAAE,AAEF,aAAY,GAAG,CAAI,CAAE,CACjB,KAAK,IAAI,GAET,IAAI,CAAC,OAAO,CAAG,IAAI,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,CAClC,IAAI,CAAC,MAAM,CAAG,IAAI,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAChC,IAAI,CAAC,SAAS,CAAG,OAAO,MAAM,CAAC,MAC/B,IAAI,CAAC,aAAa,CAAG,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,aAAa,AAAA,EAE7C,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,AAAA,IACjB,EAAE,KAAK,CAAG,IAAI,CACd,IAAI,CAAC,mBAAmB,CAAC,EAC7B,GAGA,IAAI,CAAC,QAAQ,CAAG,EAAE,CAClB,IAAI,CAAC,iBAAiB,CAAG,EAAE,CAI3B,IAAI,CAAC,iBAAiB,CAAG,KAGzB,IAAI,CAAC,gBAAgB,CAAG,KAGxB,IAAI,CAAC,cAAc,CAAG,CAAA,EAEtB,IAAI,CAAC,eAAe,CAAG,KAEvB,IAAI,CAAC,aAAa,CAAG,EAErB,IAAI,CAAC,YAAY,CAAG,EAEpB,IAAI,CAAC,aAAa,CAAG,KAErB,IAAI,CAAC,aAAa,CAAG,KAGrB,IAAI,CAAC,UAAU,CAAG,IAAI,EAAiB,CAAE,MAAO,IAAI,AAAC,GACrD,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,mBACpB,IAAI,CAAC,gBAAgB,CAAG,IAAI,CAAC,WAAW,CAAC,CACrC,aAAe,CAAA,EACf,OAAe,IAAI,CAAC,UAAU,CAC9B,OAAe,CAAA,CACnB,GAGI,AAAuB,GAAvB,IAAI,CAAC,OAAO,CAAC,MAAM,EACnB,IAAI,CAAC,YAAY,GAErB,IAAI,EAAQ,IAAI,CAAC,WAAW,CAAC,CAAE,OAAQ,IAAI,CAAC,OAAO,CAAC,EAAE,AAAC,GAEvD,IAAI,CAAC,GAAG,CAAC,GACT,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,gBAAgB,EAE9B,IAAI,CAAC,cAAc,CAAC,GACpB,EAAM,WAAW,EACrB,CAEA,eAAgB,CACZ,MAAO,0BACX,CAEA,oBAAoB,CAAG,CAAE,CACrB,EAAI,gBAAgB,CAAC,YAAa,KAC9B,IAAI,EAAK,IAAI,CAAC,cAAc,GAC5B,IAAI,CAAC,eAAe,CAAC,GAAK,OAAO,CAAC,AAAA,IAC1B,IAAM,GACN,IAAI,CAAC,WAAW,CAAC,EAEzB,GACA,AAAA,EAAO,IAAI,CAAC,OAAO,CAAE,GACjB,IAAI,CAAC,eAAe,KAAO,GAC3B,IAAI,CAAC,gBAAgB,CAAC,EAC9B,EACJ,CAEA,eAAe,CAAI,CAAE,CAAO,CAAE,CAC1B,EAAU,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,GAC1B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAC7B,CAEA,kBAAmB,CACX,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAK,CAAA,AAAiC,GAAjC,IAAI,CAAC,iBAAiB,CAAC,MAAM,EAC7B,IAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAA,GACtF,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAC7C,IAAI,CAAC,QAAQ,CAAG,EAAE,AACtB,CAEA,cAAe,CACX,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GAC9B,CAEA,eAAe,CAAI,CAAE,CACb,GACA,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EACzC,IAAI,CAAC,QAAQ,CAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,KAE5C,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAC5C,IAAI,CAAC,QAAQ,CAAG,IAAI,CAAC,iBAAiB,CAAC,GAAG,GAElD,CAEA,UAAU,CAAG,CAAE,CAIX,OAHI,AAAE,aAAe,GACjB,CAAA,EAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,AAAA,GAAK,EAAE,IAAI,EAAI,EAD3C,EAGO,CACX,CAEA,WAAW,CAAG,CAAE,CACZ,EAAM,IAAI,CAAC,SAAS,CAAC,GACrB,IAAI,CAAC,SAAS,CAAC,iBAAkB,GACjC,EAAI,OAAO,EACf,CAEA,aAAa,CAAG,CAAE,CAAI,CAAE,CAEpB,AADA,CAAA,EAAM,IAAI,CAAC,SAAS,CAAC,EAArB,EACI,IAAI,CAAG,EACX,EAAI,SAAS,CAAC,mBAClB,CAEA,mBAAmB,CAAG,CAAE,CACpB,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC,GAChC,IAAI,CAAC,SAAS,CAAC,iBAAkB,EACrC,CAEA,eAAe,CAAS,CAAE,CACtB,IAAI,EAAM,IAAI,CAAC,SAAS,CAAC,GAAY,EAAI,IAAI,CAAC,OAAO,CAQrD,OAPI,AAAC,GAED,CAAA,EAAM,IAAI,CAAC,YAAY,CAAC,CAAE,KAAM,CAAU,EAAA,EAE9C,AAAA,EAAO,EAAG,GACV,EAAE,OAAO,CAAC,GACV,IAAI,CAAC,kBAAkB,CAAC,GACjB,CACX,CAEA,iBAAiB,CAAG,CAAE,CAClB,IAAI,EAAI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,AAAA,IACxB,GAAI,IAAQ,EAAK,MAAO,CAAA,EACxB,IAAI,EAAS,CAAA,EAEb,OADA,EAAI,YAAY,CAAC,IAAM,EAAS,CAAA,GACzB,CACX,GACA,GAAI,EAAE,MAAM,CAAG,EAAG,CACd,IAAI,EAAM,CAAC,CAAC,EAAE,CACd,AAAA,EAAO,IAAI,CAAC,OAAO,CAAE,GACrB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAClB,IAAI,CAAC,kBAAkB,CAAC,EAC5B,MACI,IAAI,CAAC,cAAc,CAAC,YAE5B,CAEA,oBAAqB,CACjB,IAAI,EAAI,IAAI,CAAC,OAAO,CACpB,GAAI,EAAE,MAAM,CAAG,EAAG,CACd,IAAI,EAAM,EAAE,KAAK,GACjB,EAAE,IAAI,CAAC,GACP,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,EAAE,CAChC,CACJ,CAEA,wBAAyB,CACrB,IAAI,EAAI,IAAI,CAAC,OAAO,CACpB,GAAI,EAAE,MAAM,CAAG,EAAG,CACd,IAAI,EAAM,EAAE,GAAG,GACf,EAAE,OAAO,CAAC,GACV,IAAI,CAAC,kBAAkB,CAAC,EAC5B,CACJ,CAEA,cAAc,CAAG,CAAE,CAAC,CAAE,CACd,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACnB,IAAI,EAAI,IAAI,CAAC,OAAO,CACpB,OAAO,CAAC,CAAC,AAAC,CAAA,EAAE,OAAO,CAAC,GAAO,CAAA,EAAK,EAAE,MAAM,CAAC,AAC7C,CAEA,cAAc,CAAG,CAAE,CAAC,CAAE,CAElB,OADI,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACZ,IAAI,CAAC,aAAa,CAAC,EAAK,CAAC,EACpC,CAEA,gBAAgB,CAAG,CAAE,CAEjB,OADA,EAAM,IAAI,CAAC,SAAS,CAAC,GACd,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,AAAA,GAAK,EAAE,MAAM,GAAK,EAChD,CAEA,aAAa,EAAO,CAAC,CAAC,CAAE,CACpB,IAAI,EAAM,IAAI,EAAa,CAAE,GAAG,CAAI,CAAE,MAAO,IAAI,AAAC,GAKlD,OAJA,IAAI,CAAC,mBAAmB,CAAC,GACrB,AAAC,EAAK,MAAM,EACZ,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GACtB,IAAI,CAAC,SAAS,CAAC,iBAAkB,GAC1B,CACX,CAEA,YAAY,EAAO,CAAC,CAAC,CAAE,CACnB,IAAI,EAAQ,IAAI,EAAY,CAAE,GAAG,CAAI,CAAE,MAAO,IAAI,AAAC,GAInD,OAHI,AAAC,EAAK,MAAM,EACZ,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,GACxB,EAAM,QAAQ,CAAC,IAAI,CAAC,aAAa,EAC1B,CACX,CAEA,cAAc,CAAK,CAAE,CACjB,CAAE,IAAI,CAAC,gBAAgB,IAAK,IAAI,CAAC,MAAM,CAAE,CAAC,OAAO,CAAC,AAAA,GAAS,EAAM,QAAQ,CAAC,GAC9E,CAEA,cAAc,CAAK,CAAE,CACjB,GAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAG,EAAG,CACxB,IAAI,EAAK,EAAM,UAAU,GACzB,KAAO,EAAG,UAAU,EAAI,IAAI,CAAC,iBAAiB,IAC1C,EAAK,EAAG,UAAU,CAClB,IAAO,IACP,EAAG,WAAW,CAAC,EAAM,UAAU,IAC/B,IAAI,CAAC,cAAc,CAAC,GACpB,EAAM,aAAa,GACnB,IAAI,CAAC,MAAM,CAAG,CAAE,EAAO,CAE/B,CACJ,CAEA,YAAY,CAAK,CAAE,CACf,GAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAG,EAAG,CACxB,AAAA,EAAO,IAAI,CAAC,MAAM,CAAE,GACpB,IAAI,EAAS,EAAM,UAAU,GAAG,UAAU,CACtC,EAAQ,IAAI,EAAO,QAAQ,CAAC,CAAC,IAAI,CAAC,AAAA,IAClC,IAAI,EAAM,EAAG,aAAa,CAC1B,OAAO,aAAe,GACd,aAAe,GAAe,IAAQ,CAClD,GACA,EAAO,WAAW,CAAC,GACf,AAAC,AAAA,EAAI,QAAQ,CAAC,EAAO,gBACrB,CAAA,EAAQ,EAAM,aAAa,CAAC,eADhC,EAGA,EAAQ,EAAM,aAAa,CAC3B,IAAI,CAAC,cAAc,CAAC,GACpB,EAAM,aAAa,EACvB,CACJ,CAEA,iBAAkB,CACd,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CACtC,CAEA,gBAAiB,CAEb,OAAO,IAAI,CAAC,UAAU,GAAG,aAAa,CADrB,0EAErB,CAEA,gBAAiB,CACb,IAAI,EAAM,AAAC,IACP,GAAI,AAAA,EAAI,QAAQ,CAAC,EAAI,eAAgB,CACjC,IAAI,EAAQ,EAAG,aAAa,CACxB,EAAM,EAAM,oBAAoB,GACpC,MAAO,CACH,OAAQ,EAAM,MAAM,CAAC,IAAI,CACzB,MAAO,CAAC,EAAM,WAAW,CACzB,OAAQ,EAAI,SAAS,CAAG,EAAI,YAAY,CACxC,OAAQ,IAAU,IAAI,CAAC,cAAc,EACzC,CACJ,CAAO,CAEH,IAAI,EAAQ,AADC,EAAG,aAAa,CACV,CAAC,CAAC,KAAK,CACtB,EAAQ,OAAO,gBAAgB,CAAC,GAEhC,EAAI,AADC,sEACE,IAAI,CAAC,EAAQ,EAAM,gBAAgB,CAAG,EAAM,mBAAmB,EAE1E,MAAO,CAAE,EADE,CAAC,CAAC,CAAC,EAAE,CAAI,CAAA,CAAC,CAAC,CAAC,EAAE,EAAG,CAAC,CAAC,CAAC,EAAE,AAAF,EACT,EAAI,EAAG,QAAQ,CAAC,EAAE,EAAG,EAAI,EAAG,QAAQ,CAAC,EAAE,EAAG,AACpE,CACJ,EACA,OAAO,EAAI,IAAI,CAAC,cAAc,GAClC,CAEA,eAAe,CAAM,CAAE,CACnB,IAAI,CAAC,cAAc,IAAI,SAIvB,IAAI,EAAU,EAAE,CACZ,EAAS,IAAK,IAAI,CAAC,MAAM,CAAE,EAC9B,AAAA,SAAS,EAAI,CAAE,EACZ,GAAI,MAAM,OAAO,CAAC,GACd,EAAI,CAAE,CAAC,EAAE,EACT,EAAI,CAAE,CAAC,EAAE,OAET,IAAK,IAAI,EAAI,EAAO,MAAM,CAAE,EAAE,GAAK,GAC/B,GAAI,CAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAQ,EAAG,MAAM,CAAE,CACrC,EAAQ,IAAI,CAAC,CAAE,EAAG,MAAM,CAAE,CAAM,CAAC,EAAE,CAAE,EACrC,EAAO,MAAM,CAAC,EAAG,GACjB,KACJ,CAGZ,EAAG,GAEH,IAAI,EAAY,AAAA,GACL,IAAI,CAAC,SAAS,CAAC,IAAe,IAAI,CAAC,YAAY,CAAC,CAAE,KAAM,CAAW,GAI1E,EAAW,CAAC,EAAY,KACxB,IAAI,EAAI,EAAQ,SAAS,CAAC,CAAC,CAAE,EAAK,GAAK,GAAO,GAC9C,GAAI,EAAI,EAEJ,IAAI,CAAA,EAAO,MAAM,CAAG,CAAA,EAOhB,OAAO,IAAI,CAAC,WAAW,CAAC,CAAE,OAAQ,EAAU,GAAa,MAAO,CAAM,OAPnD,CAEnB,IAAI,EAAK,EAAO,GAAG,GAEnB,OADA,EAAG,SAAS,CAAC,EAAU,EAAY,IAC5B,CACX,CAIG,CAEH,IAAI,EAAK,CAAO,CAAC,EAAE,CAAC,EAAE,CAEtB,OADA,EAAQ,MAAM,CAAC,EAAG,GACX,CACX,CACJ,EAGI,EAAM,EAAE,CACR,EAAS,KACT,EAAQ,SAAS,EAAI,CAAE,EACvB,GAAI,MAAM,OAAO,CAAC,GAAK,CACnB,IAAI,EAAQ,IAAI,EAAgB,CAAE,MAAO,CAAE,CAAC,EAAE,AAAC,GAC3C,EAAS,EAAI,CAAE,CAAC,EAAE,EAClB,EAAS,EAAI,CAAE,CAAC,EAAE,EAEtB,OADA,EAAI,IAAI,CAAC,IAAM,EAAM,QAAQ,CAAC,EAAQ,EAAQ,CAAE,CAAC,EAAE,GAC5C,CACX,CAAO,CACH,IAAI,EAAQ,EAAS,EAAG,MAAM,CAAE,EAAG,KAAK,EAMxC,OALI,EAAG,MAAM,EAAE,CAAA,EAAS,CAAxB,EACA,EAAI,IAAI,CAAC,KACL,IAAI,EAAM,EAAM,oBAAoB,EACpC,CAAA,EAAI,SAAS,CAAG,EAAG,MAAM,CAAG,EAAI,YAAY,AAChD,GACO,CACX,CACJ,EAAG,GAKH,EAAO,OAAO,CAAC,AAAA,IACX,AAAA,EAAO,IAAI,CAAC,MAAM,CAAE,GACpB,EAAG,OAAO,EACd,GAEA,IAAI,EAAO,IAAI,CAAC,UAAU,GAC1B,EAAK,YAAY,CAAC,EAAK,UAAU,GAAI,EAAK,iBAAiB,EAI3D,EAAI,OAAO,GAAG,OAAO,CAAC,AAAA,GAAK,KAG3B,IAAI,CAAC,cAAc,CAAC,GAAU,IAAI,CAAC,MAAM,CAAC,EAAE,CAChD,CAEA,OAAQ,CACJ,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,KAAK,EAC5B,CAEA,cAAc,CAAK,CAAE,CACjB,IAAI,CAAC,aAAa,CAAG,CACzB,CAEA,eAAe,CAAK,CAAE,CAAO,CAAE,CAC3B,GAAI,CAAC,EAAM,YAAY,CAAE,CACrB,IAAI,EAAM,IAAI,CAAC,cAAc,EACzB,CAAA,GACA,EAAI,QAAQ,CAAC,sBAEjB,AAAA,EAAO,IAAI,CAAC,MAAM,CAAE,GACpB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GACjB,EAAM,QAAQ,CAAC,qBACnB,CACA,IAAI,CAAC,aAAa,CAAG,EACjB,AAAC,GACD,EAAM,KAAK,EACnB,CAEA,gBAAiB,CACb,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,GAC1B,CAEA,iBAAkB,CACd,IAAI,EAAQ,IAAI,CAAC,cAAc,GAC/B,OAAO,EAAQ,EAAM,MAAM,CAAG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,GAClD,CAEA,cAAc,CAAO,CAAE,CACnB,IAAI,CAAC,QAAQ,CAAC,uBACV,AAAE,aAAmB,OACrB,CAAA,EAAU,CAAE,EAAS,AAAA,EACzB,EAAQ,OAAO,CAAC,AAAA,IACZ,IAAI,CAAC,QAAQ,CAAC,eAAiB,EACnC,EACJ,CAEA,WAAY,CACR,IAAI,CAAC,QAAQ,CAAC,sBACd,IAAI,CAAC,QAAQ,CAAC,mBAClB,CACA,aAAc,CACV,IAAI,CAAC,QAAQ,CAAC,oBACd,IAAI,CAAC,QAAQ,CAAC,qBAClB,CACA,iBAAkB,CACV,IAAI,CAAC,QAAQ,CAAC,sBACd,IAAI,CAAC,SAAS,GAEd,IAAI,CAAC,WAAW,EAExB,CAEA,oBAAoB,CAAG,CAAE,CACrB,IAAI,EAAQ,IAAI,CAAC,cAAc,GAE3B,EAAM,AADE,EAAM,eAAe,GACjB,qBAAqB,GACrC,IAAI,EAAM,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,MAAM,GAAG,IAAI,CAAG,EAAE,MAAM,GAAG,IAAI,EACvE,EAAM,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,MAAM,GAAG,GAAG,CAAG,EAAE,MAAM,GAAG,GAAG,EACzE,OAAQ,GACN,IAAK,OACH,OAAO,IAAI,CAAC,oBAAoB,CAAC,EAAK,EAAK,EAAK,EAClD,KAAK,QACH,OAAO,IAAI,CAAC,qBAAqB,CAAC,EAAK,EAAK,EAAK,EACnD,KAAK,KACH,OAAO,IAAI,CAAC,kBAAkB,CAAC,EAAK,EAAK,EAAK,EAChD,KAAK,OACH,OAAO,IAAI,CAAC,oBAAoB,CAAC,EAAK,EAAK,EAAK,EACpD,CACA,OAAO,IAAI,CAAC,mBAAqB,EAAI,CAAC,EAAK,EAAK,EAAK,EACzD,CAEA,qBAAqB,CAAG,CAAE,CAAG,CAAE,CAAG,CAAE,CAAK,CAAE,CAKvC,OAAO,EAJP,EAAM,EAAI,MAAM,CAAC,AAAA,IACb,IAAI,EAAI,EAAE,MAAM,GAChB,OAAO,IAAO,GAAW,EAAE,IAAI,CAAG,EAAI,IAAI,EAAM,EAAE,GAAG,CAAG,EAAI,MAAM,EAAI,EAAI,GAAG,EAAM,EAAE,GAAG,CAAG,EAAE,MAAM,CAAG,EAAI,GAAG,AACjH,GACgC,EACpC,CAEA,sBAAsB,CAAG,CAAE,CAAG,CAAE,CAAG,CAAE,CAAK,CAAE,CAMxC,OALA,EAAI,OAAO,GAKJ,EAJP,EAAM,EAAI,MAAM,CAAC,AAAA,IACb,IAAI,EAAI,EAAE,MAAM,GAChB,OAAO,IAAO,GAAW,EAAE,IAAI,CAAG,EAAI,IAAI,EAAM,EAAE,GAAG,CAAG,EAAI,MAAM,EAAI,EAAI,GAAG,EAAM,EAAE,GAAG,CAAG,EAAE,MAAM,CAAG,EAAI,GAAG,AACjH,GACgC,EACpC,CAEA,mBAAmB,CAAG,CAAE,CAAG,CAAE,CAAG,CAAE,CAAK,CAAE,CAKrC,OAAO,EAJP,EAAM,EAAI,MAAM,CAAC,AAAA,IACb,IAAI,EAAI,EAAE,MAAM,GAChB,OAAO,IAAO,GAAW,EAAE,GAAG,CAAG,EAAI,GAAG,EAAM,EAAE,IAAI,CAAG,EAAI,KAAK,EAAI,EAAI,IAAI,EAAM,EAAE,IAAI,CAAG,EAAE,KAAK,CAAG,EAAI,IAAI,AACjH,GACgC,EACpC,CAEA,qBAAqB,CAAG,CAAE,CAAG,CAAE,CAAG,CAAE,CAAK,CAAE,CAMvC,OALA,EAAI,OAAO,GAKJ,EAJP,EAAM,EAAI,MAAM,CAAC,AAAA,IACb,IAAI,EAAI,EAAE,MAAM,GAChB,OAAO,IAAO,GAAW,EAAE,GAAG,CAAG,EAAI,GAAG,EAAM,EAAE,IAAI,CAAG,EAAI,KAAK,EAAI,EAAI,IAAI,EAAM,EAAE,IAAI,CAAG,EAAE,KAAK,CAAG,EAAI,IAAI,AACjH,GACgC,EACpC,CAIA,QAAS,CACL,OAAO,IAAI,CAAC,QAAQ,EAChB,CAAA,IAAI,CAAC,QAAQ,CAAG,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,UAAU,GAAK,KAAA,CAE9E,CAEA,OAAO,CAAG,CAAE,CACR,IAAI,CAAC,QAAQ,CAAG,EAChB,aAAa,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,UAAU,CAAE,KAAK,SAAS,CAAC,GAC3D,CAEA,mBAAmB,CAAI,CAAE,CAAO,CAAE,CAC9B,IAA+D,EAA3D,EAAO,IAAI,CAAC,mBAAmB,CAAC,GAAO,EAAQ,EAAK,KAAK,CAI7D,GAHI,AAAgB,GAAhB,EAAM,MAAM,EACZ,CAAA,EAAO,EAAK,GAAG,CAAC,CAAK,CAAC,EAAE,CAAC,AAAD,EAExB,AAAQ,MAAR,GAAgB,CAAC,EACjB,MAAM,IAAI,EAAgB,kBAE9B,OAAO,CACX,CAEA,mBAAmB,CAAI,CAAE,CAAO,CAAE,CAC9B,IAAI,EAAQ,IAAI,CAAC,mBAAmB,CAAC,EAAM,OAC3C,CAAA,EAAM,GAAG,CAAC,EAAM,KAAK,CAAC,EAAE,CAAC,CAAG,EAC5B,IAAI,CAAC,MAAM,CAAC,EAAM,KAAK,CAC3B,CAEA,oBAAoB,CAAI,CAAE,CAAM,CAAE,CAC9B,IAAI,EAAO,EAAM,EAAQ,IAAI,CAAC,MAAM,GAAI,EAAO,EAAE,CACjD,EAAO,EAAK,OAAO,CAAC,YAAa,IAAI,KAAK,CAAC,SAE3C,IADA,IAAI,EAAO,EAAE,CAAE,EAAQ,EAAE,CAClB,EAAK,MAAM,CAAG,GAAG,CACpB,IAAI,EAAO,EAAK,KAAK,EACT,CAAA,KAAR,IACA,AAAQ,MAAR,GACA,EAAK,GAAG,GACR,EAAM,EAAK,GAAG,IAET,AAAQ,KAAR,GACL,EAAO,EAAE,CACT,EAAQ,EAAE,CACV,EAAO,EAAE,CACT,EAAM,GAED,OAAO,MAAM,CAAC,EAAK,IAAU,AAAoB,UAApB,OAAO,CAAG,CAAC,EAAK,EAClD,EAAK,IAAI,CAAC,GACV,EAAM,CAAG,CAAC,EAAK,CACf,EAAK,IAAI,CAAC,IAGV,EAAM,IAAI,CAAC,GAEnB,CACA,GAAI,EAAQ,CAER,IADA,IAAI,EAAI,CAAA,CAAA,AAAU,QAAV,CAAU,EACX,EAAM,MAAM,CAAG,GAClB,EAAM,CAAG,CAAC,EAAM,KAAK,GAAG,CAAG,CAAC,EAEhC,IAAI,CAAC,MAAM,CAAC,EAChB,CACA,MAAO,CACH,MAAQ,EACR,IAAQ,EACR,KAAQ,EACR,MAAQ,EACR,KAAQ,EAAK,MAAM,CAAC,GAAO,IAAI,CAAC,IACpC,CACJ,CAEA,cAAc,CAAI,CAAE,CAChB,IAAI,EAAO,IAAI,CAAC,mBAAmB,CAAC,EACpC,QAAO,EAAK,GAAG,CAAC,EAAK,KAAK,CAAC,IAAI,CAAC,KAAK,CACrC,IAAI,CAAC,MAAM,CAAC,EAAK,KAAK,CAC1B,CAIA,iBAAiB,CAAI,CAAE,CACnB,EAAO,EAAK,OAAO,CAAC,YAAa,IAAI,KAAK,CAAC,SAE3C,IADA,IAAI,EAAM,EAAE,CACL,EAAK,MAAM,CAAG,GAAG,CACpB,IAAI,EAAI,EAAK,KAAK,EACT,CAAA,KAAL,IACI,AAAK,MAAL,EACA,EAAI,GAAG,GACA,AAAK,KAAL,EACP,EAAM,EAAE,CAER,EAAI,IAAI,CAAC,GAGrB,CACA,OAAO,EAAI,IAAI,CAAC,IACpB,CAEA,YAAY,CAAI,CAAE,CAAI,CAAE,CACpB,GAAI,CAAA,MAAE,CAAK,CAAA,IAAE,CAAG,CAAE,CAAG,IAAI,CAAC,mBAAmB,CAAC,UAC9C,AAAI,EAAM,MAAM,CAAG,EACR,EAAK,AAAC,CAAK,CAAC,EAAE,CACP,AAAwB,UAAxB,OAAO,CAAG,CAAC,CAAK,CAAC,EAAE,CAAC,CAAe,OACnC,MAFU,aAIjB,EAAK,YAEpB,CAEA,mBAAmB,CAAI,CAAE,CAAO,CAAE,CAAI,CAAE,CACpC,IAAI,EAAO,IAAI,CAAC,kBAAkB,CAAC,EAAM,GACzC,EAAK,EAAM,EACf,CAEA,mBAAmB,CAAI,CAAE,CAAO,CAAE,CAAK,CAAE,CAAI,CAAE,CACvC,GAAS,AAAC,CAAA,IAAI,CAAC,kBAAkB,CAAC,EAAM,CAAA,IAAS,EAAA,GAAO,EACxD,EAAK,OAEL,IAAI,CAAC,kBAAkB,CAAC,EAAM,GAC9B,EAAK,GAEb,CAEA,wBAAwB,CAAG,CAAE,CACzB,OAAO,OAAO,IAAI,CAAC,GAAK,IAAI,CAAC,CAAC,EAAG,KAC7B,EAAI,EAAE,WAAW,GACjB,EAAI,EAAE,WAAW,GACjB,IAAI,EAAO,AAAiB,UAAjB,OAAO,CAAG,CAAC,EAAE,CACpB,EAAO,AAAiB,UAAjB,OAAO,CAAG,CAAC,EAAE,CACxB,GAAI,GAAQ,CAAC,EAAM,OAAO,GAC1B,GAAI,GAAQ,CAAC,EAAM,OAAO,EAC1B,GAAI,CAAC,GAAQ,CAAC,EAAM,CAChB,IAAI,EAAO,IAAI,CAAC,mBAAmB,CAAC,GAChC,EAAO,IAAI,CAAC,mBAAmB,CAAC,GACpC,GAAI,GAAQ,CAAC,EAAM,OAAO,EAC1B,GAAI,GAAQ,CAAC,EAAM,OAAO,EAC9B,CACA,OAAO,EAAI,EAAI,GAAK,CAAA,CAAA,EAAI,CAAA,CAC5B,EACJ,CAEA,oBAAoB,CAAQ,CAAE,CAC1B,MAAO,WAAW,IAAI,CAAC,EAC3B,CAEA,gBAAgB,CAAO,CAAE,CAAI,CAAE,CAC3B,IAAI,EAAO,IAAI,CAAC,mBAAmB,CAAC,EAAS,CAAA,GAE7C,GADA,EAAU,EAAK,IAAI,CAAC,IAAI,CAAC,KACrB,EAAM,CACN,IAAI,EAAQ,CAAC,EACb,IAAK,IAAI,KAAK,IAAI,CAAC,uBAAuB,CAAC,EAAK,GAAG,EAC/C,CAAK,CAAC,EAAE,CAAG,CACP,KAAO,EACP,KAAO,EAAU,IAAM,EACvB,KAAO,AAAsB,UAAtB,OAAO,EAAK,GAAG,CAAC,EAAE,CAAe,OAAS,WACrD,EAEJ,EAAK,EACT,MACI,EAAK,KAEb,CAEA,cAAc,CAAI,CAAE,CAAI,CAAE,CACtB,IAAI,CAAC,aAAa,CAAC,GACnB,GACJ,CAEA,YAAY,CAAG,CAAE,CAAI,CAAE,CACnB,EAAK,EACT,CAEA,gBAAiB,CACb,MAAO,CAAC,CAAC,IAAI,CAAC,eAAe,AACjC,CAEA,kBAAmB,CACf,MAAO,CAAC,CAAC,IAAI,CAAC,iBAAiB,AACnC,CAEA,eAAgB,CACZ,IAAI,CAAC,cAAc,CAAG,CAAA,CAC1B,CAEA,WAAW,CAAS,CAAE,OAClB,CAAI,IAAI,CAAC,gBAAgB,KAErB,GACA,IAAI,CAAC,iBAAiB,CAAG,IAAI,CAAC,gBAAgB,EAAI,EAAE,CACpD,IAAI,CAAC,gBAAgB,CAAG,MAExB,IAAI,CAAC,iBAAiB,CAAG,EAAE,CACxB,CAAA,EACX,CAEA,WAAY,CACJ,IAAI,CAAC,iBAAiB,GACtB,IAAI,CAAC,gBAAgB,CAAG,IAAI,CAAC,iBAAiB,CAC9C,IAAI,CAAC,iBAAiB,CAAG,KAEjC,CAEA,cAAe,CACX,OAAO,IAAI,CAAC,gBAAgB,AAChC,CAEA,WAAY,CACR,OAAa,CAKT,GAJI,IAAI,CAAC,YAAY,EAAI,IAAI,CAAC,eAAe,CAAC,MAAM,GAChD,IAAI,CAAC,aAAa,GAClB,IAAI,CAAC,YAAY,CAAG,GAEpB,AAAsB,GAAtB,IAAI,CAAC,aAAa,EAAS,IAAI,CAAC,cAAc,CAAE,CAChD,IAAI,CAAC,aAAa,CAAG,EACrB,IAAI,CAAC,YAAY,CAAG,EACpB,IAAI,CAAC,eAAe,CAAG,KACvB,MACJ,CACA,IAAI,EAAK,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,YAAY,CAAC,CAChD,IAAI,CAAC,eAAe,CAAC,GACrB,IAAI,CAAC,YAAY,EACrB,CACJ,CAEA,SAAS,CAAK,CAAE,CAAK,CAAE,CACnB,GAAI,IAAI,CAAC,gBAAgB,GACrB,MAAO,CAAA,CACX,CAAA,IAAI,CAAC,cAAc,CAAG,CAAA,EACtB,IAAI,CAAC,eAAe,CAAG,EACvB,IAAI,CAAC,YAAY,CAAG,EACpB,IAAI,CAAC,aAAa,CAAG,EACrB,IAAI,EAAO,IAAI,CAEf,OADA,WAAW,WAAa,EAAK,SAAS,EAAI,EAAG,GACtC,CAAA,CACX,CAEA,gBAAgB,CAAE,CAAE,CAEhB,IAAI,EAAS,AADD,IAAI,CAAC,aAAa,CACX,MAAM,CAKzB,OAHI,IAAI,CAAC,iBAAiB,EACtB,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAEzB,EAAO,eAAe,CAAC,EAClC,CAEA,CAAA,CAAmB,CAAG,IAAK,AAC3B,CAAA,aAAa,CAAA,KACT,EAAO,MAAA,CAAA,KACP,CAAI,CAAA,OACJ,EAAS,CAAA,CAAA,CAAA,QACT,EAAU,CAAA,CAAA,CAAA,QACV,CAAO,CACV,CAAE,CACC,IAAI,EAAQ,IAAI,CAAC,OAAO,EAAK,CAAA,IAAI,CAAC,OAAO,CAAG,IAAI,CAAU,EACtD,EAAK,EAAM,UAAU,GACzB,EAAM,SAAS,CAAC,EAAS,cACpB,IACD,EAAG,KAAK,CAAC,cAAc,CAAC,QACxB,EAAG,KAAK,CAAC,cAAc,CAAC,OACxB,EAAG,KAAK,CAAC,cAAc,CAAC,UACxB,EAAG,KAAK,CAAC,cAAc,CAAC,SACxB,EAAG,KAAK,CAAC,cAAc,CAAC,cAExB,AAAC,GACD,CAAA,EAAO,AAAA,EAAI,UAAU,CAAC,EAD1B,EAGA,EAAM,UAAU,CAAC,GACb,EACA,IAAI,CAAC,aAAa,CAAC,EAAM,UAAU,IAEnC,IAAI,CAAC,GAAG,CAAC,GAEb,aAAa,IAAI,CAAC,CAAA,CAAmB,EACjC,GACA,CAAA,IAAI,CAAC,CAAA,CAAmB,CAAG,WAAW,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,EAAG,EAD7E,CAGJ,CAEA,mBAAoB,CACZ,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,OAAO,CAAC,UAAU,GAAG,MAAM,EAExC,CAEA,mBAAoB,CAChB,OAAO,IAAI,CAAC,UAAU,GAAG,iBAAiB,EAC9C,CAEA,cAAc,CAAE,CAAE,CACd,EAAG,KAAK,CAAC,UAAU,CAAG,SACtB,AAAA,EAAI,QAAQ,CAAC,EAAI,kBACjB,IAAI,CAAC,GAAG,CAAC,GACT,IAAI,EAAQ,IAAI,CAAC,UAAU,GAAG,qBAAqB,GAE/C,EAAO,AADC,IAAI,CAAC,aAAa,CAAC,eAAe,GAC7B,qBAAqB,GAClC,EAAc,CAAE,EAAI,AAAA,CAAA,EAAK,IAAI,CAAG,EAAK,KAAK,AAAL,EAAS,EAC9B,EAAI,AAAA,CAAA,EAAK,GAAG,CAAG,EAAK,MAAM,AAAN,EAAU,CAAE,EAChD,EAAe,CAAE,EAAI,AAAA,CAAA,EAAM,IAAI,CAAG,EAAM,KAAK,AAAL,EAAS,EAChC,EAAI,AAAA,CAAA,EAAM,GAAG,CAAG,EAAM,MAAM,AAAN,EAAU,CAAE,CACnD,CAAA,EAAY,CAAC,CAAG,EAAa,CAAC,CAC1B,EAAY,CAAC,CAAG,EAAa,CAAC,EAC9B,AAAA,EAAI,QAAQ,CAAC,EAAI,kBACjB,EAAG,KAAK,CAAC,SAAS,CAAG,CAAC,0BAA0B,EAAE,EAAK,MAAM,CAAG,EAAE,IAAI,CAAC,GAEvE,AAAA,EAAI,QAAQ,CAAC,EAAI,iBACjB,EAAG,KAAK,CAAC,SAAS,CAAG,CAAC,8BAA8B,EAAE,EAAK,MAAM,CAAG,EAAE,IAAI,CAAC,EAG3E,EAAY,CAAC,CAAG,EAAa,CAAC,EAC9B,AAAA,EAAI,QAAQ,CAAC,EAAI,kBACjB,EAAG,KAAK,CAAC,SAAS,CAAG,CAAC,aAAa,EAAE,EAAK,MAAM,CAAG,EAAE,GAAG,CAAC,GAEzD,AAAA,EAAI,QAAQ,CAAC,EAAI,iBACjB,EAAG,KAAK,CAAC,SAAS,CAAG,CAAC,iBAAiB,EAAE,EAAK,MAAM,CAAG,EAAE,GAAG,CAAC,EAGrE,EAAG,KAAK,CAAC,IAAI,CAAI,EAAY,CAAC,CAAG,EAAM,IAAI,CAAI,KAC/C,EAAG,KAAK,CAAC,GAAG,CAAI,EAAY,CAAC,CAAG,EAAM,GAAG,CAAI,KAC7C,EAAG,KAAK,CAAC,cAAc,CAAC,aAC5B,CAEA,eAAe,CAAG,CAAE,CAChB,IAAI,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAI,QAC/B,AAAa,MAAT,IACA,EAAM,MAAM,EACZ,IAAI,CAAC,cAAc,CAAC,EAAM,MAAM,EACzB,CAAA,UAEf,CAEA,WAAW,CAAO,CAAE,CAChB,IAAI,EAAM,IAAI,GAAa,CAAE,GAAG,CAAO,CAAE,MAAO,IAAI,AAAC,GAErD,OADA,IAAI,CAAC,GAAG,CAAC,GACF,CACX,CACJ,CAEA,SAAS,GAAQ,CAAI,EAKjB,MAJmB,UAAf,OAAO,IACH,GAAQ,GAAK,EAAO,EAAG,EAAO,AAAO,IAAP,EAAa,IAC1C,GAAQ,MAEV,CACX,CAEO,MAAM,WAAqB,EAC9B,OAAO,QAAU,CACb,UAAW,CAAA,EACX,UAAW,CAAA,EACX,SAAU,CAAA,EACV,QAAS,KACT,SAAU,CAAA,EACV,MAAO,MACP,OAAQ,MACR,MAAO,IACX,CAAE,AAEF,aAAY,GAAG,CAAI,CAAE,CACjB,KAAK,IAAI,GACT,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,CAAC,CAAC,KAAK,CAEzB,IAAI,EAAO,IAAI,CAAC,UAAU,GACtB,EAAU,IAAI,CAAC,CAAC,CAAC,OAAO,CAgB5B,GAfI,AAAkB,YAAlB,OAAO,GACP,CAAA,EAAU,EAAQ,IAAI,CAAC,IAAI,CAAE,EAAM,IAAI,CAAA,EAEvC,GACA,EAAK,WAAW,CAAC,GAEjB,IAAI,CAAC,CAAC,CAAC,SAAS,EAChB,CAAA,EAAK,KAAK,CAAC,MAAM,CAAG,MADxB,EAGI,IAAI,CAAC,CAAC,CAAC,KAAK,EACZ,CAAA,EAAK,KAAK,CAAC,KAAK,CAAG,GAAQ,IAAI,CAAC,CAAC,CAAC,KAAK,CAAA,EAEvC,IAAI,CAAC,CAAC,CAAC,MAAM,EACb,CAAA,EAAK,KAAK,CAAC,MAAM,CAAG,GAAQ,IAAI,CAAC,CAAC,CAAC,MAAM,CAAA,EAEzC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAE,CACjB,GAAI,AAAoB,CAAA,IAApB,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAW,CAC1B,IAAI,EAAK,AAAA,EAAI,QAAQ,CAAC,oCACtB,EAAK,WAAW,CAAC,GACjB,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAG,CACtB,CACA,AAAA,EAAI,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAE,CACpB,UAAW,AAAA,GAAM,EAAG,eAAe,GACnC,MAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CACrC,EACJ,CACI,IAAI,CAAC,CAAC,CAAC,SAAS,GACZ,AAAqB,CAAA,IAArB,IAAI,CAAC,CAAC,CAAC,SAAS,EAAW,CAAA,IAAI,CAAC,CAAC,CAAC,SAAS,CAAG,CAAlD,EACA,IAAI,CAAC,aAAa,CAAG,CACjB,UAAY,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,EACzC,QAAY,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAC3C,EACA,AAAA,EAAI,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAE,YAAa,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,GAE3E,CAEA,eAAgB,CACZ,IAAI,EAAI,CAAE,eAAgB,CAE1B,OADI,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,EAAE,IAAI,CAAC,YACrB,EAAE,IAAI,CAAC,IAClB,CAEA,OAAQ,CACJ,IAAI,CAAC,UAAU,GAAG,MAAM,GACxB,IAAI,CAAC,OAAO,GACZ,IAAI,CAAC,KAAK,CAAC,KAAK,GAChB,IAAI,CAAC,SAAS,CAAC,UACnB,CAEA,YAAY,CAAE,CAAE,CACZ,EAAG,eAAe,GAClB,IAAI,CAAC,KAAK,EACd,CAEA,eAAe,CAAE,CAAE,CACf,EAAG,eAAe,GAClB,IAAI,EAAO,IAAI,CAAC,UAAU,EAC1B,CAAA,IAAI,CAAC,SAAS,CAAG,CACb,KAAM,AAAA,EAAI,MAAM,CAAC,GACjB,MAAO,AAAA,EAAI,QAAQ,CAAC,EAAI,EAAK,YAAY,EACzC,MAAO,SAAS,aAAa,AACjC,EACA,AAAA,EAAI,EAAE,CAAC,OAAQ,IAAI,CAAC,aAAa,EACjC,AAAA,EAAI,SAAS,CAAC,oBAClB,CAEA,eAAe,CAAE,CAAE,CACf,IAAI,EAAO,IAAI,CAAC,UAAU,GACtB,EAAQ,AAAA,EAAI,QAAQ,CAAC,EAAI,EAAK,YAAY,EAC1C,EAAM,IAAI,CAAC,SAAS,CACpB,EAAK,EAAM,CAAC,CAAG,EAAI,KAAK,CAAC,CAAC,CAC1B,EAAK,EAAM,CAAC,CAAG,EAAI,KAAK,CAAC,CAAC,CAC9B,EAAK,KAAK,CAAC,cAAc,CAAC,UAC1B,EAAK,KAAK,CAAC,cAAc,CAAC,SAC1B,EAAK,KAAK,CAAC,IAAI,CAAG,EAAI,IAAI,CAAC,CAAC,CAAG,EAAK,KACpC,EAAK,KAAK,CAAC,GAAG,CAAG,EAAI,IAAI,CAAC,CAAC,CAAG,EAAK,IACvC,CAEA,aAAa,CAAE,CAAE,CACb,AAAA,EAAI,GAAG,CAAC,OAAQ,IAAI,CAAC,aAAa,EAClC,AAAA,EAAI,UAAU,GACd,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,QACtB,IAAI,CAAC,SAAS,CAAG,IACrB,CACJ,CW18BO,MAAM,GAET,YAAY,CAAA,OACR,EAAS,IAAA,CAAA,KACT,EAAO,CAAA,CAAA,IACP,EAAM,CAAA,CACT,CAAG,CAAC,CAAC,CAAE,CACJ,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,IAAI,CAAG,EACZ,IAAI,CAAC,GAAG,CAAG,CACf,CAEA,UAAW,CAGP,MAFA,EAAE,IAAI,CAAC,IAAI,CACX,IAAI,CAAC,GAAG,CAAG,EACJ,IAAI,CAAC,IAAI,CAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,AAC9C,CAEA,UAAW,CAGP,MAFA,EAAE,IAAI,CAAC,IAAI,CACX,IAAI,CAAC,GAAG,CAAG,EACJ,IAAI,CAAC,IAAI,EAAI,CACxB,CAEA,KAAK,EAAI,CAAC,CAAE,CACR,GAAI,IAAI,CAAC,IAAI,CAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAE,CACrC,IAAI,EAAM,IAAI,CAAC,GAAG,CAAG,EACjB,EAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CACtC,GAAI,EAAM,EAAK,MAAM,CAAE,OAAO,EAAK,MAAM,CAAC,GAC1C,GAAI,GAAO,EAAK,MAAM,CAAE,MAAO,IACnC,CACJ,CAEA,SAAS,EAAM,IAAI,CAAC,IAAI,CAAE,CACtB,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAI,AAChC,CAEA,gBAAgB,EAAM,IAAI,CAAC,IAAI,CAAE,CAC7B,MAAO,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAK,CAAC,EAAE,CAAC,MAAM,AACpD,CAEA,UAAU,CAAI,CAAE,CACZ,GAAI,IAAI,CAAC,IAAI,CAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAE,CACrC,IAAI,EAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QACtC,AAAI,aAAgB,OACT,EAAK,IAAI,CAAC,EAAK,MAAM,CAAC,IAAI,CAAC,GAAG,GAE9B,EAAK,MAAM,CAAC,IAAI,CAAC,GAAG,CAAE,EAAK,MAAM,GAAK,EAAO,CAAE,EAAM,CAAG,IAEvE,CACJ,CAEA,WAAW,CAAG,CAAE,CAGZ,OAFI,AAAO,MAAP,GACA,CAAA,EAAM,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,GAAG,CAAA,EACpD,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,EAAG,EAC3C,CAEA,UAAU,CAAG,CAAE,CAGX,OAFI,AAAO,MAAP,GACA,CAAA,EAAM,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,GAAG,CAAA,EACpD,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,EACxC,CAEA,UAAU,CAAK,CAAE,CAAG,CAAE,CAClB,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,SAAS,CAAC,EAAO,EAClD,CAEA,OAAO,CAAK,CAAE,CAAG,CAAE,CACf,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,EAAO,EAC/C,CAEA,KAAM,CACF,OAAO,IAAI,CAAC,GAAG,EAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,AACzD,CAEA,KAAM,CACF,IAAI,EAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAE,EAAI,IAAI,CAAC,IAAI,CAC9C,OAAO,GAAK,GAAK,GAAK,EAAI,GAAK,IAAI,CAAC,GAAG,EAC3C,CAEA,OAAO,CAAI,CAAE,CAAG,CAAE,EAAO,IAAI,CAAC,GAAG,CAAE,CAC/B,IAAI,CAAC,MAAM,CAAG,CAAE,KAAA,EAAM,IAAA,EAAK,KAAA,CAAK,CACpC,CAEA,QAAS,CACL,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,AAClC,CAEA,WAAW,CAAI,CAAE,CAGb,OAFI,AAAQ,MAAR,GACA,CAAA,EAAO,IAAI,CAAC,IAAI,AAAJ,EACT,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAK,CAAC,MAAM,AACxC,CAEA,MAAO,CACH,MAAO,CAAE,OAAQ,IAAI,CAAC,MAAM,CAAE,KAAM,IAAI,CAAC,IAAI,CAAE,IAAK,IAAI,CAAC,GAAG,AAAC,CACjE,CAEA,QAAQ,CAAK,CAAE,CACX,IAAI,CAAC,MAAM,CAAG,EAAM,MAAM,CAC1B,IAAI,CAAC,IAAI,CAAG,EAAM,IAAI,CACtB,IAAI,CAAC,GAAG,CAAG,EAAM,GAAG,AACxB,CAEA,WAAY,CACR,GAAI,IAAI,CAAC,GAAG,GAAI,MAAM,IAAI,CAAC,GAAG,CAC9B,GAAI,IAAI,CAAC,GAAG,GAAI,MAAM,IAAI,CAAC,GAAG,CAC9B,IAAI,EAAO,IAAI,CAAC,MAAM,CACtB,GAAI,GACI,CAAA,IAAI,CAAC,IAAI,CAAG,EAAK,IAAI,EACjB,IAAI,CAAC,IAAI,EAAI,EAAK,IAAI,EAAI,IAAI,CAAC,GAAG,EAAI,EAAK,GAAG,AAAH,EAE/C,MADA,IAAI,CAAC,MAAM,CAAG,KACR,EAAK,IAAI,EAAI,IAAI,CAAC,GAAG,AAGvC,CAEJ,CAEA,GAAa,SAAS,CAAC,GAAG,CAAG,CAAC,EAC9B,GAAa,SAAS,CAAC,GAAG,CAAG,CAAC,CAEvB,OAAM,GAET,YAAY,CAAA,OACR,EAAS,IAAA,CAAA,KACT,EAAO,CAAA,CAAA,IACP,EAAM,CAAA,CAAA,IACN,EAAM,IAAA,CACT,CAAG,CAAC,CAAC,CAAE,CAMJ,GALA,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,IAAI,CAAG,EACZ,IAAI,CAAC,GAAG,CAAG,EACX,IAAI,CAAC,GAAG,CAAG,EAEP,AAAY,MAAZ,IAAI,CAAC,GAAG,CACR,IAAI,CAAC,GAAG,CAAG,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,GAAG,MACzD,CACH,IAAI,EAAK,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,CAC/C,CAAA,IAAI,CAAC,IAAI,CAAG,EAAG,GAAG,CAClB,IAAI,CAAC,GAAG,CAAG,EAAG,GAAG,AACrB,CACJ,CAEA,OAAO,cAAc,CAAE,CAAE,CACrB,OAAQ,GACN,IAAK,IACL,IAAK,KACL,IAAK,IACL,IAAK,KACL,IAAK,SACL,IAAK,SACL,IAAK,IACH,MAAO,CAAA,CACX,CACJ,CAEA,MAAO,CACH,IAAI,EAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CACpB,EAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QACvB,AAAI,AAAQ,MAAR,EAAqB,KACrB,IAAI,CAAC,GAAG,EAAI,EAAK,MAAM,CAChB,IAAI,CAAC,IAAI,EAAI,EAAE,MAAM,CAAG,EAAI,KAAO,KACvC,EAAK,MAAM,CAAC,IAAI,CAAC,GAAG,CAC/B,CAEA,MAAO,CACH,IAAI,EAAK,IAAI,CAAC,IAAI,GASlB,OARI,IACA,EAAE,IAAI,CAAC,GAAG,CACV,EAAE,IAAI,CAAC,GAAG,CACN,IAAI,CAAC,GAAG,CAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,GAC7C,IAAI,CAAC,GAAG,CAAG,EACX,EAAE,IAAI,CAAC,IAAI,GAGZ,CACX,CAEA,WAAW,CAAI,CAAE,CAEb,IADA,IAAc,EAAV,EAAM,GACF,AAAA,CAAA,EAAK,IAAI,CAAC,IAAI,EAAA,GAAO,EAAK,IAC9B,GAAO,IAAI,CAAC,IAAI,GACpB,OAAO,CACX,CAEA,SAAU,CACN,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa,CAC7C,CAEA,WAAW,CAAI,CAAE,CACb,IAAI,EAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QACtC,AAAI,aAAgB,OACT,EAAK,IAAI,CAAC,EAAK,MAAM,CAAC,IAAI,CAAC,GAAG,GAE9B,EAAK,MAAM,CAAC,IAAI,CAAC,GAAG,CAAE,EAAK,MAAM,GAAK,CAErD,CAEJ,CAEA,GAAoB,SAAS,CAAC,aAAa,CAAG,GAAoB,aAAa,CAE/E,IAAI,GAAY,OAAO,MAAM,CAAC,KAEvB,OAAM,WAAwB,EAEjC,OAAO,OAAO,CAAI,CAAE,CAAI,CAAE,CACtB,EAAS,CAAC,EAAK,WAAW,GAAG,CAAG,CACpC,CAEA,YAAY,CAAA,OAAE,CAAM,CAAA,KAAE,CAAI,CAAE,CAAE,CAC1B,KAAK,GAED,AAAe,UAAf,OAAO,GACP,CAAA,EAAO,EAAS,CAAC,EAAK,WAAW,GAAG,AAAH,EAGrC,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,IAAI,CAAG,CAChB,CAEA,OAAQ,CACJ,IAAI,CAAC,MAAM,CAAG,IAAI,GAAa,CAAE,OAAQ,IAAI,CAAC,MAAM,AAAC,GACrD,IAAI,CAAC,SAAS,CAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAE,IAAI,EAC5C,IAAI,CAAC,OAAO,CAAG,CAAE,IAAI,CAAC,SAAS,CAAC,IAAI,GAAI,CACxC,IAAI,CAAC,WAAW,CAAG,KACnB,IAAI,CAAC,KAAK,EACd,CAEA,MAAO,CACH,aAAa,IAAI,CAAC,WAAW,CACjC,CAEA,YAAY,CAAI,CAAE,CAAO,CAAE,CACvB,OAAO,EAAS,CAAC,EAAK,CAAC,IAAI,CAAC,MAAM,CAAE,IAAI,CAAE,EAC9C,CAEA,OAAQ,CACJ,IAAI,CAAC,IAAI,GACT,IAAI,EAAS,IAAI,CAAC,MAAM,CAAE,EAAG,EAAI,IAAI,CAAC,OAAO,CAG7C,IAFA,EAAO,IAAI,CAAG,EAAE,MAAM,CAAG,EACzB,EAAO,GAAG,CAAG,EACN,CAAE,CAAA,EAAI,CAAC,CAAC,EAAO,IAAI,CAAC,AAAD,GACtB,EAAO,QAAQ,GACnB,EAAI,IACJ,IAAI,EAAO,KACP,IAAI,CAAC,MAAM,CAAC,cAAc,GAC1B,IAAI,EAAI,IACR,OACI,GAAI,CACA,OAAa,EAAE,IAAI,EACvB,CACA,MAAM,EAAI,CACN,GAAI,IAAO,EAAO,GAAG,CAGjB,CAAA,GAFA,EAAO,QAAQ,GACf,CAAC,CAAC,EAAO,IAAI,CAAC,CAAG,EAAE,IAAI,GAClB,AAAO,GAAP,EAAE,EAAQ,CACX,IAAI,CAAC,MAAM,CAAC,aAAa,GACzB,IAAI,CAAC,WAAW,CAAG,WAAW,EAtQxC,IAuQU,MACJ,CAAA,MAEC,GAAI,IAAO,EAAO,GAAG,CAAE,CACxB,IAAI,CAAC,MAAM,CAAC,aAAa,GACzB,KACJ,MACK,MAAM,CACf,CAER,EACA,GACJ,CAEA,gBAAgB,CAAG,CAAE,CACjB,IAAI,CAAC,QAAQ,CAAC,EAClB,CAEA,gBAAgB,CAAG,CAAE,CACjB,IAAI,CAAC,QAAQ,CAAC,EAClB,CAEA,QAAQ,CAAI,CAAE,CAAE,CAAE,CAAE,CAAE,CAAI,CAAE,CACxB,IAAI,CAAC,SAAS,CAAC,eAAgB,EAAM,EAAI,EAAI,EACjD,CAEA,iBAAiB,CAAG,CAAE,EAAM,CAAC,CAAE,CAC3B,IAAI,CAAC,IAAI,GACT,IAAI,EAAS,IAAI,CAAC,MAAM,CAAE,EAAG,EAAI,IAAI,CAAC,OAAO,CAG7C,IAFA,EAAO,IAAI,CAAG,EACd,EAAO,GAAG,CAAG,EACN,CAAE,CAAA,EAAI,CAAC,CAAC,EAAO,IAAI,CAAC,AAAD,GACtB,EAAO,QAAQ,EACf,AAAO,OAAP,GACA,EAAO,MAAM,CAAC,EAAK,GAEvB,EAAI,IACJ,GAAI,CAEA,IADA,IAAI,CAAC,MAAM,CAAC,cAAc,KACb,CACT,GAAI,AAAO,MAAP,GAAe,EAAO,IAAI,EAAI,EAC9B,OAAO,EAEX,GAAI,CACA,OAAa,EAAE,IAAI,EACvB,CAAE,MAAM,EAAI,CACR,GAAI,IAAO,EAAO,GAAG,CACjB,EAAO,QAAQ,GACf,CAAC,CAAC,EAAO,IAAI,CAAC,CAAG,EAAE,IAAI,QAEtB,GAAI,IAAO,EAAO,GAAG,CACtB,OAAO,OAGP,MAAM,CAEd,CACJ,CACJ,QAAU,CACN,IAAI,CAAC,MAAM,CAAC,aAAa,GACrB,EAAO,IAAI,CAAG,EAAO,MAAM,IAC3B,CAAA,IAAI,CAAC,WAAW,CAAG,WAAW,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAE,EAAO,IAAI,EApU7D,GAmUN,CAEJ,CACJ,CAEA,WAAW,CAAG,CAAE,CAAG,CAAE,CACjB,OAAO,IAAI,CAAC,gBAAgB,CAAC,EAAK,EACtC,CAEA,YAAa,CAET,OADA,IAAI,CAAC,QAAQ,CAAC,GACP,IAAI,CAAC,aAAa,EAC7B,CAEA,eAAgB,CAEZ,OADA,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAI,MACrC,IAAI,CAAC,aAAa,EAC7B,CAEA,eAAgB,CACZ,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,GAC3B,CAEA,eAAe,CAAG,CAAE,CAAM,CAAE,CACxB,IAAI,EAAI,IAAI,CAAC,gBAAgB,CAAC,EAAK,MACnC,GAAI,GAAK,EAAE,WAAW,YAAY,SAC9B,OAAO,EAAE,WAAW,CAAC,EAC7B,CAEA,SAAS,CAAG,CAAE,CACV,IACI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,GAAK,CAAA,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,CAArD,CACJ,CAEA,OAAQ,CACJ,IAAI,EAAK,IAAI,CAAC,SAAS,CAAC,YAAY,CAEpC,OADI,aAAc,UAAU,CAAA,EAAK,GAAjC,EACO,EAAK,IAAI,EAAG,CAAC,IAAI,CAAC,IAAiB,EAAE,AAChD,CAEJ,CAEO,SAAS,GAAc,CAAE,CAAE,CAAE,EAChC,MAAS,AAAA,CAAA,EAAG,GAAG,EAAI,EAAG,IAAG,AAAH,EAAS,CAAA,EAAG,GAAG,EAAI,EAAG,IAAI,AAAJ,EACtC,GACA,AAAC,CAAA,EAAG,GAAG,EAAI,EAAG,IAAI,AAAJ,EAAS,CAAA,EAAG,GAAG,EAAI,EAAG,IAAG,AAAH,EACpC,EACA,AAAC,CAAA,EAAG,GAAG,EAAI,EAAG,EAAE,AAAF,EAAO,CAAA,EAAG,GAAG,EAAI,EAAG,EAAC,AAAD,CAC5C,CAEO,SAAS,GAAY,CAAK,CAAE,CAAI,EACnC,OAAO,AAAA,GAAM,EAAE,MAAM,EACR,AAAQ,SAAR,GAAmB,EAAE,KAAK,CACtB,AAA8D,EAA9D,GAAc,CAAE,KAAM,EAAE,KAAK,CAAC,EAAE,CAAE,IAAK,EAAE,KAAK,CAAC,EAAE,AAAC,EAAG,IAC9C,GAAc,CAAE,KAAM,EAAE,KAAK,CAAC,EAAE,CAAE,IAAK,EAAE,KAAK,CAAC,EAAE,AAAC,EAAG,IAAU,EAExE,AAAQ,SAAR,GAAmB,EAAE,KAAK,CACxB,AAA+D,GAA/D,GAAc,CAAE,KAAM,EAAE,KAAK,CAAC,EAAE,CAAE,IAAK,EAAE,KAAK,CAAC,EAAE,AAAC,EAAG,IAC9C,GAAc,CAAE,KAAM,EAAE,KAAK,CAAC,EAAE,CAAE,IAAK,EAAE,KAAK,CAAC,EAAE,AAAC,EAAG,IAAU,EAGtE,AAA0B,EAA1B,GAAc,EAAG,IACV,GAAc,EAAE,MAAM,CAAE,IAAU,CAE9D,CChXA,IAAI,GAAc,AAAA,EAAa,MAAM,CAAC,OAAQ,CAC1C,EAAK,aACT,GAEI,GAAuB,AAAA,EAAa,MAAM,CAAC,gBAAiB,CAC5D,gBAAiB,WACb,IAAI,CAAC,SAAS,CAAC,IACf,IAAI,CAAC,aAAa,CAAC,GACvB,CACJ,GAizCI,SAAS,GAAmB,CAAM,CAAE,CAAK,CAAE,CAAG,CAAE,CAAI,EAChD,EAAO,GAAG,CAAC,iBAAkB,WAIzB,IAAK,IAHD,EAAK,IAAI,CAAC,iBAAiB,CAAC,GAChC,EAAK,IAAI,CAAC,iBAAiB,CAAC,GAC5B,EAAQ,KAAK,GAAG,CAAC,EAAG,GAAG,CAAG,EAAG,GAAG,EACvB,EAAO,EAAG,GAAG,CAAE,GAAQ,EAAG,GAAG,CAAE,EAAE,EAAM,CAC5C,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAM,IACnD,IAAI,EAAO,IAAI,CAAC,IAAI,CAAC,EAAK,CAC1B,EAAK,EAAG,GAAG,CACX,EAAK,EAAG,GAAG,CACX,EAAI,IAAI,CAAC,KAAK,GAAI,EAAK,EACvB,GAAI,EAAK,EAAI,CACT,IAAI,EAAM,EACV,EAAK,EACL,EAAK,CACT,CACI,EAAK,EAAK,MAAM,GAChB,EAAK,EAAK,EAAK,MAAM,CACrB,EAAK,EAAK,MAAM,EAEhB,EAAK,EAAK,MAAM,EAChB,CAAA,EAAK,EAAK,MAAM,AAAN,EAEd,EAAK,IAAI,CAAC,IAAI,CAAE,EAAI,EAAI,EAAI,EAAI,EAAI,EACxC,CACJ,EAAG,GAAS,EAAO,KAAK,GAC5B,CA10CJ,GAAqB,cAAc,CAAG,CAAE,WAEpC,IAAI,EAAK,AADA,IAAI,CAAC,gBAAgB,GAClB,GAAG,CASf,OARI,AAAa,GAAb,EAAG,MAAM,CACT,IAAI,CAAC,WAAW,CAAC,8BAEjB,IAAI,CAAC,IAAI,CAAC,0BAA0B,GACpC,IAAI,CAAC,IAAI,CAAC,2BAEd,IAAI,CAAC,SAAS,CAAC,IACf,IAAI,CAAC,aAAa,CAAC,IACZ,CAAA,CACX,EAAG,CAEH,AAAA,EAAa,WAAW,CAAC,CAErB,aAAc,AAAA,EAAkB,IAAK,SAAS,CAAC,EAE3C,OADI,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACZ,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,KAAK,GAAK,EAChD,GAEA,cAAe,AAAA,EAAkB,IAAK,SAAS,CAAC,EAE5C,OADI,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACZ,IAAI,CAAC,GAAG,CAAC,eAAgB,CAAC,EACrC,GAEA,aAAc,AAAA,EAAkB,IAAK,SAAS,CAAC,EACvC,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACnB,IAAI,EAAK,IAAI,CAAC,OAAO,AACjB,CAAC,4BAA4B,IAAI,CAAC,IAAI,CAAC,eAAe,GACtD,IAAI,CAAC,IAAI,CAAC,8BAA+B,EAAG,GAAG,EAEnD,IAAI,EAAM,IAAI,CAAC,GAAG,CAAC,YACA,IAAI,CAAC,iBAAiB,CAAC,EAAG,GAAG,CAAG,EACT,KAAK,GAAG,CAAC,EAAG,GAAG,CACN,IAAI,CAAC,IAAI,CAAC,kCAG7D,OAFI,AAAC,GACD,IAAI,CAAC,IAAI,CAAC,8BAA+B,EAAG,GAAG,EAC5C,CACX,GAEA,cAAe,AAAA,EAAkB,IAAK,SAAS,CAAC,EAE5C,OADI,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACZ,IAAI,CAAC,GAAG,CAAC,eAAgB,CAAC,EACrC,GAEA,mBAAoB,AAAA,EAAkB,IAAK,SAAS,CAAM,SAEtD,AAAI,IAAI,CAAC,GAAG,CAAC,wBADJ,EAAS,iBAAmB,WAEjC,IAAI,CAAC,GAAG,CAAC,iBACF,CAAA,GACC,SACD,IAAI,CAAC,GAAG,CAAC,gBACxB,GAEA,oBAAqB,AAAA,EAAkB,IAAK,SAAS,CAAM,SAEvD,AAAI,IAAI,CAAC,GAAG,CAAC,yBADJ,EAAS,iBAAmB,WAEjC,IAAI,CAAC,GAAG,CAAC,gBACF,CAAA,GACC,SACD,IAAI,CAAC,GAAG,CAAC,sBACxB,GAEA,kBAAmB,AAAA,EAAkB,WACjC,OAAO,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAE,GAC1E,GAEA,oBAAqB,AAAA,EAAkB,WACnC,IAAI,EAAK,IAAI,CAAC,OAAO,CAAE,EAAO,IAAI,CAAC,IAAI,CAAC,EAAG,GAAG,CAAC,CAAE,EAAI,KAAK,IAAI,CAAC,GAC/D,GAAI,EACA,OAAO,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAG,GAAG,CAAE,EAAE,KAAK,EAC3E,GAEA,iCAAkC,AAAA,EAAkB,WAChD,OAAO,IAAI,CAAC,GAAG,CAAC,wBAA0B,IAAI,CAAC,GAAG,CAAC,oBACvD,GAEA,YAAa,AAAA,EAAkB,WAC3B,IAAI,EAAK,IAAI,CAAC,OAAO,CACrB,OAAO,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAG,GAAG,CAAE,IAAI,CAAC,IAAI,CAAC,EAAG,GAAG,CAAC,CAAC,MAAM,EACxF,GAEA,oBAAqB,AAAA,EAAkB,WACnC,OAAO,IAAI,CAAC,GAAG,CAAC,YAAa,EACjC,GAEA,cAAe,AAAA,EAAkB,WAC7B,OAAO,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,WAAW,GACjD,GAEA,MAAO,WACH,OAAO,IAAI,CAAC,KAAK,IAAM,IAAI,CAAC,WAAW,EAC3C,EAEA,MAAO,WACH,OAAO,AAAgB,GAAhB,IAAI,CAAC,KAAK,EACrB,EAEA,MAAO,WACH,IAAI,EAAK,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,IAC1C,OAAO,EAAG,GAAG,EAAI,IAAI,CAAC,IAAI,CAAC,EAAG,IAAI,CAAC,CAAC,MAAM,AAC9C,EAEA,MAAO,WACH,OAAO,AAA4C,GAA5C,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,IAAI,GAAG,AACnD,EAEA,qBAAsB,AAAA,EAAkB,KAAM,SAAS,CAAC,EACpD,GAAI,CAAC,IAAI,CAAC,qBAAqB,GAAI,CAC3B,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACnB,IAAI,EAAM,IAAI,CAAC,KAAK,EAChB,CAAA,EAAM,GACN,IAAI,CAAC,WAAW,CAAC,EAAM,EAAG,EAClC,CACJ,GAEA,YAAa,AAAA,EAAkB,KAAM,SAAS,CAAC,EAC3C,GAAI,CAAC,IAAI,CAAC,qBAAqB,GAAI,CAC3B,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACnB,IAAI,EAAM,IAAI,CAAC,KAAK,GACpB,IAAI,CAAC,WAAW,CAAC,EAAK,EAAM,EAChC,CACJ,GAEA,kBAAmB,AAAA,EAAkB,KAAM,SAAS,CAAM,EACtD,GAAI,CAAC,IAAI,CAAC,qBAAqB,GAAI,CAC/B,IAAI,EAAI,IAAI,CAAC,KAAK,GAClB,GAAI,IAAI,CAAC,GAAG,CAAC,qBAAsB,GAE/B,OADA,IAAI,CAAC,WAAW,CAAC,EAAG,IAAI,CAAC,KAAK,IACvB,CAAA,CAEf,CACJ,GAEA,2BAA4B,AAAA,EAAkB,KAAM,SAAS,CAAM,EAC/D,GAAI,CAAC,IAAI,CAAC,qBAAqB,GAAI,CAC/B,IAAI,EAAI,IAAI,CAAC,KAAK,GAClB,GAAI,IAAI,CAAC,GAAG,CAAC,sBAAuB,GAEhC,OADA,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,GAAI,GACxB,CAAA,CAEf,CACJ,GAEA,mBAAoB,AAAA,EAAkB,IAAK,SAAS,CAAQ,EACpD,GACA,IAAI,CAAC,GAAG,CAAC,gBACb,IAAI,CAAC,GAAG,CAAC,uBACT,IAAI,CAAC,GAAG,CAAC,8BACT,IAAI,CAAC,GAAG,CAAC,SAAU,IACvB,GAEA,mBAAoB,AAAA,EAAkB,IAAK,WACvC,IAAI,CAAC,UAAU,CAAC,GACZ,AAAC,IAAI,CAAC,YAAY,EAClB,IAAI,CAAC,aAAa,CAAC,MAC3B,GAEA,eAAgB,AAAA,EAAkB,WAC9B,IAAI,CAAC,kBAAkB,EAC3B,GAEA,oBAAqB,AAAA,EAAkB,KAAM,SAAS,CAAM,EACxD,IAAI,EAAK,IAAI,CAAC,gBAAgB,GAC1B,EAAK,EAAG,GAAG,CACX,EAAK,IAAI,CAAC,OAAO,CACrB,GAAI,AAAa,GAAb,EAAG,MAAM,EAAS,CAAC,EAAG,MAAM,EAAI,CAAC,EAAG,OAAO,CAAE,CAI7C,GAHA,IAAI,CAAC,qBAAqB,GACtB,AAAU,MAAV,GACA,CAAA,EAAK,EAAG,MAAM,CAAC,EADnB,EAEI,IAAI,CAAC,aAAa,CAAE,CACpB,IAA8B,EAAO,AAA1B,IAAI,CAAC,IAAI,CAAC,EAAG,GAAG,CAAC,CAAc,MAAM,CAAG,EAAG,GAAG,AACrD,CAAA,EAAO,GACP,IAAI,CAAC,GAAG,CAAC,cAAe,KAAK,GAAG,CAAC,EAAM,GAAU,GACzD,CAEA,OADA,IAAI,CAAC,GAAG,CAAC,SAAU,GACZ,CAAA,CACX,CACA,MAAO,CAAA,CACX,GAEA,QAAS,AAAA,EAAkB,KAAM,SAAS,CAAC,EACnC,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACnB,IAAI,CAAC,qBAAqB,GAC1B,IAAI,CAAC,GAAG,CAAC,SAAU,KAAK,MAAM,CAAC,GACnC,GAEA,mBAAoB,AAAA,EAAkB,KAAM,SAAS,CAAC,EAC9C,EACA,IAAI,CAAC,GAAG,CAAC,UAAW,IAEpB,IAAI,CAAC,GAAG,CAAC,6BAA8B,CAAA,GACvC,IAAI,CAAC,GAAG,CAAC,WACT,IAAI,CAAC,GAAG,CAAC,eAEjB,GAEA,cAAe,AAAA,EAAkB,WAEjC,GAEA,YAAa,AAAA,EAAkB,IAAK,SAAS,CAAO,EAChD,GAAK,IAAI,CAAC,SAAS,CAEZ,CACH,IAAI,EAAS,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAE,IAAI,EACjE,GAAI,AAAU,MAAV,EAAgB,CAChB,IAAI,EAAO,IAAI,CAAC,OAAO,GACvB,GAAI,CAAC,GAAW,KAAK,IAAI,CAAC,GAAO,CAC7B,IAAI,EAAK,IAAI,CAAC,OAAO,CACjB,EAAM,IAAI,CAAC,KAAK,GAAK,EAAG,GAAG,CAC3B,EAAK,aAAa,IAAI,CAAC,EAAK,CAAC,EAAE,CAAC,MAAM,AACtC,CAAA,EAAK,EACL,IAAI,CAAC,WAAW,CAAC,EAAK,EAAM,EAAK,GAC1B,EAAS,GAChB,IAAI,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC,EAAS,GAAK,GAE1C,EAAG,GAAG,EAAI,GACV,IAAI,CAAC,GAAG,CAAC,YAAa,EAAM,EAEpC,CACJ,CACJ,MAnBI,IAAI,CAAC,GAAG,CAAC,SAAU,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,gBAoBhD,GAEA,cAAe,AAAA,EAAkB,IAAK,SAAS,CAAK,CAAE,CAAG,EACjD,EAAM,GAAO,CAAA,CAAE,EAAO,EAAK,CAAG,CAAE,EAAK,EAAO,AAAA,EAChD,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACvB,IAAI,EAAI,IAAI,CAAC,YAAY,CAAC,GAE1B,IADA,IAAI,CAAC,GAAG,CAAC,YAAa,GACf,IAAI,CAAC,KAAK,GAAK,EAAE,WAAW,KAC/B,IAAI,CAAC,GAAG,CAAC,cAAe,CAAA,GACxB,IAAI,CAAC,GAAG,CAAC,qBACJ,IAAI,CAAC,GAAG,CAAC,mBAGlB,EAAE,OAAO,EACb,EACJ,GAEA,YAAa,SAAS,CAAG,EACrB,OAAO,IAAI,CAAC,YAAY,CAAC,EAC7B,EAEA,WAAY,WACR,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAE,UACvC,EAEA,aAAc,WACV,OAAO,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,CAAE,UACzC,EAEA,eAAgB,AAAA,EAAkB,YAAa,SAAS,CAAG,CAAE,CAAK,EAC9D,IAAI,EAAO,IAAI,CAAC,OAAO,GAAI,EAAQ,IAAI,CAAC,KAAK,GACzC,IAAI,CAAC,IAAI,CAAC,sBACV,EAAO,EAAK,WAAW,GACvB,EAAM,EAAI,WAAW,IAEzB,IAAI,EAAM,EAAK,OAAO,CAAC,EAAK,GAC5B,GAAI,GAAO,GAAM,CAAA,AAAS,MAAT,GAAiB,GAAO,CAAA,EACrC,OAAO,IAAI,CAAC,GAAG,CAAC,YAAa,EAAM,EAAI,MAAM,CAErD,GAEA,gBAAiB,AAAA,EAAkB,qBAAsB,SAAS,CAAG,CAAE,CAAK,EACxE,IAAI,EAAO,IAAI,CAAC,OAAO,GAAI,EAAQ,IAAI,CAAC,KAAK,GACzC,IAAI,CAAC,IAAI,CAAC,sBACV,EAAO,EAAK,WAAW,GACvB,EAAM,EAAI,WAAW,IAEzB,IAAI,EAAM,EAAK,WAAW,CAAC,EAAK,GAGhC,GAFI,GAAO,GACP,CAAA,EAAM,EAAK,WAAW,CAAC,EAAK,EAAQ,EADxC,EAEI,GAAO,GAAK,GAAO,GAAU,CAAA,AAAS,MAAT,GAAiB,GAAO,CAAA,EACrD,OAAO,IAAI,CAAC,GAAG,CAAC,YAAa,EAErC,GAEA,YAAa,SAAS,CAAE,EACpB,GAAI,CAAE,CAAA,aAAc,MAAA,EAAS,CACzB,IAAI,EAAY,CAAC,IAAI,CAAC,IAAI,CAAC,oBAC3B,GAAI,CACA,EAAK,IAAI,OAAO,EAAI,EAAY,MAAQ,OAC5C,CAAE,MAAM,EAAI,CACR,MAAM,IAAI,EAAgB,iBAC9B,CACJ,CACA,OAAO,CACX,EAEA,sBAAuB,AAAA,EAAkB,mBAAoB,SAAS,CAAE,EAEpE,IAAI,EAAM,AADV,CAAA,EAAK,IAAI,CAAC,GAAG,CAAC,cAAe,EAA7B,EACa,SAAS,CAAG,IAAI,CAAC,KAAK,GAC/B,EAAI,EAAG,IAAI,CAAC,IAAI,CAAC,OAAO,IAC5B,GAAI,GAAK,EAAG,SAAS,EAAI,EAIrB,OAHA,EAAE,KAAK,CAAG,EAAG,SAAS,CACtB,IAAI,CAAC,SAAS,CAAG,EACjB,IAAI,CAAC,GAAG,CAAC,YAAa,EAAG,SAAS,EAC3B,CAAA,CAEf,GAEA,uBAAwB,AAAA,EAAkB,4BAA6B,SAAS,CAAE,EAC9E,EAAK,IAAI,CAAC,GAAG,CAAC,cAAe,GAC7B,IAAI,EAAI,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,OAAO,GAAI,EAAI,IAAI,CAAC,KAAK,IAC7D,GAAI,GAAK,EAAE,KAAK,EAAI,IAAI,CAAC,KAAK,GAE1B,OADA,IAAI,CAAC,GAAG,CAAC,YAAa,EAAE,KAAK,EACtB,CAAA,CAEf,GAEA,aAAc,AAAA,EAAoB,WAE9B,IADA,IAAI,EAAc,IAAI,CAAC,IAAI,CAAC,eAAgB,EAAM,CAAA,EAC3C,CAAC,GAAO,CAAC,EAAY,IAAI,CAAC,IAAI,CAAC,MAAM,KACpC,AAAC,IAAI,CAAC,GAAG,CAAC,iBACV,CAAA,EAAM,CAAA,CAFd,EAGA,KAAO,CAAC,GAAO,EAAY,IAAI,CAAC,IAAI,CAAC,MAAM,KACnC,AAAC,IAAI,CAAC,GAAG,CAAC,iBACV,CAAA,EAAM,CAAA,CAFd,CAGJ,GAEA,cAAe,AAAA,EAAoB,WAE/B,IADA,IAAI,EAAc,IAAI,CAAC,IAAI,CAAC,eAAgB,EAAM,CAAA,EAC3C,CAAC,GAAO,CAAC,EAAY,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MACrC,AAAC,IAAI,CAAC,GAAG,CAAC,kBACV,CAAA,EAAM,CAAA,CAFd,EAGA,KAAO,CAAC,GAAO,EAAY,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MACpC,AAAC,IAAI,CAAC,GAAG,CAAC,kBACV,CAAA,EAAM,CAAA,CAFd,CAGJ,GAEA,kBAAmB,AAAA,EAAoB,WACnC,IAAI,EAAK,IAAI,CAAC,IAAI,CAAC,wBACnB,IAAI,CAAC,GAAG,CAAC,qBACT,IAAI,CAAC,GAAG,CAAC,iBACL,IAAI,CAAC,GAAG,CAAC,aAAc,IACvB,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,GAAG,CAAC,cAE/B,IAAI,CAAC,GAAG,CAAC,wBAAyB,GAClC,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,GAAG,CAAC,mBAAqB,GAEpD,IAAI,CAAC,GAAG,CAAC,gBAEjB,GAEA,mBAAoB,AAAA,EAAoB,WACpC,IAAI,EAAQ,IAAI,CAAC,KAAK,GAClB,EAAK,IAAI,CAAC,IAAI,CAAC,wBAEnB,GADA,IAAI,CAAC,GAAG,CAAC,qBACL,IAAI,CAAC,GAAG,CAAC,eAAgB,GAAK,CAC9B,IAAI,EAAM,IAAI,CAAC,GAAG,CAAC,YACf,CAAA,GAAO,GACP,CAAA,EAAM,IAAI,CAAC,GAAG,CAAC,kBADnB,EAGA,IAAI,CAAC,GAAG,CAAC,YAAa,EAC1B,CACI,IAAI,CAAC,GAAG,CAAC,yBAA0B,GACnC,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,GAAG,CAAC,cAE/B,IAAI,CAAC,GAAG,CAAC,sBAEjB,GAEA,eAAgB,AAAA,EAAkB,KAAM,SAAS,CAAK,CAAE,CAAG,EAClD,IAAI,CAAC,eAAe,CAMpB,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACxB,IAAI,CAAC,eAAe,EACpB,IAAI,CAAC,GAAG,CAAC,YAAa,GAC1B,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,GAAG,CAAC,qBACT,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,IACvB,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAC9C,IAZI,IAAI,CAAC,GAAG,CAAC,qBACT,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,IACvB,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,GAAG,CAAC,uBAUb,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,IAAI,CAAC,cAAe,CAAA,EAC7B,GAEA,gBAAiB,AAAA,EAAoB,WAIjC,IAAI,CAAC,GAAG,CAAC,iBACL,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,MAAM,KACzC,IAAI,CAAC,GAAG,CAAC,gBAEb,IAAI,EAAI,EAAE,CACV,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC3C,IAAI,CAAC,GAAG,CAAC,iBAAkB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC5C,IAAI,CAAC,GAAG,CAAC,iBAAkB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC5C,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC3C,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,UAAU,CAAC,GAC1C,GAEA,gBAAiB,AAAA,EAAoB,WACjC,IAAI,EAAI,EAAE,CACV,IAAI,CAAC,GAAG,CAAC,iBACT,IAAI,CAAC,GAAG,CAAC,qBAAsB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAChD,IAAI,CAAC,GAAG,CAAC,eAAgB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC1C,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC3C,IAAI,CAAC,GAAG,CAAC,eAAgB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC1C,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,UAAU,CAAC,GAAK,EAC/C,GAEA,gBAAiB,AAAA,EAAoB,WACjC,IAAI,EAAM,IAAI,CAAC,KAAK,EAChB,CAAA,IAAI,CAAC,GAAG,CAAC,kBACT,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,UAAU,CAAC,CAAE,EAAM,EAAG,EAAK,EAAK,EAAM,EAAG,EAC5E,GAEA,UAAW,AAAA,EAAkB,KAAM,SAAS,CAAM,EAC9C,GAAI,IAAI,CAAC,eAAe,CAAE,CACtB,IAAI,EAAI,IAAI,CAAC,SAAS,GACtB,IAAI,CAAC,GAAG,CAAC,cAAe,EAAE,KAAK,CAAE,EAAE,GAAG,EACtC,IAAI,CAAC,kBAAkB,EAC3B,KAAO,CACH,IAAI,EAAM,IAAI,CAAC,KAAK,GACpB,IAAI,CAAC,GAAG,CAAC,eAAgB,AAAU,MAAV,EAAiB,EAAI,GAC9C,IAAI,EAAO,IAAI,CAAC,KAAK,GACrB,IAAI,CAAC,cAAc,CAAC,EAAK,EAAM,CAAA,EACnC,CACJ,GAEA,mBAAoB,AAAA,EAAoB,WACpC,IAAI,EAAM,IAAI,CAAC,KAAK,GACpB,IAAI,CAAC,GAAG,CAAC,iBACT,IAAI,EAAO,IAAI,CAAC,KAAK,GACrB,IAAI,CAAC,cAAc,CAAC,EAAK,EAAM,CAAA,EACnC,GAEA,yBAA0B,SAAU,CAAE,CAAE,CAAE,EACtC,IAAI,EAAM,IAAI,CAAC,KAAK,GACpB,GAAI,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,MAAM,IAAK,CAC9C,IAAI,EAAO,IAAI,CAAC,GAAG,CAAC,iBAAkB,WAElC,OADA,IAAI,CAAC,GAAG,CAAC,gBACF,IAAI,CAAC,KAAK,EACrB,GACI,EAAO,EAAG,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAAK,IAC9C,IAAI,CAAC,WAAW,CAAC,EAAK,GACtB,IAAI,CAAC,WAAW,CAAC,EACrB,MACI,IAAI,CAAC,GAAG,CAAC,gBACT,IAAI,CAAC,GAAG,CAAC,iBACL,GAAO,IAAI,CAAC,KAAK,IACjB,IAAI,CAAC,GAAG,CAAC,EAErB,EAEA,gBAAiB,AAAA,EAAoB,WACjC,IAAI,CAAC,GAAG,CAAC,2BAA4B,WACjC,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,WAAW,GAAK,IAAI,CAAC,MAAM,CAAC,GAAG,WAAW,EACpE,EAAG,kBACP,GAEA,cAAe,AAAA,EAAoB,WAC/B,IAAI,CAAC,GAAG,CAAC,2BAA4B,OAAO,SAAS,CAAC,WAAW,CAAE,gBACvE,GAEA,YAAa,AAAA,EAAoB,WAC7B,IAAI,CAAC,GAAG,CAAC,2BAA4B,OAAO,SAAS,CAAC,WAAW,CAAE,cACvE,GAEA,UAAW,AAAA,EAAkB,eAAgB,SAAS,CAAG,EACrD,OAAO,IAAI,CAAC,gBAAgB,CAAC,EACjC,GAEA,UAAW,AAAA,EAAkB,eAAgB,SAAS,CAAG,EACrD,IAAI,EAAM,IAAI,CAAC,iBAAiB,CAAC,EAAM,EAAG,GAC1C,OAAO,IAAI,CAAC,GAAG,CAAC,YAAa,EACjC,GAEA,eAAgB,AAAA,EAAkB,oBAAqB,SAAS,CAAG,CAAE,CAAK,EACtE,IAAI,EAAK,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,IACtC,EAAO,IAAI,CAAC,IAAI,CAAC,EAAG,GAAG,CAAC,AACxB,CAAA,EAAK,MAAM,CAAG,EACV,GACA,IAAI,CAAC,GAAG,CAAC,eACT,IAAI,CAAC,GAAG,CAAC,SAAU,IAAI,MAAM,CAAC,EAAM,EAAK,MAAM,IAE/C,IAAI,CAAC,GAAG,CAAC,eAGb,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAG,GAAG,CAAE,GAE7D,GAEA,cAAe,AAAA,EAAkB,IAAK,SAAS,CAAK,CAAE,CAAG,EACrD,IAAI,CAAC,WAAW,CAAC,EAAO,EAC5B,GAEA,OAAQ,AAAA,EAAkB,iBAAkB,SAAS,GAAG,CAAI,EACxD,OAAO,IAAI,CAAC,WAAW,CAAC,EAAK,IAAI,CAAC,IACtC,GAEA,cAAe,AAAA,EAAkB,WAC7B,IAAI,CAAC,kBAAkB,GACvB,IAAI,CAAC,YAAY,CAAC,KAAA,GAClB,IAAI,CAAC,aAAa,CAAC,GACvB,GAEA,iBAAkB,SAAS,CAAK,CAAE,CAAG,EACjC,GAAI,AAAoB,GAApB,UAAU,MAAM,CAAO,CACvB,IAAI,EAAI,IAAI,CAAC,SAAS,GACtB,EAAQ,EAAE,KAAK,CACf,EAAM,EAAE,GAAG,AACf,CACA,OAAO,IAAI,CAAC,gBAAgB,CAAC,EAAO,EACxC,EAEA,UAAW,AAAA,EAAkB,KAAM,SAAS,CAAM,EAC9C,GAAI,IAAI,CAAC,eAAe,CAAE,CACtB,IAAI,EAAI,IAAI,CAAC,SAAS,GACtB,IAAI,CAAC,GAAG,CAAC,cAAe,EAAE,KAAK,CAAE,EAAE,GAAG,EACtC,IAAI,CAAC,kBAAkB,EAC3B,MAAO,GAAI,AAAU,MAAV,EACP,IAAI,CAAC,cAAc,CACf,IAAI,CAAC,KAAK,GACV,IAAI,CAAC,GAAG,CAAC,iBAAkB,KACvB,IAAI,CAAC,GAAG,CAAC,eAAgB,GACzB,IAAI,CAAC,GAAG,CAAC,qBACF,IAAI,CAAC,KAAK,UAGtB,CACH,IAAI,EAAM,IAAI,CAAC,KAAK,GAChB,EAAK,IAAI,CAAC,OAAO,CAEjB,EAAM,EAAM,AADL,IAAI,CAAC,IAAI,CAAC,EAAG,GAAG,CAAC,CACP,MAAM,CAAG,EAAG,GAAG,AAChC,CAAA,EAAG,GAAG,CAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAG,GAAK,IAAI,CAAC,GAAG,CAAC,aAAc,WACxD,IACJ,IAAI,CAAC,cAAc,CAAC,EAAK,EAC7B,CACJ,GAEA,eAAgB,WACZ,OAAO,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,IAAI,CAAE,UAC3C,EAEA,aAAc,WACV,OAAO,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,CAAE,UACzC,EAEA,MAAO,WACH,OAAO,IAAI,CAAC,WAAW,CAAC,WAAW,EACvC,EAEA,YAAa,AAAA,EAAkB,IAAK,SAAS,CAAK,CAAE,CAAG,EACnD,IAAI,CAAC,cAAc,CAAC,EAAO,EAC/B,GAEA,oBAAqB,AAAA,EAAkB,IAAK,SAAS,CAAK,CAAE,CAAG,EAC3D,IAAI,CAAC,cAAc,CAAC,EAAO,EAAK,CAAA,EAAO,CAAA,EAC3C,GAEA,KAAM,AAAA,EAAkB,KAAM,SAAS,CAAO,EAC1C,IAAI,CAAC,qBAAqB,GAC1B,IAAI,EAAQ,IAAI,CAAC,KAAK,GACtB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,IACxC,IAAI,CAAC,OAAO,CAAC,GACT,GACA,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAC7C,GAEA,2BAA4B,AAAA,EAAkB,iBAC1C,GAAI,CACA,IAAI,EAAO,MAAM,UAAU,SAAS,CAAC,QAAQ,GAC7C,IAAI,CAAC,eAAe,CAAC,GACrB,IAAI,CAAC,iBAAiB,CAAC,OAC3B,CAAE,MAAM,EAAI,CACR,QAAQ,KAAK,CAAC,GACd,IAAI,CAAC,WAAW,CAAC,+DACrB,CACJ,GAEA,0BAA2B,AAAA,EAAkB,IAAK,eAAe,CAAK,CAAE,CAAG,EACvE,GAAI,CACA,IAAI,EAAO,IAAI,CAAC,GAAG,CAAC,mBAAoB,EAAO,EAC/C,OAAM,UAAU,SAAS,CAAC,SAAS,CAAC,EACxC,CAAE,MAAM,EAAI,CACR,QAAQ,KAAK,CAAC,GACd,IAAI,CAAC,WAAW,CAAC,+DACrB,CACJ,GAEA,SAAU,AAAA,EAAkB,WACpB,QAAQ,IAAI,CAAC,IAAI,CAAC,eAAe,GACjC,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,CAAA,GAC1B,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAE,IAAI,CAAC,UAAU,EAClD,IAAI,CAAC,GAAG,CAAC,SAET,IAAI,CAAC,WAAW,CAAC,kCAEzB,GAEA,WAAY,AAAA,EAAkB,WACtB,QAAQ,IAAI,CAAC,IAAI,CAAC,eAAe,GACjC,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,CAAA,GAC1B,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAE,IAAI,CAAC,UAAU,EAClD,IAAI,CAAC,GAAG,CAAC,SAET,IAAI,CAAC,WAAW,CAAC,kCAEzB,GAEA,KAAM,WACF,OAAO,IAAI,CAAC,UAAU,CAAC,WAAW,EACtC,EAEA,iBAAkB,AAAA,EAAkB,IAAK,SAAS,CAAC,EAC/C,IAAI,CAAC,kBAAkB,GACvB,IAAI,CAAC,OAAO,CAAC,GACc,oBAAvB,IAAI,CAAC,cAAc,GACnB,IAAI,CAAC,UAAU,CAAC,WAAY,KAAM,KAClC,IAAI,CAAC,IAAI,CAAC,cAAe,CAAA,GAEjC,GAEA,wBAAyB,AAAA,EAAkB,IAAK,WAC5C,IAAI,CAAC,eAAe,CAAG,IAAI,CAAC,YAAY,GACxC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,EACrC,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,IAAI,CAAC,cAAe,CAAA,EAC7B,GAEA,kBAAmB,AAAA,EAAkB,WACjC,IAAI,CAAC,kBAAkB,GACvB,IAAI,CAAC,GAAG,CAAC,iBACT,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,GAAG,CAAC,uBACT,IAAI,CAAC,mBAAmB,EAC5B,GAEA,oBAAqB,AAAA,EAAkB,IAAK,WACxC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAK,EAC/B,EAAM,iBAAiB,CAAC,IAAI,CAAC,gBAAgB,GAAK,EACtD,EACJ,GAEA,SAAU,AAAA,EAAkB,IAAK,WAC7B,IAAI,CAAC,eAAe,CAAC,SAAS,CAAK,EAC/B,EAAM,aAAa,EACvB,EACJ,GAEA,qBAAsB,AAAA,EAAkB,WACpC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAK,EAC3B,EAAM,kBAAkB,IACxB,EAAM,aAAa,EAC3B,EACJ,GAIA,0BAA2B,WACvB,IAAI,EAAK,IAAI,CAAC,GAAG,CAAC,iBAAkB,KAC5B,AAAC,IAAI,CAAC,GAAG,CAAC,aAAc,IAAI,CAAC,IAAI,CAAC,0BAClC,IAAI,CAAC,GAAG,CAAC,qBACb,IAAI,EAAM,IAAI,CAAC,KAAK,GAAK,EAGzB,OAFA,IAAI,CAAC,GAAG,CAAC,sBAEF,CAAE,MADG,IAAI,CAAC,KAAK,GACN,IAAA,CAAI,CACxB,GACI,EAAK,IAAI,CAAC,GAAG,CAAC,qCACX,IAAI,CAAC,GAAG,CAAC,0CAChB,AAAI,EACO,CAAE,MAAO,KAAK,GAAG,CAAC,EAAG,KAAK,CAAE,EAAG,KAAK,EAClC,IAAK,KAAK,GAAG,CAAC,EAAG,GAAG,CAAE,EAAG,GAAG,CAAE,EAEpC,CACX,EAEA,eAAgB,AAAA,EAAkB,MAAO,SAAS,CAAK,CAAE,CAAG,CAAE,CAAQ,EAClE,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACvB,GAAK,IAAI,CAAC,eAAe,CAKrB,IAAI,CAAC,kBAAkB,OALA,CACvB,IAAI,EAAI,IAAI,CAAC,GAAG,CAAC,6BACjB,EAAQ,EAAE,KAAK,CACf,EAAM,EAAE,GAAG,AACf,CAIA,IAAI,CAAC,GAAG,CAAC,YAAa,GACtB,IAAI,EAAM,IAAI,CAAC,YAAY,CAAC,GAGxB,EAAS,GAAI,EAAM,OAwBvB,IAvBI,IAAI,CAAC,GAAG,CAAC,aAAc,iBACvB,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAC1B,EAAM,gBAED,IAAI,CAAC,GAAG,CAAC,aAAc,gBAC5B,EAAS,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,EAC5C,EAAM,cAED,IAAI,CAAC,GAAG,CAAC,aAAc,oBAC5B,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAC1B,EAAM,mBAED,IAAI,CAAC,GAAG,CAAC,aAAc,4CAC5B,EAAS,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,EAC5C,EAAM,mBAGN,IACA,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,GAAI,IAAI,CAAC,KAAK,GAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,EACtE,EAAS,IAKT,IAAI,CAAC,GAAG,CAAC,eACT,IAAI,CAAC,GAAG,CAAC,+BACL,CAAA,IAAI,CAAC,KAAK,IAAM,EAAI,WAAW,EAAA,GAEnC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,GAAI,IAAI,CAAC,KAAK,GAAK,EAAG,KAC9C,GAAO,IAAI,CAAC,GAAG,CAAC,aAAc,IAC9B,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,GAAI,IAAI,CAAC,KAAK,GAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,EAI9E,IAAI,CAAC,GAAG,CAAC,qBAIT,IADA,IAAI,EAAM,IAAI,CAAC,KAAK,GAAI,EAAO,CAAA,EACxB,CAAC,GAAM,CACV,IAAI,EAAI,IAAI,CAAC,KAAK,EACd,CAAC,IAAI,CAAC,GAAG,CAAC,wBAAyB,QACnC,CAAA,EAAO,CAAA,CADX,EAGI,IAAI,CAAC,KAAK,IAAM,EAAI,WAAW,KAC/B,IAAI,CAAC,GAAG,CAAC,YAAa,GACtB,EAAO,CAAA,GAEP,IAAI,CAAC,OAAO,CAAC,GAAG,CAAG,IAAI,CAAC,IAAI,CAAC,eAAiB,IAC1C,EAAI,GACJ,IAAI,CAAC,GAAG,CAAC,YAAa,GAE1B,IAAI,CAAC,GAAG,CAAC,8BACT,IAAI,CAAC,GAAG,CAAC,WACT,IAAI,CAAC,GAAG,CAAC,SAAU,GACnB,EAAM,IAAI,CAAC,KAAK,GAExB,CAEA,EAAI,OAAO,EACf,EACJ,GAKA,qBAAsB,AAAA,EAAkB,WACpC,IAAI,CAAC,GAAG,CAAC,sBAGT,IAAI,EAAS,GACT,IAAI,CAAC,GAAG,CAAC,aAAc,yBACvB,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CACrB,CAAA,SAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAE,IAAM,CAAA,EACnC,IAAI,CAAC,SAAS,CAAC,EAAE,CAEhB,IAAI,CAAC,GAAG,CAAC,aAAc,gCAC5B,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CACtB,OAAO,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,UAAU,CAAC,GAAK,GACtD,IAAI,CAAC,SAAS,CAAC,EAAE,CAEhB,IAAI,CAAC,GAAG,CAAC,aAAc,sBAC5B,CAAA,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,AAAF,EAG5B,IAAI,CAAC,GAAG,CAAC,qBACL,IAAI,CAAC,GAAG,CAAC,UACT,IAAI,CAAC,GAAG,CAAC,WAEb,IAAI,CAAC,GAAG,CAAC,SAAU,KAAM,GAEpB,IAAI,CAAC,GAAG,CAAC,aAAc,WACxB,IAAI,CAAC,GAAG,CAAC,WACT,IAAI,CAAC,GAAG,CAAC,iBAEjB,GAEA,iBAAkB,AAAA,EAAoB,WAClC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAK,EAC/B,IAAI,EAAK,EAAM,aAAa,GAC5B,IAAI,CAAC,GAAG,CAAC,eAAgB,KAAK,KAAK,CAAC,EAAK,OACzC,IAAI,CAAC,GAAG,CAAC,WACb,EACJ,GAEA,eAAgB,AAAA,EAAoB,WAChC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAK,EAC/B,IAAI,EAAK,EAAM,aAAa,GAC5B,IAAI,CAAC,GAAG,CAAC,gBAAiB,KAAK,KAAK,CAAC,EAAK,OAC1C,IAAI,CAAC,GAAG,CAAC,WACb,EACJ,GAEA,UAAW,AAAA,EAAkB,IAAK,SAAS,CAAG,EACtC,AAAO,MAAP,GAAa,CAAA,EAAM,CAAA,EACvB,IAAI,CAAC,eAAe,CAAC,SAAS,CAAK,EAC/B,EAAM,QAAQ,CAAC,EACnB,EACJ,GAEA,YAAa,AAAA,EAAkB,IAAK,SAAS,CAAG,EACxC,AAAO,MAAP,GAAa,CAAA,EAAM,CAAA,EACvB,IAAI,CAAC,eAAe,CAAC,SAAS,CAAK,EAC/B,EAAM,UAAU,CAAC,EACrB,EACJ,GAEA,yBAA0B,AAAA,EAAkB,WACxC,IAAI,CAAC,GAAG,CAAC,iBAAkB,WAEvB,IADA,IAAI,CAAC,GAAG,CAAC,YAAa,GACf,IAAI,CAAC,OAAO,CAAC,GAAG,CAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CACxC,IAAI,EAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CACtC,EAAI,OAAO,IAAI,CAAC,GAKhB,GAJI,IACA,IAAI,CAAC,GAAG,CAAC,qBACT,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,GAAK,EAAE,KAAK,CAAE,IAAI,CAAC,KAAK,GAAK,EAAK,MAAM,GAEnE,CAAC,IAAI,CAAC,GAAG,CAAC,gBACV,KACR,CACJ,EACJ,GAEA,aAAc,SAAS,CAAC,EACpB,OAAO,IAAI,CAAC,SAAS,CAAC,EAAE,AAC5B,EAEA,gBAAiB,WACb,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,AAC/B,EAEA,UAAW,WACP,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,AAC1D,EAEA,KAAM,AAAA,EAAoB,WACtB,IAAI,CAAC,kBAAkB,GACnB,AAAC,IAAI,CAAC,aAAa,IACnB,IAAI,CAAC,WAAW,CAAC,8BAEzB,GAEA,iBAAkB,AAAA,EAAkB,WAChC,IAAI,EAAI,EAAE,CAOV,GAPkB,IAAI,CAAC,KAAK,GAC5B,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,AAAA,IACrB,GAAI,AAAU,GAAV,EAAE,IAAI,CAAO,CACb,IAAI,EAAI,EAAE,OAAO,CAAC,IAAI,CAAC,AAAA,GAAK,CAAC,CAAC,EAAE,GAAK,IAAI,CAAC,WAAW,CACjD,CAAA,GAAG,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CACtB,CACJ,GACI,EAAE,MAAM,CAAE,CACV,EAAI,EAAE,OAAO,GACb,IAAI,EAAI,IAAI,CAAC,gBAAgB,GAAK,EAAE,MAAM,CAC1C,IAAI,CAAC,GAAG,CAAC,YAAa,CAAC,CAAC,EAAE,CAC9B,CACJ,GAEA,YAAa,AAAA,EAAkB,IAAK,SAAS,CAAC,EACtC,AAAK,MAAL,GAAW,CAAA,EAAI,CAAA,EACnB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAG,EAAE,EACjB,EAAI,GAAG,IAAI,CAAC,GAAG,CAAC,gBACpB,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACvB,IAAI,CAAC,GAAG,CAAC,eACT,IAAI,CAAC,GAAG,CAAC,6BAA8B,CAAA,GACvC,IAAI,CAAC,GAAG,CAAC,qBACT,IAAI,CAAC,GAAG,CAAC,oBAAqB,CAAA,GAC9B,IAAI,EAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAClC,EAAS,KAAK,KAAK,CAAE,AAAA,CAAA,IAAI,CAAC,IAAI,CAAC,eAAiB,EAAK,MAAK,AAAL,EAAU,GACnE,IAAI,CAAC,GAAG,CAAC,SAAU,IAAI,MAAM,CAAC,GAClC,EAER,GAIA,eAAgB,AAAA,EAAoB,WAC5B,AAAwB,kBAAxB,IAAI,CAAC,eAAe,EACpB,IAAI,CAAC,IAAI,CAAC,kBAAmB,MAEjC,IAqBI,EArBA,EAAM,IAAI,CAAC,IAAI,CAAC,mBACpB,GAAI,CAAC,EAAK,CACN,EAAM,IAAI,CAAC,IAAI,CAAC,kBAAmB,CAAC,GACpC,IAAI,EAAK,IAAI,CAAC,GAAG,CAAC,iBAAkB,WAIhC,OAHA,IAAI,CAAC,GAAG,CAAC,iBAAkB,CACvB,YAAa,IAAI,CAAC,IAAI,CAAC,sBAC3B,EAAG,iBACI,IAAI,CAAC,KAAK,EACrB,GACA,GAAI,GAAM,IAAI,CAAC,KAAK,GAChB,OAAO,IAAI,CAAC,WAAW,CAAC,oBAC5B,CAAA,EAAI,MAAM,CAAG,IAAI,CAAC,GAAG,CAAC,mBAAoB,EAAI,IAAI,CAAC,KAAK,IACxD,EAAI,KAAK,CAAG,EACZ,EAAI,MAAM,CAAG,IAAI,CAAC,KAAK,GAAK,EAC5B,EAAI,UAAU,CAAG,EACjB,EAAI,WAAW,CAAG,OAAO,MAAM,CAAC,MAChC,EAAI,OAAO,CAAG,CAAA,EACd,EAAI,MAAM,CAAG,IAAI,CACjB,EAAI,WAAW,CAAG,CAAE,IAAI,CAAE,CAC1B,EAAI,WAAW,CAAG,IAAI,AAC1B,CAQA,EAAI,MAAM,CAAC,GAAG,CAAC,iBAAkB,SAAS,IACtC,IACI,EADA,EAAO,IAAI,CAAC,IAAI,CAAC,uBAEjB,EAAQ,CAAA,EAGZ,GAFA,IAAI,CAAC,GAAG,CAAC,YAAa,EAAI,UAAU,EAE/B,EAAI,OAAO,CAiBT,CACH,KAAO,IAAI,CAAC,GAAG,CAAC,iBAAkB,EAAI,MAAM,GACxC,GAAI,CAAC,EAAK,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAI,MAAM,CAAC,MAAM,CAAG,IAAK,CACjD,EAAQ,CAAA,EACR,KACJ,CACJ,GAAI,EACA,EAAI,UAAU,CAAG,IAAI,CAAC,KAAK,GAC3B,EAAK,IAAI,CAAC,KAAK,GAAK,EAAI,MAAM,CAAC,MAAM,KAClC,CAEH,GADA,EAAI,MAAM,CAAG,IAAI,CAAC,SAAS,CAAC,gBAAiB,IAAI,EAC7C,EAAI,WAAW,CAAC,QAAQ,CAAC,EAAI,MAAM,EAAG,CACtC,EAAY,EAAI,MAAM,CACtB,EAAI,WAAW,CAAC,WAAW,CAAC,uBAC5B,EAAI,UAAU,CAAG,EAAI,KAAK,CAAG,EAAI,MAAM,CACvC,EAAI,WAAW,CAAC,IAAI,CAAC,kBAAmB,MACxC,MACJ,CACI,EAAI,WAAW,CAAC,IAAI,CAAC,EAAI,MAAM,EAC/B,EAAI,UAAU,CAAG,EACjB,EAAI,MAAM,CAAC,GAAG,CAAC,iBAAkB,GACjC,MAER,CACJ,KAzCkB,CACd,KAAO,IAAI,CAAC,GAAG,CAAC,kBAAmB,EAAI,MAAM,GACzC,GAAI,CAAC,EAAK,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAM,CAC7B,EAAQ,CAAA,EACR,KACJ,CAEJ,GAAI,EACA,EAAK,IAAI,CAAC,KAAK,GACf,EAAI,UAAU,CAAG,EACjB,IAAI,CAAC,GAAG,CAAC,YAAa,EAAK,EAAI,MAAM,CAAC,MAAM,MACzC,CACH,EAAI,OAAO,CAAG,CAAA,EACd,EAAI,UAAU,CAAG,EAAI,KAAK,CAAG,EAAI,MAAM,CACvC,EAAO,IAAI,CAAC,IAAI,EAChB,MACJ,CACJ,CAyBU,MAAN,IAEA,IAAI,CAAC,GAAG,CAAC,iBAAkB,CACvB,YAAa,IAAI,CAAC,IAAI,CAAC,sBAC3B,EAAG,gBACH,EAAY,IAAI,CAAC,GAAG,CAAC,mBAAoB,EAAI,IAAI,CAAC,KAAK,IACnD,EAAI,WAAW,CAAC,EAAU,EAC1B,EAAO,IAAI,CAAC,IAAI,EAE5B,GACiB,MAAb,IACA,IAAI,CAAC,YAAY,CAAC,EAAI,KAAK,CAAE,EAAI,KAAK,CAAG,EAAI,MAAM,CAAE,GACrD,EAAI,MAAM,CAAG,EAAU,MAAM,CAC7B,EAAI,WAAW,CAAC,EAAU,CAAG,CAAA,EAErC,GAIA,uBAAwB,AAAA,EAAkB,IAAK,SAAS,CAAO,EACvD,AAAW,MAAX,EAAiB,EAAU,MAC1B,GAAW,IAChB,IAAI,CAAC,eAAe,CAAC,SAAU,EACnC,GAEA,yBAA0B,AAAA,EAAkB,IAAK,SAAS,CAAO,EACzD,AAAW,MAAX,EAAiB,EAAU,MAC1B,GAAW,IAChB,IAAI,CAAC,eAAe,CAAC,SAAU,EACnC,GAEA,oBAAqB,AAAA,EAAkB,WACnC,IAAI,CAAC,eAAe,CAAC,oBACzB,GAEA,aAAc,AAAA,EAAkB,WAC5B,IAAI,CAAC,eAAe,CAAC,cACzB,GAEA,YAAa,AAAA,EAAkB,WAC3B,IAAI,CAAC,SAAS,CAAC,kBACnB,GAEA,SAAU,SAAS,CAAG,EAClB,IAAI,CAAC,SAAS,CAAC,SAAS,CAAK,EACzB,IAAI,EAAI,EAAM,mBAAmB,CAAC,EAC9B,CAAA,GAAG,EAAE,KAAK,EAClB,EACJ,EAEA,YAAa,AAAA,EAAkB,WAC3B,IAAI,CAAC,SAAS,CAAC,qBAAsB,IAAI,CAAC,gBAAgB,GAAK,EACnE,GAEA,gBAAiB,AAAA,EAAkB,WAC/B,IAAI,CAAC,SAAS,CAAC,yBAA0B,IAAI,CAAC,gBAAgB,GAAK,EACvE,GAEA,iBAAkB,AAAA,EAAkB,sBAAuB,SAAS,CAAM,EACtE,IAAI,CAAC,SAAS,CAAC,SAAS,CAAK,EACzB,GAAI,CAAC,KAAK,IAAI,CAAC,GAAS,CACpB,GAAI,EAAM,OAAO,CAAC,MAAM,CAAG,EAAG,OAC9B,EAAS,EAAM,OAAO,CAAC,EAAE,AAC7B,CACA,EAAM,cAAc,CAAC,EACzB,EACJ,GAEA,YAAa,AAAA,EAAkB,WAC3B,IAAI,EAAO,IAAI,CACf,SAAS,IACL,EAAK,SAAS,CAAC,SAAS,CAAK,EACzB,EAAM,kBAAkB,GACxB,EAAM,UAAU,CAAC,EACrB,EACJ,CACA,GAAI,EAAK,KAAK,GAAI,CACd,IAAI,EAAM,UAAY,EAAK,IAAI,CAAG,0BAClC,EAAK,GAAG,CAAC,gBAAiB,EAAK,SAAS,CAAG,EACnC,GAAK,GACb,EACJ,MACI,GAER,GAEA,cAAe,AAAA,EAAkB,8BAA+B,SAAS,CAAI,EACzE,IAAI,CAAC,SAAS,CAAC,SAAS,CAAK,EACzB,EAAM,YAAY,CAAC,IAAI,CAAE,EAC7B,EACJ,GAIA,sBAAuB,AAAA,EAAkB,IAAK,WAC1C,GAAI,CAAC,IAAI,CAAC,qBAAqB,GAAI,CAC/B,IAAI,CAAC,GAAG,CAAC,qBACT,IAAI,EAAM,IAAI,CAAC,KAAK,GAGpB,GAFA,IAAI,CAAC,GAAG,CAAC,eACT,IAAI,CAAC,GAAG,CAAC,gBACL,IAAI,CAAC,KAAK,IAAM,EAEhB,OADA,IAAI,CAAC,WAAW,CAAC,EAAK,IAAI,CAAC,KAAK,IACzB,CAAA,CAEf,CACJ,GAGA,mBAAoB,AAAA,EAAoB,WACpC,IAAI,EAeJ,GAdA,IAAI,CAAC,GAAG,CAAC,iBAAkB,WAEvB,IADA,IAAI,EAAO,EACJ,AAAQ,GAAR,GAAa,IAAI,CAAC,GAAG,CAAC,yBAA0B,6BACnD,EAAM,IAAI,CAAC,GAAG,CAAC,eAAgB,GAC3B,IAAI,CAAC,GAAG,CAAC,aAAc,UACvB,EAAE,EAEG,CAAC,IAAI,CAAC,GAAG,CAAC,aAAc,yBAC7B,EAAE,CAGN,AAAQ,CAAA,GAAR,GACA,CAAA,EAAM,IADV,CAEJ,GACI,EACA,IAAI,CAAC,GAAG,CAAC,SAAU,KAAM,EAAK,UAE9B,MAAM,IAAI,EAAgB,+BAElC,GAEA,eAAgB,WACZ,OAAO,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,CAAE,UAC1C,EAEA,WAAY,AAAA,EAAkB,uCAAwC,SAAS,CAAK,CAAE,CAAG,CAAE,CAAI,EAC3F,GAAI,EAAM,EAAO,CAAE,IAAI,EAAM,EAAO,EAAQ,EAAK,EAAM,CAAK,CACxD,AAAE,aAAgB,UAClB,CAAA,EAAO,IAAI,CAAC,QAAQ,CAAC,EAAK,AAAL,EACzB,IAAI,CAAC,kBAAkB,GACvB,IAAI,CAAC,GAAG,CAAC,YAAa,GACtB,EAAQ,IAAI,CAAC,YAAY,CAAC,EAAO,CAAA,GACjC,EAAM,IAAI,CAAC,YAAY,CAAC,GACxB,IAAI,CAAC,YAAY,CACb,CACI,UAAW,SAAS,CAAG,EACnB,GAAI,GAAO,EAAM,WAAW,IAAM,GAAO,EAAI,WAAW,GACpD,OAAO,IAAI,CAAC,gBAAgB,CAAC,EACjC,MAAM,gBACV,CACJ,EACA,WACI,GAAI,CACA,OAAa,CACT,IAAI,EAAM,IAAI,CAAC,KAAK,GAEpB,GADA,EAAK,IAAI,CAAC,IAAI,EACV,IAAI,CAAC,KAAK,IAAM,GAAO,CAAC,IAAI,CAAC,GAAG,CAAC,gBACjC,KACR,CACJ,CAAE,MAAM,EAAI,CACR,GAAI,AAAO,mBAAP,EACA,MAAM,CACd,QAAU,CACN,EAAM,OAAO,GACb,EAAI,OAAO,EACf,CACJ,EAER,GAEA,eAAgB,AAAA,EAAkB,KAAM,SAAS,CAAK,CAAE,CAAG,EACvD,IAAI,EAAO,IAAI,CAAC,IAAI,CAAC,wBAA0B,IAAI,CAAC,IAAI,CAAC,wBACpD,IACL,IAAI,CAAC,kBAAkB,GACvB,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACvB,EAAM,IAAI,CAAC,YAAY,CAAC,GACxB,IAAI,CAAC,GAAG,CAAC,YAAa,GACtB,IAAI,EAAM,IACV,EAAK,KAAO,IAAI,CAAC,KAAK,GAAK,EAAI,WAAW,IAAI,CAC1C,KAAO,IAAI,CAAC,GAAG,CAAC,aAAc,WAC1B,GAAI,CAAC,IAAI,CAAC,GAAG,CAAC,gBAAiB,MAAM,EAGzC,IADA,IAAI,EAAM,IAAI,CAAC,OAAO,CAAC,GAAG,CACnB,IAAI,CAAC,GAAG,CAAC,aAAc,QAAU,EAAM,GAAK,CAC/C,GAAI,CAAC,IAAI,CAAC,GAAG,CAAC,gBAAiB,MAAM,CACrC,GAAE,CACN,CAUA,GATI,EAAM,GAAK,CAAA,EAAM,CAArB,EACI,MAAM,OAAO,CAAC,EAAK,EAAE,GACrB,IAAI,CAAC,GAAG,CAAC,SAAU,EAAK,EAAE,CAAC,EAAE,CAAE,KAC/B,IAAI,CAAC,GAAG,CAAC,eACT,IAAI,CAAC,GAAG,CAAC,SAAU,IAAK,EAAK,EAAE,CAAC,EAAE,GAElC,IAAI,CAAC,GAAG,CAAC,SAAU,EAAK,EAAE,CAAE,KAEhC,IAAI,CAAC,GAAG,CAAC,qBACL,CAAC,IAAI,CAAC,GAAG,CAAC,gBAAiB,KACnC,CACA,IAAI,CAAC,GAAG,CAAC,YAAa,GAClB,IAAI,CAAC,OAAO,CAAC,GAAG,CAAG,GAAK,CAAC,IAAI,CAAC,GAAG,CAAC,aAAc,WAChD,IAAI,CAAC,GAAG,CAAC,qBACjB,GACJ,GAEA,iBAAkB,AAAA,EAAkB,IAAK,SAAS,CAAK,CAAE,CAAG,EACxD,IAAI,EAAQ,IAAI,CAAC,IAAI,CAAC,uBAClB,EAAQ,IAAI,CAAC,IAAI,CAAC,wBAClB,CAAA,AAAC,GAAU,CAAA,IACf,IAAI,CAAC,kBAAkB,GACvB,IAAI,CAAC,GAAG,CAAC,iBAAkB,WAGvB,IAFA,EAAM,IAAI,CAAC,YAAY,CAAC,GACxB,IAAI,CAAC,GAAG,CAAC,YAAa,GACf,IAAI,CAAC,KAAK,GAAK,EAAI,WAAW,KACjC,IAAI,CAAC,GAAG,CAAC,sBACL,GAAS,IAAI,CAAC,GAAG,CAAC,aAAc,EAAM,EAAE,EACxC,IAAI,CAAC,GAAG,CAAC,cAAe,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,EACzC,GAAS,IAAI,CAAC,GAAG,CAAC,aAAc,EAAM,EAAE,GAC/C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,GAAI,IAAI,CAAC,KAAK,GAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAE,IAAI,CAAC,SAAS,CAAC,EAAE,EAE9F,IAAI,CAAC,GAAG,CAAC,qBACJ,IAAI,CAAC,GAAG,CAAC,mBAEtB,GACJ,GAEA,aAAc,AAAA,EAAkB,KAAM,SAAS,CAAK,CAAE,CAAG,EACrD,IAAI,EAAQ,IAAI,CAAC,IAAI,CAAC,uBAClB,EAAQ,IAAI,CAAC,IAAI,CAAC,wBAClB,CAAA,AAAC,GAAU,CAAA,IACX,IAAI,CAAC,eAAe,CACpB,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACvB,IAAI,CAAC,GAAG,CAAC,YAAa,GAElB,GAAU,IAAI,CAAC,GAAG,CAAC,aAAc,EAAM,EAAE,GAExC,GAAS,IAAI,CAAC,GAAG,CAAC,aAAc,EAAM,EAAE,EAEzC,IAAI,CAAC,GAAG,CAAC,mBAAoB,EAAO,GAEpC,IAAI,CAAC,GAAG,CAAC,iBAAkB,EAAO,EAE1C,IAEA,IAAI,CAAC,GAAG,CAAC,eACL,EACA,IAAI,CAAC,GAAG,CAAC,SAAU,IAAK,EAAM,EAAE,CAAE,MAElC,IAAI,CAAC,GAAG,CAAC,SAAU,IAAK,EAAM,EAAE,CAAC,EAAE,CAAE,EAAM,EAAE,CAAC,EAAE,EAChD,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAM,EAAE,CAAC,EAAE,CAAC,MAAM,GAEhD,IAAI,CAAC,GAAG,CAAC,gBAEjB,GAEA,qBAAsB,AAAA,EAAkB,IAAK,WACzC,IAAI,EAAK,IAAI,CAAC,MAAM,GAAI,EAAS,CAC7B,AAAM,OAAN,EACA,EAAS,MACJ,AAAM,KAAN,EACL,EAAS,QACJ,AAAM,MAAN,GACL,CAAA,EAAS,SADR,EAEL,IAAI,CAAC,YAAY,CAAC,CACd,OAAQ,CAAA,EACR,QAAS,CAAA,EACT,KAAM,AAtuClB,SAAwB,CAAA,GACpB,CAAE,CAAA,KAAE,CAAI,CAAA,QAAE,CAAO,CAAA,MAAE,CAAK,CAAA,OAAE,CAAM,CACnC,EACG,MAAO;A;AAE+D,0EAAA,EAAE,EAAG;AAC7E,EAAA,EAAE,AAAQ,MAAR,EAAe;AAC0D,6EAAA,EAAE,EAAK,KAAK,EAAE,EAAQ;AACjG,EAAA,CAAC,CAAG;AACoE,0EAAA,EAAE,EAAM;AACL,6EAAA,EAAE,EAAO;AAC9E,QAAA,CAAC,AACT,EA0tCiC,CACjB,GAAU,AAAA,EAAI,UAAU,CAAC,GACzB,KAAU,EAAK,EAAG,UAAU,CAAC,GAAK,KAClC,QAAU,EAAK,EAAG,UAAU,GAAG,QAAQ,CAAC,IAAI,WAAW,GAAK,KAC5D,MAAU,IAAI,CAAC,KAAK,GACpB,KAAU,IAAI,CAAC,WAAW,GAC1B,OAAU,AAAA,EAAY,IAAI,CAAC,WAAW,GAAI,EAC9C,EACJ,EACJ,GAEA,gBAAiB,AAAA,EAAkB,IAAK,SAAS,CAAK,EAClD,IAAI,EAAO,AAAA,IACP,IAAI,EAAO,IAAI,CAAC,IAAI,CAAC,eACrB,IAAI,CAAC,IAAI,CAAC,cAAe,CAAC,GAC1B,IAAI,CAAC,UAAU,CAAC,CAAC,mBAAmB,EAAE,EAAM,MAAM,EAAE,EAAK,CAAC,CAAC,CAAE,CAAA,EAAO,IACxE,CACI,AAAS,OAAT,EACA,IAAI,CAAC,cAAc,CAAC,AAAA,IAChB,IAAI,CAAC,GAAG,CAAC,oBAAqB,wBAC9B,EAAG,OAAO,GACV,EAAG,eAAe,CAAG,EAAG,YAAY,CAAC,EAAG,KAAK,GAAI,CAAA,GACjD,EAAG,GAAG,CAAC,SAAU,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,GACxC,EAAG,mBAAmB,GACtB,IAAI,CAAC,GAAG,CAAC,yBAA0B,EACvC,GAEA,EAAK,EAEb,GAEA,YAAa,AAAA,EAAkB,WAE3B,AADY,IAAI,CAAC,KAAK,CAChB,kBAAkB,EAC5B,GAEA,cAAe,AAAA,EAAkB,WAC7B,IAAI,EAAQ,IAAI,CAAC,KAAK,CAClB,EAAM,EAAM,cAAc,CAAC,UAC/B,EAAM,cAAc,CAAC,GACrB,EAAI,UAAU,CAAC,IACf,EAAI,YAAY,CAAC,KACb,EAAI,OAAO,CAAC,CAAC,0BAA0B,EAAE,IAAI,CAAC,IAAI,CAAC;AAAA;AAAA;AAA+B,CAAC,EACnF,EAAI,GAAG,CAAC,iBACR,IAAI,EAAa,CAAC,EAAQ,KACtB,IAAK,GAAI,CAAE,EAAK,EAAK,GAAI,OAAO,OAAO,CAAC,GAAc,CAClD,IAAI,EAAM,AAAC,CAAA,EAAS,EAAS,IAAM,EAAA,EAAM,EACzC,GAAI,MAAM,OAAO,CAAC,GAAM,CACpB,IAAI,EAAM,KACV,GAAO,EACP,IAAK,IAAI,EAAI,GAAK,EAAI,MAAM,CAAE,MAAO,GAAI,GAAO,IAChD,GAAO,MACH,CAAA,AAAiB,YAAjB,OAAO,CAAG,CAAC,EAAE,CAAiB,WAAa,KAAK,SAAS,CAAC,EAAA,EAE9D,EAAI,GAAG,CAAC,SAAU,GAClB,EAAI,GAAG,CAAC,UACZ,MAAW,GAAO,AAAc,UAAd,OAAO,GACrB,EAAW,EAAK,EAExB,CACJ,EACA,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,GAAG,OAAO,CAAC,CAAC,EAAQ,KACpC,EAAQ,GAAG,EAAI,GAAG,CAAC,SAAU,MACjC,EAAI,GAAG,CAAC,SAAU,CAAC,QAAQ,EAAE,EAAO,IAAI,EAAI;AAAc,CAAC,EAC3D,EAAI,GAAG,CAAC,WACR,EAAW,GAAI,EAAO,WAAW,CACrC,EACJ,GACA,EAAI,KAAK,CAAC,CAAA,GACV,EAAI,GAAG,CAAC,YAAa,EACzB,GAEA,iCAAkC,AAAA,EAAkB,WAChD,IAAI,CAAC,cAAc,CAAC,AAAA,IAChB,EAAG,MAAM,CAAC,qCACV,IAAI,CAAC,IAAI,CAAC,yBAA0B,AAAC,IACjC,IAAI,EAAQ,IAAI,CAAC,KAAK,AACtB,CAAA,EAAM,SAAS,CAAC,EAAI,CAAG,CAAE,OAAQ,EAAM,cAAc,EAAG,EACxD,IAAI,CAAC,UAAU,CAAC,CAAC,mBAAmB,EAAE,EAAI,CAAC,CAAC,CAAE,KAAM,IACxD,GACA,IAAI,CAAC,UAAU,CAAC,GACpB,EACJ,GAEA,iBAAkB,AAAA,EAAkB,WAChC,IAAI,CAAC,cAAc,CAAC,AAAA,IAChB,EAAG,MAAM,CAAC,qBACV,IAAI,CAAC,IAAI,CAAC,yBAA0B,AAAC,GAAQ,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,IACvE,IAAI,CAAC,UAAU,CAAC,GACpB,EACJ,EAEJ,GAkCI,AAAA,EAAa,WAAW,CAAC,CAErB,iBAAkB,AAAA,EAAkB,yBAA0B,SAAS,CAAK,CAAE,CAAG,CAAE,CAAM,EACrF,GAAmB,IAAI,CAAE,EAAO,EAAK,SAAS,CAAE,CAAE,CAAE,CAAE,CAAE,EAChD,EAAK,EACL,IAAI,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC,GAAK,GAEjC,IAAI,CAAC,WAAW,CAAC,EAAI,GAEzB,IAAI,CAAC,WAAW,CAAC,EAAQ,EAAK,EAClC,EACJ,GAEA,eAAgB,AAAA,EAAkB,IAAK,SAAS,CAAK,CAAE,CAAG,EACtD,IAAI,EAAO,EAAE,CACb,GAAmB,IAAI,CAAE,EAAO,EAAK,SAAS,CAAE,CAAE,CAAE,CAAE,CAAE,CAAE,CAAK,EAC3D,IAAI,EAAM,IAAI,CAAC,gBAAgB,CAAC,EAAI,EAChC,CAAA,EAAK,EAAK,GACV,CAAA,GAAO,IAAI,MAAM,CAAC,EAAQ,EAAK,EADnC,EAEA,EAAK,IAAI,CAAC,GACV,IAAI,CAAC,WAAW,CAAC,EAAI,EACzB,GACA,IAAI,CAAC,IAAI,CAAC,mBAAoB,EAClC,GAEA,gBAAiB,AAAA,EAAkB,IAAK,SAAS,CAAK,CAAE,CAAG,EACvD,IAAI,CAAC,GAAG,CAAC,mBAAoB,EAAO,EAC3B,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAK,GAAG,CAC/B,IAAI,CAAC,iBAAiB,CAAC,GAAO,GAAG,GAClE,GAEA,iBAAkB,SAAS,CAAK,CAAE,CAAI,EAClC,IAAI,EAAM,IAAI,CAAC,iBAAiB,CAAC,GAAO,GAAG,CAC3C,IAAI,CAAC,OAAO,CAAC,GACb,EAAK,OAAO,CAAC,CAAC,EAAM,KACZ,EAAI,IACC,IAAI,CAAC,GAAG,CAAC,kBACV,IAAI,CAAC,GAAG,CAAC,eACT,IAAI,CAAC,GAAG,CAAC,YAEb,IAAI,CAAC,GAAG,CAAC,iBAAkB,EAAK,CAAA,IAEpC,IAAI,CAAC,GAAG,CAAC,SAAU,EACvB,EACJ,EAEA,eAAgB,AAAA,EAAkB,IAAK,SAAS,CAAK,EACjD,IAAI,EAAK,IAAI,CAAC,IAAI,CAAC,oBACnB,GAAI,AAAM,MAAN,EACA,MAAM,IAAI,EAAgB,uBAC9B,IAAI,CAAC,GAAG,CAAC,mBAAoB,EAAO,EACxC,GAEA,cAAe,WACN,IAAI,CAAC,YAAY,GAClB,IAAI,CAAC,YAAY,CAAG,CAAA,EACpB,IAAI,CAAC,WAAW,CAAC,GAAG,GAE5B,CAEJ,GAKA,AAAA,EAAa,WAAW,CAAC,CACrB,mBAAoB,AAAA,EAAkB,IAAK,SAAS,CAAG,EACnD,IAAI,IAAI,CAAC,KAAK,CAAC,cAAc,IAG7B,GAAI,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAI,YAC/B,IAAI,CAAC,WAAW,CAAC,oCAGrB,IAAI,CAAC,UAAU,CAAC,2BAChB,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,AAAQ,OAAR,GAC1B,GACA,iBAAkB,AAAA,EAAkB,WAChC,IAAI,IAAI,CAAC,KAAK,CAAC,cAAc,IAG7B,GAAI,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAI,YAChC,IAAI,CAAC,UAAU,CAAC,0BAGpB,IAAI,CAAC,UAAU,CAAC,0BAChB,IAAI,CAAC,KAAK,CAAC,SAAS,GACxB,GACA,0BAA2B,AAAA,EAAkB,IAAK,SAAS,CAAG,EAC1D,IAAI,CAAC,KAAK,CAAC,SAAS,GAChB,AAAQ,OAAR,GACA,CAAA,EAAM,CAAA,EACV,IAAI,EAAQ,IAAI,CAAC,KAAK,CAAC,YAAY,GACnC,IAAI,CAAC,gBAAgB,CAAC,MACtB,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAK,EAC7B,EACJ,GAKJ,CACI,eACA,eACA,eACA,oBACA,eACA,oBACA,mCACA,sBACA,gBACA,gBACA,gBACA,qBACA,gBACA,cACA,gBAEH,CAAC,OAAO,CAAC,SAAS,CAAG,EAClB,AAAA,EAAa,QAAQ,CAAC,EAAM,QAAQ,CAAG,AAAA,EAAkB,IAAK,WAC1D,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,QAAQ,CAAC,EAAK,WACnB,IAAI,CAAC,mBAAmB,EAC5B,EACJ,GEj+CA,IAAI,GAAQ,KAAM,GAAiB,KAAM,GAAgB,KACzD,SAAS,GAAoB,CAAK,CAAE,CAAI,CAAE,CAAA,QAAE,EAAU,CAAA,CAAA,CAAA,SAAO,EAAW,CAAA,CAAA,CAAO,CAAG,CAAC,CAAC,EAChF,KACA,IAAI,EAAgB,SAAS,aAAa,CACtC,EAAQ,IAAI,CAAC,KAAK,CAEtB,AADA,CAAA,GAAQ,IAAI,CAAZ,EACM,QAAQ,CAAC,cACf,EAAK,OAAO,CAAC,CAAC,EAAO,KACjB,IAAI,EAAQ,CACQ,CAAA,UAAhB,OAAO,IACP,EAAQ,EAAM,KAAK,CACnB,EAAQ,EAAM,KAAK,EAEvB,IAAI,EAAK,AAAA,EAAI,QAAQ,CAAC,CAAC,yCAAyC,EAAE,AAAA,EAAI,UAAU,CAAC,GAAO;AAC1C,sDAAA,EAAE,EAAM,EAAE,EAAE,AAAA,EAAI,UAAU,CAAC,GAAO,MAAM,CAAC,EACvF,GAAM,GAAG,CAAC,EACd,GACA,AAAA,EAAI,EAAE,CAAC,GAAM,iBAAiB,GAAI,CAC9B,MAAO,AAAA,IACH,EAAc,KAAK,GACnB,IAAI,EAAO,EAAG,MAAM,CACf,AAAA,EAAI,QAAQ,CAAC,EAAM,qBACxB,GAAO,CAAC,EAAK,OAAO,CAAC,KAAK,EAC1B,GAAa,IAAI,CAAC,IAAI,EAC1B,CACJ,GACA,EAAM,aAAa,CAAC,GAAM,UAAU,IACpC,GAAO,GAIP,IAAI,EAAW,IAAI,CAAC,IAAI,CAAC,mBAAqB,AAAA,EAAQ,KAClD,KACA,IAAI,CAAC,GAAG,CAAC,sBAAuB,CAAE,QAAA,EAAS,SAAA,CAAS,EACxD,EAAG,GAEH,IAAI,CAAC,UAAU,CAAC,IACZ,GAAU,IAAI,CAAC,gBAAgB,CAAC,WAAY,GAChD,GAAM,gBAAgB,CAAC,YAAa,KAChC,IAAI,CAAC,SAAS,CAAC,IACX,GAAU,IAAI,CAAC,mBAAmB,CAAC,WAAY,EACvD,EACJ,CAEA,SAAS,KACD,IAAO,GAAM,OAAO,GACxB,GAAQ,KACR,GAAgB,KAChB,GAAiB,IACrB,CAEA,SAAS,GAAO,CAAG,EAEf,IAAI,EAAQ,IAAI,AADL,GAAM,iBAAiB,GACb,gBAAgB,CAAC,oBAAoB,CACtD,EAAI,EAAM,MAAM,CACpB,GAAkB,AAAC,CAAA,EAAM,EAAK,CAAA,EAAK,EACnC,EAAM,OAAO,CAAC,AAAA,IACV,IAAI,EAAU,EAAG,OAAO,CAAC,KAAK,EAAI,EAC9B,CAAA,GAAS,CAAA,GAAgB,CAA7B,EACA,AAAA,EAAI,SAAS,CAAC,EAAI,EAAS,WAC/B,GACA,GAAc,cAAc,CAAC,CAAE,MAAO,SAAU,EACpD,CAEO,SAAS,GAAuB,CAAW,CAAE,CAAI,CAAE,CAAQ,EAC9D,IAAI,CAAC,cAAc,CAAC,SAAS,CAAE,EAC3B,IAAI,EAAM,IAAgB,GAC1B,IAAI,EAAe,EAAG,IAAI,CAAC,CACvB,eAAgB,EAChB,gBAAiB,EACjB,sBAAuB,CAAC,EAAM,KACtB,AAAQ,MAAR,GACA,CAAA,EAAO,EAAG,GAAG,CAAC,sBADlB,EAEI,EACA,EAAS,IAAI,CAAC,IAAI,CAAE,EAAI,EAAM,GAE9B,EAAM,CAAA,EACd,EACA,wBAAyB,AAAA,IACrB,EAAG,IAAI,CAAC,GACJ,GACA,EAAK,IAAI,CAAC,IAAI,CAAE,EACxB,CACJ,GACA,EAAG,GAAG,CAAC,sBAAuB,CAAE,QAAS,CAAA,EAAM,SAAU,CAAC,CAAI,EAClE,EACJ,CAEA,SAAS,GAAoB,CAAE,CAAE,CAAG,CAAE,CAAI,CAAE,CAAA,SAAE,EAAW,CAAA,CAAA,CAAO,CAAG,CAAC,CAAC,EAEjE,IAAI,EAAY,EAAI,WAAW,CAAC,KAC5B,EAAM,EAAI,KAAK,CAAC,EAAG,EAAU,GAC7B,EAAU,EAAI,KAAK,CAAC,EAAU,GAClC,AAJW,IAAI,CAIV,KAAK,CAAC,eAAe,CAAC,EAAK,SAAU,CAAK,EAQ3C,GAAK,EAGE,CACH,IAAI,EAAc,EAAE,CACpB,IAAK,IAAI,KAAK,OAAO,IAAI,CAAC,GAClB,AAAsB,GAAtB,EAAE,OAAO,CAAC,IACV,EAAY,IAAI,CAbxB,AAAI,AAAoB,aAApB,CAAK,CAa0C,EAbpC,CAAC,IAAI,CACT,AAYwC,EAZjC,IAYiC,GAGnD,GAAI,AAAsB,GAAtB,EAAY,MAAM,CAClB,EAAK,EAAE,MACJ,CACH,IAAI,EAAS,Ab6KtB,SAAS,EAAc,CAAO,EACjC,OAAQ,EAAQ,MAAM,EACpB,KAAK,EACH,MAAO,EACT,MAAK,EACH,OAAO,CAAO,CAAC,EAAE,AACnB,MAAK,EACH,IAAI,EAAI,CAAO,CAAC,EAAE,CACd,EAAI,CAAO,CAAC,EAAE,CACd,EAAI,KAAK,GAAG,CAAC,EAAE,MAAM,CAAE,EAAE,MAAM,EAC/B,EAAI,EACR,KAAO,EAAI,GAAK,EAAE,MAAM,CAAC,KAAO,EAAE,MAAM,CAAC,IAAI,EAAE,EAC/C,OAAO,EAAE,SAAS,CAAC,EAAG,EACxB,SACE,OAAO,EAAc,CAAE,CAAO,CAAC,EAAE,CAAE,EAAc,EAAQ,KAAK,CAAC,IAAK,CACxE,CACJ,Ea7L2C,EACvB,CAAA,GAAU,GAAY,EAGf,AAAsB,GAAtB,EAAY,MAAM,CACzB,EAAK,CAAE,EAAK,EAEZ,EAAK,EAAY,GAAG,CAAC,AAAA,GAAS,CAAA,CAAE,MAAO,EAAM,MAAO,EAAM,CAAK,CAAA,KAL/D,EAAG,GAAG,CAAC,2BAA4B,EAAM,GACzC,EAAK,EAAY,GAAG,CAAC,AAAA,GAAS,CAAA,CAAE,MAAO,EAAM,MAAO,EAAM,CAAK,CAAA,IAMvE,CACJ,MAtBI,EAAG,WAAW,CAAC,aACf,EAAK,KAsBb,EACJ,CA+NA,SAAS,KACD,IACA,GAAO,GAAiB,EAEhC,CAEA,SAAS,KACD,IACA,GAAO,GAAiB,EAEhC,CAcA,SAAS,KACL,GAAI,GAAO,CACP,IAAI,EAAO,GACP,GACA,KACA,IAAI,CAAC,GAAG,CAAC,2BAA4B,EAAK,OAAO,CAAC,KAAK,EACvD,IAAI,CAAC,GAAG,CAAC,iCAET,IAAI,CAAC,WAAW,CAAC,sBAEzB,MACI,IAAI,CAAC,GAAG,CAAC,+BAEjB,CAlQA,AAAA,EAAa,WAAW,CAAC,CAErB,kBAAmB,SAAS,CAAM,CAAE,CAAO,EACvC,IAAI,CAAC,cAAc,CAAC,SAAS,CAAE,EAC3B,IAAI,EAAI,IAAI,CAAC,kBAAkB,GAC/B,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,GACzB,EAAG,MAAM,CAAC,GACN,AAAC,GACD,EAAE,KAAK,EACf,EACJ,EAEA,cAAe,SAAS,CAAM,CAAE,CAAI,EAChC,IAAI,CAAC,GAAG,CAAC,oBAAqB,EAAS,iBACvC,IAAI,CAAC,GAAG,CAAC,qBAAsB,SAAU,CAAI,EACzC,EAAK,AAAQ,OAAR,EACT,EACJ,EAEA,mBAAoB,SAAS,CAAI,EAC7B,GAAuB,IAAI,CAAC,IAAI,CAAE,CAAE,MAAO,KAAM,CAAE,EAAM,SAAS,CAAE,CAAE,CAAI,CAAE,CAAK,EACzE,AAAQ,OAAR,GAAiB,AAAQ,MAAR,EACjB,EAAM,CAAA,GAEN,EAAG,WAAW,CAAC,yBACvB,EACJ,EAEA,uBAAwB,SAAS,CAAI,EACjC,GAAuB,IAAI,CAAC,IAAI,CAAE,KAAM,EAAM,SAAS,CAAE,CAAE,CAAI,CAAE,CAAK,EAClE,IAAI,EAAI,SAAS,EAAM,GACnB,CAAA,MAAM,IACN,EAAG,WAAW,CAAC,yBACnB,EAAM,CAAC,MAAM,GACjB,EACJ,EAEA,wBAAyB,SAAS,CAAI,EAClC,IAAI,EAAc,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,AAAA,GAAO,IAAI,CAAC,QAAQ,CAAC,EAAI,CAAC,gBAAgB,EAAE,IAAI,GACpG,GAAuB,IAAI,CAAC,IAAI,CAAE,EAAa,EAAM,SAAS,CAAE,CAAE,CAAI,CAAE,CAAK,EACzE,IAAI,EAAM,IAAI,CAAC,QAAQ,CAAC,EAAK,CACzB,EAAM,GAAO,EAAI,gBAAgB,AACjC,CAAC,GACD,EAAG,WAAW,CAAC,oBAAsB,GAEzC,EAAM,EACV,EACJ,EAEA,yBAA0B,SAAS,CAAI,EACnC,IAAI,EAAe,MAAM,QAAQ,CAAC,AAAA,EAAa,QAAQ,EAAE,IAAI,GAC7D,GAAuB,IAAI,CAAC,IAAI,CAAE,EAAc,EAAM,SAAS,CAAE,CAAE,CAAI,CAAE,CAAK,EAC1E,IACI,EAAM,CAAC,CADD,IAAI,CAAC,QAAQ,CAAC,EAAK,AAEzB,CAAC,GACD,EAAG,WAAW,CAAC,qBAAuB,GAC1C,EAAM,EACV,EACJ,EAEA,uBAAwB,SAAS,CAAI,EACjC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAK,EACzB,IAAI,EAAc,EAAM,OAAO,CAAC,GAAG,CAAC,AAAA,GAAK,EAAE,IAAI,EAC/C,EAAY,IAAI,CAAC,EAAY,KAAK,IAClC,GAAuB,IAAI,CAAC,IAAI,CAAE,EAAa,EAEnD,EACJ,EAEA,uBAAwB,SAAS,CAAW,CAAE,CAAI,CAAE,CAAQ,EACxD,GAAuB,IAAI,CAAC,IAAI,CAAE,EAAa,EAAM,EACzD,EAEA,yBAA0B,SAAS,CAAI,EAEnC,IAAI,EAAc,OAAO,IAAI,CADnB,OAAO,MAAM,CAAC,CAAC,EAAG,IAAI,CAAC,eAAe,CAAE,IAAI,CAAC,SAAS,GAC7B,MAAM,CAAC,AAAA,GAAQ,CAAC,MAAM,IAAI,CAAC,IAAO,IAAI,GACzE,GAAuB,IAAI,CAAC,IAAI,CAAE,EAAa,SAAS,CAAI,EACxD,IAAI,EAAM,IAAI,CAAC,IAAI,CAAC,GAEpB,OADA,IAAI,CAAC,UAAU,CAAC,CAAC,oBAAoB,EAAE,AAAA,EAAI,UAAU,CAAC,GAAM,UAAU,EAAE,AAAA,EAAI,UAAU,CAAC,GAAK,IAAI,CAAC,CAAE,CAAA,EAAM,KAClG,EAAK,KAAK,CAAC,IAAI,CAAE,UAC5B,EACJ,EAEA,8BAA+B,SAAS,CAAI,EACxC,IAAI,EAAO,IAAI,CACf,EAAK,GAAG,CAAC,0CAA2C,WAChD,GAAuB,IAAI,CAAC,EAAM,GAAqB,EAAM,SAAS,CAAE,CAAE,CAAI,CAAE,CAAK,EACjF,EAAK,KAAK,CAAC,WAAW,CAAC,EAAM,SAAU,CAAI,EACnC,AAAQ,QAAR,GACA,EAAG,WAAW,CAAC,iBAAmB,GAClC,EAAM,CAAA,IAEN,EAAM,CAAA,EAEd,EACJ,EACJ,EACJ,EAEA,qBAAsB,SAAS,CAAI,EAC/B,IAAI,EAAO,IAAI,CACf,EAAK,GAAG,CAAC,0CAA2C,WAChD,GAAuB,IAAI,CAAC,EAAM,GAAqB,EAAM,SAAS,CAAE,CAAE,CAAI,CAAE,CAAK,EACjF,EAAK,KAAK,CAAC,WAAW,CAAC,EAAM,SAAU,CAAI,EACvC,EAAM,AAAQ,aAAR,EACV,EACJ,EACJ,EACJ,EAEA,kCAAmC,SAAS,CAAI,EAC5C,IAAI,EAAO,IAAI,CACf,EAAK,GAAG,CAAC,0CAA2C,WAChD,GAAuB,IAAI,CAAC,EAAM,GAAqB,EAC3D,EACJ,EAEA,0BAA2B,SAAS,CAAI,EACpC,IAAI,EAAO,IAAI,CACf,EAAK,GAAG,CAAC,0CAA2C,WAChD,GAAuB,IAAI,CAAC,EAAM,GAAqB,EAC3D,EACJ,EAEA,sBAAuB,WACnB,OAAO,IAAI,CAAC,cAAc,CAAC,SAAS,CAAE,EAClC,OAAO,EAAG,YAAY,CAAC,WAAW,EACtC,EACJ,EAEA,oBAAqB,WACjB,OAAO,IAAI,CAAC,cAAc,CAAC,SAAS,CAAE,EAClC,OAAO,EAAG,gBAAgB,CAAC,EAAG,YAAY,CAC9C,EACJ,EAEA,yBAA0B,SAAS,CAAK,EACpC,IAAI,CAAC,cAAc,CAAC,SAAS,CAAE,EAC3B,EAAG,YAAY,CAAC,EAAG,YAAY,CAAE,EAAG,WAAW,GAAI,GACnD,IAAI,CAAC,kBAAkB,GAAG,WAAW,CAAC,CAAA,EAC1C,EACJ,EAEA,wCAAyC,SAAU,CAAI,EACnD,IAAI,CAAC,SAAS,CAAC,SAAS,CAAK,EACzB,IAAI,EAAO,IAAI,CACX,EAAO,EAAM,eAAe,GAAG,IAAI,CACnC,EAAM,EAAK,KAAK,CAAC,EAAG,EAAK,WAAW,CAAC,KAAK,GAC9C,EAAM,eAAe,CAAC,EAAK,SAAU,CAAI,EACjC,GAAQ,OAAO,IAAI,CAAC,GAAM,MAAM,CAAG,EACnC,EAAM,WAAW,CAAC,EAAK,SAAU,CAAG,EAChC,EAAK,GAAG,CAAC,2BAA4B,GACrC,EAAK,GAAG,CAAC,sBAAuB,CAAE,QAAS,CAAA,EAAM,SAAU,CAAA,CAAK,GAChE,GACJ,IAEA,EAAK,GAAG,CAAC,2BAA4B,IACrC,IAER,EACJ,EACJ,EAEA,oBAAqB,SAAS,CAAA,QAAE,EAAU,CAAA,CAAA,CAAA,SAAO,EAAW,CAAA,CAAA,CAAO,CAAG,CAAC,CAAC,EACpE,IAAI,EAAO,IAAI,CACf,EAAK,cAAc,CAAC,SAAS,CAAE,EAC3B,IAAI,EAAM,EAAG,GAAG,CAAC,uBACb,EAAI,EAAG,IAAI,CAAC,mBAEhB,SAAS,EAAS,CAAC,EACX,AAAC,GAAK,AAAY,GAAZ,EAAE,MAAM,CAGd,GAAoB,IAAI,CAAC,EAAI,EAAK,kBAAkB,GAAI,EAAG,CAAE,QAAA,EAAS,SAAA,CAAS,GAF3E,AAAC,GAAS,EAAG,WAAW,CAAC,iBAAkB,CAAA,EAAO,IAI9D,CAEI,aAAa,SACb,EAAE,IAAI,CAAC,EAAM,EAAI,EAAK,SAAU,CAAC,EACzB,GAAG,EAAS,EACpB,EAAG,CAAE,SAAA,CAAS,GAET,GAAK,EAAE,MAAM,CAAG,EACrB,EAAS,AbyBlB,SAAsB,CAAU,CAAE,CAAK,EAE1C,GAAI,CADJ,CAAA,EAAQ,EAAM,IAAI,EAAlB,EACY,OAAO,EACnB,IAAI,EAVG,AAAI,OAAO,IAUU,EAVA,CAAC,GAAG,CAAC,AAAA,IAC7B,EAAK,EAAG,OAAO,CAAC,mCAAoC,QAC/C,OAAO,CAAC,WAAY,WAClB,CAAC,CAAC,EAAE,EAAG,MAAM,CAAC,GACtB,IAAI,CAAC,IAAK,QAOT,EAAU,sBACV,EAAU,EAAE,CA0BhB,OAzBA,EAAW,OAAO,CAAC,AAAA,IACf,IAAI,EAAQ,AAAe,UAAf,OAAO,EAAmB,EAAO,EAAK,KAAK,CACnD,EAAQ,AAAe,UAAf,OAAO,EAAmB,EAAO,EAAK,KAAK,CAEvD,IADA,EAAS,SAAS,CAAG,IACR,CACT,IAAI,EAAI,EAAS,IAAI,CAAC,GACtB,GAAI,CAAC,EAAG,MACR,IAAI,EAAQ,EACR,EAAM,GACN,EAAI,EACR,IAAK,IAAI,EAAI,EAAG,EAAI,EAAE,OAAO,CAAC,MAAM,EAAG,CACnC,GAAI,CAAE,EAAQ,EAAQ,CAAG,EAAE,OAAO,CAAC,IAAI,CACnC,CAAE,EAAQ,EAAQ,CAAG,EAAE,OAAO,CAAC,IAAI,CACvC,GAAS,EAAS,EAClB,EAAQ,SAAS,CAAG,EAChB,EAAQ,IAAI,CAAC,IAAQ,CAAA,GAAS,CAAA,EAClC,GAAO,EAAI,UAAU,CAAC,EAAM,SAAS,CAAC,EAAG,IACnC,CAAC,GAAG,EAAE,EAAM,SAAS,CAAC,EAAQ,GAAQ,IAAI,CAAC,CACjD,EAAI,CACR,CACI,AAAK,MAAL,GAAW,CAAA,GAAO,EAAI,UAAU,CAAC,EAAM,MAAM,CAAC,GAAlD,EACA,EAAQ,IAAI,CAAC,CAAE,MAAO,EAAI,QAAQ,CAAC,GAAM,MAAO,EAAO,MAAO,CAAM,GACpE,EAAS,SAAS,CAAG,EAAE,KAAK,CAAG,CACnC,CACJ,GACO,EAAQ,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,KAAK,CAAG,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,EAAG,KACpD,AAAC,EAAE,IAAI,CAAC,AAAA,GAAM,EAAG,KAAK,EAAI,EAAK,KAAK,GAAG,EAAE,IAAI,CAAC,GAC3C,GACR,EAAE,CACT,Ea5DsC,EAAG,IAGzB,EAAS,EACjB,EACJ,EAEA,6BAA8B,WAC1B,IAAI,CAAC,cAAc,CAAC,AAAA,IAChB,EAAG,IAAI,CAAC,yBAAyB,IAAI,CAAC,EAAI,KAAM,AAAA,IACxC,EACA,EAAG,GAAG,CAAC,2BAA4B,IAAI,CAAC,IAAI,CAAC,4BAE7C,EAAG,GAAG,CAAC,sBACf,EACJ,EACJ,EAEA,yBAA0B,SAAS,CAAI,EACnC,IAAI,CAAC,cAAc,CAAC,SAAS,CAAE,EAC3B,IAAI,EAAO,IAAI,CAAC,GAAG,CAAC,uBACpB,EAAG,OAAO,CAAC,IACX,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,cAAc,IAClD,IAAI,CAAC,KAAK,CAAC,cAAc,GAAG,KAAK,GAC7B,AAAC,GACD,EAAG,SAAS,CAAC,SAEjB,WAAW,KACH,GACA,EAAK,IAAI,CAAC,IAAI,CAAE,GACpB,IAAI,CAAC,YAAY,EACrB,EAAG,EACP,GACA,IACJ,CAEJ,GA0EA,IAAI,GAAe,CACf,IAlCJ,WACS,GAGD,GAAkB,IAAI,CAAC,IAAI,EAF3B,IAAI,CAAC,GAAG,CAAC,sBAGjB,EA8BI,MAAuC,GACvC,cAzBJ,WACI,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,YAAY,CAC3C,EAwBI,IAhBJ,WACI,GAAI,IAAI,CAAC,IAAI,CAAC,qBAAuB,IAC7B,IAAI,CAAC,GAAG,CAAC,eAAgB,KAAM,CAC/B,KACA,IAAI,CAAC,GAAG,CAAC,2BAA4B,MACrC,IAAI,CAAC,GAAG,CAAC,sBAAuB,CAAE,QAAS,CAAA,EAAM,SAAU,CAAA,CAAK,GAChE,MACJ,CAEJ,IAAI,CAAC,GAAG,CAAC,sBACb,EAOI,kBAAuC,AAAA,EAAkB,IAvB7D,WACI,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,YAAY,EACvC,IAAI,CAAC,mBAAmB,EAC5B,EAoBA,EAEI,GAAmB,AAAA,EAAa,MAAM,CAAC,KAAM,OAAO,MAAM,CAAC,CAC3D,gBAAkB,0BACtB,EAAG,KAEC,GAAsB,AAAA,EAAa,MAAM,CAAC,KAAM,OAAO,MAAM,CAAC,CAC9D,QAvCJ,WACI,GAAgB,IAAI,CAAC,IAAI,CAC7B,EAsCI,wCAA0C,GAC1C,qCAA0C,GAC1C,SAA0C,GAC1C,OAA0C,GAC1C,eAxEJ,WACQ,IACA,GAAO,GAEf,EAqEI,gBA/EJ,WACQ,IACA,GAAO,EAEf,EA4EI,OAA0C,WACtC,IACJ,CACJ,EAAG,IACH,CAAA,GAAoB,cAAc,CAAG,CAAE,WAEnC,OADI,AAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,KAC3B,CAAA,CACX,EAAG,CAEH,AAAA,EAAa,OAAO,CAAC,kBAAmB,WAEpC,OADA,IAAI,CAAC,UAAU,CAAC,IACT,WACH,IAAI,CAAC,SAAS,CAAC,GACnB,CACJ,GDxcA,AAAA,EAAa,WAAW,CAAC,CAErB,WAAY,WACR,OAAO,IAAI,CAAC,SAAS,EACzB,EAEA,gBAAiB,SAAS,CAAI,EACtB,AAAC,GACD,CAAA,EAAO,IAAI,CAAC,OAAO,EADvB,EAEA,IAAI,EAAQ,EAAK,KAAK,CAAC,MAGvB,IAAK,IAAI,KAFL,EAAM,MAAM,CAAG,GACf,EAAM,MAAM,CAAC,EAAG,EAAM,MAAM,CAAG,GAClB,GAAO,CACpB,IAAI,EAAI,uBAAuB,IAAI,CAAC,GACpC,GAAI,EAAG,OAAO,CAAC,CAAC,EAAE,AACtB,CACJ,EAIA,eAAgB,SAAS,CAAI,EAGzB,OAFI,CAAC,GAAM,CAAA,EAAO,IAAI,CAAC,IAAI,AAAJ,EACb,AAAC,CAAA,WAAW,IAAI,CAAC,IAAS,CAAC,GAAE,AAAC,CAAC,CAAC,EAAE,EAE1C,IAAK,OACH,MAAO,KAET,KAAK,MACH,MAAO,YAET,KAAK,QACL,IAAK,OACL,IAAK,MACH,MAAO,MAET,KAAK,MACH,MAAO,UAET,KAAK,OACH,MAAO,KAET,KAAK,QACH,MAAO,MAET,KAAK,QACH,MAAO,WACX,CACA,OAAO,IACX,EAEA,gBAAiB,SAAS,CAAI,EACtB,AAAC,GACD,CAAA,EAAO,IAAI,CAAC,GAAG,CAAC,oBAAsB,IAAI,CAAC,GAAG,CAAC,iBADnD,EAEI,IACI,IAAI,CAAC,QAAQ,CAAC,EAAK,CACnB,IAAI,CAAC,GAAG,CAAC,EAAM,CAAA,GACR,IAAI,CAAC,QAAQ,CAAC,EAAO,QAAQ,EACpC,IAAI,CAAC,GAAG,CAAC,EAAO,QAAS,CAAA,GAGrC,EAEA,aAAc,AAAA,EAAkB,IAAK,SAAS,CAAK,CAAE,CAAG,EACpD,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACvB,IAAI,EAAQ,IAAI,CAAC,iBAAiB,CAAC,GAAM,EAAM,EAAG,EAAQ,EAAE,CAC5D,IAAI,CAAC,GAAG,CAAC,YAAa,GACtB,IAAI,CAAC,GAAG,CAAC,qBAAsB,CAAA,GAC/B,IAAI,EAAK,IAAI,CAAC,MAAM,GACpB,GAAI,EAAG,WAAW,IAAM,EAAG,WAAW,GAAI,YACtC,IAAI,CAAC,WAAW,CAAC,sBAGrB,KAAO,IAAI,CAAC,OAAO,CAAC,GAAG,EAAI,EAAM,GAAG,EAAE,CAClC,IAAI,EAAM,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,GAMjC,GALI,GAAO,IACH,EAAM,GACN,CAAA,EAAM,CADV,EAEA,EAAM,IAAI,CAAC,CAAE,IAAI,CAAC,OAAO,CAAC,GAAG,CAAE,EAAK,GAEpC,CAAC,IAAI,CAAC,GAAG,CAAC,gBACV,KACR,CACA,EAAE,EACF,EAAM,OAAO,CAAC,AAAA,IACV,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,EAAE,CAAE,CAAC,CAAC,EAAE,GACvD,IAAI,CAAC,GAAG,CAAC,SAAU,IAAI,MAAM,CAAC,EAAM,CAAC,CAAC,EAAE,EAC5C,EACJ,EACJ,GAEA,eAAgB,AAAA,EAAkB,OAAQ,SAAS,CAAK,CAAE,CAAG,CAAE,CAAO,EAClE,IAAI,CAAC,SAAS,CAAC,aAAa,GAC5B,IAGI,EAHA,EAAM,IAAI,CAAC,iBAAiB,CAAC,GAAO,GAAG,CACvC,EAAO,GACP,EAAO,EAMX,IAJI,GAAW,CAAC,EAAQ,KAAK,EACzB,CAAA,EAAO,SAAS,EAAS,GAD7B,EAGA,EAAM,OADN,EAAM,IAAI,CAAC,iBAAiB,CAAC,GAAK,GAAG,EACnB,MAAM,CACjB,GAAO,GACV,GAAQ,qBACJ,GACA,CAAA,GAAQ,6BAA+B,AZkKhD,SAAiB,CAAK,CAAE,CAAK,CAAE,EAAO,GAAG,EACxC,AAAgB,UAAhB,OAAO,GACP,CAAA,EAAQ,KAAK,KAAK,CAAC,EADvB,EAIA,IADA,IAAI,EAAI,GAAK,EACN,EAAE,MAAM,CAAG,GACd,EAAI,EAAO,EACf,OAAO,CACX,EY1K+D,EAAM,EAAK,KAAO,SADrE,EAEA,EAAE,EACF,GAAQ,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,EAAK,IAAI,CAAC,IAAI,CAAC,EAAI,CAAE,MAAQ,WACtE,EAAE,EAEN,IAAI,EAAM,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,aACpC,EAAI,OAAO,CAAC,GACZ,EAAI,GAAG,CAAC,WAAY,CAAA,EACxB,GAEA,yBAA0B,AAAA,EAAkB,SAAU,SAAS,CAAG,EAC9D,IAAI,CAAC,iBAAiB,CAAC,EAC3B,GAEA,aAAc,AAAA,EAAkB,+BAAgC,SAAS,CAAQ,CAAE,CAAK,EACpF,IAAI,EAAM,WAAW,EACjB,CAAC,MAAM,IACP,CAAA,EAAQ,CADZ,EAEA,IAAI,CAAC,IAAI,CAAC,EAAU,EACxB,GAEA,YAAa,AAAA,EAAkB,kBAAmB,SAAS,CAAI,EAC3D,GAAI,CACA,IAAI,EAAY,CACZ,IAAI,CACJ,IAAI,CAAC,KAAK,CACb,CAED,AADA,CAAA,EAAO,AAAI,SAAS,SAAU,QAAS,EAAvC,EACK,KAAK,CAAC,IAAI,CAAE,GACjB,IAAI,CAAC,kBAAkB,EAC3B,CAAE,MAAM,EAAI,CACR,IAAI,CAAC,WAAW,CAAC,EAAG,IAAI,CAAG,KAAO,EAAG,OAAO,EACxC,OAAO,OAAO,EACd,QAAQ,GAAG,CAAC,EACpB,CACJ,GAEA,YAAa,AAAA,EAAkB,KAAM,SAAS,CAAK,CAAE,CAAG,EACpD,IAAI,CAAC,GAAG,CAAC,cAAe,IAAI,CAAC,GAAG,CAAC,mBAAoB,EAAO,GAChE,GAEA,YAAa,AAAA,EAAkB,WAC3B,IAAI,CAAC,GAAG,CAAC,cAAe,IAAI,CAAC,OAAO,GACxC,GAEA,oBAAqB,AAAA,EAAkB,IAAK,WACxC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,qBAC3B,GAEA,UAAW,AAAA,EAAkB,gBAAiB,SAAS,CAAI,EACvD,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,EAAM,IAAI,CAAC,OAAO,IAChD,IAAI,CAAC,UAAU,CAAC,yBACpB,GAEA,UAAW,AAAA,EAAkB,eAAgB,SAAS,CAAI,EACtD,IAAI,EAAO,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,GACrC,EAAS,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAE,KAAM,CAAK,GAClD,EAAO,OAAO,CAAC,GACf,EAAO,GAAG,CAAC,mBACX,EAAO,GAAG,CAAC,mBAAoB,EACnC,GAEA,UAAW,AAAA,EAAkB,eAAgB,SAAS,CAAI,EACtD,IAAI,EAAO,IAAI,CACf,EAAO,EAAK,KAAK,CAAC,gBAAgB,CAAC,GACnC,EAAK,KAAK,CAAC,WAAW,CAAC,EAAM,SAAU,CAAI,EACnC,AAAQ,aAAR,EACA,EAAK,UAAU,CAAC,wBAEhB,EAAK,KAAK,CAAC,kBAAkB,CAAC,EAAM,CAAA,EAAM,SAAU,CAAI,CAAE,CAAK,EAC3D,IAAI,EAAS,EAAK,KAAK,CAAC,SAAS,CAAC,GAElC,SAAS,IACL,EAAO,OAAO,CAAC,GAAQ,IACvB,EAAO,KAAK,CAAG,EACf,EAAO,KAAK,CAAC,CAAA,GACb,EAAO,GAAG,CAAC,mBACX,EAAO,GAAG,CAAC,mBAAoB,EACnC,CAEA,GAAI,EACA,GAAI,AAAS,MAAT,EACA,SACG,GAAI,EAAO,KAAK,EAAI,EACvB,EAAO,GAAG,CAAC,mBAAoB,OAC5B,CACH,IAAI,EAAM,QAAU,EAAO,sBACpB,CAAA,EAAO,KAAK,GAAK,sBAAwB,mBAAA,EAChD,EAAO,GAAG,CAAC,gBAAiB,EAAK,SAAU,CAAG,EACtC,GACA,GACR,EACJ,MAEA,EAAS,EAAK,KAAK,CAAC,YAAY,CAAC,CAAE,KAAM,EAAM,MAAO,CAAM,GACxD,AAAQ,MAAR,GACA,EAAK,UAAU,CAAC,YACpB,GAER,EAER,EACJ,GAEA,WAAY,AAAA,EAAkB,gBAAiB,SAAS,CAAI,EACxD,IAAI,EAAO,IAAI,CAEf,SAAS,IACL,EAAK,KAAK,CAAC,kBAAkB,CAAC,EAAM,EAAK,OAAO,GAAI,KAAM,SAAU,CAAK,EACrE,EAAK,GAAG,CAAC,gBAAiB,GAC1B,EAAK,KAAK,CAAC,CAAA,GACX,EAAK,KAAK,CAAG,EACb,EAAK,UAAU,CAAC,SAAS,EAC7B,EACJ,CAEA,IAAI,EAAS,EAAK,KAAK,CAAC,SAAS,CAAC,GAClC,GAAK,EAEA,CACD,IAAI,EAAM,wBAAwB,EAAK,aACvC,EAAO,GAAG,CAAC,gBAAiB,EAAK,SAAU,CAAG,EACtC,IACA,EAAK,KAAK,CAAC,UAAU,CAAC,GACtB,IAER,EACJ,MATI,GAUR,GAEA,kBAAmB,WACf,IAAI,CAAC,GAAG,CAAC,sCAAuC,CAAA,EAAM,WAAc,EACxE,EAEA,oCAAqC,SAAU,CAAG,CAAE,CAAI,EAEpD,IAAI,EAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,IASnC,AAPA,SAAS,EAAK,CAAK,EACX,EAAK,MAAM,CAAG,EACd,EAAK,KAAK,GAAG,GAAG,CAAC,gCAAiC,EAAK,GAEvD,GACR,EAEK,CAAA,EACT,EAEA,8BAA+B,SAAU,CAAG,CAAE,CAAI,EAE9C,IAAI,EAAO,IAAI,CAEf,SAAS,EAAS,CAAK,EACnB,EAAK,KAAK,CAAC,CAAA,GACX,EAAK,KAAK,CAAG,EACb,EAAK,CAAA,EACT,CAEA,SAAS,IACL,EAAK,KAAK,CAAC,kBAAkB,CAAC,EAAK,IAAI,CAAE,EAAK,OAAO,GAAI,EAAK,KAAK,CAAE,SAAU,CAAK,EAC5E,AAAS,MAAT,EACA,EAAS,GAET,EAAK,GAAG,CAAC,gBAAiB,EAAK,IAAI,CAAG,qDAAsD,SAAU,CAAG,EAChG,EAGD,EAAK,KAAK,CAAC,kBAAkB,CAAC,EAAK,IAAI,CAAE,EAAK,OAAO,GAAI,KAAM,SAAU,CAAK,EAC1E,EAAS,EACb,GAJA,EAAK,CAAA,EAMb,EAER,EACJ,CAEI,CAAC,EAAK,KAAK,IAAO,GAAO,EAAK,IAAI,CAAC,KAAK,CAAC,YACzC,EAAK,CAAA,GACG,EAGR,EAAK,GAAG,CAAC,gBAAiB,aAAe,EAAK,IAAI,CAAG,IAAK,SAAU,CAAG,EAC9D,EAGD,IAFA,EAAK,CAAA,EAIb,GARA,GAUR,EAEA,YAAa,AAAA,EAAkB,GAAI,WAC/B,IAAI,EAAO,IAAI,CACX,EAAK,KAAK,GACV,EAAK,GAAG,CAAC,gCAAiC,CAAA,EAAO,SAAU,CAAK,EACxD,GACA,EAAK,UAAU,CAAC,SAAS,EAAK,IAAI,CAC1C,GAEA,EAAK,UAAU,CAAC,8BACxB,GAEA,YAAa,AAAA,EAAkB,iBAAkB,SAAS,CAAI,EAC1D,IAAI,EAAO,IAAI,CACf,EAAK,KAAK,CAAC,aAAa,CAAC,EAAM,WAC3B,EAAK,UAAU,CAAC,WAAW,EAC/B,EACJ,GAEA,UAAW,AAAA,EAAkB,eAAgB,SAAS,CAAI,EACtD,IAAI,EAAO,IAAI,CACf,EAAK,KAAK,CAAC,kBAAkB,CAAC,EAAM,CAAA,EAAO,SAAU,CAAI,CAAE,CAAK,EAC5D,EAAK,GAAG,CAAC,cAAe,EAC5B,EACJ,GAEA,oBAAqB,AAAA,EAAkB,iBACnC,GAAI,CACA,IAAI,CAAC,KAAK,CAAC,iBAAiB,EAChC,CAAE,MAAM,EAAI,CACR,QAAQ,KAAK,CAAC,GACd,IAAI,CAAC,WAAW,CAAC,qBAAsB,CAAA,EAAO,IAClD,CACJ,GAEA,gBAAiB,AAAA,EAAkB,SAAS,CAAK,EAC7C,GAAI,EACA,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,OACtB,CACH,IAAI,EAAQ,AZ1BjB,CAAA,WACH,IAAI,EAAS,EAAE,CACf,IAAK,IAAI,KAAM,SAAS,WAAW,CAAE,AAGrC,CAAA,SAAS,EAAS,CAAE,EAChB,IAAK,IAAI,KAAQ,EAAG,QAAQ,CAAE,KAGjB,EAHyB,EAItC,GAAI,aAAgB,cAChB,EAAS,EAAK,UAAU,MACrB,CACH,IAAI,EAAI,iCAAiC,IAAI,CAAC,EAAK,YAAY,CAC3D,CAAA,GACI,AAAuB,EAAvB,EAAO,OAAO,CAAC,CAAC,CAAC,EAAE,GACnB,EAAO,IAAI,CAAC,CAAC,CAAC,EAAE,CAG5B,CAbA,CACJ,CAAA,EAL8C,GAC9C,OAAO,CAkBX,CAAA,IYKyC,IAAI,GACjC,IAAI,CAAC,GAAG,CAAC,oBAAqB,iBAC9B,AAAA,GAAuB,IAAI,CAAC,IAAI,CAAE,EAAO,AAAA,IACrC,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,EAC7B,EAAG,CAAC,EAAI,EAAO,KAEX,GADA,EAAQ,EAAM,IAAI,GAGX,GAAI,AAAuB,EAAvB,EAAM,OAAO,CAAC,GAErB,OADA,EAAG,WAAW,CAAC,iBACR,EAAK,CAAA,QAEZ,OAAO,EAAK,CAAA,GALZ,EAAG,GAAG,CAAC,sBAOf,EACJ,CACJ,GAEA,kBAAmB,AAAA,EAAkB,WACjC,IAAI,CAAC,KAAK,CAAC,eAAe,EAC9B,EAEJ,GEnWA,IAAI,GAAuB,AAAA,EAAa,MAAM,CAAC,UAAW,CACtD,OAA0B,CAAE,gBAAiB,CAAA,EAAM,CACnD,MAA0B,yBAC1B,eAA0B,4BAC1B,MAA0B,kBAC1B,MAA0B,mBAC1B,MAA0B,gBAC1B,QAA0B,uBAC1B,eAA0B,sBAC1B,eAA0B,2BAC1B,uBAA0B,gCAC1B,MAA0B,gBAC1B,MAA0B,sBAC1B,UAA0B,WAClB,IAAI,CAAC,aAAa,GAAG,KAAK,GAAK,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,WAAW,KACtE,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC,wBACzB,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,eAAe,CAAC,SAAS,EACpD,GAAY,IAAI,CAAC,IAAI,EACrB,GAAc,IAAI,CAAC,IAAI,EAE/B,CACJ,GAGA,SAAS,GAAY,CAAA,QACjB,EAAU,CAAA,CAAA,CAAA,OACV,EAAS,CAAA,CAAA,CAAA,IACT,EAAM,CAAA,CAAA,CAAA,KACN,EAAO,CAAA,CAAA,CAAA,UACP,EAAY,IAAI,CAAC,IAAI,CAAC,mBAAA,CAAA,aACtB,EAAe,IAAI,CAAC,IAAI,CAAC,eAAA,CAAA,SACzB,EAAW,CAAA,CAAA,CAAA,OACX,EAAS,IAAA,CACZ,CAAG,CAAC,CAAC,EACF,GAAI,CAAC,IAAI,CAAC,eAAe,CAoBrB,OAnBA,IAAI,CAAC,eAAe,CAAG,CACnB,QAAe,EACf,OAAe,EACf,IAAe,EACf,KAAe,EACf,UAAe,EACf,aAAe,EACf,UAAe,IAAI,CAAC,KAAK,GACzB,UAAe,IAAI,CAAC,KAAK,GACzB,QAAe,CAAE,MAAO,IAAI,CAAC,KAAK,GAAI,IAAK,IAAI,CAAC,KAAK,EAAG,EACxD,OAAe,IAAI,CAAC,aAAa,GAAG,YAAY,CAChD,MAAe,GACf,SAAe,EACf,OAAe,CACnB,EACK,IACD,IAAI,CAAC,UAAU,CAAC,IAChB,GAAY,IAAI,CAAC,IAAI,GAElB,CAAA,CAEf,CAEA,SAAS,KACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAAK,CAAG,IAAI,CAAC,aAAa,GAAG,gBAAgB,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,CACzG,CAEA,SAAS,GAAc,CAAA,QAAE,CAAO,CAAE,CAAG,CAAC,CAAC,EACnC,IAAI,EAAQ,IAAI,CAAC,eAAe,CAAC,KAAK,CAatC,MAZI,CAAC,KAAK,IAAI,CAAC,IAAU,IAAI,CAAC,IAAI,CAAC,0BAC/B,IAAI,CAAC,eAAe,CAAG,IAAI,CAAC,IAAI,CAAC,wBACjC,EAAQ,IAAI,CAAC,eAAe,CAAC,KAAK,CAClC,IAAI,CAAC,aAAa,GAAG,kBAAkB,GACvC,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC,SAAU,GACnC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAG,IAAI,CAAC,KAAK,GAC3C,IAAI,CAAC,eAAe,CAAC,OAAO,CAAG,CAAE,MAAO,IAAI,CAAC,KAAK,GAAI,IAAK,IAAI,CAAC,KAAK,EAAG,GAE5E,IAAI,CAAC,eAAe,CAAC,SAAS,CAAG,IAAI,CAAC,KAAK,GACvC,AAAW,MAAX,GACA,CAAA,IAAI,CAAC,eAAe,CAAC,OAAO,CAAG,CADnC,EAGO,GAAS,IAAI,CAAC,IAAI,CAC7B,CAEA,SAAS,KACL,IAAI,EAAM,IAAI,CAAC,eAAe,CAC1B,EAAQ,EAAI,KAAK,CACrB,OAAO,EAAI,SAAS,EACf,AAAA,CAAA,EAAI,MAAM,CAAI,EAAQ,EAAM,OAAO,CAAC,OAAQ,IAAO,CAAA,GAAU,EAAM,WAAW,EAEvF,CAEA,SAAS,GAAc,CAAG,CAAE,CAAM,EAC9B,IAAI,EAAS,IAAI,CAAC,OAAO,CACrB,EAAS,IAAI,CAAC,iBAAiB,CAAC,EAAO,GAAG,CAAG,GAAI,GACjD,EAAS,IAAI,CAAC,iBAAiB,CAAC,EAAO,GAAG,CAAG,GAAI,KACjD,EAAO,IAAI,CAAC,OAAO,GACnB,EAAK,EAAE,CACP,EAAM,IAAI,CAAC,eAAe,CAC1B,EAAQ,IAAI,CAAC,KAAK,GAClB,EAAQ,EACR,EAAO,EAEX,IADA,EAAI,SAAS,CAAG,EAAI,MAAM,EAAE,OAAS,IACxB,CACT,IAAI,EAAI,EAAI,IAAI,CAAC,GACjB,GAAI,GAAK,CAAC,CAAC,EAAE,CAAC,MAAM,CAAE,CAClB,GAAI,EAAI,MAAM,EAAI,EAAI,SAAS,CAAG,EAAI,MAAM,CAAC,GAAG,CAC5C,MAGJ,GADA,IACI,EAAE,KAAK,EAAI,GAAU,EAAE,KAAK,EAAI,EAAQ,CACxC,IAAI,EAAK,IAAI,CAAC,iBAAiB,CAAC,EAAE,KAAK,EACnC,EAAK,IAAI,CAAC,iBAAiB,CAAC,EAAI,SAAS,EAC7C,EAAG,IAAI,CAAC,CACJ,MAAO,EAAG,GAAG,CAAE,KAAM,EAAG,GAAG,CAC3B,MAAO,EAAG,GAAG,CAAE,KAAM,EAAG,GAAG,AAC/B,EACJ,CACI,CAAA,GAAS,EAAE,KAAK,EAAI,EAAQ,EAAI,SAAS,EAAK,GAAS,EAAI,SAAS,EAAI,EAAI,OAAO,AAAP,GAC5E,CAAA,EAAO,CADX,CAGJ,MACI,KAER,CACA,GAAY,IAAI,CAAC,IAAI,CAAE,EAAO,EAAM,GACpC,IAAI,CAAC,UAAU,CAAC,eAAgB,EACpC,CAEA,SAAS,GAAY,CAAK,CAAE,CAAI,CAAE,CAAM,EACpC,IAAI,EAAM,IAAI,CAAC,eAAe,CAC9B,IAAI,CAAC,cAAc,CAAC,AAAA,IAChB,GAAI,EACA,EAAG,MAAM,CAAC,EAAO,IAAI,CAAC,IAAI,CAAE,EAAO,EAAM,QACtC,CACH,IAAI,EAAM,EAAI,QAAQ,EAAI,EAAQ,CAAC,CAAC,EAAE,EAAM,EAAE,CAAC,CACzC,GAAU,EAAQ,CAAC,CAAC,EAAE,EAAK,CAAC,EAAE,EAAM,EAAE,CAAC,CACvC,GACN,EAAG,MAAM,CAAC,CAAA,EAAG,EAAA,EACvB,EAAI,QAAQ,CAAG,gBAAkB,WAAA,EACjC,EAAI,MAAM,CAAG,UAAY,EAAI,IAAI,CAAG,QAAU,GAAA,EAC9C,EAAI,OAAO,CAAG,GAAK,YAAY,CAAC,CAAC,CAC3B,CACA,IAAI,EAAQ,EAAI,MAAM,CAClB,EAAM,EAAQ,EAAI,cAAc,EAAE,MAC3B,OAAP,IACA,EAAG,WAAW,CAAC,CAAC,EAAM,EAAI,KACtB,EAAG,eAAe,CAAC,eAAe,CAAC,EAAM,EAAI,EAAI,MACrD,EAAG,EAAO,GACV,EAAG,WAAW,CAAC,CAAC,EAAM,EAAI,KACtB,EAAG,eAAe,CAAC,YAAY,CAAC,EAAM,EAAI,EAAI,MAAO,eACzD,EAAG,GAEX,EACJ,CAEA,SAAS,GAAS,CAAA,QAAE,CAAO,CAAE,CAAG,IAAI,CAAC,eAAe,EAChD,IAAI,EAAM,IAAI,CAAC,eAAe,CAC1B,EAAQ,EAAI,KAAK,CACjB,EAAQ,CAAA,EACZ,GAAI,CACA,IAAI,EAAK,GAAa,IAAI,CAAC,IAAI,EAE/B,GADA,EAAQ,IAAI,CAAC,GAAG,CAAC,EAAU,wBAA0B,yBAA0B,GACpE,CACP,EAAI,cAAc,CAAG,EACrB,IAAI,CAAC,GAAG,CAAC,wBACT,IAAI,EAAK,IAAI,CAAC,KAAK,GACf,EAAK,EAAM,AAAA,CAAA,EAAU,GAAK,CAAA,EAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,AACvD,CAAA,GAAS,CAAA,CAAE,EAAI,EAAI,CAAG,CAAE,EAAI,EAAI,AAAA,EACpC,EAAI,OAAO,CAAG,CAAE,MAAO,EAAI,IAAK,CAAG,EACnC,IAAI,EAAO,IAAI,CAAC,iBAAiB,CAAC,GAC9B,EAAO,IAAI,CAAC,iBAAiB,CAAC,GAClC,IAAI,CAAC,UAAU,CAAC,UAAW,CACvB,MAAO,EAAK,GAAG,CAAE,KAAM,EAAK,GAAG,CAC/B,MAAO,EAAK,GAAG,CAAE,KAAM,EAAK,GAAG,AACnC,EACJ,CACA,GAAc,IAAI,CAAC,IAAI,CAAE,EAC7B,CAAE,KAAM,CAAC,CACT,OAAO,CACX,CAEA,SAAS,GAAa,CAAA,MAClB,EAAQ,IAAA,CAAA,OACR,EAAS,CAAA,CAAA,CAAA,IACT,EAAM,CAAA,CAAA,CAAA,UACN,EAAY,CAAA,CAAA,CAAA,KACZ,EAAO,CAAA,CAAA,CACV,CAAI,IAAI,CAAC,eAAe,EAAI,CAAC,CAAE,EAC5B,IAAI,EAAW,EAWf,MAVI,CAAC,IACD,EAAW,EAAM,OAAO,CAAC,kCAAmC,QACxD,GAEA,CAAA,EAAW,MAAQ,EAAW,KAA9B,GAGJ,GACA,CAAA,EAAW,EAAS,OAAO,CAAC,OAAQ,OADxC,EAGO,IAAI,OAAO,EAAU,GAAS,IAAI,CAAC,IAAI,EAAI,OAAS,MAC/D,CA9KA,GAAqB,cAAc,CAAG,CAAE,wBAAyB,CAgLjE,AAAA,EAAa,WAAW,CAAC,CAErB,gBAAiB,AAAA,EAAkB,WAC/B,IAAI,EAAM,CAAE,QAAS,CAAA,CAAK,CACtB,CAAC,GAAY,IAAI,CAAC,IAAI,CAAE,IACnB,GAAc,IAAI,CAAC,IAAI,CAAE,IAC1B,IAAI,CAAC,WAAW,CAAC,iDAE7B,GAEA,iBAAkB,AAAA,EAAkB,WAChC,IAAI,EAAM,CAAE,QAAS,CAAA,CAAM,CACvB,CAAC,GAAY,IAAI,CAAC,IAAI,CAAE,IACnB,GAAc,IAAI,CAAC,IAAI,CAAE,IAC1B,IAAI,CAAC,WAAW,CAAC,kDAG7B,GAEA,uBAAwB,AAAA,EAAkB,WACtC,IAAI,EAAM,CAAE,QAAS,CAAA,EAAM,OAAQ,CAAA,CAAK,CACpC,CAAC,GAAY,IAAI,CAAC,IAAI,CAAE,IACnB,GAAc,IAAI,CAAC,IAAI,CAAE,IAC1B,IAAI,CAAC,WAAW,CAAC,iDAE7B,GAEA,wBAAyB,AAAA,EAAkB,WACvC,IAAI,EAAM,CAAE,QAAS,CAAA,EAAO,OAAQ,CAAA,CAAK,CACrC,CAAC,GAAY,IAAI,CAAC,IAAI,CAAE,IACnB,GAAc,IAAI,CAAC,IAAI,CAAE,IAC1B,IAAI,CAAC,WAAW,CAAC,iDAE7B,GAEA,0BAA2B,AAAA,EAAkB,WACrC,AAAC,IAAI,CAAC,eAAe,EACrB,GAAY,IAAI,CAAC,IAAI,CAAE,CAAE,QAAS,CAAA,CAAK,GAE3C,IAAI,EAAM,IAAI,CAAC,eAAe,CAC9B,IAAI,EAAM,EAAI,OAAO,CAAC,GAAG,CACrB,EAAO,IAAI,CAAC,GAAG,CAAC,iBAAkB,WAGlC,OAFA,IAAI,CAAC,GAAG,CAAC,YAAa,GACtB,IAAI,CAAC,GAAG,CAAC,gBACF,IAAI,CAAC,KAAK,EACrB,GACA,GAAI,GAAQ,EAAK,CACb,IAAI,EAAO,IAAI,CAAC,gBAAgB,CAAC,EAAK,GACtC,IAAI,CAAC,aAAa,GAAG,kBAAkB,GACvC,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC,SAAU,EAAK,WAAW,IACnD,EAAO,GAAY,IAAI,CAAC,IAAI,EAC5B,IAAI,CAAC,GAAG,CAAC,YAAa,EAAI,OAAO,CAAC,KAAK,EACvC,GAAS,IAAI,CAAC,IAAI,CAAE,CAAE,QAAS,CAAA,CAAK,EACxC,CACJ,GAEA,oBAAqB,AAAA,EAAkB,WACnC,IAAI,EAAM,IAAI,CAAC,eAAe,AAC9B,CAAA,EAAI,IAAI,CAAG,CAAC,EAAI,IAAI,CAChB,EAAI,IAAI,EAAE,CAAA,EAAI,MAAM,CAAG,CAAA,CAA3B,EACA,IAAI,CAAC,UAAU,CAAC,CAAC,aAAa,EAAE,EAAI,IAAI,CAAG,KAAO,MAAA,CAAO,CAAE,CAAA,EAAO,KAClE,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,KAAK,EACxD,GAAS,IAAI,CAAC,IAAI,CACtB,GAEA,yBAA0B,AAAA,EAAkB,WACxC,IAAI,EAAM,IAAI,CAAC,eAAe,AAC1B,AAAiB,OAAjB,EAAI,SAAS,CAAU,EAAI,SAAS,CAAG,CAAA,EAClC,AAAkB,CAAA,IAAlB,EAAI,SAAS,CAAY,EAAI,SAAS,CAAG,CAAA,EACzC,AAAkB,CAAA,IAAlB,EAAI,SAAS,EAAW,CAAA,EAAI,SAAS,CAAG,IAA5C,EACL,IAAI,CAAC,UAAU,CAAC,CAAC,gBAAgB,EAAE,AAAiB,MAAjB,EAAI,SAAS,CAAW,OAAS,EAAI,SAAS,CAAG,MAAQ,KAAA,CAAM,CAAE,CAAA,EAAO,KAC3G,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,KAAK,EACxD,GAAS,IAAI,CAAC,IAAI,CACtB,GAEA,8BAA+B,AAAA,EAAkB,WAC7C,IAAI,EAAM,IAAI,CAAC,eAAe,AAC9B,CAAA,EAAI,GAAG,CAAG,CAAC,EAAI,GAAG,CAClB,IAAI,CAAC,UAAU,CAAC,CAAC,kBAAkB,EAAE,EAAI,GAAG,CAAG,KAAO,MAAA,CAAO,CAAE,CAAA,EAAO,KACtE,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,KAAK,EACxD,GAAS,IAAI,CAAC,IAAI,CACtB,GAEA,sBAAuB,AAAA,EAAkB,WACrC,IAAI,EAAM,IAAI,CAAC,eAAe,CAC9B,IAAI,EAAK,IAAI,CAAC,gBAAgB,UAC9B,AAAI,GAAI,KAAK,QAAU,GAAM,EAAG,OAAO,EAAK,EAAG,MAAM,EASjD,IAAI,CAAC,GAAG,CAAC,iBACF,CAAA,IATP,IAAI,CAAC,cAAc,CAAC,AAAA,IAChB,EAAG,GAAG,CAAC,uBACP,IAAI,CAAC,GAAG,CAAC,YAAa,EAAI,SAAS,EACnC,GAAY,IAAI,CAAC,IAAI,EACrB,GAAS,IAAI,CAAC,IAAI,CACtB,GACO,CAAA,EAKf,GAEA,cAAe,AAAA,EAAkB,SAAS,CAAS,EAa/C,OAZI,AAAC,GACD,IAAI,CAAC,SAAS,CAAC,uBAAwB,IAAI,CAAC,eAAe,EAC/D,IAAI,CAAC,aAAa,CAAC,IACnB,IAAI,CAAC,SAAS,CAAC,IACX,EACA,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,eAAe,CAAC,SAAS,EAEpD,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC,SAAS,EAE9D,IAAI,CAAC,eAAe,CAAG,KACvB,IAAI,CAAC,aAAa,CAAC,WACnB,IAAI,CAAC,aAAa,CAAC,gBACZ,CAAA,CACX,GAEA,uBAAwB,AAAA,EAAkB,WACtC,IAAI,EAAM,IAAI,CAAC,eAAe,AAC1B,AAAC,CAAA,EAAI,cAAc,EAAI,EAAI,KAAK,EAAI,EAAI,cAAc,CAGtD,IAAI,CAAC,cAAc,CAAC,AAAA,IAChB,EAAG,YAAY,CAAC,EAAI,MAAM,CAAE,EAAG,OAAO,GAAG,MAAM,CAAE,EAAI,cAAc,EACnE,EAAI,KAAK,CAAG,EAAI,cAAc,CAC9B,GAAS,IAAI,CAAC,IAAI,CACtB,GANA,IAAI,CAAC,GAAG,CAAC,gBAAiB,CAAA,EAQlC,EACJ,GAIA,IAAI,GAA6B,AAAA,EAAa,MAAM,CAAC,gBAAiB,CAClE,aAA6B,oCAC7B,IAA6B,6CAC7B,2BAA6B,mCAC7B,EAA6B,8BAC7B,IAA6B,oCAC7B,aAA6B,CAAE,sBAAuB,CAAA,EAAM,CAC5D,MAA6B,qBACjC,GAGA,SAAS,GAAgB,EAAO,CAAC,CAAC,EAC9B,IAAI,CAAC,cAAc,CAAC,AAAA,IAChB,GAAY,IAAI,CAAC,IAAI,CAAE,CAAE,GAAG,CAAI,CAAE,SAAU,CAAA,CAAK,GACjD,IAAI,EAAM,IAAI,CAAC,eAAe,CAC9B,IAAI,CAAC,GAAG,CAAC,oBAAqB,CAAC,aAAa,EAAE,EAAI,MAAM,CAAG,UAAY,EAAI,IAAI,CAAG,QAAU,GAAG,EAAE,CAAC,EAClG,IAAI,EAAS,KACT,GAAY,IAAI,CAAC,IAAI,EACrB,GAAI,CACA,GAAc,IAAI,CAAC,IAAI,CAAE,GAAa,IAAI,CAAC,IAAI,EACnD,CAAE,KAAM,CAAC,CACb,EACA,EAAG,gBAAgB,CAAC,0BAA2B,GAC/C,IAAI,EAAS,AAAC,IACV,EAAG,mBAAmB,CAAC,0BAA2B,GAClD,EAAG,mBAAmB,CAAC,QAAS,GAC3B,IACD,IAAI,CAAC,aAAa,CAAC,WACnB,IAAI,CAAC,aAAa,CAAC,gBACnB,IAAI,CAAC,eAAe,CAAG,KAE/B,EACA,EAAG,gBAAgB,CAAC,QAAS,GAC7B,IAAI,CAAC,GAAG,CAAC,yBAA0B,KAAM,AAAA,IACrC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAG,EAC7B,GAAgB,IAAI,CAAC,IAAI,EACzB,EAAO,CAAA,EACX,EAAG,CAAC,EAAK,EAAO,KACZ,EAAI,KAAK,CAAG,EACZ,GAAI,CACA,GAAc,IAAI,CAAC,IAAI,CAAE,GAAa,IAAI,CAAC,IAAI,GAC/C,EAAK,EACT,CAAE,KAAM,CACJ,EAAI,YAAY,CAAC,CAAE,KAAM,QAAS,KAAM,oBAAqB,QAAS,CAAA,CAAK,EAC/E,CACJ,EACJ,EACJ,CAEA,SAAS,KACL,IAAI,EAAK,IAAI,CAAC,aAAa,GACvB,EAAM,IAAI,CAAC,eAAe,CAC1B,EAAQ,EAAI,KAAK,CACjB,EAAS,GAAa,IAAI,CAAC,IAAI,EAEnC,GADA,GAAc,IAAI,CAAC,IAAI,CAAE,GACrB,EAAQ,CACR,IAAI,CAAC,GAAG,CAAC,oBAAqB,CAAC,QAAQ,EAAE,EAAI,MAAM,CAAG,UAAY,GAAG,QAAC,EAAE,EAAM,eAAQ,CAAC,EACvF,IAAI,EAAS,KACT,IAAI,CAAC,aAAa,CAAC,WACnB,IAAI,CAAC,aAAa,CAAC,gBACnB,IAAI,CAAC,eAAe,CAAG,KACvB,EAAG,mBAAmB,CAAC,QAAS,EACpC,EACA,EAAG,gBAAgB,CAAC,QAAS,GAC7B,IAAI,CAAC,GAAG,CAAC,yBAA0B,KAAM,AAAA,IACrC,IAAI,CAAC,kBAAkB,GACvB,GAAgB,IAAI,CAAC,IAAI,CAAE,EAAI,EAAQ,EAC3C,EACJ,CACJ,CAEA,SAAS,GAAY,CAAI,EAErB,GAAI,AADM,IAAI,CAAC,eAAe,CACtB,YAAY,EAAI,GAAQ,EAAK,WAAW,GAAI,CAChD,IAAI,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAC5B,GAAI,GAAQ,EAAK,WAAW,GAAI,OAAO,EAAK,WAAW,GACvD,GAAI,GAAQ,IAAI,CAAC,UAAU,CAAC,GAAO,OAAO,IAAI,CAAC,UAAU,CAAC,EAC9D,CACA,OAAO,CACX,CAEA,SAAS,GAAgB,CAAE,CAAE,CAAM,CAAE,CAAW,EAC5C,IAAI,EAAM,IAAI,CAAC,eAAe,CAC9B,IAAI,CAAC,UAAU,CAAC,IAChB,IAAI,EAAM,EAAM,EAAM,EAAQ,EAC1B,EAAQ,EAAE,CACV,EAAM,EAAI,MAAM,EAAI,IAAI,CAAC,YAAY,CAAC,EAAI,MAAM,CAAC,GAAG,EACxD,IAAI,CAAC,GAAG,CAAC,YAAa,EAAI,MAAM,CAAG,EAAI,MAAM,CAAC,KAAK,CAAG,EAAI,OAAO,CAAC,KAAK,EAEvE,IAAI,EAAU,AAAA,IACN,EAAI,MAAM,EAEV,CAAA,EAAc,EAAY,OAAO,CAC7B,8BACA,CAAC,EAAG,IAAM,AAAK,MAAL,EAAY,KACZ,AAAK,KAAL,EAAW,EACX,AAAK,KAAL,EAAW,IAAI,CAAC,SAAS,CAAC,EAAE,CAC5B,AAAQ,KAAR,CAAC,CAAC,EAAE,CAAU,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,MAAM,CAAC,EAAG,EAAE,MAAM,CAAG,GAAG,CAClE,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAA,EAGzB,GAAY,IAAI,CAAC,IAAI,CAAE,IAG9B,EAAW,AAAC,IACZ,IAAI,EAAQ,IAAI,CAAC,KAAK,GAClB,EAAQ,IAAI,CAAC,GAAG,CAAC,wBAAyB,GAC9C,GAAI,EAAO,CACP,IAAI,EAAI,IAAI,CAAC,SAAS,CACtB,GAAI,EAAI,MAAM,EAAK,CAAA,EAAE,KAAK,CAAG,EAAI,MAAM,CAAC,KAAK,EAAI,EAAE,KAAK,CAAG,CAAA,EAIvD,OAHI,AAAC,GACD,IAAI,CAAC,GAAG,CAAC,YAAa,GAEnB,KAEX,IAAI,EAAQ,IAAI,CAAC,SAAS,CAAC,KAAK,CAEhC,GADA,EAAQ,CAAE,MAAO,EAAO,IAAK,IAAI,CAAC,KAAK,EAAG,EACtC,CAAC,EAAK,CACN,IAAI,CAAC,GAAG,CAAC,wBACT,IAAI,EAAW,IAAI,CAAC,iBAAiB,CAAC,GACtC,IAAI,CAAC,UAAU,CAAC,UAAW,CACvB,MAAO,EAAS,GAAG,CAAE,KAAM,EAAS,GAAG,CACvC,MAAO,IAAI,CAAC,OAAO,CAAC,GAAG,CAAE,KAAM,IAAI,CAAC,OAAO,CAAC,GAAG,AACnD,EACJ,CACJ,CAKA,OAJI,AAAC,GACD,GAAc,IAAI,CAAC,IAAI,CAAE,EAAQ,CAAC,EAAO,IACrC,CAAC,CAAC,EAAE,EAAM,uBAAgB,EAAE,EAAQ,GAAa,mBAAY,CAAC,EAE/D,CACX,EAEA,EAAO,IAAI,CAAC,eAAe,CAAC,CACxB,kCAAmC,AAAA,EAAkB,KACjD,EAAM,IAAI,CAAC,GACX,IAAI,CAAC,YAAY,CAAC,EAAK,KAAK,CAAE,EAAK,GAAG,CAAE,EAAQ,IAChD,IAEI,AADJ,CAAA,EAAO,GAAP,GACW,GACf,GACA,2CAA4C,AAAA,EAAkB,KAC1D,EAAM,IAAI,CAAC,GACX,IAAI,CAAC,YAAY,CAAC,EAAK,KAAK,CAAE,EAAK,GAAG,CAAE,EAAQ,IAChD,IACA,GACJ,GACA,iCAAkC,AAAA,EAAkB,KAE5C,AADJ,CAAA,EAAO,GAAP,GACW,GACf,GACA,kCAAmC,AAAA,EAAkB,KACjD,IAAI,EACJ,KAAO,GACH,EAAO,EACP,IAAI,CAAC,YAAY,CAAC,EAAK,KAAK,CAAE,EAAK,GAAG,CAAE,EAAQ,IAChD,IACA,EAAO,EAAS,CAAA,GAEhB,IACA,IAAI,CAAC,GAAG,CAAC,YAAa,EAAK,KAAK,EAChC,IAAI,CAAC,GAAG,CAAC,yBAEb,GACJ,GACA,4BAA6B,AAAA,EAAkB,KAC3C,IAAI,EAAO,EAAM,GAAG,GACpB,GAAI,EAAM,CACN,IACA,IAAI,CAAC,GAAG,CAAC,QAIT,IAAI,EAAO,IAAI,CAAC,aAAa,CACzB,EAAK,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,EAAG,GACnC,WAAW,KACP,IAAI,CAAC,aAAa,CAAG,EACrB,IAAI,CAAC,WAAW,CAAG,CACvB,GAEA,IAAI,CAAC,GAAG,CAAC,YAAa,EAAK,KAAK,EAChC,EAAO,GACX,MACI,IAAI,CAAC,WAAW,CAAC,eAEzB,GACA,oBAAqB,AAAA,EAAkB,AAAA,IACnC,IACO,GAEf,GACA,EAAO,KACC,GAAK,EAAI,OAAO,GACpB,EAAG,mBAAmB,CAAC,QAAS,GAChC,IAAI,CAAC,WAAW,CAAC,GACjB,IAAI,CAAC,aAAa,CAAC,WACnB,IAAI,CAAC,aAAa,CAAC,gBACnB,IAAI,CAAC,eAAe,CAAG,KACvB,IAAI,CAAC,SAAS,CAAC,IACf,EAAG,GAAG,CAAC,4BACP,IAAI,CAAC,UAAU,CAAC,CAAC,SAAS,EAAE,EAAM,YAAY,CAAC,CACnD,EACA,CAAA,EAAO,GAAP,EAII,EAAG,gBAAgB,CAAC,QAAS,GAF7B,GAIR,CAEA,SAAS,GAAc,CAAM,EACzB,OAAO,AAAA,EAAkB,KAAM,SAAS,CAAI,EACxC,IAAI,EAAM,IAAI,CAAC,eAAe,CAC1B,EAAO,CACP,SAAU,CAAA,EACV,OAAQ,AAAU,MAAV,GAAkB,EAAM,EAAI,MAAM,CAAG,CAAC,CAAC,EAC/C,KAAM,EAAM,EAAI,IAAI,CAAG,CAAC,CAAC,EACzB,OAAQ,IAAI,CAAC,eAAe,EAAI,IAAI,CAAC,SAAS,EAClD,EACI,GACA,IAAI,CAAC,GAAG,CAAC,iBACT,IAAI,CAAC,eAAe,CAAG,OAAO,MAAM,CAAC,CAAC,EAAG,EAAK,GAC9C,GAAgB,IAAI,CAAC,IAAI,GAEzB,GAAgB,IAAI,CAAC,IAAI,CAAE,EAEnC,EACJ,CA1NA,GAA2B,cAAc,CAAG,CAAE,sBAAuB,CA4NrE,AAAA,EAAa,WAAW,CAAC,CACrB,cAAe,GAAc,MAC7B,qBAAsB,GAAc,CAAA,EACxC,EEljBO,OAAM,GACT,MAAQ,CAAI,AACZ,CAAA,UAAY,CAAI,AAChB,CAAA,QAAU,CAAI,AACd,CAAA,WAAa,IAAK,AAClB,CAAA,UAAY,CAAA,CAAM,AAClB,CAAA,OAAS,IAAK,AAEd,CAAA,QAAU,CAAE,KAAM,CAAE,KAAM,KAAM,IAAK,CAAE,AAAC,AACxC,CAAA,OAAS,CAAE,IAAK,IAAK,AAAC,AACtB,CAAA,OAAS,0DAA2D,AACpE,CAAA,KAAO,2BAA4B,AACnC,CAAA,WAAa,uIAAwI,AACrJ,CAAA,WAAa,CACT,IAAO,IACP,IAAO,IACP,IAAO,GACX,CAAE,AACF,CAAA,YAAc,CACV,IAAM,IACN,IAAM,IACN,IAAM,GACV,CAAE,AAEF,aAAY,CAAA,OAAE,CAAM,CAAA,IAAE,CAAG,CAAE,CAAE,CACzB,IAAI,CAAC,OAAO,CAAG,EACf,IAAI,CAAC,IAAI,CAAG,CAChB,CAEA,MAAO,CACH,IAAI,CAAC,OAAO,CAAC,SAAS,GAClB,IAAI,CAAC,KAAK,GAAK,EACf,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAExB,IAAI,CAAC,IAAI,EAEjB,CAEA,MAAO,CACH,IAAI,EAAQ,IAAI,CAAC,KAAK,CAClB,EAAY,IAAI,CAAC,SAAS,CAC1B,EAAU,IAAI,CAAC,OAAO,CACtB,EAAa,IAAI,CAAC,UAAU,CAC5B,EAAY,IAAI,CAAC,SAAS,CAC1B,EAAS,IAAI,CAAC,MAAM,CACxB,MAAO,KACH,IAAI,CAAC,KAAK,CAAG,EACb,IAAI,CAAC,SAAS,CAAG,EACjB,IAAI,CAAC,OAAO,CAAG,EACf,IAAI,CAAC,UAAU,CAAG,EAClB,IAAI,CAAC,SAAS,CAAG,EACjB,IAAI,CAAC,MAAM,CAAG,EACP,IAAI,CAEnB,CAEA,WAAY,CACR,IAAI,EAAI,IAAI,CAAC,OAAO,CACpB,GAAI,EAAE,GAAG,IAAM,EAAE,QAAQ,GAErB,OADA,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,IAAI,CAAC,CAAG,IAAI,CAAC,IAAI,GAC9B,CAAA,CAEf,CAEA,OAAO,EAAY,CAAA,CAAI,CAAE,CACrB,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EACtB,OAII,GAHK,CAAA,EAAI,EAAE,SAAS,CAAC,IAAI,CAAC,UAAU,CAAA,GAChC,IAAI,CAAC,CAAC,CAAC,KAAM,CAAC,CAAC,EAAE,CAAC,MAAM,EAExB,EACA,CAAA,GAAI,CAAC,IAAI,CAAC,SAAS,GAAI,KAAvB,MAEA,KAGZ,CAEA,MAAO,CACF,IAAI,CAAC,WAAW,IAChB,IAAI,CAAC,UAAU,IACf,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,cAAc,IACnB,IAAI,CAAC,UAAU,IACf,IAAI,CAAC,sBAAsB,IAC3B,IAAI,CAAC,CAAC,EACX,CAEA,aAAc,CACV,IAAK,IAAI,KAAO,IAAI,CAAC,OAAO,CACxB,GAAI,MAAM,OAAO,CAAC,IAAQ,IAAI,CAAC,gBAAgB,IAAI,IAC/C,IAAI,CAAC,eAAe,CAAC,GADgC,MAAO,CAAA,CAGxE,CAEA,gBAAgB,CAAK,CAAE,CACnB,IAAI,EAAI,IAAI,CAAC,OAAO,CAChB,EAAI,KAAM,EAAM,KACpB,KAAO,EAAE,SAAS,CAAC,IACX,AAAC,GACD,CAAA,EAAI,CACA,KAAM,EAAE,IAAI,CAAE,IAAK,EAAE,GAAG,CAAE,GAAI,EAAE,GAAG,CAAE,GAAI,EAAE,GAAG,CAAE,QAAS,CAAA,EAAM,KAAM,GACrE,MAAO,CAAE,GAAI,EAAE,IAAI,CAAE,GAAI,EAAE,GAAG,AAAC,EAC/B,MAAO,CAAE,GAAI,EAAE,IAAI,CAAE,GAAI,EAAE,GAAG,AAAC,CACnC,CAAA,EAEJ,IAAI,CAAC,CAAC,CAAC,kBAAmB,EAAM,MAAM,EACtC,IAAI,CAAC,KAAK,CAAC,CAAE,KAAM,EAAE,IAAI,CAAE,GAAI,EAAE,GAAG,CAAE,GAAI,EAAE,GAAG,CAAG,EAAE,UAAU,EAAG,EAAG,WACpE,EAAM,CAAE,KAAM,EAAE,IAAI,CAAE,IAAK,EAAE,GAAG,CAAE,GAAI,EAAE,GAAG,CAAE,GAAI,EAAE,GAAG,CAAE,KAAM,GAAI,OAAQ,CAAE,EAYhF,OANI,IACA,EAAE,MAAM,CAAG,EACX,EAAE,KAAK,CAAC,EAAE,CAAG,EAAE,KAAK,CAAC,EAAE,CAAG,EAAI,IAAI,CAClC,EAAE,KAAK,CAAC,EAAE,CAAG,EAAE,KAAK,CAAC,EAAE,CAAG,EAAI,EAAE,CAChC,IAAI,CAAC,SAAS,CAAC,IAEZ,CACX,CAEA,iBAAiB,CAAK,CAAE,CAAI,CAAE,CAAK,CAClB,EAAO,kBAAkB,CACzB,EAAO,UAAU,CACjB,EAAO,kBAAkB,CAC1C,CACI,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EACtB,GAAI,IAAI,CAAC,UAAU,CACf,GAAK,EAAI,EAAE,SAAS,CAAC,GAAQ,CACzB,IAAI,EAAI,IAAI,CAAC,UAAU,CAAC,EAAO,CAAC,CAAC,EAAE,CAAC,MAAM,CAAE,EAC5C,CAAA,EAAE,KAAK,CAAC,EAAE,CAAG,EAAE,MAAM,CAAC,IAAI,CAC1B,EAAE,KAAK,CAAC,EAAE,CAAG,EAAE,MAAM,CAAC,EAAE,CACxB,EAAE,KAAK,CAAC,EAAE,CAAG,EAAE,MAAM,CAAC,IAAI,CAC1B,EAAE,KAAK,CAAC,EAAE,CAAG,EAAE,MAAM,CAAC,EAAE,CACxB,IAAI,CAAC,OAAO,GACZ,IAAI,CAAC,UAAU,CAAG,IACtB,MACI,IAAI,CAAC,CAAC,CAAC,QAER,GAAI,EAAE,SAAS,CAAC,GAAQ,CAC3B,IAAI,CAAC,UAAU,CAAG,CAAE,KAAM,EAAE,IAAI,CAAE,GAAI,EAAE,GAAG,CAAE,MAAO,CAAM,EAC1D,IAAI,EAAI,IAAI,CAAC,WAAW,CAAC,EAAO,GAKhC,OAJA,EAAE,OAAO,CAAG,CAAA,EACZ,EAAE,KAAK,CAAG,CAAE,GAAI,EAAE,IAAI,CAAE,GAAI,EAAE,EAAE,AAAC,EACjC,EAAE,KAAK,CAAG,CAAE,GAAI,EAAE,IAAI,CAAE,GAAI,EAAE,EAAE,AAAC,EACjC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAE,EAAO,EAAM,EAAO,EAAM,EAAM,IACxE,CAAA,CACX,CACJ,CAEA,WAAW,CAAK,CAAE,CAAI,CAAE,CAAQ,CAAE,CAAO,CAAE,CAAO,CAAE,CAChD,IAAI,EAAI,IAAI,CAAC,OAAO,CACpB,GAAI,IAAI,CAAC,SAAS,CACd,GAAI,EAAE,SAAS,CAAC,MACZ,IAAI,CAAC,CAAC,CAAC,GACP,IAAI,CAAC,CAAC,CAAC,QACJ,GAAI,EAAE,SAAS,CAAC,GACnB,IAAI,CAAC,OAAO,GACZ,IAAI,CAAC,SAAS,CAAG,CAAA,EACjB,IAAI,CAAC,UAAU,CAAC,EAAO,EAAK,MAAM,CAAE,CAAA,EAAG,EAAQ,QAAQ,CAAC,OACrD,GAAI,GAAY,EAAE,SAAS,CAAC,GAAW,CAC1C,IAAI,CAAC,SAAS,CAAG,CAAA,EACjB,IAAI,EAAK,IAAI,CAAC,WAAW,CAAC,GAC1B,IAAI,CAAC,QAAQ,CAAC,KACN,EAAE,SAAS,CAAC,IAAY,IAAI,CAAC,SAAS,CAAC,GAAG,GAAK,GAC/C,IAAI,CAAC,UAAU,CAAC,EAAU,EAAQ,MAAM,EACxC,IAAI,CAAC,OAAO,GACZ,IAAI,CAAC,SAAS,CAAG,CAAA,GAEjB,IAAI,CAAC,IAAI,EAEjB,EACJ,MACI,IAAI,CAAC,CAAC,CAAC,QAER,IAAK,IAAI,KAAO,IAAI,CAAC,MAAM,CAAE,CAChC,IAAI,EAAQ,EAAK,EAAO,EAAK,EAAU,EAAS,EAAU,SAE1D,GADI,MAAM,OAAO,CAAC,IAAM,CAAA,CAAE,EAAO,EAAM,EAAU,EAAS,EAAU,QAAQ,CAAE,CAAG,CAAjF,EACI,EAAE,SAAS,CAAC,GAIZ,OAHA,IAAI,CAAC,WAAW,CAAC,EAAO,CAAA,EAAG,EAAQ,QAAQ,CAAC,EAC5C,IAAI,CAAC,SAAS,CAAG,CAAA,EACjB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAE,EAAO,EAAM,EAAU,EAAS,IAClE,CAAA,CAEf,CACJ,CAEA,YAAa,CACT,OAAO,IAAI,CAAC,UAAU,EAC1B,CAEA,UAAW,CACP,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EAAI,EAAE,SAAS,CAAC,IAAI,CAAC,IAAI,EAC/C,GAAI,EACA,MAAO,CAAE,KAAM,EAAE,IAAI,CAAE,GAAI,EAAE,GAAG,CAAE,GAAI,EAAE,GAAG,EAAI,CAAC,CAAC,EAAE,CAAC,MAAM,CAAE,GAAI,CAAC,CAAC,EAAE,AAAC,CAE7E,CAEA,UAAU,EAAO,IAAI,CAAE,CACnB,IAAI,EAAO,IAAI,CAAC,QAAQ,GAExB,OADI,GAAM,IAAI,CAAC,KAAK,CAAC,EAAM,EAAK,IAAI,CAAG,GAChC,CACX,CAEA,YAAa,CACT,IAAI,EAAI,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,EAC1C,GAAI,EAEA,OADA,IAAI,CAAC,CAAC,CAAC,SAAU,CAAC,CAAC,EAAE,CAAC,MAAM,EACrB,CAAA,CAEf,CAEA,aAAa,CAAI,CAAE,CACf,IAAI,CAAC,MAAM,CAAG,CAClB,CAEA,eAAgB,CACZ,IAAI,EAAK,IAAI,CAAC,OAAO,CAAC,IAAI,GAC1B,GAAI,IAAI,CAAC,UAAU,CAAC,EAAG,CAGnB,OAFA,IAAI,CAAC,WAAW,CAAC,GAAI,IAAI,CAAG,IAAI,CAAC,MAAM,CACvC,IAAI,CAAC,MAAM,CAAG,KACP,CAAA,CAEf,CAEA,gBAAiB,CACb,IAAI,EAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG,CAChD,GAAI,EAEA,OADA,IAAI,CAAC,UAAU,CAAC,EAAM,GACf,CAAA,CAEf,CAEA,wBAAyB,CACrB,IAAI,EAAI,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,SAC/B,GAAI,EAEA,OADA,IAAI,CAAC,CAAC,CAAC,sBAAuB,CAAC,CAAC,EAAE,CAAC,MAAM,EAClC,CAAA,CAEf,CAEA,EAAE,EAAO,IAAI,CAAE,EAAM,CAAC,CAAE,CACpB,IAAI,CAAC,KAAK,CAAC,CACP,KAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CACvB,GAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CACpB,GAAI,IAAI,CAAC,OAAO,CAAC,GAAG,EAAI,CAC5B,EAAG,EACP,CAEA,MAAM,CAAG,CAAE,EAAO,EAAI,IAAI,CAAE,CACxB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,EAAI,IAAI,CAAE,EAAI,EAAE,CAAE,EAAI,EAAE,CAAE,EAChD,CAEA,YAAY,CAAI,CAAE,EAAU,YAAY,CAAE,CACtC,IAAI,EAAI,IAAI,CAAC,OAAO,CAChB,EAAI,EAAK,MAAM,CACf,EAAI,CAAE,KAAM,EAAE,IAAI,CAAE,IAAK,EAAE,GAAG,CAAE,GAAI,EAAE,GAAG,CAAE,GAAI,EAAE,GAAG,CAAG,EAAG,KAAM,CAAK,EAGzE,OAFA,IAAI,CAAC,SAAS,CAAG,IAAI,EAAK,EAAG,IAAI,CAAC,SAAS,EACvC,GAAG,IAAI,CAAC,CAAC,CAAC,EAAS,GAChB,CACX,CAEA,WAAW,CAAK,CAAE,EAAI,EAAM,MAAM,CAAE,EAAU,aAAa,CAAE,CACzD,IAAI,EAAI,IAAI,CAAC,OAAO,CACpB,GAAI,IAAI,CAAC,SAAS,GAAK,EAAK,CACxB,IAAI,EAAQ,IAAI,CAAC,SAAS,CAAC,GAAG,CAU9B,OATA,IAAI,CAAC,SAAS,CAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAC/B,GAAS,EAAM,IAAI,CAEf,GAAG,IAAI,CAAC,CAAC,CAAC,QAAS,IAEvB,EAAM,MAAM,CAAG,CAAE,KAAM,EAAE,IAAI,CAAE,IAAK,EAAE,GAAG,CAAE,GAAI,EAAE,GAAG,CAAE,GAAI,EAAE,GAAG,CAAG,EAAG,OAAQ,CAAM,EACnF,IAAI,CAAC,SAAS,CAAC,GACX,GAAG,IAAI,CAAC,CAAC,CAAC,EAAS,IAEpB,CACX,CACQ,GAAG,IAAI,CAAC,CAAC,CAAC,QAAS,EAE/B,CAEA,SAAU,CACN,OAAO,IAAI,CAAC,SAAS,CAAC,GAAG,AAC7B,CAEA,UAAU,CAAC,CAAE,CACT,IAAI,CAAC,OAAO,CAAG,IAAI,EAAK,EAAG,IAAI,CAAC,OAAO,CAC3C,CAEA,SAAS,CAAI,CAAE,CACX,IAAI,CAAC,KAAK,CAAG,IAAI,EAAK,EAAM,IAAI,CAAC,KAAK,CAC1C,CAEA,SAAU,CACN,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,KAAK,CAAC,GAAG,AAC/B,CAGA,aAAc,CACV,IAAI,EAAI,IAAI,CAAC,OAAO,CAChB,EAAM,EAAE,IAAI,CACZ,EAAc,EAAE,QAAQ,GACxB,EAAS,EAET,EAAe,IAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,gBAElD,GAAI,IAAI,CAAC,SAAS,QAEd,AAAI,EAAM,GAAK,CAAC,KAAK,IAAI,CAAC,GAEf,EAAE,eAAe,CAAC,EAAM,GAG5B,KAGX,GAAI,IAAI,CAAC,UAAU,CAAE,CACjB,IAAI,EAAmB,EAAE,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAEtD,GADA,EAAS,IAAI,CAAC,UAAU,CAAC,EAAE,CAAG,EAC1B,AAAyB,KAAzB,IAAI,CAAC,UAAU,CAAC,KAAK,EAAW,CAAC,SAAS,IAAI,CAAC,GAAc,CAE7D,IAAI,EAAK,SACT,CAAA,EAAG,SAAS,CAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAG,EACpC,IAAI,EAAI,EAAG,IAAI,CAAC,EACZ,CAAA,GAAG,CAAA,EAAS,EAAE,KAAK,AAAL,CACtB,CACA,OAAO,CACX,CAEA,IAAI,EAAI,IAAI,CAAC,SAAS,CAAC,GAAG,CAC1B,GAAI,EAAG,CAEH,IAAI,EAAK,AAAI,OAAO,UAAY,IAAI,CAAC,UAAU,CAAC,EAAE,IAAI,CAAC,EACnD,EAAiB,EAAG,IAAI,CAAC,EAI7B,CADA,CAAA,EAAK,KAAL,EACG,SAAS,CAAG,EAAE,GAAG,CAAG,EACvB,IAAI,EAAI,EAAG,IAAI,CAAC,EAAE,QAAQ,CAAC,EAAE,IAAI,GACjC,GAAI,EAEA,EAAS,EAAiB,EAAE,GAAG,CAAG,EAAE,KAAK,KAExC,CAID,IAAI,EAAO,EAAE,IAAI,AACb,CAAA,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,QAAQ,MAAQ,GAClC,CAAA,EAAO,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,AAAJ,EAE5B,EAAS,EAAE,eAAe,CAAC,GAAQ,IAG/B,EACA,GAAU,IACH,IAAI,CAAC,YAAY,EAAI,iCAAiC,IAAI,CAAC,IAClE,CAAA,GAAU,GADP,CAGX,CACJ,KACK,CACD,IAAI,EAAI,EAAK,EACb,KAAO,KAAM,GAAG,GAAK,EAAI,KAAK,IAAI,CAAC,EAAE,QAAQ,CAAC,IAAM,CAChD,IAAI,EAAI,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,GACnC,GAAI,CAAE,CAAA,EAAE,SAAS,EAAI,EAAE,UAAU,AAAV,EAAa,KACxC,CACI,GAAG,CAAA,EAAS,EAAE,KAAK,AAAL,CACtB,CAMA,GAAI,EAAM,EAAG,CACT,IAAI,EAAS,EAAE,UAAU,GACzB,GAAI,SAAS,IAAI,CAAC,IAAW,IAAI,CAAC,OAAO,GAAK,EAAK,CAM/C,EAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CACpB,IAAI,EAAW,EAAE,QAAQ,CAAC,EAAE,IAAI,CAC5B,CAAA,yBAAyB,IAAI,CAAC,IAAa,CAAC,SAAS,IAAI,CAAC,IAC1D,CAAA,GAAU,GADd,CAEJ,KACS,aAAa,IAAI,CAAC,IAAW,CAAC,SAAS,IAAI,CAAC,IACjD,CAAA,GAAU,GAFd,CAIJ,CAMA,MAHI,yBAAyB,IAAI,CAAC,IAC9B,CAAA,GAAU,IAAiB,CAAA,EAExB,CACX,CAEA,IAAI,cAAe,CACf,MAAO,IAAI,IAAI,CAAC,OAAO,CAAC,AAC5B,CAEA,IAAI,QAAS,CACT,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,AAC9B,CAEA,IAAI,OAAQ,CACR,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,AAC9B,CACJ,CAEA,AAAA,EAAa,WAAW,CAAC,CACrB,iCAAkC,WAC9B,GAAI,CAAC,IAAI,CAAC,SAAS,CAAE,OACrB,IAAI,EAAc,IAAM,IAAI,CAAC,SAAS,CAAC,KAAK,GACvC,MAAM,CAAC,AAAA,GAAY,IAAI,CAAC,OAAO,GAC/B,QAAQ,CAAC,AAAA,GAAK,EAAE,OAAO,EACxB,EAAU,KAAiB,IAAI,CAAC,GAAG,CAAC,iBAAkB,KACtD,IAAI,CAAC,GAAG,CAAC,eACF,MAEX,GAAI,GAAS,OAAQ,CACjB,IAAI,EAAI,CACJ,MAAO,IAAI,CAAC,iBAAiB,CAAC,EAAQ,KAAK,CAAC,EAAE,CAAE,EAAQ,KAAK,CAAC,EAAE,EAChE,IAAK,IAAI,CAAC,iBAAiB,CAAC,EAAQ,KAAK,CAAC,EAAE,CAAE,EAAQ,KAAK,CAAC,EAAE,CAClE,EAMA,OALA,IAAI,CAAC,GAAG,CAAC,iBAAkB,KACvB,IAAI,CAAC,GAAG,CAAC,YAAa,EAAE,KAAK,EAC7B,IAAI,CAAC,GAAG,CAAC,sBAAuB,CAAA,GAChC,EAAE,KAAK,CAAG,IAAI,CAAC,KAAK,EACxB,GACO,CACX,CACJ,CACJ,EDrbA,OAAM,WAAuB,GACzB,YAAa,CACT,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EACtB,IAAK,GAAI,CAAE,EAAI,GAAG,EAAO,GAAI,IAAI,CAAC,KAAK,CACnC,GAAK,EAAI,EAAE,SAAS,CAAC,GAGjB,OAFA,EAAM,OAAO,CAAC,CAAC,EAAK,IAChB,GAAO,CAAC,CAAC,EAAE,EAAI,IAAI,CAAC,CAAC,CAAC,EAAK,CAAC,CAAC,EAAE,CAAC,MAAM,GACnC,CAAA,CAGnB,CACA,MAAQ,CACJ,CAAE,+DAAgE,SAAU,OAAQ,CACpF,CAAE,oCAAqC,gBAAiB,WAAY,CACpE,CAAE,yBAA0B,UAAW,WAAY,CACnD,CAAE,uBAAwB,gBAAiB,CAC3C,CAAE,sBAAuB,WAAY,CACrC,CAAE,sBAAuB,UAAW,CACpC,CAAE,8FAA+F,UAAW,CAC/G,AAAC,AACN,CAEA,AAAA,GAAgB,MAAM,CAAC,MAAO,CAAC,EAAQ,IAAQ,IAAI,GAAe,CAAE,OAAA,EAAQ,IAAA,CAAI,IAEhF,AAAA,EAAa,OAAO,CAAC,WAAY,WAC7B,IAAI,EAAM,IAAI,CAAC,SAAS,CACxB,IAAI,CAAC,YAAY,CAAC,IAAI,GAAgB,CAAE,OAAQ,IAAI,CAAE,KAAM,KAAM,IAClE,IAAI,EAAkB,IAAI,CAAC,GAAG,CAAC,mBAAoB,CAAA,GAC/C,EAAe,IAAI,CAAC,IAAI,CAAC,CACzB,qBAAsB,uBACtB,oBAAqB,CACjB,GAAI,uBACJ,GAAI,IACR,EACA,qBAAsB,CAClB,GAAI,+BACJ,GAAI,CAAE,KAAM,KAAM,AACtB,CACJ,GAEA,OAAO,WACH,IAAI,CAAC,YAAY,CAAC,GACd,AAAC,GACD,IAAI,CAAC,GAAG,CAAC,mBAAoB,CAAA,GACjC,IAAI,CAAC,IAAI,CAAC,EACd,CACJ,GE5CA,IAAM,GAAW,AAAA,EAAO,CAAC;A;A;A;AAIkC,2DAAA,CAAC,EAEtD,GAAgB,AAAA,EAAO,CAAC;AAC2B,yDAAA,CAAC,EAEpD,GAAiB,AAAA,EAAO,0CAExB,GAAmB,AAAA,EAAO,CAAC;A;AAEH,8BAAA,CAAC,EAEzB,GAAqB,gEAE3B,OAAM,WAAsB,GACxB,OAAS,CAAE,IAAK,IAAK,CAAE,IAAK,IAAK,KAAM,IAAK,CAAE,AAAC,AAC/C,CAAA,QAAU,IAAK,AAEf,CAAA,MAAO,CACH,IAAI,EAAS,KAAK,CAAC,OACf,EAAU,IAAI,CAAC,OAAO,CAC1B,MAAO,KACH,IAAI,EAAO,IAEX,OADA,EAAK,OAAO,CAAG,EACR,CACX,CACJ,CAEA,YAAa,CACT,IAAI,EAAI,IAAI,CAAC,OAAO,CACpB,GAAI,AAAY,KAAZ,EAAE,IAAI,IAAa,GAAmB,IAAI,CAAC,EAAE,UAAU,IAAK,CAC5D,IAAI,EAAK,CAAE,KAAM,EAAE,IAAI,CAAE,IAAK,EAAE,GAAG,CAAE,KAAM,GAAI,EAG/C,OAFA,IAAI,CAAC,CAAC,CAAC,kBACP,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAE,IACzC,CAAA,CACX,CACA,GAAI,EAAE,SAAS,CAAC,OAEZ,OADA,IAAI,CAAC,CAAC,CAAC,WAAY,GACZ,CAAA,EAEX,IAAI,EAAS,IAAI,CAAC,OAAO,AACzB,CAAA,IAAI,CAAC,OAAO,CAAG,AAAY,KAAZ,EAAE,IAAI,GACrB,IAAI,EAAM,IAAI,CAAC,QAAQ,UACvB,AAAI,GACA,IAAI,CAAC,MAAM,GACP,GACA,EAAI,IAAI,CAAG,EAAE,SAAS,CAAC,KAAO,gBAAkB,KAChD,IAAI,CAAC,KAAK,CAAC,IACJ,EAAE,SAAS,CAAC,MACnB,EAAI,IAAI,CAAG,AAAU,WAAV,EAAI,EAAE,CAAgB,UAAY,KAC7C,IAAI,CAAC,KAAK,CAAC,IACH,IAAI,CAAC,YAAY,CAAC,KAC1B,EAAI,IAAI,CAAG,EAAI,EAAE,IAAI,GAAW,UAC1B,EAAE,SAAS,CAAC,KAAO,gBACnB,EAAI,EAAE,IAAI,GAAgB,OAC1B,EAAI,EAAE,IAAI,GAAiB,WAC3B,EAAI,EAAE,IAAI,GAAmB,UAC7B,KACN,IAAI,CAAC,KAAK,CAAC,IAER,CAAA,GAEJ,IAAI,CAAC,UAAU,EAC1B,CAEA,aAAa,CAAG,CAAE,CACd,IAEI,EAFA,EAAI,IAAI,CAAC,OAAO,CAChB,EAAQ,IAAI,CAAC,OAAO,GAGxB,OAAQ,EAAI,EAAE,EACZ,IAAK,QACH,GAAI,EAAE,SAAS,CAAC,MAAS,CAAA,EAAO,IAAI,CAAC,SAAS,CAAC,OAAA,EAAU,CACrD,IAAI,CAAC,KAAK,CAAC,EAAK,WAChB,IAAI,CAAC,MAAM,GACX,IAAI,EAAM,IAAI,CAAC,QAAQ,GACnB,IACI,AAAU,WAAV,EAAI,EAAE,EACN,IAAI,CAAC,KAAK,CAAC,EAAK,EAAI,IAAI,CAAG,WAC3B,IAAI,CAAC,MAAM,GACX,IAAI,CAAC,SAAS,CAAC,SAEf,IAAI,CAAC,KAAK,CAAC,EAAK,OAGxB,IAAI,CAAC,YAAY,CAAC,CAAE,MAAO,EAAK,KAAM,CAAK,EAC/C,CACA,MAAO,CAAA,CAET,KAAK,MAGH,OAFA,IAAI,CAAC,KAAK,CAAC,EAAK,WAChB,IAAI,CAAC,YAAY,CAAC,CAAE,IAAK,CAAI,GACtB,CAAA,CAET,KAAK,KACH,GAAI,GAAO,MAAM,IAEb,OADA,IAAI,CAAC,KAAK,CAAC,EAAK,WACT,CAAA,EAEX,KAEF,KAAK,WAGH,OAFA,IAAI,CAAC,KAAK,CAAC,EAAK,WAChB,IAAI,CAAC,SAAS,CAAC,iBACR,CAAA,CAET,KAAK,MAKH,OAJA,IAAI,CAAC,KAAK,CAAC,EAAK,WACZ,AAAC,EAAE,SAAS,CAAC,WACb,IAAI,CAAC,SAAS,CAAC,QAEZ,CAAA,CAET,KAAK,MACL,IAAK,MACL,IAAK,SACL,IAAK,cACH,GAAI,GAAO,MAAM,MAEb,OADA,IAAI,CAAC,KAAK,CAAC,EAAK,WACT,CAAA,CAGf,CAEA,GAAI,GAAO,MAAM,OAAS,EAAE,SAAS,CAAC,UAGlC,OADA,IAAI,CAAC,KAAK,CAAC,EAAK,iBACT,CAAA,CAEf,CAEA,kBAAkB,CAAE,CAAE,CAClB,IAAI,EAAI,IAAI,CAAC,OAAO,CAChB,EAAI,EAAM,CAAA,EAAO,EAAQ,EAAG,EAAQ,EAAE,GAAG,CAC7C,KAAO,CAAC,EAAE,GAAG,IAAI,CAIb,GAFI,AAAM,KADV,CAAA,EAAK,EAAE,IAAI,EAAX,GACiB,CAAC,GAAO,CAAC,GAAO,IAC7B,AAAM,KAAN,GAAa,CAAC,GAAO,GAAO,IAC5B,AAAM,KAAN,GAAa,CAAC,GAAO,CAAC,EAAO,CAC7B,IAAI,EAAK,EAAE,GAAG,CACd,IAAI,CAAC,OAAO,GACZ,IAAI,CAAC,KAAK,CAAC,CAAE,KAAM,EAAE,IAAI,CAAE,GAAI,EAAO,GAAI,EAAE,GAAG,AAAC,EAAG,UACnD,IAAI,CAAC,CAAC,CAAC,kBACP,IAAI,EAAI,EAAE,SAAS,CAAC,eAChB,CAAA,GAAG,IAAI,CAAC,CAAC,CAAC,kBAAmB,CAAC,CAAC,EAAE,CAAC,MAAM,EAC5C,EAAG,MAAM,CAAG,CAAE,KAAM,EAAE,IAAI,CAAE,GAAI,EAAI,GAAI,EAAE,GAAG,CAAE,OAAQ,CAAG,EAC1D,IAAI,CAAC,SAAS,CAAC,GACf,MACJ,CACA,EAAM,CAAC,GAAO,AAAO,OAAP,EACd,EAAE,EAAE,GAAG,AACX,CACA,IAAI,CAAC,KAAK,CAAC,CAAE,KAAM,EAAE,IAAI,CAAE,GAAI,EAAO,GAAI,EAAE,GAAG,AAAC,EAAG,SACvD,CACJ,CAEA,GAAc,SAAS,CAAC,YAAY,CAAG,CAAA,EAEvC,AAAA,GAAgB,MAAM,CAAC,KAAM,CAAC,EAAQ,IAAQ,IAAI,GAAc,CAAE,OAAA,EAAQ,IAAA,CAAI,IAE9E,IAAI,GAAkB,AAAA,EAAa,MAAM,CAAC,KAAM,CAC5C,IAAQ,CAAE,oBAAqB,IAAK,IAAK,UAAW,CACpD,IAAQ,CAAE,oBAAqB,IAAK,IAAK,UAAW,CACpD,MAAQ,CAAE,qBAAsB,IAAK,IAAK,UAAW,CACrD,MAAQ,CAAE,qBAAsB,IAAK,IAAK,UAAW,AACzD,GCrKI,SAAS,GAAQ,CAAK,EAClB,IAAI,CAAC,KAAK,CAAG,CACjB,CAEA,SAAS,GAAY,CAAM,CAAE,CAAG,EAC5B,IAAI,EAAQ,IAAI,GAAoB,CAAE,OAAQ,EAAQ,IAAK,CAAI,GAC/D,SAAS,IAAS,OAAO,EAAM,IAAI,EAAG,CACtC,SAAS,IAAS,OAAO,EAAM,IAAI,EAAG,CACtC,SAAS,IACL,OAAO,EAAM,UAAU,CAAC,SAAS,CAAE,QAC/B,AAAI,CAAA,CAAA,CAAC,GAAe,AAAS,MAAT,GAAiB,EAAM,GAAG,EAAI,CAAA,GAC3C,EAAM,aAAa,CAAC,EAC/B,EACJ,CAEA,SAAS,EAAW,CAAI,EAAI,OAAO,EAAM,UAAU,CAAC,EAAM,CAC1D,SAAS,EAAa,CAAK,CAAE,CAAG,CAAE,CAAK,EAFnB,IAMhB,IAFA,IAAI,EAAU,CAAA,EACV,EAAM,KACG,CACT,IAAI,EAAK,IACT,GAAI,CAAC,EAAI,MAAM,IAAI,GAAQ,GAC3B,GAAI,EACA,GAAO,EACP,EAAU,CAAA,OACP,GAAI,AAAM,MAAN,EACH,GAAO,CAAA,GAAO,CAAlB,EACA,EAAU,CAAA,OACP,GAAI,GAAM,EACb,WAEA,GAAO,CAEf,CACA,OAAO,CACX,CACA,SAAS,IACL,OAAO,EAAW,SAAS,CAAE,EAAG,OAAO,GAAM,AAAM,MAAN,CAAW,EAC5D,CACA,SAAS,IACL,IAAI,EAAU,EAAW,WACrB,MAAO,CAAC,EAAM,UAAU,CAAC,KAC7B,GAEA,OA/BgB,IAAA,IA+BT,CACX,CACA,SAAS,IACL,OAAO,EAAa,IAAM,IAC9B,CACA,SAAS,EAAU,CAAG,CAAE,CAAG,EACvB,IAAI,EAAkB,EACtB,EAAa,EACb,GAAI,CACA,IAAI,EAAM,EAAE,CAxCA,IA0CZ,EAAK,OAED,OADA,IACQ,KACN,KAAK,EAAK,MAAM,CAChB,MAAK,KAAM,MAAM,IAAI,GAAQ,EAC7B,SACE,EAAI,IAAI,CAAC,KACT,EAAE,CACN,CAGJ,OArDY,IAqDL,CACX,QAAU,CACN,EAAa,CACjB,CACJ,CACA,SAAS,IAWL,MAAO,CAAE,QAVC,EAAa,IAAK,IAAK,CAAA,GAUV,UATZ,EAAW,SAAS,CAAE,EAC7B,GAAI,EAAI,OAAQ,EAAG,WAAW,IAC5B,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACH,MAAO,CAAA,CACX,CACJ,GAAG,WAAW,EACyB,CAC3C,CACA,SAAS,EAAe,CAAE,EACtB,OAAQ,GACN,KAAK,KACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,KACL,IAAK,IACL,IAAK,KACL,IAAK,SACL,IAAK,SACL,IAAK,IACH,MAAO,CAAA,CACX,CACA,MAAO,CAAA,CACX,CACA,SAAS,IACL,OAAO,EAAW,EACtB,CACA,SAAS,IACL,OAAO,IAAS,EAAW,SAAS,CAAE,EAClC,OAAQ,GAAM,KAAO,GAAM,KACtB,GAAM,KAAO,GAAM,KACnB,GAAM,KAAO,GAAM,KACpB,AAAM,KAAN,GAAa,AAAM,KAAN,CACrB,EACJ,CACA,SAAS,IAGL,OA/GgB,IA8GZ,AAAU,MAAV,KAAgB,IACb,GACX,CACA,SAAS,IAEL,OAnHgB,IAmHR,KACN,IAAK,KAAc,OAAR,IAAe,EAAM,OAAQ,EACxC,KAAK,IAAK,OAAO,EAAM,SAAU,EACjC,KAAK,IAAK,OAAO,EAAM,SAAU,EAAU,IAAI,CAAC,KAAM,IAAK,KAC3D,KAAK,IAAa,OAAR,IAAe,EAAM,WAAY,EAC3C,KAAK,IAAa,OAAR,IAAe,EAAM,UAAW,EAC1C,SACE,OAAO,EAAM,UAAW,EAC5B,CACJ,CACA,SAAS,IAEL,GADA,IACI,CAAC,GAAe,AAAS,MAAT,GAAiB,EAAM,GAAG,EAAI,GAAU,CAAA,CAAC,GAAU,AAAe,QAAf,EAAO,IAAI,AAAI,EAClF,OAAO,EAAc,EAAM,SAE/B,OAAQ,KACN,IAAK,IAAO,OAAO,EAAM,UAAW,EACpC,KAAK,IAAO,OAAO,EAAM,SAAU,EACnC,KAAK,IAAO,OAAO,EAAM,OAAQ,EAAU,IAAI,CAAC,KAAM,IAAK,KAC3D,KAAK,IAAO,OAAO,EAAM,OAAQ,EAAU,IAAI,CAAC,KAAM,IAAK,KAC3D,KAAK,IAAO,OAAO,EAAM,OAAQ,EAAU,IAAI,CAAC,KAAM,IAAK,KAC3D,KAAK,IAAO,OAAO,EAAM,QAAS,EAClC,KAAK,IAAO,OAAO,EAAM,OAAQ,EACjC,KAAK,IAAe,OAAR,IAAe,EAAM,KAAM,EAAY,GACnD,KAAK,IAEH,GADA,IACI,AAAU,KAAV,IAEA,OADA,IACO,EAAM,SAAU,EAAY,IAEvC,OAAO,EAAM,UAAW,EAAY,GACtC,KAAK,IAAe,OAAR,IAAe,EAAM,QAAS,EAAY,GACtD,KAAK,IACL,KAAK,KADO,OAAO,IAErB,CACA,OAAO,EAAM,SAAU,EAC3B,CACA,SAAS,IAEL,IADA,IAAI,EAAM,EAAE,CACL,AAAU,MAAV,KAAgB,CACnB,IAAI,EAAM,IACV,GAAI,AAAO,MAAP,EAAa,MACjB,EAAI,IAAI,CAAC,GACT,EAAE,CACN,CACA,OAAO,CACX,CACA,IAAI,EAAc,KACd,EAAa,EACb,EAAQ,KACR,EAAS,KACT,EAAW,KACf,SAAS,EAAM,CAAI,CAAE,CAAM,CAAE,CAAY,EACjC,AAAgB,MAAhB,GAAsB,CAAA,EAAe,CAAA,EACzC,IAAI,EAAc,EAClB,GAAI,CACA,IAAI,EAAM,CACN,MAAU,KACV,MAAU,EACV,KAAU,EACV,MAAU,EAAM,GAAG,CAAG,EACtB,OAAU,EACV,MAAU,EAAS,EAAO,KAAK,CAAG,EAAI,EACtC,QAAU,CAAA,CACd,CACI,AAAQ,CAAA,QAAR,GAAgB,CAAA,EAAS,CAA7B,EACA,GAAI,CACI,IACA,EAAI,KAAK,CAAG,IACR,AAAc,KAAd,EAAI,KAAK,EAAW,AAAQ,UAAR,GAEpB,IAGZ,CAAE,MAAM,EAAI,CACR,GAAI,aAAc,GACd,EAAI,KAAK,CAAG,EAAG,KAAK,CACpB,EAAI,OAAO,CAAG,CAAA,OAEd,MAAM,CAEd,CAOA,OANA,EAAI,GAAG,CAAG,EAAM,GAAG,CACf,AAAS,MAAT,GACI,EAAI,KAAK,EAAI,GAAS,EAAI,GAAG,EAAI,GAC7B,CAAC,GAAU,CAAA,EAAW,CAA1B,EAGD,CACX,QAAU,CACN,EAAS,CACb,CACJ,CACA,MAAO,CACH,MAAO,SAAS,CAAG,EAEf,OADA,EAAQ,EACD,EAAM,OAAQ,EACzB,EACA,KAAM,WACF,OAAO,GACX,EACA,SAAU,kBACN,AAAI,EACO,EAAY,MAAM,CAAC,KAAK,CAAC,EAAY,KAAK,CAAG,EAAE,CAC/C,EACP,AAAI,AAAiB,QAAjB,EAAS,IAAI,EAAc,EAAS,GAAG,EAAI,EAAQ,EAC5C,EAAS,KAAK,CAAC,EAAE,CAAC,IACtB,EAAS,MAAM,CAAC,KAAK,CAAC,EAAS,KAAK,CAAC,OAEpD,EACA,YAAa,WACT,OAAO,CACX,EACA,SAAU,WACN,OAAO,CACX,EACA,KAAM,WAEF,IADA,IAAI,EAAM,EACH,GAAQ,CAAA,CAAC,oBAAoB,IAAI,CAAC,EAAI,IAAI,GAAK,EAAI,GAAG,EAAI,CAAA,GAC7D,EAAM,EAAI,MAAM,CACpB,OAAO,CACX,CACJ,CACJ,CDrFJ,AAAA,EAAa,OAAO,CAAC,kBAAmB,WACpC,IAAI,EAAM,IAAI,CAAC,SAAS,CACxB,IAAI,CAAC,YAAY,CAAC,IAAI,GAAgB,CAAE,OAAQ,IAAI,CAAE,KAAM,IAAK,IACjE,IAAI,EAAkB,IAAI,CAAC,GAAG,CAAC,mBAAoB,CAAA,GACnD,IAAI,CAAC,UAAU,CAAC,IAChB,IAAI,EAAe,IAAI,CAAC,IAAI,CAAC,CACzB,qBAAsB,uBACtB,oBAAqB,CACjB,GAAI,uBACJ,GAAI,IACR,EACA,qBAAsB,CAClB,GAAI,+BACJ,GAAI,CAAE,KAAM,KAAM,AACtB,CACJ,GAEA,OAAO,WACH,IAAI,CAAC,YAAY,CAAC,GACd,AAAC,GACD,IAAI,CAAC,GAAG,CAAC,mBAAoB,CAAA,GACjC,IAAI,CAAC,SAAS,CAAC,IACf,IAAI,CAAC,IAAI,CAAC,EACd,CACJ,G,O,c,C,C,E,kB,C,I,I,G,I,K,E,W,C,E,a,C,C,GC+DI,AAAA,EAAa,WAAW,CAAC,CAErB,gBAAiB,AAAA,EAAkB,WAC/B,GAAI,CACA,IAAI,EAAI,GAAY,IAAI,EACpB,EAAM,EAAE,KAAK,CAAC,IAAI,CAAC,KAAK,IAC5B,QAAQ,GAAG,CAAC,GACZ,QAAQ,GAAG,CAAC,EAAE,WAAW,IACzB,QAAQ,GAAG,CAAC,EAAE,QAAQ,IACtB,QAAQ,GAAG,CAAC,EAAE,QAAQ,GAC1B,CAAE,MAAM,EAAI,CACR,QAAQ,GAAG,CAAC,EAChB,CACJ,GAEA,uBAAwB,WACpB,OAAO,GAAY,KAAK,CAAC,IAAI,CAAE,CAAC,IAAI,IAAK,UAAU,CACvD,EAEA,kBAAmB,AAAA,EAAkB,WAEjC,IAAI,EAAM,AADF,GAAY,IAAI,CAAE,IAAI,CAAC,KAAK,IACxB,IAAI,EACZ,CAAA,GAAK,IAAI,CAAC,GAAG,CAAC,YAAa,EAAI,GAAG,CAC1C,GAEA,mBAAoB,AAAA,EAAkB,WAClC,IAAI,EAAI,GAAY,IAAI,EACxB,EAAE,KAAK,CAAC,IAAI,CAAC,KAAK,IAClB,IAAI,EAAM,EAAE,QAAQ,EAChB,CAAA,GAAK,IAAI,CAAC,GAAG,CAAC,YAAa,EAAI,KAAK,CAC5C,GAEA,sBAAuB,AAAA,EAAkB,WACrC,IAAI,EAAI,GAAY,IAAI,EACxB,EAAE,KAAK,CAAC,IAAI,CAAC,KAAK,IAClB,IAAI,EAAO,EAAE,IAAI,EACb,CAAA,GAAQ,EAAK,MAAM,EAAE,IAAI,CAAC,GAAG,CAAC,YAAa,EAAK,KAAK,CAC7D,GAEA,yBAA0B,AAAA,EAAkB,WACxC,IAAI,EAAI,GAAY,IAAI,EACxB,EAAE,KAAK,CAAC,IAAI,CAAC,KAAK,IAClB,IAAI,EAAM,EAAE,QAAQ,EAChB,CAAA,GAAO,AAAY,UAAZ,EAAI,IAAI,EAAgB,IAAI,CAAC,KAAK,GAAK,EAAI,GAAG,CACjD,IAAI,CAAC,GAAG,CAAC,aAAc,OACvB,IAAI,CAAC,GAAG,CAAC,gBACH,IAAI,CAAC,GAAG,CAAC,eAAgB,OAG/B,IAAI,CAAC,GAAG,CAAC,SAAU,KAFnB,IAAI,CAAC,GAAG,CAAC,SAAU,QAIvB,IAAI,CAAC,GAAG,CAAC,SAAU,MACnB,IAAI,CAAC,GAAG,CAAC,iBAEjB,EAEJ,GAIJ,IAAM,GAAgB,AAAA,EAAW,wyBAakD,KAE7E,GAAgB,AAAA,EAAW,qfAa3B,GAAc,AAAA,EAAO,qBAErB,GAAY,AAAA,EAAO,SAEnB,GAAmB,AAAA,EAAO,uCAE1B,GAAe,AAAA,EAAO,8BAEtB,GAAmB,AAAA,EAAO,4CAE1B,GAAY,CACd,GAAyB,KACzB,IAAyB,KACzB,KAAyB,KACzB,MAAyB,KACzB,YAAyB,KACzB,OAAyB,KACzB,OAAyB,KACzB,MAAyB,KACzB,WAAyB,KACzB,QAAyB,KACzB,WAAyB,KACzB,UAAyB,KACzB,SAAyB,KACzB,UAAyB,KACzB,SAAyB,KACzB,MAAyB,KACzB,MAAyB,KACzB,MAAyB,KACzB,uBAAyB,KACzB,MAAyB,KACzB,IAAyB,KACzB,OAAyB,KACzB,KAAyB,KACzB,SAAyB,KACzB,kBAAyB,KACzB,iBAAyB,KACzB,MAAyB,KACzB,KAAyB,KACzB,MAAyB,KACzB,SAAyB,KACzB,UAAyB,KACzB,KAAyB,KACzB,eAAyB,KACzB,eAAyB,KACzB,eAAyB,KACzB,eAAyB,KACzB,cAAyB,KACzB,MAAyB,KACzB,QAAyB,KACzB,OAAyB,KACzB,qBAAyB,KACzB,sBAAyB,KACzB,UAAyB,KACzB,YAAyB,IAC7B,EAEM,GAAgB,AAAA,EAAO,uBAEtB,OAAM,WAAwB,GACjC,WAAa,CAAI,AACjB,CAAA,SAAW,IAAK,AAChB,CAAA,SAAW,CAAE,AACb,CAAA,WAAa,IAAK,AAElB,CAAA,QAAU,CAAE,IAAK,CAAE,KAAM,KAAM,CAAE,AAAC,AAClC,CAAA,OAAS,CAAE,IAAK,AAAC,AACjB,CAAA,OAAS,uGAAwG,AACjH,CAAA,KAAO,sCAAuC,AAC9C,CAAA,WAAa,CACT,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,GACV,CAAE,AACF,CAAA,YAAc,CACV,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,GACV,CAAE,AAEF,aAAY,CAAA,OAAE,CAAM,CAAA,IAAE,CAAG,CAAA,WAAE,CAAU,CAAE,CAAE,CACrC,KAAK,CAAC,CAAE,OAAA,EAAQ,IAAA,CAAI,GACpB,IAAI,CAAC,UAAU,CAAG,CACtB,CAEA,WAAW,CAAE,CAAE,CACX,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAO,CAAC,IAAI,CAAC,UAAU,EAAE,KAAK,EACxD,CACA,UAAW,CACP,GAAI,CAAC,IAAI,CAAC,UAAU,CAAE,OAAO,KAAK,CAAC,WACnC,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EAAO,EAAE,IAAI,GACnC,GAAI,IAAI,CAAC,UAAU,CAAC,GAAO,CACvB,IAAI,EAAM,EAAE,GAAG,GAAI,EACnB,KAAO,IAAI,CAAC,UAAU,CAAC,EAAK,EAAE,IAAI,KAC9B,GAAQ,EACR,EAAE,GAAG,GAET,MAAO,CAAE,KAAM,EAAE,IAAI,CAAE,GAAI,EAAK,GAAI,EAAE,GAAG,CAAE,GAAI,CAAK,CACxD,CACJ,CAEA,MAAO,CACH,IAAI,EAAS,KAAK,CAAC,OACf,EAAa,IAAI,CAAC,UAAU,CAC5B,EAAW,IAAI,CAAC,QAAQ,CACxB,EAAW,IAAI,CAAC,QAAQ,CACxB,EAAa,IAAI,CAAC,UAAU,CAChC,MAAO,KACH,IAAI,EAAO,IAKX,OAJA,EAAK,UAAU,CAAG,EAClB,EAAK,QAAQ,CAAG,EAChB,EAAK,QAAQ,CAAG,EAChB,EAAK,UAAU,CAAG,EACX,CACX,CACJ,CAEA,OAAO,CAAG,CAAE,CACJ,GAAK,IAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAA,IAAI,CAAC,QAAQ,CAAG,CAA/C,EACA,IAAI,CAAC,QAAQ,EACjB,CAEA,OAAO,CAAI,CAAE,CACT,IAAI,EAAI,IAAI,CAAC,QAAQ,EAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,CACzC,GAAI,QAEA,CADA,EAAI,EAAE,WAAW,GACb,AAAQ,MAAR,GAAqB,EAClB,AAAe,UAAf,OAAO,EAAmB,GAAK,EAC/B,aAAgB,OAAS,EAAK,IAAI,CAAC,GACnC,KAAK,CAEpB,CAEA,YAAa,CACT,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EACtB,GAAK,EAAI,EAAE,SAAS,CAAC,qBAGjB,OAFA,IAAI,CAAC,MAAM,GACX,IAAI,CAAC,CAAC,CAAC,WAAY,CAAC,CAAC,EAAE,CAAC,MAAM,EACvB,CAAA,EAEX,GAAI,EAAE,SAAS,CAAC,OAAS,IAAI,CAAC,UAAU,CAAC,EAAE,IAAI,CAAC,IAI5C,OAHA,IAAI,CAAC,MAAM,GACX,EAAE,GAAG,EAAI,EACT,IAAI,CAAC,SAAS,CAAC,gBACR,CAAA,EAEX,GAAI,EAAE,SAAS,CAAC,OAAS,IAAI,CAAC,UAAU,CAAC,EAAE,IAAI,CAAC,IAI5C,OAHA,IAAI,CAAC,MAAM,GACX,EAAE,GAAG,EAAI,EACD,IAAI,CAAC,SAAS,CAAC,iBAChB,CAAA,EAEX,GAAK,EAAI,EAAE,SAAS,CAAC,wCAMjB,OALA,IAAI,CAAC,MAAM,GACX,IAAI,CAAC,CAAC,CAAC,iBAAkB,GACzB,IAAI,CAAC,CAAC,CAAC,SAAU,CAAC,CAAC,EAAE,CAAC,MAAM,EAC5B,IAAI,CAAC,CAAC,CAAC,kBACH,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,CAAC,kBAAmB,CAAC,CAAC,EAAE,CAAC,MAAM,EACxC,CAAA,EAEX,GAAK,EAAI,EAAE,SAAS,CAAC,gBAIjB,OAFA,IAAI,CAAC,MAAM,GACX,IAAI,CAAC,CAAC,CAAC,WAAY,CAAC,CAAC,EAAE,CAAC,MAAM,EACvB,CAAA,EAEX,GAAK,EAAI,IAAI,CAAC,QAAQ,GAAK,CACvB,IAAI,EAAK,EAAE,EAAE,CAAC,MAAM,CAAC,GAAI,EAAO,KA4BhC,GAzBI,qBAAqB,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,KAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAG,GAAK,AAAiB,GAAjB,IAAI,CAAC,QAAQ,EAG9F,qBAAqB,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,KAAK,KAAK,KAAO,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,IAAM,GAAK,AAAuB,GAAvB,IAAI,CAAC,UAAU,CAAC,GAAG,CAClI,EAAO,WAEF,YAAY,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,KAAK,KAAK,KAAO,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,KAAO,GAAK,AAAiB,GAAjB,IAAI,CAAC,QAAQ,EAG/G,YAAY,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,KAAO,AAAuB,GAAvB,IAAI,CAAC,UAAU,CAAC,GAAG,CAC1E,EAAO,gBAEF,qBAAqB,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,KAAK,KAAK,KAAO,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,KAAO,GAAK,AAAiB,GAAjB,IAAI,CAAC,QAAQ,CAC7H,EAAO,gBAEF,qBAAqB,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,KAAO,AAAuB,GAAvB,IAAI,CAAC,UAAU,CAAC,GAAG,EACnF,CAAA,EAAO,eADN,EAID,AAAC,GAAM,CAAA,EAAO,AAAM,KAAN,EAAY,eACxB,AAAM,KAAN,EAAY,OACZ,EAAE,EAAE,IAAI,GAAc,QACtB,EAAE,EAAE,IAAI,GAAY,WACpB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,EAAI,SACzB,IALN,EAMI,CAAC,GAAQ,AAAuB,GAAvB,IAAI,CAAC,UAAU,CAAC,GAAG,CAAO,CACnC,IAAI,EAAQ,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,EAClC,AAAS,CAAA,UAAT,GAAqB,AAAiB,GAAjB,IAAI,CAAC,QAAQ,CAClC,EAAO,gBAEF,sBAAsB,IAAI,CAAC,IAChC,CAAA,EAAO,eADN,CAGT,CAiCA,MAhCI,CAAC,IACoB,GAAjB,IAAI,CAAC,QAAQ,EAAS,GAAc,IAAI,CAAC,EAAE,EAAE,GAGxC,AAAiB,GAAjB,IAAI,CAAC,QAAQ,EAAS,gCAAgC,IAAI,CAAC,EAAE,EAAE,EACpE,EAAO,UAEF,AAAiB,GAAjB,IAAI,CAAC,QAAQ,EAAS,IAAI,CAAC,MAAM,CAAC,IACvC,EAAO,gBAEF,AAAiB,GAAjB,IAAI,CAAC,QAAQ,EAAS,IAAI,CAAC,MAAM,CAAC,IACvC,EAAO,OAEF,AAAiB,GAAjB,IAAI,CAAC,QAAQ,EAAS,IAAI,CAAC,MAAM,CAAC,OACvC,EAAO,gBAEF,AAAiB,GAAjB,IAAI,CAAC,QAAQ,EAAS,IAAI,CAAC,MAAM,CAAC,IACvC,EAAO,gBAEF,AAAiB,GAAjB,IAAI,CAAC,QAAQ,EAAS,IAAI,CAAC,MAAM,CAAC,QACvC,EAAO,gBAEF,AAAiB,GAAjB,IAAI,CAAC,QAAQ,EAAS,IAAI,CAAC,MAAM,CAAC,QACvC,EAAO,OAEF,IAAI,CAAC,MAAM,CAAC,SAAW,GAAc,IAAI,CAAC,EAAE,EAAE,GACnD,CAAA,EAAO,WADN,GAIT,EAAE,IAAI,CAAG,EACT,IAAI,CAAC,MAAM,CAAC,GACZ,IAAI,CAAC,KAAK,CAAC,EAAG,GACP,CAAA,CACX,CACJ,CAEA,WAAW,GAAG,CAAI,CAAE,CAChB,GAAI,KAAK,CAAC,cAAc,GAEpB,OADA,IAAI,CAAC,MAAM,GACJ,CAAA,CAEf,CAEA,eAAgB,CACZ,GAAI,KAAK,CAAC,gBAMN,OALA,IAAI,CAAC,MAAM,GACX,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,EAChC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,EAChC,IAAI,CAAC,QAAQ,CAAG,KAChB,IAAI,CAAC,QAAQ,CAAG,EACT,CAAA,CAEf,CAEA,gBAAiB,CACb,GAAI,KAAK,CAAC,iBAKN,OAJI,IAAI,CAAC,SAAS,GAAK,IACnB,IAAI,CAAC,QAAQ,CAAG,IAAI,CAAC,YAAY,GACjC,IAAI,CAAC,QAAQ,CAAG,IAAI,CAAC,YAAY,IAE9B,CAAA,CAEf,CAEA,cAAc,CAAG,CAAE,CACf,IAAI,CAAC,UAAU,CAAG,IAAI,EAAK,EAAK,IAAI,CAAC,UAAU,CACnD,CACA,cAAe,CACX,IAAI,EAAM,IAAI,CAAC,UAAU,CAAC,GAAG,CAE7B,OADA,IAAI,CAAC,UAAU,CAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAC9B,CACX,CAEA,aAAc,CACV,GAAI,IAAI,CAAC,SAAS,EAAI,IAAI,CAAC,UAAU,CACjC,OAAO,KAAK,CAAC,cAGjB,IAAI,EAAI,IAAI,CAAC,OAAO,CAChB,EAAe,IAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,gBAElD,IAAI,EAAS,EAIT,EAAI,IAAI,CAAC,SAAS,CAAC,GAAG,CAC1B,GAAI,EAAG,CACH,IAKI,EALA,EAAO,EAAE,QAAQ,CAAC,EAAE,IAAI,EAE5B,GADA,EAAS,EAAE,GAAG,CAAG,EACb,SAAS,IAAI,CAAC,EAAK,MAAM,CAAC,EAAE,GAAG,CAAG,IAClC,OAAO,EAGX,GAAI,IAAI,CAAC,UAAU,CAAC,EAAK,MAAM,CAAC,IAAU,CACtC,IAAI,EAAK,OACT,CAAA,EAAG,SAAS,CAAG,EAAE,GAAG,CAEhB,AADJ,CAAA,EAAe,EAAG,IAAI,CAAC,EAAvB,GAEI,CAAA,EAAS,EAAe,EAAa,KAAK,CAAG,CAAA,CAErD,CACA,GAAI,IAAI,CAAC,QAAQ,CAAE,CACf,IAAI,EAAc,IAAI,CAAC,MAAM,GAC7B,GAAI,EAAa,CAEb,IAAI,EAAW,EAAS,CADxB,EAAc,EAAY,OAAO,CAAC,MAAO,IACJ,CAYrC,GAXI,CAAC,GAAY,cAAc,IAAI,CAAC,IAEhC,CAAA,EAAW,IAAX,EAEA,CAAC,GAAY,OAAO,IAAI,CAAC,KAGrB,EADA,GAAgB,WAAW,IAAI,CAAC,EAAK,MAAM,CAAC,IACjC,KAEA,MAEf,CAAC,EAAU,GAAI,CACX,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,IAAM,eAChC,EAAW,KAEN,EAAa,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,EACtD,AAA+B,GAA/B,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,EAC3B,CAAA,EAAW,IAFV,CAIT,CAAE,MAAM,EAAG,CAAC,CACZ,GAAI,EAAU,CACV,IAAI,EAAI,SAAS,EAAU,IACvB,EAAU,KAAK,IAAI,CAAC,GACX,KAAK,IAAI,CAAC,GACvB,EAAS,EAAE,GAAG,CAAG,IACb,GAAW,EACX,EAAS,EAEH,EAAI,GAAK,IAAI,CAAC,QAAQ,CAAG,EAAI,IAE/B,EACA,EAAS,EAET,GAAU,IAEtB,CACJ,CACJ,CACJ,CAEA,OAAO,CACX,CACJ,CAEA,AAAA,GAAgB,MAAM,CAAC,OAAQ,CAAC,EAAQ,EAAK,EAAU,CAAC,CAAC,GACrD,IAAI,GAAgB,CAAE,OAAA,EAAQ,IAAA,EAAK,GAAG,CAAO,AAAC,IAElD,IAAI,GAAwB,AAAA,EAAa,MAAM,CAAC,OAAQ,CACpD,IAAM,CAAE,2BAA4B,AACxC,GAEA,AAAA,EAAa,OAAO,CAAC,YAAa,WAE9B,IAAI,EAAM,IAAI,CAAC,SAAS,CACxB,IAAI,CAAC,YAAY,CAAC,IAAI,GAAgB,CAAE,OAAQ,IAAI,CAAE,KAAM,MAAO,IACnE,IAAI,EAAe,IAAI,CAAC,IAAI,CAAC,CACzB,aAAc,EACd,qBAAsB,oBACtB,oBAAqB,CACjB,GAAI,mBACJ,GAAI,IACR,EACA,oBAAqB,4BACrB,uBACI,MAAO,CAAC,IAAI,CAAC,YAAY,CAAC,6BAC9B,CACJ,GACI,EAAkB,IAAI,CAAC,GAAG,CAAC,mBAAoB,CAAA,GACnD,IAAI,CAAC,UAAU,CAAC,IAEhB,IAAI,EAAmB,IAAI,CAAC,eAAe,CAAC,CACxC,aAA4B,oBAC5B,cAA4B,qBAC5B,iBAA4B,uBAChC,GAEA,OAAO,WACH,IAAI,CAAC,YAAY,CAAC,GAClB,IAAI,CAAC,IAAI,CAAC,GACV,IAAI,CAAC,WAAW,CAAC,GACb,AAAC,GACD,IAAI,CAAC,GAAG,CAAC,mBAAoB,CAAA,GACjC,IAAI,CAAC,SAAS,CAAC,GACnB,CAEJ,GCzuBA,IAAI,GAAS,8MAEb,OAAM,WAA4B,GAC9B,QAAU,EAAE,AAAC,AACb,CAAA,OAAS,CACL,CAAE,IAAK,IAAK,KAAM,KAAM,gBAAiB,CACzC,CAAE,KAAM,KAAM,KAAM,KAAM,OAAQ,CAClC,CAAE,KAAM,KAAM,KAAM,KAAM,OAAQ,CAClC,CAAE,IAAK,IAAK,KAAM,KAAM,SAAU,CACrC,AAAC,AACF,CAAA,WAAa,CACT,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,GACV,CAAE,AACF,CAAA,YAAc,CACV,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,GACV,CAAE,AAEF,CAAA,OAAS,IAAK,AAEd,CAAA,MAAO,CACH,IAAI,EAAS,KAAK,CAAC,OACf,EAAS,IAAI,CAAC,MAAM,CACxB,MAAO,KACH,IAAI,EAAO,IAEX,OADA,EAAK,MAAM,CAAG,EACP,CACX,CACJ,CAEA,EAAE,EAAO,IAAI,CAAE,EAAM,CAAC,CAAE,CAChB,AAAe,MAAf,IAAI,CAAC,MAAM,EACX,CAAA,EAAO,IAAI,CAAC,MAAM,CAAI,CAAA,AAAQ,MAAR,EAAe,IAAM,EAAO,EAAA,CAAC,EAEvD,IAAI,CAAC,KAAK,CAAC,CACP,KAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CACvB,GAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CACpB,GAAI,IAAI,CAAC,OAAO,CAAC,GAAG,EAAI,CAC5B,EAAG,EACP,CAEA,MAAO,CAEH,OADI,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,CAAA,IAAI,CAAC,MAAM,CAAG,IAAtC,EACO,KAAK,CAAC,MACjB,CAEA,MAAO,CACD,AAAe,gBAAf,IAAI,CAAC,MAAM,EAAsB,IAAI,CAAC,UAAU,IACjD,IAAI,CAAC,UAAU,IACf,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,cAAc,IACnB,IAAI,CAAC,sBAAsB,IAC3B,IAAI,CAAC,CAAC,EACX,CAEA,YAAa,CACT,OAAO,IAAI,CAAC,UAAU,EAC1B,CAEA,YAAa,CACT,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EACtB,GAAI,AAAS,GAAT,EAAE,GAAG,EAAU,CAAA,EAAI,EAAE,SAAS,CAAC,MAAA,EAC/B,IAAI,CAAC,MAAM,CAAG,UAAY,CAAC,CAAC,EAAE,CAAC,MAAM,MAEpC,GAAI,AAAS,GAAT,EAAE,GAAG,EAAU,CAAA,EAAI,EAAE,SAAS,CAAC,QAAA,EACpC,IAAI,CAAC,MAAM,CAAG,oBAEb,GAAI,AAAS,GAAT,EAAE,GAAG,EAAU,CAAA,EAAI,EAAE,SAAS,CAAC,WAAA,EAAc,CAClD,IAAI,EAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,OAAQ,IAAI,MAAM,CAAG,EAC9C,EAAQ,KAAK,GAAG,CAAC,EAAG,GACpB,IAAI,CAAC,MAAM,CAAG,sBAAyB,CAAA,EAAQ,EAAI,EAAQ,EAAA,CAC/D,MACK,GAAK,EAAI,EAAE,SAAS,CAAC,IAEtB,OADA,IAAI,CAAC,CAAC,CAAC,CAAC,gBAAgB,EAAE,CAAC,CAAC,EAAE,CAAA,CAAE,CAAE,CAAC,CAAC,EAAE,CAAC,MAAM,EACtC,CAAA,OAEN,GAAK,EAAI,EAAE,SAAS,CAAC,uBAEtB,OADA,IAAI,CAAC,CAAC,CAAC,eAAgB,CAAC,CAAC,EAAE,CAAC,MAAM,EAC3B,CAAA,CAEf,CAEA,aAAc,CACV,IAAI,EAAI,IAAI,CAAC,OAAO,CAChB,EAAM,EAAE,IAAI,CAChB,OAAO,EAAM,GAAK,EAAE,eAAe,CAAC,EAAM,IAAM,EAAE,eAAe,CAAC,EACtE,CACJ,CAEA,IAAI,GAAwB,AAAA,EAAa,MAAM,CAAC,WAAY,CACxD,IAAQ,CAAE,oBAAqB,IAAK,IAAK,UAAW,CACpD,MAAQ,CAAE,qBAAsB,IAAK,IAAK,UAAW,AACzD,GAEA,AAAA,GAAgB,MAAM,CAAC,WAAY,CAAC,EAAQ,IAAQ,IAAI,GAAoB,CAAE,OAAA,EAAQ,IAAA,CAAI,IAE1F,AAAA,EAAa,OAAO,CAAC,gBAAiB,WAElC,IAAI,EAAM,IAAI,CAAC,SAAS,CACxB,IAAI,CAAC,YAAY,CAAC,IAAI,GAAgB,CAAE,OAAQ,IAAI,CAAE,KAAM,UAAW,IACvE,IAAI,EAAkB,IAAI,CAAC,GAAG,CAAC,mBAAoB,CAAA,GAEnD,OADA,IAAI,CAAC,UAAU,CAAC,IACT,WACH,IAAI,CAAC,YAAY,CAAC,GACd,AAAC,GACD,IAAI,CAAC,GAAG,CAAC,mBAAoB,CAAA,GACjC,IAAI,CAAC,SAAS,CAAC,GACnB,CAEJ,GCpHA,IAAI,GAA0B,AAAA,EAAa,MAAM,CAAC,aAAc,CAC5D,QAAiC,sBACjC,QAAiC,cACjC,iBAAiC,eACjC,iBAAiC,gBACjC,8BAAiC,mBACjC,QAAiC,qBACjC,QAAiC,eACjC,MAAiC,UACjC,gBAAiC,YACjC,QAAiC,YACjC,YAAiC,YACjC,QAAiC,kBAEjC,IAAiC,CAAE,oBAAqB,IAAK,IAAK,CAClE,IAAiC,CAAE,oBAAqB,IAAK,IAAK,CAClE,IAAiC,CAAE,oBAAqB,IAAK,IAAK,CAClE,IAAiC,CAAE,oBAAqB,IAAK,IAAK,CAClE,IAAiC,CAAE,oBAAqB,IAAK,IAAK,CAClE,IAAiC,CAAE,oBAAqB,IAAK,IAAK,CAClE,IAAiC,CAAE,oBAAqB,IAAK,IAAK,UAAW,CAE7E,IAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,IAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,IAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,IAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,IAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,IAAiC,CAAE,qBAAsB,IAAK,IAAK,CAEnE,MAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,MAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,MAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,MAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,MAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,MAAiC,CAAE,qBAAsB,IAAK,IAAK,CACnE,MAAiC,CAAE,qBAAsB,IAAK,IAAK,UAAW,CAE9E,MAAiC,qBACjC,MAAiC,sBACjC,UAAiC,+BAEjC,MAAiC,6BACjC,mBAAiC,uBACrC,GAEA,IAAI,GAAS,CACT,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,GACV,EAEI,GAAW,CACX,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,GACV,EAEA,SAAS,GAAM,CAAC,EACZ,MAAM,IAAI,EAAgB,gCAC9B,CAEA,SAAS,GAAQ,CAAK,EAClB,OAAO,EAAM,EAAE,EAAI,EAAM,GAAG,AAChC,CAEA,SAAS,GAAM,CAAK,EAChB,OAAO,EAAM,EAAE,EAAK,EAAM,GAAG,CAAG,CACpC,CAEA,SAAS,GAAO,CAAK,SACjB,AAAI,EAAM,MAAM,CAAS,EAAM,MAAM,CAAC,IAAI,EAAI,GACvC,EAAM,IAAI,EAAI,EACzB,CAEA,SAAS,GAAQ,CAAK,CAAE,CAAK,EACzB,OAAO,EAAM,IAAI,EAAI,EAAM,GAAG,EACvB,GAAQ,IAAU,EAAM,GAAG,EAC3B,EAAM,GAAG,EAAI,GAAM,EAC9B,CAEA,AAAA,EAAa,WAAW,CAAC,CAErB,qBACI,IAAI,EAAK,IAAI,CAAC,OAAO,CACjB,EAAS,IAAI,CAAC,SAAS,CAAC,KAAK,GAC7B,EAAI,EAAE,CACV,IAAK,IAAI,KAAM,EAAQ,CACnB,GAAI,CAAC,EAAG,IAAI,CAAE,SACd,IAAI,EAAK,EAAG,MAAM,CACb,IACD,GAAQ,EAAI,IAAK,EAAE,IAAI,CAAC,GACxB,GAAQ,EAAI,IAAK,EAAE,IAAI,CAAC,GAChC,QACA,AAAK,EAAE,MAAM,CAEG,GAAZ,EAAE,MAAM,EAER,KAAK,IAAI,CAAC,GAAO,CAAC,CAAC,EAAE,IAAM,CAAC,KAAK,IAAI,CAAC,GAAO,CAAC,CAAC,EAAE,GAD1C,CAAC,CAAC,EAAE,CAAC,MAAM,EAAI,CAAC,CAAC,EAAE,CAG1B,KAAK,IAAI,CAAC,GAAO,CAAC,CAAC,EAAE,IAAM,CAAC,KAAK,IAAI,CAAC,GAAO,CAAC,CAAC,EAAE,GAC1C,CAAC,CAAC,EAAE,CAAC,MAAM,EAAI,CAAC,CAAC,EAAE,CAGvB,AADP,CAAA,EAAI,AADJ,CAAA,EAAI,EAAE,IAAI,CAAC,GAAX,CACK,CAAC,EAAE,CAAC,MAAM,CAAG,CAAC,CAAC,EAAE,CAAG,CAAC,CAAC,EAAE,AAAF,EAClB,MAAM,EAAI,EATR,IAUf,EAEA,iBACI,IAAI,CAAC,SAAS,CAAC,aAAa,GAC5B,IAAI,EAAK,IAAI,CAAC,OAAO,CACjB,EAAI,IAAI,CAAC,GAAG,CAAC,sBACjB,GAAI,SACA,AAAI,GAAQ,EAAG,GACJ,IAAI,CAAC,iBAAiB,CAAC,EAAE,MAAM,CAAC,IAAI,CAAE,GAAM,EAAE,MAAM,GACxD,IAAI,CAAC,iBAAiB,CAAC,EAAE,IAAI,CAAE,GAAQ,GAEtD,EAEA,YAAa,AAAA,EAAkB,WAC3B,IAAI,EAAM,IAAI,CAAC,GAAG,CAAC,iBACf,AAAO,OAAP,EACA,IAAI,CAAC,GAAG,CAAC,gBAAiB,IAAI,CAAC,KAAK,GAAI,GAExC,GAAM,IAAI,CAElB,GAEA,oBAAqB,AAAA,EAAkB,WACnC,IAAI,EAAM,IAAI,CAAC,GAAG,CAAC,kBACnB,GAAI,AAAO,MAAP,EAEA,OADA,IAAI,CAAC,GAAG,CAAC,YAAa,GACf,CAAA,CAEf,GAEA,aAAc,AAAA,EAAkB,eAExB,EADJ,IAAI,CAAC,SAAS,CAAC,aAAa,GAE5B,IAAI,EAAK,IAAI,CAAC,OAAO,CACjB,EAAS,IAAI,CAAC,SAAS,CAAC,KAAK,GACjC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAO,MAAM,CAAE,EAAE,EAAG,CACpC,IAAI,EAAI,CAAM,CAAC,EAAE,CACjB,GAAI,EAAE,IAAI,CAAG,EAAG,GAAG,EAAK,EAAE,IAAI,EAAI,EAAG,GAAG,EAAI,GAAQ,IAAM,EAAG,GAAG,CAAG,CAC/D,EAAO,EACP,KACJ,CACJ,CACA,IAAI,CAAC,aAAa,CAAC,CACf,YAAa,IAAI,CAAC,IAAI,CAAC,mBAC3B,EAAG,gBACC,GAAQ,EAAK,MAAM,EAAI,AAAA,GAAc,IAAI,CAAC,OAAO,CAAE,GAAQ,GAC3D,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAK,MAAM,CAAC,IAAI,CAAE,GAAM,EAAK,MAAM,GAExF,GAEA,cAAe,AAAA,EAAkB,eAEzB,EADJ,IAAI,CAAC,SAAS,CAAC,aAAa,GAE5B,IAAI,EAAK,IAAI,CAAC,OAAO,CACjB,EAAS,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,MAAM,CAAC,AAAA,GAAK,EAAE,MAAM,EAAE,GAAG,CAAC,AAAA,GAAK,EAAE,MAAM,EAAE,IAAI,CAAC,IAClF,IAAK,IAAI,EAAI,EAAO,MAAM,CAAE,EAAE,GAAK,GAAI,CACnC,IAAI,EAAI,CAAM,CAAC,EAAE,CACjB,GAAI,EAAE,IAAI,CAAG,EAAG,GAAG,EACX,EAAE,IAAI,EAAI,EAAG,GAAG,EACZ,CAAA,GAAQ,GAAK,EAAG,GAAG,EACf,EAAE,EAAE,EAAI,EAAE,EAAE,EAAI,GAAQ,IAAM,EAAG,GAAG,AAAH,EAAQ,CACrD,EAAO,EACP,KACJ,CACJ,CACA,IAAI,CAAC,aAAa,CAAC,CACf,YAAa,IAAI,CAAC,IAAI,CAAC,mBAC3B,EAAG,iBACC,GAAQ,EAAK,MAAM,EAAI,AAAqE,EAArE,AAAA,GAAc,IAAI,CAAC,OAAO,CAAE,CAAE,KAAM,EAAK,IAAI,CAAE,IAAK,GAAM,EAAM,IACvF,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAK,MAAM,CAAC,IAAI,CAAE,GAAQ,EAAK,MAAM,GAE1F,GAEA,UAAW,AAAA,EAAkB,KAAM,SAAS,CAAK,CAAE,CAAG,EAClD,IAAI,CAAC,SAAS,CAAC,aAAa,GAC5B,IAAI,EAAQ,IAAI,CAAC,GAAG,CAAC,sBACjB,GAAO,OACP,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAM,KAAK,CAAC,EAAE,CAAE,EAAM,KAAK,CAAC,EAAE,GAC3E,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAM,KAAK,CAAC,EAAE,CAAE,EAAM,KAAK,CAAC,EAAE,GAC3E,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,IACvB,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,GAEzC,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACxB,IAAI,CAAC,eAAe,EACpB,IAAI,CAAC,GAAG,CAAC,YAAa,GAC1B,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,GAAG,CAAC,gBACT,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,IACvB,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAC9C,GACA,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,IAAI,CAAC,cAAe,CAAA,EAC7B,GAEA,UAAW,AAAA,EAAkB,WACzB,IAAI,CAAC,cAAc,CACf,IAAI,CAAC,KAAK,GACV,IAAI,CAAC,GAAG,CAAC,iBAAkB,WAEvB,OADA,IAAI,CAAC,GAAG,CAAC,gBACF,IAAI,CAAC,KAAK,EACrB,GAER,GAEA,gBAAiB,AAAA,EAAkB,WAC/B,IAAI,EAAI,EAAE,CACV,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC3C,IAAI,CAAC,GAAG,CAAC,iBAAkB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC5C,IAAI,CAAC,GAAG,CAAC,iBAAkB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC5C,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,IAC3C,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,UAAU,CAAC,GAC1C,GAEA,UAAW,AAAA,EAAkB,WACzB,IAAI,CAAC,SAAS,CAAC,aAAa,GAC5B,IAAI,EAAK,IAAI,CAAC,OAAO,CACjB,EAAK,CAAE,KAAM,EAAG,GAAG,CAAE,IAAK,EAAG,GAAG,AAAC,EACjC,EAAI,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,MAAM,CAAC,AAAA,GAAK,EAAE,MAAM,EAAE,IAAI,CAAC,AAAA,GAAK,AAAA,GAAc,EAAG,IAAO,EACnF,AAAK,OAAL,EACA,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAE,IAAI,CAAE,GAAM,KAE3D,GAAM,IAAI,CAElB,GAEA,iBAAkB,AAAA,EAAkB,WAChC,IAAI,CAAC,SAAS,CAAC,aAAa,GAC5B,IAAI,EAAK,IAAI,CAAC,OAAO,CACjB,EAAI,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,MAAM,CAAC,AAAA,GAAY,IAAK,EAAE,CAAC,GACtD,AAAK,OAAL,EACA,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAE,IAAI,CAAE,GAAQ,KAE7D,GAAM,IAAI,CAElB,GAEA,QAAS,AAAA,EAAkB,WACvB,IAAI,CAAC,GAAG,CAAC,oBACT,IAAI,CAAC,GAAG,CAAC,eACb,GAEA,mBAAoB,AAAA,EAAkB,WAClC,IAAI,CAAC,SAAS,CAAC,aAAa,GAC5B,IAAI,EAAK,IAAI,CAAC,OAAO,CACjB,EAAI,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,MAAM,CAAC,AAAA,GAAY,GAAI,CAAC,EAAE,AACrD,AAAK,OAAL,EACA,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAE,IAAI,CAAE,GAAQ,KAE7D,IAAI,CAAC,GAAG,CAAC,iBAEb,IAAI,CAAC,GAAG,CAAC,sBACb,GAEA,aAAc,AAAA,EAAkB,WAC5B,IAAI,CAAC,SAAS,CAAC,aAAa,GAC5B,IAAI,EAAK,IAAI,CAAC,OAAO,CACjB,EAAI,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,MAAM,CAAC,AAAA,GAAY,GAAI,CAAC,EAAE,AACrD,AAAK,OAAL,GACA,EAAI,EAAE,MAAM,CACZ,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAE,IAAI,CAAE,GAAM,MAE3D,IAAI,CAAC,GAAG,CAAC,eAEjB,GAEA,mBAAoB,AAAA,EAAkB,WAIlC,GAHA,IAAI,CAAC,SAAS,CAAC,aAAa,GAGxB,CAFI,IAAI,CAAC,SAAS,CAAC,KAAK,GACvB,MAAM,CAAC,AAAA,GAAY,IAAI,CAAC,OAAO,CAAE,UAAU,EAAE,CAAC,IAC3C,YACJ,IAAI,CAAC,WAAW,CAAC,4BAGrB,IAAI,CAAC,GAAG,CAAC,gBACT,IAAI,CAAC,GAAG,CAAC,iBACT,IAAI,EAAQ,IAAI,CAAC,KAAK,GACtB,IAAI,CAAC,GAAG,CAAC,gBACT,IAAI,EAAM,IAAI,CAAC,KAAK,GACpB,IAAI,CAAC,GAAG,CAAC,oBACT,IAAI,EAAS,IAAI,CAAC,KAAK,GACvB,IAAI,CAAC,GAAG,CAAC,gBACT,IAAI,EAAO,IAAI,CAAC,KAAK,GACjB,EAAO,IAAI,CAAC,GAAG,CAAC,mBAAoB,EAAO,GAC/C,IAAI,CAAC,YAAY,CAAC,EAAQ,EAAM,GAChC,IAAI,CAAC,GAAG,CAAC,YAAa,GACtB,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAQ,EAAS,EAAK,MAAM,CAC1D,GAEA,oBAAqB,AAAA,EAAkB,WACnC,IAAI,CAAC,SAAS,CAAC,aAAa,GAC5B,IAAI,EAAI,IAAI,CAAC,SAAS,CAAC,KAAK,GACvB,MAAM,CAAC,AAAA,GAAY,IAAI,CAAC,OAAO,CAAE,UAAU,EAAE,CAAC,IACnD,GAAI,CAAC,EAAG,YACJ,IAAI,CAAC,WAAW,CAAC,2BAGjB,CAAA,EAAE,KAAK,EAAI,EAAE,KAAK,CAClB,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACvB,IAAI,EAAc,IAAI,CAAC,iBAAiB,CAAC,EAAE,KAAK,CAAC,EAAE,CAAE,EAAE,KAAK,CAAC,EAAE,EAC3D,EAAY,IAAI,CAAC,iBAAiB,CAAC,EAAE,KAAK,CAAC,EAAE,CAAE,EAAE,KAAK,CAAC,EAAE,EACzD,EAAc,IAAI,CAAC,iBAAiB,CAAC,EAAE,KAAK,CAAC,EAAE,CAAE,EAAE,KAAK,CAAC,EAAE,EAC3D,EAAY,IAAI,CAAC,iBAAiB,CAAC,EAAE,KAAK,CAAC,EAAE,CAAE,EAAE,KAAK,CAAC,EAAE,EAC7D,IAAI,CAAC,WAAW,CAAC,CAAC,EAAI,KAClB,IAAI,CAAC,WAAW,CAAC,EAAW,GAC5B,IAAI,CAAC,WAAW,CAAC,EAAa,GAC9B,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAI,EAClC,EAAG,EAAa,EACpB,GAEA,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACvB,IAAI,CAAC,GAAG,CAAC,oBACT,IAAI,EAAQ,IAAI,CAAC,KAAK,GACtB,IAAI,CAAC,GAAG,CAAC,gBACT,IAAI,CAAC,GAAG,CAAC,wBACT,IAAI,EAAM,IAAI,CAAC,KAAK,GACpB,IAAI,CAAC,GAAG,CAAC,YAAa,GACtB,IAAI,CAAC,GAAG,CAAC,eACT,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAO,EAAM,EAC3C,EAER,GAEA,6BAA8B,AAAA,EAAkB,KAAM,SAAS,CAAC,EAC5D,GAAI,AAAK,MAAL,EAAW,OAAO,IAAI,CAAC,GAAG,CAAC,uBAAwB,GACvD,GAAI,CAAC,IAAI,CAAC,qBAAqB,GAAI,CAC/B,GAAI,IAAI,CAAC,GAAG,CAAC,eAAgB,uBAAwB,CACjD,IAAI,EAAQ,EAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CACrC,GAAI,EAAO,CACP,IAAI,EAAK,AAAI,OAAO,SAAW,EAAO,KAClC,CAAA,IAAI,CAAC,GAAG,CAAC,aAAc,IAAK,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACvD,IAAI,CAAC,GAAG,CAAC,qBACT,IAAI,CAAC,GAAG,CAAC,cACb,EACJ,CACJ,CACA,IAAI,CAAC,GAAG,CAAC,uBACb,CACJ,GAEA,oBAAqB,AAAA,EAAkB,KAAM,SAAS,CAAC,EACnD,GAAI,AAAK,MAAL,EAAW,OAAO,IAAI,CAAC,GAAG,CAAC,cAAe,GAC9C,GAAI,CAAC,IAAI,CAAC,qBAAqB,GAAI,CAC/B,GAAI,IAAI,CAAC,GAAG,CAAC,aAAc,uBAAwB,CAC/C,IAAI,EAAO,EAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CACtC,GAAI,EAAM,CACN,IAAI,EAAK,AAAI,OAAO,KAAO,EAAO,OAAQ,KACtC,CAAA,IAAI,CAAC,GAAG,CAAC,eAAgB,IAAK,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACzD,IAAI,CAAC,GAAG,CAAC,8BACT,IAAI,CAAC,GAAG,CAAC,uBACb,EACJ,CACJ,CACA,IAAI,CAAC,GAAG,CAAC,cACb,CACJ,GAEA,kBAAmB,AAAA,EAAkB,IAAK,SAAS,CAAM,CAAE,CAAM,CAAE,CAAS,EACxE,GAAI,IAAI,CAAC,eAAe,CAAE,YACtB,IAAI,CAAC,GAAG,CAAC,qBAAsB,EAAQ,EAAQ,GAGnD,GAAI,GAAU,GAAU,IAAI,CAAC,UAAU,CAAC,GAEpC,IAAI,CAAC,GAAG,CAAC,oBACN,CACH,IAAI,EAAc,IAAI,CAAC,IAAI,CAAC,uBACxB,AAAsB,CAAA,YAAtB,OAAO,GACP,CAAA,EAAc,EAAY,KAAK,CAAC,IAAI,CAAE,UAD1C,EAGI,GACA,IAAI,CAAC,GAAG,CAAC,SAAU,KAEvB,IAAI,CAAC,GAAG,CAAC,SAAU,GACnB,IAAI,CAAC,GAAG,CAAC,SAAU,GACnB,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAO,MAAM,CAC3C,CACA,IAAI,CAAC,GAAG,CAAC,uBACb,GAEA,mBAAoB,AAAA,EAAkB,IAAK,SAAS,CAAM,CAAE,CAAM,EAC9D,GAAI,IAAI,CAAC,eAAe,CAAE,YACtB,IAAI,CAAC,GAAG,CAAC,qBAAsB,EAAQ,GAG3C,IAAI,EAAK,AAAI,OAAO,SAAW,EAAQ,KACnC,CAAA,IAAI,CAAC,GAAG,CAAC,aAAc,IACvB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,GAAI,IAAI,CAAC,SAAS,CAAC,KAAK,EACvD,IAAI,CAAC,GAAG,CAAC,SAAU,GACnB,IAAI,CAAC,GAAG,CAAC,uBACb,GAEA,mBAAoB,AAAA,EAAkB,IAAK,SAAS,CAAK,CAAE,CAAO,CAAE,CAAS,EACzE,IAAI,EAAI,IAAI,CAAC,eAAe,CACtB,IAAI,CAAC,SAAS,GACd,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACzB,IAAI,EAAQ,IAAI,CAAC,KAAK,GAEtB,OADA,IAAI,CAAC,GAAG,CAAC,gBACF,CAAE,MAAO,EAAO,IAAK,IAAI,CAAC,KAAK,EAAG,CAC7C,GACA,EAAM,IAAI,CAAC,gBAAgB,CAAC,EAAE,KAAK,CAAE,EAAE,GAAG,EAC1C,EAAS,IAAI,CAAC,KAAK,GAAK,EAAE,GAAG,AAC7B,CAAA,GACA,CAAA,EAAM,EAAI,OAAO,CAAC,EAAW,AAAA,GAAK,KAAO,EAD7C,EAGA,IAAI,EAAI,IAAI,CAAC,YAAY,CAAC,EAAE,GAAG,EAC/B,IAAI,CAAC,GAAG,CAAC,iBAAkB,WACvB,IAAI,CAAC,YAAY,CAAC,EAAE,KAAK,CAAE,EAAE,GAAG,CAAE,EAAQ,EAAM,EACpD,EAAG,GACC,GACA,IAAI,CAAC,GAAG,CAAC,gBAEb,IAAI,CAAC,kBAAkB,GACvB,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAE,KAAK,CAAE,EAAE,WAAW,IAChD,EAAE,OAAO,EACb,GAEA,2BAA4B,AAAA,EAAkB,WAC1C,IAAI,EAAW,IAAI,CAAC,UAAU,CAAC,oBACxB,IAAI,CAAC,YAAY,CAAC,AAAI,OAAO,KAAO,EAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAG,UAAW,MACpF,IAAI,CAAC,GAAG,CAAC,sBACL,IACA,IAAI,CAAC,GAAG,CAAC,sBACT,IAAI,CAAC,GAAG,CAAC,iBACT,IAAI,CAAC,GAAG,CAAC,eAEjB,GAEA,qBAAsB,WACd,IAAI,CAAC,IAAI,CAAC,oBACV,IAAI,CAAC,GAAG,CAAC,cAEjB,EAEA,sBAAuB,AAAA,EAAkB,WACrC,IAAI,CAAC,GAAG,CAAC,uBACT,IAAI,CAAC,GAAG,CAAC,uBACb,EAEJ,GAEA,AAAA,EAAa,OAAO,CAAC,mBAAoB,WAErC,IAAI,CAAC,UAAU,CAAC,IAEhB,IAAI,EAAW,AAAA,CAAA,WACX,IAAI,CAAC,aAAa,CAAC,cACvB,CAAA,EAAE,IAAI,CAAC,IAAI,EAEX,IAAI,EAAS,CACT,yBAA0B,WACtB,GACJ,EACA,wBAAyB,AAAA,EAAQ,KACpB,IAAI,CAAC,OAAO,CACrB,IAAI,EAAK,EAAE,CACP,EAAI,IAAI,CAAC,GAAG,CAAC,qBACb,CAAA,GACA,EAAG,IAAI,CAAC,CACJ,MAAO,EAAE,IAAI,CAAE,KAAM,EAAE,EAAE,CACzB,MAAO,EAAE,IAAI,CAAE,KAAM,EAAE,EAAE,AAC7B,EAAG,CACC,MAAO,EAAE,MAAM,CAAC,IAAI,CAAE,KAAM,EAAE,MAAM,CAAC,EAAE,CACvC,MAAO,EAAE,MAAM,CAAC,IAAI,CAAE,KAAM,EAAE,MAAM,CAAC,EAAE,AAC3C,GAEJ,IAAI,CAAC,UAAU,CAAC,cAAe,EACnC,EAAG,IACP,EAOA,OANA,IAAI,CAAC,gBAAgB,CAAC,GAElB,AAAgC,MAAhC,IAAI,CAAC,IAAI,CAAC,oBACV,IAAI,CAAC,IAAI,CAAC,kBAAmB,CAAA,GAG1B,WACH,IACA,IAAI,CAAC,SAAS,CAAC,IACf,IAAI,CAAC,mBAAmB,CAAC,EAC7B,CAEJ,GChfA,IAAM,GAAe,8EACf,GAAe,oMAEjB,GAAmB,AAAA,EAAa,MAAM,CAAC,MAAO,CAC9C,QAAY,gBACZ,IAAY,yBACZ,IAAY,sBACZ,IAAY,sBACZ,MAAY,+BACZ,UAAY,iBACZ,MAAY,wBAChB,GAEI,GAAc,AAAA,GAAY,WAC1B,IAAI,EAAM,IAAI,CAAC,SAAS,CACxB,IAAI,CAAC,YAAY,CAAC,IAAI,GAAgB,CAAE,OAAQ,IAAI,CAAE,KAAM,CAAS,IACrE,IAAI,EAAkB,IAAI,CAAC,GAAG,CAAC,mBAAoB,CAAA,GACnD,IAAI,CAAC,UAAU,CAAC,IAChB,IAAI,EAAe,IAAI,CAAC,IAAI,CAAC,CACzB,aAAc,EACd,qBAAsB,CAClB,GAAI,iDACJ,GAAI,CAAE,UAAQ,SAAO,AACzB,EACA,oBAAqB,uBACrB,iBAAkB,sBACtB,GACA,OAAO,WACC,AAAC,GACD,IAAI,CAAC,GAAG,CAAC,mBAAoB,CAAA,GACjC,IAAI,CAAC,SAAS,CAAC,IACf,IAAI,CAAC,IAAI,CAAC,GACV,IAAI,CAAC,YAAY,CAAC,EACtB,CACJ,EAEA,AAAA,EAAa,OAAO,CAAC,WAAY,GAAY,QAC7C,AAAA,EAAa,OAAO,CAAC,YAAa,GAAY,SAC9C,AAAA,EAAa,OAAO,CAAC,iBAAkB,GAAY,aAEnD,OAAM,WAAuB,GACzB,MAAQ,CAAI,AACZ,CAAA,OAAS,IAAK,AACd,CAAA,QAAU,CAAE,AAEZ,CAAA,QAAU,CACN,CAAE,UAAQ,SAAO,IAAK,CACtB,CAAE,YAAa,MAAO,KACpB,oBAAqB,YAAa,oBAAqB,CAC5D,AAAC,AACF,CAAA,KAAO,+BAAgC,AACvC,CAAA,WAAa,CACT,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,GACV,CAAE,AACF,CAAA,YAAc,CACV,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,IACN,IAAM,GACV,CAAE,AAEF,aAAY,CAAA,OAAE,CAAM,CAAA,IAAE,CAAG,CAAA,UAAE,CAAS,CAAA,OAAE,CAAM,CAAE,CAAE,CAC5C,KAAK,CAAC,CAAE,OAAA,EAAQ,IAAA,CAAI,GACpB,IAAI,CAAC,SAAS,CAAG,EACjB,IAAI,CAAC,MAAM,CAAG,CAClB,CAEA,MAAO,CACH,IAAI,EAAS,KAAK,CAAC,OACf,EAAQ,IAAI,CAAC,KAAK,CAClB,EAAS,IAAI,CAAC,MAAM,CACpB,EAAU,IAAI,CAAC,OAAO,CAC1B,MAAO,KACH,IAAI,EAAO,IAIX,OAHA,EAAK,KAAK,CAAG,EACb,EAAK,MAAM,CAAG,EACd,EAAK,OAAO,CAAG,EACR,CACX,CACJ,CAEA,MAAO,CACF,IAAI,CAAC,WAAW,IAChB,IAAI,CAAC,eAAe,IACpB,IAAI,CAAC,YAAY,IACjB,IAAI,CAAC,WAAW,IAChB,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,cAAc,IACnB,IAAI,CAAC,sBAAsB,IAC3B,IAAI,CAAC,CAAC,CAAC,KAAM,EAAG,AAAuB,KAAvB,IAAI,CAAC,OAAO,CAAC,IAAI,GACtC,CAEA,EAAE,EAAO,IAAI,CAAE,EAAM,CAAC,CAAE,CAAS,CAAE,CAC/B,GAAI,GAAa,IAAI,CAAC,MAAM,CAAE,CAC1B,IAAI,EAAM,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAClC,AAAO,OAAP,GACA,CAAA,EAAO,EAAO,CAAA,AAAQ,MAAR,EAAe,IAAM,EAAO,EAAA,CAAC,CAEnD,CACA,IAAI,CAAC,KAAK,CAAC,CACP,KAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CACvB,GAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CACpB,GAAI,IAAI,CAAC,OAAO,CAAC,GAAG,EAAI,CAC5B,EAAG,EACP,CAEA,iBAAkB,CACd,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EAAI,EAAE,SAAS,CAAC,UACtC,GAAI,EAAG,CACH,IAAI,EAAK,CAAC,CAAC,EAAE,CAWb,OAVA,IAAI,CAAC,WAAW,CAAC,EAAI,oBACrB,IAAI,CAAC,QAAQ,CAAC,KACV,IAAI,EAAI,EAAE,SAAS,CAAC,SAChB,GACA,IAAI,CAAC,UAAU,CAAC,EAAI,CAAC,CAAC,EAAE,CAAC,MAAM,CAAE,qBACjC,IAAI,CAAC,OAAO,IAEZ,IAAI,CAAC,UAAU,IAAM,IAAI,CAAC,sBAAsB,IAAM,IAAI,CAAC,CAAC,CAAC,YAErE,GACO,CAAA,CACX,CACJ,CAEA,aAAc,CACV,IAAI,EAAI,IAAI,CAAC,OAAO,CACpB,GAAI,EAAE,SAAS,CAAC,MAAQ,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,IAAM,CAChD,IAAI,EAAQ,CAAE,GAAI,EAAE,IAAI,CAAE,GAAI,EAAE,GAAG,AAAC,EACpC,IAAI,CAAC,WAAW,CAAC,IAAK,oBACtB,IAAI,EAAM,IAAI,CAAC,SAAS,CAAC,gBAIzB,OAHA,EAAI,KAAK,CAAG,EACZ,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,EACvB,CAAA,CACX,CACJ,CAEA,aAAc,CACV,IAAI,EAAI,IAAI,CAAC,OAAO,CAChB,EAAK,EAAE,IAAI,GACX,EAAE,SAAS,CAAC,OACZ,IAAI,CAAC,UAAU,CAAC,IAAK,EAAG,qBACxB,IAAI,CAAC,OAAO,GACZ,IAAI,CAAC,MAAM,CAAG,MAET,AAAO,MAAP,GACL,IAAI,CAAC,UAAU,CAAC,IAAK,EAAG,qBACxB,IAAI,CAAC,OAAO,GACR,CAAC,IAAI,CAAC,SAAS,EAAE,KAAK,IAAI,CAAC,MAAM,CAAC,EAAE,IACpC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAG,CAAE,GAAI,EAAE,IAAI,CAAE,GAAI,EAAE,GAAG,AAAC,EAC5C,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,EACpB,IAAI,CAAC,MAAM,EACX,CAAA,IAAI,CAAC,OAAO,EAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAA,GAGvD,IAAI,CAAC,MAAM,CAAG,MAED,IAAI,CAAC,SAAS,CAAC,mBAEvB,AAAO,MAAP,GAAc,AAAO,MAAP,EACnB,IAAI,CAAC,UAAU,GAGf,IAAI,CAAC,sBAAsB,IAAM,IAAI,CAAC,CAAC,GAE/C,CAEA,cAAe,CACX,IAAI,EAAI,IAAI,CAAC,OAAO,CACpB,GAAI,EAAE,SAAS,CAAC,OAAS,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,IAAM,CACjD,IAAI,EAAO,IAAI,CAAC,MAAM,GAClB,IACA,EAAK,KAAK,CAAC,EAAE,CAAG,EAAE,IAAI,CACtB,EAAK,KAAK,CAAC,EAAE,CAAG,EAAE,GAAG,CACjB,IAAI,CAAC,MAAM,EACX,CAAA,IAAI,CAAC,OAAO,EAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAK,EAAE,CAAA,GAGhD,IAAI,CAAC,WAAW,CAAC,KAAM,oBACvB,IAAI,EAAO,IAAI,CAAC,QAAQ,GAExB,GADA,IAAI,CAAC,KAAK,CAAC,EAAM,GAAM,IAAM,EAAK,EAAE,CAAG,gBAAkB,SACrD,EAAM,CACN,IAAI,EAAQ,CAAE,KAAM,EAAK,IAAI,CAAE,GAAI,EAAK,EAAE,CAAE,GAAI,EAAK,EAAE,CAAE,KAAM,EAAK,EAAE,CACxD,MAAO,EAAK,KAAK,CAAE,MAAO,EAAK,KAAK,AAAC,EAC/C,EAAS,CAAE,KAAM,EAAK,IAAI,CAAE,GAAI,EAAK,EAAE,CAAE,GAAI,EAAK,EAAE,CAAE,OAAQ,CAAM,CACxE,CAAA,EAAM,MAAM,CAAG,EACf,IAAI,CAAC,SAAS,CAAC,EACnB,CAEA,OADA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAE,IACpC,CAAA,CACX,CACJ,CAEA,aAAa,CAAI,CAAE,CACf,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EAAI,EAAE,SAAS,CAAC,mBAClC,CAAA,GAAK,CAAC,CAAC,EAAE,EACL,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,CAAC,KAAM,CAAC,CAAC,EAAE,CAAC,MAAM,EAC9B,CAAC,CAAC,EAAE,GACJ,IAAI,CAAC,UAAU,CAAC,KAAM,EAAG,qBACzB,IAAI,CAAC,OAAO,GACR,IACA,EAAK,KAAK,CAAC,EAAE,CAAG,EAAE,IAAI,CACtB,EAAK,KAAK,CAAC,EAAE,CAAG,EAAE,GAAG,IAI7B,IAAI,CAAC,sBAAsB,IAAM,IAAI,CAAC,CAAC,CAAC,QAEhD,CAEA,aAAc,CACV,IAAI,EAAI,IAAI,CAAC,OAAO,CAGhB,EAAe,IAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,gBAElD,GAAI,IAAI,CAAC,UAAU,CACf,EAAS,EAAE,eAAe,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAI,SAElD,GAAI,IAAI,CAAC,MAAM,CAAE,CAClB,IARA,EAAQ,EAQJ,EAAM,EAAE,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAEjC,EADA,QAAQ,IAAI,CAAC,EAAI,MAAM,CAAC,EAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAAG,IACnC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAG,EAEzC,EAAE,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAEnD,KACU,CAAA,EAAU,IAAI,CAAC,KAAK,CAAC,GAAG,AAAH,IAC3B,EAAS,EAAE,eAAe,CAAC,EAAQ,IAAI,EACnC,AAAC,YAAY,IAAI,CAAC,EAAE,QAAQ,KAC5B,CAAA,GAAU,GADd,GAIJ,GAAI,AAAU,MAAV,EAAgB,CAChB,IAAI,EAAO,EAAE,IAAI,CACjB,KAAO,EAAO,GAAK,CAAC,KAAK,IAAI,CAAC,EAAE,QAAQ,CAAC,KAAQ,IACjD,EAAS,EAAE,eAAe,CAAC,EAC/B,CAEA,OAAO,CACX,CAEA,QAAQ,CAAG,CAAE,CACT,IAAI,CAAC,KAAK,CAAG,IAAI,EAAK,EAAK,IAAI,CAAC,KAAK,CACzC,CACA,QAAS,CACL,IAAI,EAAM,IAAI,CAAC,KAAK,CAAC,GAAG,CAExB,OADA,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CACpB,CACX,CACA,IAAI,KAAM,CACN,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,AACzB,CACJ,CAEA,MAAM,WAAwB,GAC1B,MAAQ,IAAI,AAAC,AACb,CAAA,IAAM,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,KAAM,AAClC,CAAA,KAAO,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,MAAO,AAEpC,KAAI,cAAe,CACf,MAAO,IACA,KAAK,CAAC,gBACN,IAAI,CAAC,GAAG,CAAC,YAAY,IACrB,IAAI,CAAC,IAAI,CAAC,YAAY,CAC5B,AACL,CAEA,MAAO,CACH,IAAI,EAAI,IAAI,CAAC,OAAO,AAChB,CAAA,IAAI,CAAC,KAAK,GAAK,IAAI,EAAI,IAAI,CAAC,GAAG,GAC3B,AAAe,UAAf,IAAI,CAAC,GAAG,CAAC,EAAE,EAAc,CAAA,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,GAAG,AAAH,EAC3C,AAAe,SAAf,IAAI,CAAC,GAAG,CAAC,EAAE,EAAa,CAAA,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,IAAI,AAAJ,GAE9C,IAAI,CAAC,KAAK,GAAK,IAAI,CAAC,GAAG,EAAI,EAAE,SAAS,CAAC,aACvC,CAAA,IAAI,CAAC,KAAK,CAAG,IAAI,AAAJ,EAEb,IAAI,CAAC,KAAK,GAAK,IAAI,CAAC,IAAI,EAAI,EAAE,SAAS,CAAC,YACxC,CAAA,IAAI,CAAC,KAAK,CAAG,IAAI,AAAJ,EAEjB,IAAI,CAAC,KAAK,GAAK,IAAI,CAAG,KAAK,CAAC,OAAS,IAAI,CAAC,KAAK,CAAC,IAAI,EACxD,CAEA,MAAO,CACH,IAAI,EAAS,KAAK,CAAC,OACf,EAAM,IAAI,CAAC,GAAG,CAAC,IAAI,GACnB,EAAO,IAAI,CAAC,IAAI,CAAC,IAAI,GACrB,EAAQ,IAAI,CAAC,KAAK,CACtB,MAAO,KACH,IAAI,EAAO,IAIX,OAHA,EAAK,GAAG,CAAE,IACV,EAAK,IAAI,CAAG,IACZ,EAAK,KAAK,CAAG,EACN,CACX,CACJ,CAEA,aAAc,CACV,IAAI,EAAI,IAAI,CAAC,OAAO,CAEpB,GAAK,IAAI,CAAC,KAAK,GAAK,IAAI,EAAM,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,EAAI,UAAU,IAAI,CAAC,EAAE,QAAQ,IAAM,CAClF,IAAI,EAAS,KAAK,CAAC,cACf,EAAM,IAAI,CAAC,KAAK,CAAC,GAAG,CACxB,GAAI,EAAK,CACL,IAAI,EAAM,EAAE,QAAQ,CAAC,EAAI,KAAK,CAAC,EAAE,EAAE,MAAM,CAAC,EAAG,EAAI,KAAK,CAAC,EAAE,CACrD,CAAA,KAAK,IAAI,CAAC,IAGV,CAAA,GATa,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,eAStC,CAER,CACA,OAAO,EAAS,EAAI,EAAS,CACjC,CAAO,CACH,IAAI,EAAM,IAAI,CAAC,GAAG,CAClB,GAAI,EAAK,CACL,IAAI,EAAO,EAAE,IAAI,CACjB,KAAO,EAAE,EAAO,EAAI,IAAI,EAAI,CAAC,KAAK,IAAI,CAAC,EAAE,QAAQ,CAAC,MAClD,GAAI,GAAQ,EAAI,IAAI,CAChB,OAAO,EAAE,eAAe,CAAC,GAAQ,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,eAClE,CACA,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,EACjC,CACJ,CACJ,CAEA,IAAM,GAAe,AAAA,EAAO,CAAC;AAC+C,4EAAA,CAAC,CAE7E,OAAM,WAAwB,GAC1B,OAAS,CAAE,IAAK,CAAE,IAAK,IAAK,KAAM,IAAK,CAAE,AAAC,AAC1C,CAAA,QAAU,CAAI,AACd,CAAA,SAAW,IAAK,AAChB,CAAA,KAAO,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,OAAQ,AACrC,CAAA,MAAQ,IAAI,CAAC,IAAI,AAAC,AAElB,KAAI,cAAe,CACf,MAAO,IACA,KAAK,CAAC,gBACN,IAAI,CAAC,IAAI,CAAC,YAAY,CAC5B,AACL,CAEA,MAAO,CACH,IAAI,EAAS,KAAK,CAAC,OACf,EAAO,IAAI,CAAC,IAAI,CAAC,IAAI,GACrB,EAAQ,IAAI,CAAC,KAAK,CAClB,EAAU,IAAI,CAAC,OAAO,CACtB,EAAW,IAAI,CAAC,QAAQ,CAC5B,MAAO,KACH,IAAI,EAAO,IAKX,OAJA,EAAK,IAAI,CAAE,IACX,EAAK,KAAK,CAAG,EACb,EAAK,OAAO,CAAG,EACf,EAAK,QAAQ,CAAG,EACT,CACX,CACJ,CAEA,MAAO,CACH,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EACtB,GAAI,IAAI,CAAC,KAAK,GAAK,IAAI,CAAC,IAAI,CACxB,CAAA,GAAK,EAAI,EAAE,SAAS,CAAC,UACjB,IAAI,CAAC,KAAK,CAAG,IAAI,CACjB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAE,CAAC,CAAC,EAAE,QACzC,GAAK,EAAI,EAAE,SAAS,CAAC,WAAa,CACrC,IAAI,CAAC,KAAK,CAAG,IAAI,CACjB,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,CAAE,eACvB,MACJ,MAAO,GAAK,EAAI,EAAE,SAAS,CAAC,UAExB,OADA,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAAE,CAAE,SAAU,KACpC,IAAI,CAAC,IAAI,EACpB,MACG,GAAI,AAAC,CAAA,EAAI,EAAE,SAAS,CAAC,UAAA,GAAe,QAAQ,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,MAGxE,OAFA,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,KAAM,CAAC,CAAC,EAAE,CAAC,MAAM,CAAE,eACvD,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,IAAI,CACf,IAAI,CAAC,IAAI,EAEpB,CAAA,IAAI,CAAC,KAAK,GAAK,IAAI,CAAG,KAAK,CAAC,OAAS,IAAI,CAAC,IAAI,CAAC,IAAI,EACvD,CAEA,YAAa,CACT,IAAI,EAAI,IAAI,CAAC,OAAO,CAChB,EAAS,SAAS,IAAI,CAAC,EAAE,UAAU,IACnC,EAAM,IAAI,CAAC,QAAQ,UACvB,AAAI,GACA,IAAI,CAAC,MAAM,GACX,EAAI,IAAI,CAAG,GAAU,EAAE,SAAS,CAAC,KAAO,gBAClC,EAAI,EAAE,IAAI,GAAe,UACzB,KACN,IAAI,CAAC,KAAK,CAAC,GACJ,CAAA,GAEJ,IAAI,CAAC,UAAU,EAC1B,CAEA,UAAU,CAAK,CAAE,CACb,IAAI,EAAI,IAAI,CAAC,OAAO,CAAE,EACtB,GAAI,IAAI,CAAC,QAAQ,CACb,IAAI,CAAC,MAAM,GACN,CAAA,EAAI,EAAE,SAAS,CAAC,SAAA,GACjB,IAAI,CAAC,UAAU,CAAC,EAAO,CAAC,CAAC,EAAE,CAAC,MAAM,CAAE,iBACpC,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,IAAI,CACtB,IAAI,CAAC,OAAO,GACR,IAAI,CAAC,QAAQ,CAAC,OAAO,EACrB,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAG,CAAE,GAAI,EAAE,IAAI,CAAE,GAAI,EAAE,GAAG,AAAC,EAC9C,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,GACrB,IAAI,CAAC,QAAQ,CAAC,KAAK,GAC1B,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAG,EAAE,IAAI,CAC/B,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAG,EAAE,GAAG,EAElC,IAAI,CAAC,QAAQ,CAAG,MAEhB,IAAI,CAAC,IAAI,OAEV,CACH,IAAI,EAAQ,CAAE,GAAI,EAAE,IAAI,CAAE,GAAI,EAAE,GAAG,AAAC,EACpC,IAAI,CAAC,WAAW,CAAC,EAAO,iBACxB,IAAI,CAAC,MAAM,GACX,IAAI,EAAO,IAAI,CAAC,QAAQ,GACxB,GAAI,EAEA,GADe,OAAO,IAAI,CAAC,EAAK,EAAE,EACpB,CACV,IAAI,EAAO,IAAI,CAAC,QAAQ,GACpB,EAAO,EAAK,EAAE,CAAC,MAAM,CAAC,GAE1B,GADA,IAAI,CAAC,KAAK,CAAC,EAAM,GAAM,IAAM,EAAO,UAAY,SAC5C,EAAM,CACF,EAAK,KAAK,GACV,EAAK,KAAK,CAAC,EAAE,CAAG,EAAM,EAAE,CACxB,EAAK,KAAK,CAAC,EAAE,CAAG,EAAM,EAAE,EAE5B,IAAI,EAAQ,CAAE,KAAM,EAAK,IAAI,CAAE,GAAI,EAAK,EAAE,CAAE,GAAI,EAAK,EAAE,CAAE,KAAM,EAAK,EAAE,CACxD,MAAO,EAAK,KAAK,CAAE,MAAO,EAAK,KAAK,AAAC,EAC/C,EAAS,CAAE,KAAM,EAAK,IAAI,CAAE,GAAI,EAAK,EAAE,CAAE,GAAI,EAAK,EAAE,CAAE,OAAQ,CAAM,CACxE,CAAA,EAAM,MAAM,CAAG,EACf,IAAI,CAAC,SAAS,CAAC,GACf,IAAI,CAAC,QAAQ,CAAG,EAChB,OAAO,EAAK,OAAO,AACvB,CAEA,GADA,IAAI,CAAC,MAAM,GACP,oBAAoB,IAAI,CAAC,GAAO,CAChC,IAAI,EAAQ,IAAI,CAAC,QAAQ,EACrB,CAAA,GACA,IAAI,CAAC,KAAK,CAAC,EAAO,EAAM,EAAE,EAAI,GAAM,OAAO,GAAK,gBAAkB,SAEtE,IAAI,CAAC,MAAM,EACf,CACJ,MACI,IAAI,CAAC,KAAK,CAAC,EAAM,WACjB,EAAK,KAAK,CAAG,EACb,IAAI,CAAC,QAAQ,CAAG,EAChB,IAAI,CAAC,cAAc,CAAC,OAEhB,CAAA,EAAI,EAAE,SAAS,CAAC,SAAA,GAExB,IAAI,CAAC,UAAU,CAAC,EAAO,CAAC,CAAC,EAAE,CAAC,MAAM,CAAE,SACpC,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,IAAI,CACtB,IAAI,CAAC,OAAO,KAEZ,IAAI,CAAC,CAAC,CAAC,SACP,IAAI,CAAC,QAAQ,CAAG,CAAE,QAAS,CAAA,CAAM,EAEzC,CACJ,CAEA,eAAe,CAAI,CAAE,CACjB,IAAI,EAAI,IAAI,CAAC,OAAO,CAGpB,GAFA,EAAK,OAAO,CAAG,CAAC,qDAAqD,IAAI,CAAC,EAAK,EAAE,EACjF,IAAI,CAAC,MAAM,GACP,AAAW,OAAX,EAAK,EAAE,CAAW,CAClB,KAAO,IAAI,CAAC,SAAS,CAAC,kBAElB,GADA,IAAI,CAAC,MAAM,GACP,EAAE,SAAS,CAAC,KACZ,EAAE,GAAG,GACL,IAAI,CAAC,MAAM,QACR,MAEX,IAAI,CAAC,MAAM,GACX,EAAK,OAAO,CAAG,EAAE,SAAS,CAAC,SAC/B,KAAW,CAAA,AAAW,SAAX,EAAK,EAAE,EAAe,AAAW,SAAX,EAAK,EAAE,AAAI,GACxC,CAAA,EAAK,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,gBADhC,CAGJ,CAEA,aAAc,CACV,IAAI,EAAI,IAAI,CAAC,OAAO,CAEpB,GAAI,IAAI,CAAC,KAAK,GAAK,IAAI,CACnB,OAAO,KAAK,CAAC,cACV,GAAI,IAAI,CAAC,KAAK,CAAE,CACnB,GAAI,IAAI,CAAC,KAAK,CAAC,MAAM,CAAE,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,GACpD,IAAI,EAAS,EAAE,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAE9C,GADc,2BAA2B,IAAI,CAAC,EAAE,QAAQ,IAC3C,OAAO,EACpB,GAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,EAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CACzD,OAAO,EATU,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,eAUlD,CACA,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,EACjC,CAEA,UAAU,CAAK,CAAE,CACb,IAAI,CAAC,OAAO,CAAG,IAAI,EAAK,EAAO,IAAI,CAAC,OAAO,CAC/C,CACA,UAAW,CACP,IAAI,EAAQ,IAAI,CAAC,OAAO,CAAC,GAAG,CAE5B,OADA,IAAI,CAAC,OAAO,CAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CACxB,CACX,CACA,IAAI,OAAQ,CACR,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,AAC3B,CACA,IAAI,KAAM,CACN,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,AACxB,CACJ,CAEA,SAAS,GAAW,CAAG,EACnB,MAAQ,AAAO,KAAP,GAAc,AAAO,MAAP,EAAc,EAC5B,AAAO,KAAP,GAAc,AAAO,UAAP,EAAkB,EAChC,AAAO,KAAP,EAAa,EACb,AAAO,MAAP,EAAc,EACd,AAAO,MAAP,EAAc,GACd,AAAO,MAAP,EAAc,GACd,AAAc,GAAd,CAAA,AAAO,MAAP,CAAO,CAEnB,CAEA,SAAS,GAAU,CAAM,EACrB,IAAI,EAAM,GAQV,OAPI,AAAS,EAAT,GAAY,CAAA,GAAO,SAAvB,EACI,AAAS,EAAT,GAAY,CAAA,GAAO,OAAvB,EACI,AAAS,EAAT,GAAY,CAAA,GAAO,OAAvB,EACI,AAAS,EAAT,GAAY,CAAA,GAAO,WAAvB,EACI,AAAS,GAAT,GAAa,CAAA,GAAO,WAAxB,EACI,AAAS,GAAT,GAAa,CAAA,GAAO,WAAxB,EACI,AAAS,GAAT,GAAa,CAAA,GAAO,WAAxB,EACO,EAAI,IAAI,IAAM,IACzB,CAEA,AAAA,GAAgB,MAAM,CAAC,MAAO,CAAC,EAAQ,IAAQ,IAAI,GAAe,CAAE,OAAA,EAAQ,IAAA,CAAI,IAEhF,AAAA,GAAgB,MAAM,CAAC,OAAQ,CAAC,EAAQ,IAAQ,IAAI,GAAgB,CAChE,OAAA,EAAQ,IAAA,EACR,UAAW,GACX,OAAQ,CAAE,KAAM,GAAY,IAAK,EAAU,CAC/C,IAEA,AAAA,GAAgB,MAAM,CAAC,YAAa,CAAC,EAAQ,IAAQ,IAAI,GAAgB,CAAE,OAAA,EAAQ,IAAA,CAAI,IAEvF,AAAA,EAAa,WAAW,CAAC,CACrB,gCAAiC,WAG7B,GAAI,CAAC,IAAI,CAAC,SAAS,CAAE,OACrB,IAAI,CAAC,SAAS,CAAC,aAAa,GAC5B,IAAI,EAAM,IAAI,CAAC,SAAS,CAAC,KAAK,GACzB,MAAM,CAAC,AAAA,GAAY,IAAI,CAAC,OAAO,CAAE,UACjC,QAAQ,CAAC,AAAA,GAAK,GAAa,IAAI,CAAC,EAAE,IAAI,GAC3C,GAAI,EAAK,CACL,IAAI,EAAI,CACJ,MAAO,IAAI,CAAC,iBAAiB,CAAC,EAAI,KAAK,CAAC,EAAE,CAAE,EAAI,KAAK,CAAC,EAAE,EACxD,IAAK,IAAI,CAAC,iBAAiB,CAAC,EAAI,KAAK,CAAC,EAAE,CAAE,EAAI,KAAK,CAAC,EAAE,CAC1D,EAaA,OAZA,IAAI,CAAC,GAAG,CAAC,iBAAkB,KACvB,IAAI,CAAC,GAAG,CAAC,YAAa,EAAE,KAAK,EACzB,IAAI,CAAC,GAAG,CAAC,aAAc,oBACvB,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,SAAS,CAAC,KAAK,EAC1C,EAAE,KAAK,CAAG,IAAI,CAAC,KAAK,IAExB,IAAI,CAAC,GAAG,CAAC,YAAa,EAAE,GAAG,EACvB,IAAI,CAAC,GAAG,CAAC,eAAgB,mBACzB,IAAI,CAAC,GAAG,CAAC,uBACT,EAAE,GAAG,CAAG,IAAI,CAAC,KAAK,GAE1B,GACO,CACX,CACJ,EACA,cAAe,AAAA,EAAkB,WAC7B,IAAI,EAAK,IAAI,CAAC,OAAO,CACrB,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,EAAG,GAAG,CAAE,EAAG,GAAG,EACxC,IAAI,EAAM,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,CAClC,EAAQ,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,KAAK,CACtC,EAAY,KACZ,IAAI,CAAC,GAAG,CAAC,SAAU,CAAC,MAAM,EAAE,EAAM,EAAE,CAAC,GAAG,CAAC,EACzC,IAAI,CAAC,GAAG,CAAC,cACb,EAKA,GAAI,AAAC,GAAQ,GACb,GAAI,CAAC,GAAO,EAAO,OAAO,IAC1B,GAAI,CAAC,GAAS,GACV,AAA4B,EAA5B,AAAA,GAAc,EAAO,GADN,YALf,IAAI,CAAC,GAAG,CAAC,SAAU,CAAC,EAAE,EAAE,EAAI,EAAE,CAAC,CAAC,CAAC,EACjC,IAAI,CAAC,GAAG,CAAC,gBAMb,IACJ,GACA,uBAAwB,AAAA,EAAkB,WAEtC,GADA,IAAI,CAAC,GAAG,CAAC,uBACL,IAAI,CAAC,YAAY,CAAC,MAAO,CACzB,IAAI,EAAK,IAAI,CAAC,OAAO,CACrB,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,EAAG,GAAG,CAAE,EAAG,GAAG,EACxC,IAAI,EAAM,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,CAClC,IACA,IAAI,CAAC,kBAAkB,GACvB,IAAI,CAAC,GAAG,CAAC,SAAU,EAAI,EAAE,CAAE,KAC3B,IAAI,CAAC,GAAG,CAAC,eAEjB,CACJ,GACA,oBAAqB,AAAA,EAAkB,WACnC,IAAI,CAAC,GAAG,CAAC,uBACT,IAAI,EAAK,IAAI,CAAC,OAAO,CACrB,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,EAAG,GAAG,CAAE,EAAG,GAAG,EACxC,IAAI,EAAM,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,CACtC,GAAI,GAAK,OAAO,IAAM,EAAG,GAAG,EAAI,EAAI,KAAK,CAAC,EAAE,EAAI,EAAG,GAAG,CAAE,CACpD,IAAI,CAAC,kBAAkB,GACvB,IAAI,EAAM,IAAI,CAAC,KAAK,GACpB,IAAI,CAAC,GAAG,CAAC,SAAU,KAAM,EAAI,EAAE,CAAE,KACjC,IAAI,CAAC,GAAG,CAAC,YAAa,EAC1B,CACJ,GACA,uBAAwB,AAAA,EAAkB,WACtC,IAAI,EAAW,IAAI,CAAC,UAAU,CAAC,OAAS,IAAI,CAAC,YAAY,CAAC,KAC1D,IAAI,CAAC,GAAG,CAAC,sBACL,IACA,IAAI,CAAC,GAAG,CAAC,sBACT,IAAI,CAAC,GAAG,CAAC,iBACT,IAAI,CAAC,GAAG,CAAC,eAEjB,GACA,oBAAqB,AAAA,EAAkB,WACnC,IAAI,CAAC,GAAG,CAAC,uBACT,IAAI,EAAK,IAAI,CAAC,OAAO,CACrB,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,EAAG,GAAG,CAAE,EAAG,GAAG,EAC7B,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,KAAK,YACrB,IAAmB,IAAI,CAAC,YAAY,CAAC,QACrD,IAAI,CAAC,kBAAkB,GACvB,IAAI,CAAC,GAAG,CAAC,SAAU,OACnB,IAAI,CAAC,GAAG,CAAC,gBAAiB,GAElC,GACA,6BAA8B,AAAA,EAAkB,WAC5C,IAAI,CAAC,SAAS,CAAC,aAAa,GAC5B,IAAI,EAAI,IAAI,CAAC,SAAS,CAAC,KAAK,GACvB,MAAM,CAAC,AAAA,GAAY,IAAI,CAAC,OAAO,GAC/B,MAAM,CAAC,AAAA,GAAK,WAAW,IAAI,CAAC,EAAE,IAAI,GAAG,EAAE,CAAC,IAC7C,GAAI,GAAG,OAAQ,CACX,IAAI,EAAU,KACN,IAAI,CAAC,YAAY,CAAC,KAClB,IAAI,CAAC,GAAG,CAAC,wBAET,IAAI,CAAC,GAAG,CAAC,SAAU,IAE3B,EACI,EAAS,KACL,IAAI,CAAC,UAAU,CAAC,KAChB,IAAI,CAAC,GAAG,CAAC,eAET,IAAI,CAAC,GAAG,CAAC,SAAU,IAE3B,EACA,IAAI,CAAC,GAAG,CAAC,iBAAkB,KACvB,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAE,MAAM,CAAC,IAAI,CAAE,EAAE,MAAM,CAAC,EAAE,GACvE,IACA,IAAI,CAAC,GAAG,CAAC,YAAa,IAAI,CAAC,iBAAiB,CAAC,EAAE,IAAI,CAAE,EAAE,EAAE,GACzD,GACJ,EACJ,CACJ,EACJ,GAKA,IAAI,GAAuB,AAAA,EAAa,MAAM,CAAC,UAAW,CACtD,IAAU,mBACV,QAAU,mBACV,MAAU,cACd,GA8GA,SAAS,KACL,IAAI,EAAQ,IAAI,CAAC,KAAK,GACtB,EAAI,IAAI,CAAC,IAAI,CAAC,mBACd,EAAQ,CAAC,CAAC,EAAE,CACZ,EAAM,EAAE,EAAE,CAAC,GACP,CAAA,CAAA,EAAQ,EAAM,WAAW,IAAM,EAAQ,EAAI,WAAW,IAAM,EAAI,WAAW,IAAM,EAAE,EAAE,CAAC,IAAI,WAAW,EAAA,GACrG,IAAI,CAAC,GAAG,CAAC,eAEjB,CAEA,AAAA,EAAa,WAAW,CAAC,CAErB,eAAgB,AAAA,EAAkB,WAC9B,IAAI,CAAC,GAAG,CAAC,gBACT,IAAI,EAAO,GACP,EAAQ,IAAI,CAAC,GAAG,CAAC,iBAAkB,WAEnC,IADA,IAAI,CAAC,GAAG,CAAC,uBACF,CAAC,IAAI,CAAC,GAAG,CAAC,eAAgB,wBACxB,IAAI,CAAC,GAAG,CAAC,mBAClB,OAAO,IAAI,CAAC,KAAK,EACrB,GACI,EAAQ,IAAI,CAAC,KAAK,GAEtB,GAAI,EACA,AAlIZ,SAAS,EAAW,CAAE,CAAE,CAAI,EAExB,IAAK,IADD,EAAI,EAAG,MAAM,EAAI,EACZ,EAAI,EAAG,GAAK,EAAG,EAAE,EAClB,EAAI,GACJ,EAAK,MACT,EAAK,IAAK,EAAG,IAAI,EACb,EAAG,EAAE,EACL,EAAK,QAAS,EAAG,EAAE,CAAC,OAAO,CAAC,MAAO,GAAI,KAEvC,EAAG,KAAK,EACR,EAAK,WAAY,EAAG,KAAK,CAAC,OAAO,CAAC,MAAO,GAAI,KAE7C,EAAG,UAAU,EACb,EAAG,UAAU,CAAC,OAAO,CAAC,AAAA,GAAQ,EAAK,IAAK,EAAM,SAElD,EAAK,KACD,EAAG,KAAK,EACR,EAAK,MACL,EAAW,EAAG,KAAK,CAAE,GACrB,EAAK,OAEL,EAAK,KAET,EAAK,KAAM,EAAG,IAAI,CAAE,KAChB,EAAG,IAAI,GACP,EAAK,MACL,EAAW,EAAG,IAAI,CAAE,GAGhC,EAsGgB,AApGhB,SAAS,EAAU,CAAG,CAAE,CAAC,EACrB,IAAI,EAAK,CAAE,KAAM,EAAG,EAAG,EAlCX,EAmCZ,EAAO,KAAO,EAAI,EAAI,MAAM,EAAE,CAC1B,IAAI,EAAK,EAAI,MAAM,CAAC,KACpB,OAAQ,GAEN,IAAK,IACH,EAxCiC,EAyCjC,EAAG,EAAE,CAAG,GACR,KAEF,KAAK,IACH,EA7CoB,EA8ChB,AAAY,MAAZ,EAAG,KAAK,CACR,EAAG,KAAK,EAAI,IAEZ,EAAG,KAAK,CAAG,GAEf,KAEF,KAAK,IACH,EAtDiE,EAuD7D,AAAiB,MAAjB,EAAG,UAAU,EACb,CAAA,EAAG,UAAU,CAAG,EAAE,AAAF,EACpB,EAAG,UAAU,CAAC,IAAI,CAAC,IACnB,KAEF,KAAK,IACH,EA7DkD,EA8DlD,EAAG,MAAM,CAAG,GACZ,KAEF,KAAK,IACH,EAAG,KAAK,CAAG,EAAU,EAAK,GAC1B,EAAI,EAAG,KAAK,CAAC,CAAC,CACd,MAAM,CAER,KAAK,IACH,EAAG,KAAK,CAAG,EAAU,EAAK,GAC1B,EAAI,EAAG,KAAK,CAAC,CAAC,CACd,KAEF,KAAK,IACH,MAAM,CAER,KAAK,IACH,EAAG,IAAI,CAAG,EAAU,EAAK,GACzB,EAAI,EAAG,IAAI,CAAC,CAAC,CACb,MAAM,CAER,SACE,OAAQ,GACN,KArFE,EAsFA,EAAG,IAAI,EAAI,EACX,KACF,MAxFkB,EAyFhB,EAAG,KAAK,EAAI,EACZ,KACF,MA3F+B,EA4F7B,EAAG,EAAE,EAAI,EACT,KACF,MA9FgD,EA+F9C,EAAG,MAAM,CAAG,SAAS,OAAO,EAAG,MAAM,EAAI,EAAI,IAC7C,KACF,MAjG+D,EAkG7D,EAAG,UAAU,CAAC,IAAI,CAAC,EAAG,UAAU,CAAC,GAAG,GAAK,EAE7C,CACJ,CACJ,CAGA,OADA,EAAG,CAAC,CAAG,EACA,CACX,EA4BoB,IAAI,CAAC,GAAG,CAAC,mBAAoB,EAAO,GAAO,IAAI,GAAI,GAEvD,CAAC,GAAG,IAAS,GAAQ,EAAK,IAAI,CAAC,IAEvC,CAAE,MAAM,EAAI,CACR,MAAM,IAAI,EAAgB,kCAC9B,CAEA,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAO,GACjC,IAAI,CAAC,GAAG,CAAC,SAAU,GACnB,EAAQ,IAAI,CAAC,YAAY,CAAC,EAAO,CAAA,EAAO,WAGxC,IAAI,EAAM,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,GAAI,CAAA,EAAM,WAAY,EAAU,EAAE,CAExE,IADA,IAAI,CAAC,GAAG,CAAC,YAAa,EAAM,WAAW,IAChC,IAAI,CAAC,GAAG,CAAC,iBAAkB,IAAK,EAAI,WAAW,KAClD,IAAI,CAAC,GAAG,CAAC,wBACT,EAAQ,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,GAAI,CAAA,EAAM,kBACnD,EAAQ,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,GAAI,CAAA,EAAO,gBAGxD,IAAI,CAAC,GAAG,CAAC,gBAAiB,EAAM,WAAW,GAAI,EAAI,WAAW,IAG1D,AADQ,EAAQ,MAAM,CACd,GAER,IAAI,CAAC,GAAG,CAAC,YAAa,CAAO,CAAC,EAAE,EAChC,EAAQ,OAAO,CAAC,GAChB,EAAQ,IAAI,CAAC,GACb,IAAI,CAAC,IAAI,CAAC,kBAAmB,GAC7B,IAAI,CAAC,UAAU,CAAC,IAChB,IAAI,CAAC,gBAAgB,CAAC,0BAA2B,MAEjD,EAAM,OAAO,GACb,EAAI,OAAO,GAEnB,GAEA,aAAc,AAAA,EAAkB,WAC5B,IAAI,EAAM,IAAI,CAAC,IAAI,CAAC,mBAChB,IACA,EAAI,GAAG,CAAC,AAAA,GAAK,EAAE,OAAO,IACtB,IAAI,CAAC,IAAI,CAAC,kBAAmB,OAEjC,IAAI,CAAC,SAAS,CAAC,IACf,IAAI,CAAC,mBAAmB,CAAC,0BAA2B,GACxD,GAEA,iBAAkB,AAAA,EAAkB,WAChC,IAAI,EAAU,IAAI,CAAC,IAAI,CAAC,mBAAoB,EAAM,IAAI,CAAC,KAAK,GAC5D,IAAK,IAAI,EAAI,EAAG,EAAI,EAAQ,MAAM,CAAE,EAAE,EAAG,CACrC,IAAI,EAAI,CAAO,CAAC,EAAE,CAClB,GAAI,EAAE,WAAW,GAAK,EAAK,CACvB,IAAI,CAAC,GAAG,CAAC,YAAa,EAAE,WAAW,IACnC,KACJ,CACJ,CACJ,GAEA,iBAAkB,AAAA,EAAkB,WAChC,IAAI,EAAU,IAAI,CAAC,IAAI,CAAC,mBAAoB,EAAM,IAAI,CAAC,KAAK,GAC5D,IAAK,IAAI,EAAI,EAAQ,MAAM,CAAE,EAAE,GAAK,GAAI,CACpC,IAAI,EAAI,CAAO,CAAC,EAAE,CAClB,GAAI,EAAE,WAAW,GAAK,EAAK,CACvB,IAAI,CAAC,GAAG,CAAC,YAAa,EAAE,WAAW,IACnC,KACJ,CACJ,CACJ,EAEJ,U,M,K,C,K,Y,C,K,Y,C,K,kB,C,M,e,C,K,iB,C,K,e,C,M,e","sources":["<anon>","src/index.js","src/js/ymacs.js","src/js/ymacs-utils.js","src/js/ymacs-buffer.js","src/js/ymacs-marker.js","src/js/ymacs-keymap.js","src/js/ymacs-keymap-emacs.js","src/js/ymacs-interactive.js","src/js/ymacs-exception.js","src/js/ymacs-textprop.js","src/js/ymacs-popup.js","src/js/ymacs-frame.js","src/js/ymacs-tokenizer.js","src/js/ymacs-commands.js","src/js/ymacs-commands-utils.js","src/js/ymacs-minibuffer.js","src/js/ymacs-isearch.js","src/js/ymacs-mode-css.js","src/js/ymacs-baselang.js","src/js/ymacs-mode-js.js","src/js/ymacs-mode-lisp.js","src/js/ymacs-mode-markdown.js","src/js/ymacs-mode-paren-match.js","src/js/ymacs-mode-xml.js"],"sourcesContent":["\nfunction $parcel$export(e, n, v, s) {\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\n}\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\nlet $08a06a2e99accb03$var$TEMPLATE = document.createElement(\"template\");\nlet $08a06a2e99accb03$var$OVERLAY;\nclass $08a06a2e99accb03$var$Raw {\n    constructor(value){\n        this._value = value;\n    }\n    toString() {\n        return this._value;\n    }\n    valueOf() {\n        return this._value;\n    }\n}\nlet $08a06a2e99accb03$export$cb0933279c36a66b = new class {\n    fromHTML(html) {\n        $08a06a2e99accb03$var$TEMPLATE.innerHTML = html.trim();\n        let cont = $08a06a2e99accb03$var$TEMPLATE.content;\n        return cont.children.length > 1 ? cont : cont.children[0];\n    }\n    addClass(el, cls) {\n        el.classList.add(cls);\n    }\n    delClass(el, cls) {\n        if (cls instanceof RegExp) el.className = el.className.replace(cls, \"\");\n        else el.classList.remove(cls);\n    }\n    hasClass(el, cls) {\n        return el.classList.contains(cls);\n    }\n    condClass(el, cond, clsTrue, clsFalse) {\n        el.classList.toggle(clsTrue, !!cond);\n        if (clsFalse) el.classList.toggle(clsFalse, !cond);\n    }\n    toggleClass(el, ...args) {\n        el.classList.toggle(...args);\n    }\n    trash(el) {\n        el && el.remove();\n    }\n    on(element, event, handler, options) {\n        if (typeof event == \"string\") element.addEventListener(event, handler, options || {});\n        else Object.keys(event).forEach((ev)=>$08a06a2e99accb03$export$cb0933279c36a66b.on(element, ev, event[ev], handler || {}));\n    }\n    off(element, event, handler, options) {\n        if (typeof event == \"string\") element.removeEventListener(event, handler, options || {});\n        else Object.keys(event).forEach((ev)=>$08a06a2e99accb03$export$cb0933279c36a66b.off(element, ev, event[ev], handler || {}));\n    }\n    overlayOn(cls) {\n        document.body.appendChild($08a06a2e99accb03$var$OVERLAY);\n        if (cls) $08a06a2e99accb03$var$OVERLAY.className = cls;\n        return $08a06a2e99accb03$var$OVERLAY;\n    }\n    overlayOff() {\n        $08a06a2e99accb03$var$OVERLAY.remove();\n    }\n    mousePos(ev, el) {\n        let box = el.getBoundingClientRect();\n        return {\n            x: ev.clientX - box.left,\n            y: ev.clientY - box.top\n        };\n    }\n    relPos(src, tgt = src.offsetParent) {\n        let srcbox = src.getBoundingClientRect();\n        let tgtbox = tgt.getBoundingClientRect();\n        return {\n            x: srcbox.left - tgtbox.left,\n            y: srcbox.top - tgtbox.top\n        };\n    }\n    htmlEscape(str) {\n        return str instanceof $08a06a2e99accb03$var$Raw ? str + \"\" : (str + \"\").replace(/&/g, \"&amp;\").replace(/\\x22/g, \"&quot;\").replace(/\\x27/g, \"&#x27;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\\u00A0/g, \"&#xa0;\");\n    }\n    htmlSafe(str) {\n        return new $08a06a2e99accb03$var$Raw(str);\n    }\n};\nconst $08a06a2e99accb03$var$nextDone = {\n    next: ()=>({\n            done: true\n        })\n};\nconst $08a06a2e99accb03$export$d5414a779ebfba6b = new class NIL {\n    car = null;\n    cdr = this;\n    toString() {\n        return \"NIL\";\n    }\n    valueOf() {\n        return null;\n    }\n    [Symbol.iterator]() {\n        return $08a06a2e99accb03$var$nextDone;\n    }\n    get length() {\n        return 0;\n    }\n};\nclass $08a06a2e99accb03$export$74c44e616647f5c0 {\n    constructor(car, cdr = $08a06a2e99accb03$export$d5414a779ebfba6b){\n        this.car = car;\n        this.cdr = cdr;\n    }\n    [Symbol.iterator]() {\n        let p = this;\n        return {\n            next () {\n                if (p === $08a06a2e99accb03$export$d5414a779ebfba6b) return {\n                    done: true\n                };\n                let value = p.car;\n                p = p.cdr;\n                return {\n                    value: value\n                };\n            }\n        };\n    }\n    get length() {\n        let p = this, count = 0;\n        while(p !== $08a06a2e99accb03$export$d5414a779ebfba6b)++count, p = p.cdr;\n        return count;\n    }\n}\n$08a06a2e99accb03$var$OVERLAY = $08a06a2e99accb03$export$cb0933279c36a66b.fromHTML(`<div style=\"position: fixed; z-index: 20000; left: 0; top: 0; right: 0; bottom: 0\"></div>`);\nclass $08a06a2e99accb03$export$76712d54f90f7348 {\n    constructor(options){\n        this._ev_handlers = Object.create(null);\n        this.o = Object.assign(Object.create(this.constructor.options || null), options);\n    }\n    addEventListener(event, handler) {\n        if (typeof event == \"string\") {\n            let a = this._getHandlers(event);\n            $08a06a2e99accb03$export$cd7f480d6b8286c3(a, handler);\n            a.push(handler);\n        } else Object.keys(event).forEach((ev)=>this.addEventListener(ev, event[ev]));\n    }\n    removeEventListener(event, handler) {\n        if (typeof event == \"string\") $08a06a2e99accb03$export$cd7f480d6b8286c3(this._getHandlers(event), handler);\n        else Object.keys(event).forEach((ev)=>this.removeEventListener(ev, event[ev]));\n    }\n    listenOnce(event, handler) {\n        this.addEventListener(event, function fn(...args) {\n            this.removeEventListener(event, fn);\n            return handler.apply(this, args);\n        });\n    }\n    callHooks(ev, ...args) {\n        this._getHandlers(ev).forEach((f)=>f.apply(this, args));\n    }\n    destroy() {\n        this.callHooks(\"onDestroy\");\n    }\n    _getHandlers(ev) {\n        return this._ev_handlers[ev] || (this._ev_handlers[ev] = []);\n    }\n}\nclass $08a06a2e99accb03$export$a829527ff4e4114a extends $08a06a2e99accb03$export$76712d54f90f7348 {\n    constructor(...args){\n        super(...args);\n        this.createElement();\n    }\n    createElement() {\n        let el = document.createElement(\"div\");\n        el.className = this.initClassName();\n        el._ymacs_object = this;\n        this.el = el;\n        return el;\n    }\n    initClassName() {\n        return this.constructor.name; // XXX: fail after minification\n    }\n    getContentElement() {\n        return this.el;\n    }\n    getElement() {\n        return this.el;\n    }\n    add(thing) {\n        if (thing instanceof $08a06a2e99accb03$export$a829527ff4e4114a) thing = thing.getElement();\n        this.getContentElement().appendChild(thing);\n    }\n    addClass(cls) {\n        $08a06a2e99accb03$export$cb0933279c36a66b.addClass(this.getElement(), cls);\n    }\n    delClass(cls) {\n        $08a06a2e99accb03$export$cb0933279c36a66b.delClass(this.getElement(), cls);\n    }\n    hasClass(cls) {\n        return $08a06a2e99accb03$export$cb0933279c36a66b.hasClass(this.getElement(), cls);\n    }\n    condClass(cond, clsTrue, clsFalse) {\n        $08a06a2e99accb03$export$cb0933279c36a66b.condClass(this.getElement(), cond, clsTrue, clsFalse);\n    }\n    toggleClass(...args) {\n        $08a06a2e99accb03$export$cb0933279c36a66b.toggleClass(this.getElement(), ...args);\n    }\n    setContent(cont) {\n        this.getContentElement().innerHTML = cont;\n    }\n    setStyle(prop, val) {\n        let style = this.getElement().style;\n        if (typeof prop == \"string\") style[prop] = val;\n        else Object.assign(style, prop);\n    }\n    getBox() {\n        return this.getElement().getBoundingClientRect();\n    }\n    destroy() {\n        $08a06a2e99accb03$export$cb0933279c36a66b.trash(this.getElement());\n        super.destroy(...arguments);\n    }\n}\nfunction $08a06a2e99accb03$export$cd7f480d6b8286c3(array, element) {\n    let pos = 0;\n    while((pos = array.indexOf(element, pos)) >= 0)array.splice(pos, 1);\n}\nfunction $08a06a2e99accb03$export$ad41d882ec94ba04(fn, timeout = 0, obj, ...args) {\n    if (arguments.length > 2) fn = fn.bind(obj, ...args);\n    let timer = null;\n    return function() {\n        clearTimeout(timer);\n        timer = setTimeout(fn, timeout);\n    };\n}\nvar $08a06a2e99accb03$var$$1K = 1024, $08a06a2e99accb03$var$$1M = $08a06a2e99accb03$var$$1K * 1024, $08a06a2e99accb03$var$$1G = $08a06a2e99accb03$var$$1M * 1024, $08a06a2e99accb03$var$$1T = $08a06a2e99accb03$var$$1G * 1024;\nfunction $08a06a2e99accb03$export$e1a3971de07c83b5(number, fixed) {\n    var sz = number, spec, r;\n    if (sz < $08a06a2e99accb03$var$$1K) spec = \"B\";\n    else if (sz < $08a06a2e99accb03$var$$1M) {\n        sz /= $08a06a2e99accb03$var$$1K;\n        spec = \"K\";\n    } else if (sz < $08a06a2e99accb03$var$$1G) {\n        sz /= $08a06a2e99accb03$var$$1M;\n        spec = \"M\";\n    } else if (sz < $08a06a2e99accb03$var$$1T) {\n        sz /= $08a06a2e99accb03$var$$1G;\n        spec = \"G\";\n    }\n    // spec = \"\" + spec;\n    r = Math.round(sz);\n    if (fixed && sz != r) return sz.toFixed(fixed) + spec;\n    else return r + spec;\n}\nfunction $08a06a2e99accb03$export$3cdc770bf8b2ed3d(thing, width, zero = \"0\") {\n    if (typeof thing == \"number\") thing = Math.round(thing);\n    var s = \"\" + thing;\n    while(s.length < width)s = zero + s;\n    return s;\n}\nfunction $08a06a2e99accb03$export$3d93c1b4c8f9bdcb(str) {\n    return str.trim().split(/\\s+/);\n}\nfunction $08a06a2e99accb03$export$da43f679ba2e9167(str) {\n    return $08a06a2e99accb03$export$3d93c1b4c8f9bdcb(str).reduce((a, key, i)=>(a[key] = i + 1, a), Object.create(null));\n}\nfunction $08a06a2e99accb03$export$90e79c6ee773013e(x, mods) {\n    if (typeof x == \"string\") x = $08a06a2e99accb03$export$3d93c1b4c8f9bdcb(x);\n    return new RegExp(\"^(\" + x.join(\"|\") + \")$\", mods);\n}\nfunction $08a06a2e99accb03$export$b43564a9f178c38c(strings) {\n    switch(strings.length){\n        case 0:\n            return \"\";\n        case 1:\n            return strings[0];\n        case 2:\n            let a = strings[0];\n            let b = strings[1];\n            let n = Math.min(a.length, b.length);\n            let i = 0;\n            while(i < n && a.charAt(i) === b.charAt(i))++i;\n            return a.substring(0, i);\n        default:\n            return $08a06a2e99accb03$export$b43564a9f178c38c([\n                strings[0],\n                $08a06a2e99accb03$export$b43564a9f178c38c(strings.slice(1))\n            ]);\n    }\n}\nfunction $08a06a2e99accb03$export$2ceef881d0b4a563() {\n    let themes = [];\n    for (let st of document.styleSheets)digStyle(st);\n    return themes;\n    function digStyle(st) {\n        for (let rule of st.cssRules)digRule(rule);\n    }\n    function digRule(rule) {\n        if (rule instanceof CSSImportRule) digStyle(rule.styleSheet);\n        else {\n            let m = /\\.Ymacs-Theme-([\\p{L}0-9_-]+)/u.exec(rule.selectorText);\n            if (m) {\n                if (themes.indexOf(m[1]) < 0) themes.push(m[1]);\n            }\n        }\n    }\n}\nfunction $08a06a2e99accb03$var$fuzzy_regexp(query) {\n    return new RegExp([\n        ...query\n    ].map((ch)=>{\n        ch = ch.replace(/[\\]\\[\\}\\{\\)\\(\\*\\+\\?\\.\\\\\\^\\$\\|]/ug, \"\\\\$&\").replace(/[\\s_-]/ug, \"[\\\\s_-]\");\n        return `(${ch})(.*?)`;\n    }).join(\"\"), \"guid\");\n}\nfunction $08a06a2e99accb03$export$acebde4da3d957e6(candidates, query) {\n    query = query.trim();\n    if (!query) return candidates;\n    let query_rx = $08a06a2e99accb03$var$fuzzy_regexp(query);\n    let word_rx = /(?<![\\p{L}\\p{N}])/uy;\n    let results = [];\n    candidates.forEach((item)=>{\n        let label = typeof item == \"string\" ? item : item.label;\n        let value = typeof item == \"string\" ? item : item.value;\n        query_rx.lastIndex = 0;\n        while(true){\n            let m = query_rx.exec(label);\n            if (!m) break;\n            let score = 0;\n            let hil = \"\";\n            let j = 0;\n            for(let i = 1; i < m.indices.length;){\n                let [li_beg, li_end] = m.indices[i++];\n                let [fi_beg, fi_end] = m.indices[i++];\n                score += fi_end - fi_beg;\n                word_rx.lastIndex = li_beg;\n                if (word_rx.test(label)) score -= 2;\n                hil += $08a06a2e99accb03$export$cb0933279c36a66b.htmlEscape(label.substring(j, li_beg)) + `<b>${label.substring(li_beg, li_end)}</b>`;\n                j = li_end;\n            }\n            if (j != null) hil += $08a06a2e99accb03$export$cb0933279c36a66b.htmlEscape(label.substr(j));\n            results.push({\n                label: $08a06a2e99accb03$export$cb0933279c36a66b.htmlSafe(hil),\n                value: value,\n                score: score\n            });\n            query_rx.lastIndex = m.index + 1;\n        }\n    });\n    return results.sort((a, b)=>a.score - b.score).reduce((a, item)=>{\n        if (!a.some((el)=>el.value == item.value)) a.push(item);\n        return a;\n    }, []);\n}\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\nclass $c35b14db10f870d1$export$57a830c2aa4f8317 {\n    constructor({ pos: pos = null, editor: editor = null, before: before = false, name: name = null } = {}){\n        this.position = pos;\n        this.editor = editor;\n        this.before = before;\n        this.name = name;\n        this.editor.markers.push(this);\n        this.rowcol = null;\n        this.onChange = [];\n    }\n    destroy() {\n        (0, $08a06a2e99accb03$export$cd7f480d6b8286c3)(this.editor.markers, this);\n        this.editor = null;\n    }\n    editorChange(pos, diff, min) {\n        var p = this.position;\n        if (this.before) --p;\n        if (diff != 0 && pos <= p) {\n            this.rowcol = null;\n            this.position += diff;\n            if (this.position < min) this.position = min;\n            this.callHooks(this.onChange, this.position);\n        }\n    }\n    callHooks(a, arg) {\n        for(var i = a.length; --i >= 0;)a[i].call(this.editor, arg);\n    }\n    getPosition() {\n        return this.position;\n    }\n    valueOf() {\n        return this.position;\n    }\n    setPosition(pos, noHooks, force) {\n        if (force || this.position != pos) {\n            this.rowcol = null;\n            this.position = pos;\n            if (!noHooks) this.callHooks(this.onChange, this.position);\n        }\n    }\n    getRowCol() {\n        return this.rowcol || (this.rowcol = this.editor._positionToRowCol(this.position));\n    }\n    swap(other, noHooks, force) {\n        var tmp = this.getPosition();\n        this.setPosition(other.getPosition(), noHooks, force);\n        other.setPosition(tmp, noHooks, force);\n    }\n}\n\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\nlet $d9a61832b63ddf79$var$KEYMAPS = Object.create(null);\nclass $d9a61832b63ddf79$export$6b6e17e3540cb3d2 {\n    constructor(keys){\n        this.definitions = Object.create(null);\n        this.defineKeys(keys);\n    }\n    static define(name, keys) {\n        let obj = name && $d9a61832b63ddf79$var$KEYMAPS[name];\n        if (!obj) {\n            obj = keys instanceof this ? keys : new this(keys);\n            if (name) {\n                $d9a61832b63ddf79$var$KEYMAPS[name] = obj;\n                obj.name = name;\n            }\n        }\n        return obj;\n    }\n    static get(name) {\n        return $d9a61832b63ddf79$var$KEYMAPS[name];\n    }\n    static parseKey(orig) {\n        let key = {\n            str: \"\"\n        };\n        let p = orig;\n        for(;;){\n            let m = /^([CMS])-/.exec(p);\n            if (m) {\n                if (m[1] == \"C\") key.ctrlKey = true;\n                if (m[1] == \"M\") key.metaKey = true;\n                if (m[1] == \"S\") key.shiftKey = true;\n                p = p.substr(2);\n            } else {\n                key.key = p == \"Space\" ? \" \" : p.length == 1 ? p.toLowerCase() : p;\n                break;\n            }\n        }\n        if (key.ctrlKey) key.str += \"C-\";\n        if (key.metaKey) key.str += \"M-\";\n        if (key.shiftKey) key.str += \"S-\";\n        key.str += p;\n        return key;\n    }\n    static unparseKey(ev) {\n        var key, a = [];\n        if (\"wheelDelta\" in ev) key = ev.wheelDelta > 0 ? \"WheelUp\" : \"WheelDown\";\n        else {\n            key = ev.key;\n            if (key == \" \" || key == \"Unidentified\" && ev.code == \"Space\") key = \"Space\";\n            if (key.length == 1) key = key.toLowerCase();\n        }\n        if (ev.ctrlKey) a.push(\"C\");\n        if (ev.altKey || ev.ymacsMeta) a.push(\"M\");\n        if (ev.shiftKey && (key.length > 1 || key.toLowerCase() != key.toUpperCase())) a.push(\"S\");\n        a.sort();\n        a.push(key);\n        return a.join(\"-\");\n    }\n    defineKey(key, func, args) {\n        if (func instanceof Array) {\n            args = func.slice(1);\n            func = func[0];\n        }\n        key = key.trim().split(/\\s*&&\\s*/);\n        if (key.length > 1) key.forEach((key)=>this.defineKey(key, func, args));\n        else {\n            key = key[0].trim();\n            var dfn = this.definitions;\n            if (key.indexOf(\" \") >= 0) {\n                var a = key.split(/\\s+/);\n                key = a.pop();\n                a.forEach((key)=>{\n                    key = this.parseKey(key).str;\n                    if (!dfn[key]) dfn[key] = {};\n                    dfn = dfn[key];\n                });\n            }\n            key = this.parseKey(key);\n            dfn[key.str] = [\n                func,\n                args\n            ];\n        }\n    }\n    defineKeys(map) {\n        Object.keys(map).forEach((key)=>this.defineKey(key, map[key]));\n    }\n    getHandler(keys) {\n        let handler = null, def = this.definitions;\n        for (let key of keys){\n            let tmp = handler ? handler[key] : def[key];\n            if (tmp) {\n                handler = tmp;\n                if (Array.isArray(handler)) break;\n            } else {\n                handler = null;\n                break;\n            }\n        }\n        return handler;\n    }\n    attached() {}\n    detached() {}\n}\n$d9a61832b63ddf79$export$6b6e17e3540cb3d2.prototype.parseKey = $d9a61832b63ddf79$export$6b6e17e3540cb3d2.parseKey;\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\nfunction $541ef653595620bf$export$c411e7bd03572a3a(why) {\n    this.message = why;\n}\n\n\nfunction $92bab0a532b3076f$export$1c2a1b3d78098030(args, func) {\n    if (arguments.length == 1) {\n        func = args;\n        args = null;\n    } else {\n        let documentation;\n        if (!(func instanceof Function)) {\n            documentation = func;\n            func = arguments[2];\n            func.ymacsDoc = documentation;\n        }\n    }\n    func.ymacsInteractive = true;\n    if (args != null) {\n        if (!Array.isArray(args)) {\n            var m = /^[\\^\\@\\*]+/.exec(args);\n            if (m) {\n                m = m[0];\n                args = args.substr(m.length);\n                if (m.indexOf(\"^\") >= 0) func.ymacsMarkExtend = true;\n                if (m.indexOf(\"*\") >= 0) func.ymacsWarnReadonly = true;\n                if (m.indexOf(\"@\") >= 0) func.ymacsSelectFrame = true;\n            }\n            if (args) args = args.split(/\\n+/);\n        }\n        if (args) {\n            let collect;\n            let execute = function(...rest) {\n                collect = collect.concat(rest);\n                return this.callInteractively(func, collect, true);\n            };\n            while(args.length > 0){\n                let next = execute;\n                execute = $92bab0a532b3076f$var$createArgumentFunction(args.pop(), function(...rest) {\n                    collect = collect.concat(rest);\n                    return next.call(this);\n                });\n            }\n            func.ymacsCallInteractively = function() {\n                collect = [];\n                return execute.call(this);\n            };\n        }\n    }\n    return func;\n}\nfunction $92bab0a532b3076f$export$8c34793404b3efcb(func) {\n    return $92bab0a532b3076f$export$1c2a1b3d78098030(\"p\", function(n) {\n        if (n == null) n = 1;\n        while(n-- > 0)func.call(this);\n    });\n}\nvar $92bab0a532b3076f$var$$TRUE = function() {};\n$92bab0a532b3076f$var$$TRUE.toString = function() {\n    return \"\";\n};\n$92bab0a532b3076f$var$$TRUE.empty = true;\n/* -----[ argument reader functions ]----- */ function $92bab0a532b3076f$var$prompt(arg) {\n    var pr = this.getPrefixArg(true);\n    if (pr) arg = pr + \" \" + arg;\n    return this.cmd(\"minibuffer_prompt\", arg);\n}\nfunction $92bab0a532b3076f$var$read_function_name(arg, cont) {\n    console.log(\"read_function_name\", arg);\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_function\", cont);\n// XXX: enforce it!\n}\nfunction $92bab0a532b3076f$var$read_existing_buffer_name(arg, cont) {\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_buffer\", cont);\n// XXX: enforce it!\n}\nfunction $92bab0a532b3076f$var$read_buffer_name(arg, cont) {\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_buffer\", cont);\n}\nfunction $92bab0a532b3076f$var$read_character(arg, cont) {}\nfunction $92bab0a532b3076f$var$read_command_name(arg, cont) {\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_command\", cont);\n// XXX: enforce it!\n}\nfunction $92bab0a532b3076f$var$get_point(arg, cont) {\n    return cont.call(this, this.point());\n}\nfunction $92bab0a532b3076f$var$get_mouse_event(arg, cont) {}\nfunction $92bab0a532b3076f$var$irrelevant(arg, cont) {\n    return cont.call(this, null);\n}\nfunction $92bab0a532b3076f$var$read_key_sequence(arg, cont) {}\nfunction $92bab0a532b3076f$var$read_key_sequence2(arg, cont) {}\nfunction $92bab0a532b3076f$var$get_mark(arg, cont) {\n    return cont.call(this, this.markMarker.getPosition());\n}\nfunction $92bab0a532b3076f$var$read_arbitrary_text(arg, cont) {\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_string\", null, cont);\n}\nfunction $92bab0a532b3076f$var$read_number(arg, cont) {\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_number\", cont);\n}\nfunction $92bab0a532b3076f$var$read_number_or_prefix(arg, cont) {\n    var n = parseInt(this.getPrefixArg(), 10);\n    if (!isNaN(n)) return cont.call(this, n);\n    else return $92bab0a532b3076f$var$read_number.call(this, arg, cont);\n}\nfunction $92bab0a532b3076f$var$get_numeric_prefix(arg, cont) {\n    var n = parseInt(this.getPrefixArg(), 10);\n    if (isNaN(n)) n = null;\n    return cont.call(this, n);\n}\nfunction $92bab0a532b3076f$var$get_raw_prefix(arg, cont) {\n    arg = this.getPrefixArg();\n    if (arg === \"\") arg = $92bab0a532b3076f$var$$TRUE;\n    return cont.call(this, arg);\n}\nfunction $92bab0a532b3076f$var$get_point_and_mark(arg, cont) {\n    var r = this.getRegion();\n    return cont.call(this, r.begin, r.end);\n}\nfunction $92bab0a532b3076f$var$read_key_sequence3(arg, cont) {}\nfunction $92bab0a532b3076f$var$read_variable_name(arg, cont) {\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_variable\", cont);\n}\nfunction $92bab0a532b3076f$var$read_existing_file_name(arg, cont) {\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_existing_file\", cont);\n}\nfunction $92bab0a532b3076f$var$read_file_name(arg, cont) {\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_file\", cont);\n}\nfunction $92bab0a532b3076f$var$read_file_or_directory_name(arg, cont) {\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_file_or_directory\", cont);\n}\nfunction $92bab0a532b3076f$var$read_existing_directory_name(arg, cont) {\n    $92bab0a532b3076f$var$prompt.call(this, arg);\n    return this.cmd(\"minibuffer_read_directory\", cont);\n}\nvar $92bab0a532b3076f$var$ARG_READERS = {\n    a: $92bab0a532b3076f$var$read_function_name,\n    b: $92bab0a532b3076f$var$read_existing_buffer_name,\n    B: $92bab0a532b3076f$var$read_buffer_name,\n    c: $92bab0a532b3076f$var$read_character,\n    C: $92bab0a532b3076f$var$read_command_name,\n    d: $92bab0a532b3076f$var$get_point,\n    e: $92bab0a532b3076f$var$get_mouse_event,\n    i: $92bab0a532b3076f$var$irrelevant,\n    k: $92bab0a532b3076f$var$read_key_sequence,\n    K: $92bab0a532b3076f$var$read_key_sequence2,\n    m: $92bab0a532b3076f$var$get_mark,\n    M: $92bab0a532b3076f$var$read_arbitrary_text,\n    n: $92bab0a532b3076f$var$read_number,\n    N: $92bab0a532b3076f$var$read_number_or_prefix,\n    p: $92bab0a532b3076f$var$get_numeric_prefix,\n    P: $92bab0a532b3076f$var$get_raw_prefix,\n    r: $92bab0a532b3076f$var$get_point_and_mark,\n    s: $92bab0a532b3076f$var$read_arbitrary_text,\n    U: $92bab0a532b3076f$var$read_key_sequence3,\n    v: $92bab0a532b3076f$var$read_variable_name,\n    f: $92bab0a532b3076f$var$read_existing_file_name,\n    F: $92bab0a532b3076f$var$read_file_name,\n    G: $92bab0a532b3076f$var$read_file_or_directory_name,\n    D: $92bab0a532b3076f$var$read_existing_directory_name\n};\nfunction $92bab0a532b3076f$var$createArgumentFunction(arg, cont) {\n    let reader = $92bab0a532b3076f$var$ARG_READERS[arg.charAt(0)];\n    arg = arg.substr(1);\n    return function() {\n        return reader.call(this, arg, cont);\n    };\n}\n\n\n// This is the default keymap, as configured in\n// Ymacs_Buffer::makeDefaultKeymap.  It follows closely the standard\n// Emacs keybindings, with some small deviations that match my taste\n// (search for \"my stuff\" below).\n// It would be nice to have more options, such as an Eclipse keymap,\n// or Visual Studio -- but I'm not familiar with any of them.\n// Contributions welcome.\n// A keymap inherits from Ymacs_Keymap and should define its bindings\n// in D.KEYS.  They can also define a defaultHandler property to take\n// whatever action they consider necessary -- for example the Isearch\n// keymap will, by default, print the entered character in the\n// minibuffer and trigger a search action.  Isearch mode is almost\n// completely defined in a keymap -- with the minor note that\n// isearch_forward and isearch_backward are assigned below to key\n// combinations; once pressed, they will push the Isearch keymap onto\n// the buffer's keymap stack, and it will be used until isearch is\n// ended.\n/* KEY DEFINITIONS.  A key is generally defined in standard Emacs\r\n   notation, with the following notes:\r\n\r\n   - it is possible to define multiple keys at once for the same\r\n     operation, by using the \"&&\" combination (separate with spaces\r\n     from the actual keys)\r\n\r\n   - some special characters are named literally (see event.key\r\n     https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key)\r\n\r\n   Normally you would define commands using Ymacs_Buffer.newCommands\r\n   (see ymacs-commands.js) and specify the command name for key\r\n   bindings, but you can directly use a function as well:\r\n\r\n   \"C-8\": function() {\r\n     alert(\"You pressed CTRL-8\");\r\n   }\r\n\r\n   It is advised to define commands for more than simple cases, for\r\n   two reasons:\r\n\r\n   1. they can be used for \"non-interactive\" calls too\r\n\r\n   2. the command name is saved in this.currentCommand /\r\n      this.previousCommand, which is useful in a number of cases.\r\n\r\n*/ let $2a60837ab2b03436$var$minibuffer_keys = {\n    // movement\n    \"ArrowLeft   && C-b\": \"backward_char\",\n    \"ArrowRight  && C-f\": \"forward_char\",\n    \"Home\": \"beginning_of_indentation_or_line\",\n    \"End && C-e\": \"end_of_line\",\n    \"C-a\": \"beginning_of_line\",\n    \"C-Home && M-<\": \"beginning_of_buffer\",\n    \"C-End && M->\": \"end_of_buffer\",\n    \"C-ArrowRight && M-f\": \"forward_word\",\n    \"C-ArrowLeft && M-b\": \"backward_word\",\n    // transient mark\n    \"S-ArrowLeft     && S-C-b\": \"backward_char_mark\",\n    \"S-ArrowRight    && S-C-f\": \"forward_char_mark\",\n    \"S-C-ArrowRight  && S-M-f\": \"forward_word_mark\",\n    \"S-C-ArrowLeft   && S-M-b\": \"backward_word_mark\",\n    \"S-Home\": \"beginning_of_indentation_or_line_mark\",\n    \"S-C-a\": \"beginning_of_line_mark\",\n    \"S-End && S-C-e\": \"end_of_line_mark\",\n    \"S-C-Home\": \"beginning_of_buffer_mark\",\n    \"S-C-End\": \"end_of_buffer_mark\",\n    // basic editing\n    \"Backspace\": \"backward_delete_char\",\n    \"Delete && C-d\": \"delete_char\",\n    \"M-d && C-Delete\": \"kill_word\",\n    \"C-Backspace && M-Backspace && M-Delete\": \"backward_kill_word\",\n    \"C-k\": \"kill_line\",\n    \"C-y && S-Insert\": \"yank\",\n    \"M-y\": \"yank_pop\",\n    \"C-Space\": \"set_mark_command\",\n    \"C-x C-x\": \"exchange_point_and_mark\",\n    \"C-w\": \"kill_region\",\n    \"M-t\": \"transpose_words\",\n    \"C-t\": \"transpose_chars\",\n    \"M-w\": \"copy_region_as_kill\",\n    \"M-c\": \"capitalize_word\",\n    \"M-u\": \"upcase_word\",\n    \"M-l\": \"downcase_word\",\n    \"F11\": \"nuke_trailing_whitespace\",\n    \"C-/ && C-x u && C-_ && C-z\": \"undo\",\n    \"Insert\": \"overwrite_mode\",\n    \"M-/\": \"dabbrev_expand\",\n    \"C-g\": \"keyboard_quit\",\n    \"Escape\": \"keyboard_quit\",\n    // \"Escape\"                                  : \"_next_is_meta\",\n    // \"M-Escape Escape\"                         : \"keyboard_quit\",\n    \"C-S-y && C-v\": \"yank_from_operating_system\",\n    \"M-S-w\": \"copy_for_operating_system\",\n    \"C-c /\": \"close_last_xml_tag\",\n    \"S-Backspace\": \"backward_delete_whitespace\",\n    \"S-Delete\": \"delete_whitespace\",\n    \"C-x =\": \"what_cursor_position\"\n};\nlet $2a60837ab2b03436$var$emacs_keys = Object.assign({}, $2a60837ab2b03436$var$minibuffer_keys, {\n    // movement\n    \"ArrowUp     && C-p\": \"backward_line\",\n    \"ArrowDown   && C-n\": \"forward_line\",\n    \"ArrowLeft   && C-b\": \"backward_char\",\n    \"ArrowRight  && C-f\": \"forward_char\",\n    \"Home\": \"beginning_of_indentation_or_line\",\n    \"End && C-e\": \"end_of_line\",\n    \"C-a\": \"beginning_of_line\",\n    \"C-Home && M-<\": \"beginning_of_buffer\",\n    \"C-End && M->\": \"end_of_buffer\",\n    \"C-ArrowRight && M-f\": \"forward_word\",\n    \"C-ArrowLeft && M-b\": \"backward_word\",\n    \"C-ArrowDown\": \"forward_paragraph\",\n    \"C-ArrowUp\": \"backward_paragraph\",\n    \"M-h\": \"mark_paragraph\",\n    \"C-l\": \"recenter_top_bottom\",\n    \"PageUp\": \"scroll_up_half\",\n    \"PageDown\": \"scroll_down_half\",\n    \"WheelUp\": \"scroll_up\",\n    \"WheelDown\": \"scroll_down\",\n    // transient mark\n    \"S-ArrowUp       && S-C-p\": \"backward_line_mark\",\n    \"S-ArrowDown     && S-C-n\": \"forward_line_mark\",\n    \"S-ArrowLeft     && S-C-b\": \"backward_char_mark\",\n    \"S-ArrowRight    && S-C-f\": \"forward_char_mark\",\n    \"S-C-ArrowRight  && S-M-f\": \"forward_word_mark\",\n    \"S-C-ArrowLeft   && S-M-b\": \"backward_word_mark\",\n    \"S-C-ArrowDown\": \"forward_paragraph_mark\",\n    \"S-C-ArrowUp\": \"backward_paragraph_mark\",\n    \"S-Home\": \"beginning_of_indentation_or_line_mark\",\n    \"S-C-a\": \"beginning_of_line_mark\",\n    \"S-End && S-C-e\": \"end_of_line_mark\",\n    \"S-C-Home\": \"beginning_of_buffer_mark\",\n    \"S-C-End\": \"end_of_buffer_mark\",\n    // basic editing\n    \"Backspace\": \"backward_delete_char\",\n    \"Delete && C-d\": \"delete_char\",\n    \"Enter && C-m\": \"newline\",\n    \"M-d && C-Delete\": \"kill_word\",\n    \"C-Backspace && M-Backspace && M-Delete\": \"backward_kill_word\",\n    \"C-k\": \"kill_line\",\n    \"C-y && S-Insert\": \"yank\",\n    \"M-y\": \"yank_pop\",\n    \"C-Space\": \"set_mark_command\",\n    \"C-x C-x\": \"exchange_point_and_mark\",\n    \"C-w\": \"kill_region\",\n    \"M-t\": \"transpose_words\",\n    \"C-t\": \"transpose_chars\",\n    \"C-x C-t\": \"transpose_lines\",\n    \"M-w\": \"copy_region_as_kill\",\n    \"M-c\": \"capitalize_word\",\n    \"M-u\": \"upcase_word\",\n    \"M-l\": \"downcase_word\",\n    \"F11\": \"nuke_trailing_whitespace\",\n    \"Tab\": \"indent_line\",\n    \"C-M-\\\\\": \"indent_region\",\n    \"M-q\": \"fill_paragraph\",\n    \"C-/ && C-x u && C-_ && C-z\": \"undo\",\n    \"Insert\": \"overwrite_mode\",\n    \"M-s\": \"center_line\",\n    \"M-/\": \"dabbrev_expand\",\n    \"C-s\": \"isearch_forward\",\n    \"C-r\": \"isearch_backward\",\n    \"C-S-s\": \"isearch_yank_word_or_char\",\n    \"M-C-s\": \"isearch_forward_regexp\",\n    \"M-C-r\": \"isearch_backward_regexp\",\n    \"M-%\": \"query_replace\",\n    \"C-M-%\": \"query_replace_regexp\",\n    \"C-u\": \"universal_argument\",\n    \"M-g\": \"goto_line\",\n    \"C-x h\": \"mark_whole_buffer\",\n    \"C-g\": \"keyboard_quit\",\n    \"M-^\": \"delete_indentation\",\n    \"M-;\": \"comment_dwim\",\n    \"C-x =\": \"what_cursor_position\",\n    \"C-x f\": \"set_fill_column\",\n    \"C-x C-\\\\\": \"goto_last_change\",\n    // vertical editing\n    \"C-x r t\": \"string_rectangle\",\n    \"C-x r c\": \"clear_rectangle\",\n    \"C-x r k\": \"kill_rectangle\",\n    \"C-x r y\": \"yank_rectangle\",\n    // buffers\n    \"C-x C-ArrowRight && C-x ArrowRight && C-Tab\": \"next_buffer\",\n    \"C-x C-ArrowLeft && C-x ArrowLeft && C-S-Tab\": \"previous_buffer\",\n    \"C-x b\": \"switch_to_buffer\",\n    \"C-x k\": \"kill_buffer\",\n    // frames\n    \"C-x 0\": \"delete_frame\",\n    \"C-x 1\": \"delete_other_frames\",\n    \"C-x 2\": \"split_frame_vertically\",\n    \"C-x 3\": \"split_frame_horizontally\",\n    \"C-x o && M-o\": \"other_frame\",\n    \"C-x l\": \"toggle_line_numbers\",\n    // eval\n    \"M-x\": \"execute_extended_command\",\n    \"C-S-y && C-v\": \"yank_from_operating_system\",\n    \"M-S-w\": \"copy_for_operating_system\",\n    // my stuff, sorry if these have different meanings in the standard Emacs keys\n    \"M-S-y\": \"yank_shift\",\n    \"C-c /\": \"close_last_xml_tag\",\n    \"S-Backspace\": \"backward_delete_whitespace\",\n    \"S-Delete\": \"delete_whitespace\",\n    \"C-M-d\": \"delete_region_or_line\",\n    \"M-Enter\": \"start_next_paragraph\",\n    \"C-M-|\": \"cperl_lineup\",\n    \"C-F4\": \"kill_buffer\",\n    \"M-ArrowLeft\": [\n        \"windmove\",\n        \"left\"\n    ],\n    \"M-ArrowRight\": [\n        \"windmove\",\n        \"right\"\n    ],\n    \"M-ArrowUp\": [\n        \"windmove\",\n        \"up\"\n    ],\n    \"M-ArrowDown\": [\n        \"windmove\",\n        \"down\"\n    ],\n    \"C-x e\": \"kmacro_end_and_call_macro\",\n    \"C-x (\": \"kmacro_start_macro\",\n    \"C-x )\": \"kmacro_end_macro\",\n    // file system commands\n    \"C-x C-f\": \"find_file\",\n    \"C-x C-w\": \"write_file\",\n    \"C-x C-s\": \"save_buffer\",\n    \"C-x s\": \"save_some_buffers\",\n    \"C-x r w\": \"window_configuration_to_register\",\n    \"C-x r j\": \"jump_to_register\",\n    \"C-h m\": \"describe_mode\"\n});\nlet $2a60837ab2b03436$export$649e07e86b62d08f = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"emacs_mb\", $2a60837ab2b03436$var$minibuffer_keys);\n$2a60837ab2b03436$export$649e07e86b62d08f.defaultHandler = [\n    \"self_insert_command\"\n];\nlet $2a60837ab2b03436$export$e144e07a20daa9d = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"emacs\", $2a60837ab2b03436$var$emacs_keys);\n$2a60837ab2b03436$export$e144e07a20daa9d.defaultHandler = [\n    \"self_insert_command\"\n];\nlet $2a60837ab2b03436$export$7f1c7eed09402475 = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"universal_arg\", {});\n$2a60837ab2b03436$export$7f1c7eed09402475.defaultHandler = [\n    (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function() {\n        var ev = this.interactiveEvent();\n        var ch = ev.key;\n        var prefix = this.getPrefixArg(true);\n        if ((/^[0-9]$/.test(ch) || ch === \"-\" && prefix === \"\") && !ev.altKey && !ev.ctrlKey) {\n            prefix += ch;\n            this.setPrefixArg(prefix);\n            if (!this.isMinibuffer) this.whenMinibuffer(function(mb) {\n                mb.cmd(\"insert\", \" \", ch);\n            });\n            return true;\n        }\n        this.popKeymap($2a60837ab2b03436$export$7f1c7eed09402475);\n        return false;\n    })\n];\n$2a60837ab2b03436$export$7f1c7eed09402475.attached = (buffer)=>buffer.setPrefixArg(\"\");\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\nclass $9e9d7d2dbe50ab17$export$bdebb5ddaa01123f extends (0, $08a06a2e99accb03$export$76712d54f90f7348) {\n    constructor({ buffer: buffer }){\n        super(...arguments);\n        this.buffer = buffer;\n        this.reset();\n    }\n    reset() {\n        this.props = [];\n    }\n    insertLine(row) {\n        if (this.props.length < row) this.props[row] = null;\n        else this.props.splice(row, 0, null);\n    }\n    deleteLine(row) {\n        this.props.splice(row, 1);\n    }\n    replaceLine(row, text) {\n        var p = this.props[row];\n        if (p && p.length > text.length) // remove extra-properties\n        p.splice(text.length);\n    }\n    addLineProps(row, i, j, prop, val) {\n        var p = this.props, o, changed = false;\n        if (i < j) {\n            p = p[row] || (p[row] = []);\n            while(i < j){\n                o = p[i] || (p[i] = {});\n                if (o[prop] != val) changed = true;\n                o[prop] = val;\n                ++i;\n            }\n            if (changed) this.callHooks(\"onChange\", row);\n        }\n        return changed;\n    }\n    removeLineProps(row, i, j, prop) {\n        var p = this.props[row], o, changed = false;\n        if (p && i < j) {\n            while(i < j){\n                o = p[i];\n                if (o && prop in o) {\n                    changed = true;\n                    delete o[prop];\n                }\n                ++i;\n            }\n            if (changed) this.callHooks(\"onChange\", row);\n        }\n        return changed;\n    }\n    spliceLineProps(row, i, diff) {\n        let p = this.props[row];\n        if (p) {\n            if (diff > 0) p.splice(i, 0, ...new Array(diff));\n            else if (diff < 0) p.splice(i, -diff);\n        }\n    }\n    // this uses the \"css\" text property to intercalate <span class=\"$css\"> ... </span> tags in the given text.\n    // \"css\" properties are added as the tokenizer parses the code and sends onFoundToken events.\n    //\n    // XXX: this function will be called a lot of times; seems complicated for what it does. Figure out if it can be\n    // optimized.\n    //\n    // Update: the mess got bigger once I decided to embed the caret in the text, rather than have it absolutely\n    // positioned (which seems to be the only practical way to position the cursor at the correct location).  It is\n    // ESSENTIAL that the start tag of the element that defines the caret ends with \"Ymacs-caret'>\", so that the\n    // frame widget can find it.\n    getLineHTML(row, text, caret) {\n        var p = this.props[row];\n        if (caret === null) {\n            if (text == \"\") return \"<br/>\";\n            if (!p || p.length == 0) return (0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(text);\n        } else {\n            if (text == \"\") return \"<span class='Ymacs-caret'>&nbsp;</span>\";\n            if (!p || p.length == 0) {\n                if (caret === text.length) return (0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(text) + \"<span class='Ymacs-caret'>&nbsp;</span>\";\n                return (0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(text.substr(0, caret)) + \"<span class='Ymacs-caret'>\" + (0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(text.charAt(caret)) + \"</span>\" + (0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(text.substr(caret + 1));\n            }\n        }\n        var i = 0, n = text.length, last = null, o, ret = \"\", ch;\n        while(i < n){\n            o = p[i];\n            o = o && o.css;\n            if (i === caret) o = o ? o + \" Ymacs-caret\" : \"Ymacs-caret\";\n            if (o && o != last) {\n                if (last) ret += \"</a>\";\n                ret += \"<a \";\n                let prev = o;\n                o = o.replace(/:href-([^\\s]*)/g, function(s, p) {\n                    if (p) ret += `href=\"${p}\" `;\n                    return \"\";\n                });\n                ret += \"class='\" + o + \"'>\";\n                o = prev;\n            } else if (!o && last) ret += \"</a>\";\n            last = o;\n            // XXX: Should have used a hash rather than a\n            // switch statement?  I'm not sure but I have\n            // a feeling that switch is faster.\n            ch = text.charAt(i);\n            switch(ch){\n                case \"<\":\n                    ret += \"&lt;\";\n                    break;\n                case \">\":\n                    ret += \"&gt;\";\n                    break;\n                case \"&\":\n                    ret += \"&amp;\";\n                    break;\n                default:\n                    ret += ch;\n                    break;\n            }\n            ++i;\n        }\n        if (last) ret += \"</a>\";\n        if (i === caret) // caret is at EOL\n        ret += \"<span class='Ymacs-caret'>&nbsp;</span>\";\n        return ret;\n    }\n}\n\n\n\n\nlet $5e779a545e33325b$var$GLOBAL_VARS = {\n    case_fold_search: null,\n    case_replace: true,\n    line_movement_requested_col: 0,\n    fill_column: 78,\n    tab_width: 8,\n    indent_level: 4,\n    sticky_mark: false,\n    // syntax variables\n    syntax_word: /^[\\p{N}\\p{L}]$/u,\n    syntax_capitalize_word: /([\\p{N}\\p{L}])([\\p{N}\\p{L}]*)/ug,\n    syntax_word_dabbrev: /^[\\p{N}_$\\p{L}]$/u,\n    syntax_word_sexp: /^[\\p{N}_$\\p{L}]$/u,\n    syntax_paragraph_sep: /\\n(?:[^\\S\\r\\n]*\\n)+/g\n};\nconst $5e779a545e33325b$var$MAX_UNDO_RECORDS = 50000; // XXX: should we not limit?\nfunction $5e779a545e33325b$var$setq(key, val) {\n    if (typeof key == \"string\") {\n        if (val === undefined) delete this[key];\n        else this[key] = val;\n        if (val instanceof Function) val.ymacsCommand = key;\n        return val;\n    } else {\n        var changed = Object.create(null);\n        for(var i in key){\n            changed[i] = this[i];\n            $5e779a545e33325b$var$setq.call(this, i, key[i]);\n        }\n        return changed;\n    }\n}\nfunction $5e779a545e33325b$var$MRK(x) {\n    return x instanceof (0, $c35b14db10f870d1$export$57a830c2aa4f8317) ? x.getPosition() : x;\n}\nclass $5e779a545e33325b$export$df331bdfc76955b4 extends (0, $08a06a2e99accb03$export$76712d54f90f7348) {\n    static options = {\n        name: \"*scratch*\",\n        code: \"\",\n        ymacs: null,\n        tokenizer: null\n    };\n    static COMMANDS = Object.create(null);\n    static newCommands(...args) {\n        return $5e779a545e33325b$var$setq.apply(this.COMMANDS, args);\n    }\n    static replaceCommands(cmds) {\n        this.COMMANDS = Object.assign(Object.create(null), this.COMMANDS);\n        let replacements = Object.create(null);\n        Object.keys(cmds).forEach((oldcmd)=>{\n            let newcmd = cmds[oldcmd];\n            if (typeof newcmd == \"string\") newcmd = this.COMMANDS[newcmd];\n            replacements[oldcmd] = newcmd;\n        });\n        return this.newCommands(replacements);\n    }\n    static newMode(name, activate) {\n        let modevar = \"*\" + name + \"*\", hookvar = modevar + \"hooks\";\n        $5e779a545e33325b$export$df331bdfc76955b4.setGlobal(hookvar, []);\n        this.COMMANDS[name] = (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"P\", function(force) {\n            let status = this.getq(modevar);\n            if (status) // currently active\n            {\n                if (force !== true) {\n                    // deactivate\n                    this.getq(hookvar).forEach((hook)=>hook.call(this, false));\n                    if (status instanceof Function) // clean-up\n                    status.call(this);\n                    this.setq(modevar, null);\n                    (0, $08a06a2e99accb03$export$cd7f480d6b8286c3)(this.modes, name);\n                }\n            } else // inactive\n            if (force !== false) {\n                let off = activate.apply(this, arguments);\n                if (!(off instanceof Function)) off = true;\n                this.setq(modevar, off);\n                this.modes.push(name);\n                this.getq(hookvar).forEach((hook)=>hook.call(this, true));\n            }\n            return status;\n        });\n    }\n    static getVariable(key) {\n        return $5e779a545e33325b$var$GLOBAL_VARS[key];\n    }\n    static setVariable() {\n        return $5e779a545e33325b$var$setq.apply($5e779a545e33325b$var$GLOBAL_VARS, arguments);\n    }\n    constructor(...args){\n        super(...args);\n        this.isMinibuffer = this instanceof $5e779a545e33325b$export$36a0d48d1b18d0fa;\n        this.COMMANDS = Object.assign(Object.create(null), this.COMMANDS);\n        this.name = this.o.name;\n        this.ymacs = this.o.ymacs;\n        this.tokenizer = this.o.tokenizer;\n        this.__savingExcursion = 0;\n        this.__preventUpdates = 0;\n        this.__preventUndo = 0;\n        this.__undoInProgress = 0;\n        this.__dirtyLines = [];\n        this.__undoQueue = [];\n        this.__undoPointer = 0;\n        this.markers = [];\n        this.caretMarker = this.createMarker(0, false, \"point\");\n        this.markMarker = this.createMarker(0, true, \"mark\");\n        this.matchData = [];\n        this.previousCommand = null;\n        this.currentCommand = null;\n        this.currentKeys = [];\n        this.variables = Object.create(null);\n        this.globalVariables = $5e779a545e33325b$var$GLOBAL_VARS;\n        this.modes = [];\n        this.caretMarker.onChange.push(function(pos) {\n            this._rowcol = this.caretMarker.getRowCol();\n            // XXX: this shouldn't be needed\n            if (!this.__preventUpdates) this.callHooks(\"onPointChange\", this._rowcol, this.point());\n        });\n        this._tokenizerEvents = {\n            \"onFoundToken\": this._on_tokenizerFoundToken.bind(this)\n        };\n        this._textProperties = new (0, $9e9d7d2dbe50ab17$export$bdebb5ddaa01123f)({\n            buffer: this\n        });\n        this._textProperties.addEventListener(\"onChange\", this._on_textPropertiesChange.bind(this));\n        this.keymap = [];\n        this.pushKeymap(this.makeDefaultKeymap());\n        this.setCode(this.o.code);\n        this._lastCommandWasKill = 0;\n    }\n    addModeHook(name, func) {\n        if (typeof func == \"string\") func = this.COMMANDS[func];\n        let hookvar = \"*\" + name + \"*hooks\";\n        this.getq(hookvar).pushUnique(func);\n    }\n    removeModeHook(name, func) {\n        if (typeof func == \"string\") func = this.COMMANDS[func];\n        let hookvar = \"*\" + name + \"*hooks\";\n        (0, $08a06a2e99accb03$export$cd7f480d6b8286c3)(this.getq(hookvar), func);\n    }\n    withVariables(vars, cont) {\n        var saved = this.variables;\n        this.variables = Object.assign(Object.create(this.variables), vars);\n        try {\n            if (cont instanceof Function) return cont.apply(this, [\n                ...arguments\n            ].slice(2));\n            else return this.cmdApply(cont, [\n                ...arguments\n            ].slice(2));\n        } finally{\n            this.variables = saved;\n        }\n    }\n    withCommands(cmds, cont) {\n        var saved = this.COMMANDS;\n        this.COMMANDS = Object.assign(Object.create(this.COMMANDS), cmds);\n        try {\n            if (cont instanceof Function) return cont.apply(this, [\n                ...arguments\n            ].slice(2));\n            else return this.cmdApply(cont, [\n                ...arguments\n            ].slice(2));\n        } finally{\n            this.COMMANDS = saved;\n        }\n    }\n    getVariable(name) {\n        return name in this.variables ? this.variables[name] : $5e779a545e33325b$var$GLOBAL_VARS[name];\n    }\n    setVariable() {\n        return $5e779a545e33325b$var$setq.apply(this.variables, arguments);\n    }\n    /* -----[ public API ]----- */ lastIndexOfRegexp(str, rx, caret, bound = 0) {\n        if (!rx.global) rx = new RegExp(rx.source, rx.flags + \"g\");\n        rx.lastIndex = bound;\n        let match;\n        while(true){\n            let pos = rx.lastIndex;\n            let m = rx.exec(str);\n            if (!m || rx.lastIndex > caret) break;\n            match = m;\n            match.after = rx.lastIndex;\n            if (rx.lastIndex <= pos) {\n                // this can happer when rx matches the empty string in the middle of an unicode\n                // surrogate pair (which we don't properly support for now). the browser will rewind\n                // lastIndex to the proper start of the code point (:-o I'm impressed!), so let's\n                // skip it to avoid an endless loop.\n                let skipOne = /[^]/ug;\n                skipOne.lastIndex = rx.lastIndex;\n                skipOne.exec(str);\n                rx.lastIndex = skipOne.lastIndex;\n            }\n        }\n        if (match) return this.matchData = match;\n    }\n    pushKeymap(keymap) {\n        if (keymap instanceof Array) keymap.forEach(this.pushKeymap, this);\n        else {\n            this.popKeymap(keymap);\n            this.keymap.push(keymap);\n            keymap.attached(this);\n        }\n    }\n    popKeymap(keymap) {\n        (0, $08a06a2e99accb03$export$cd7f480d6b8286c3)(this.keymap, keymap);\n        keymap.detached(this);\n    }\n    makeDefaultKeymap() {\n        return this.isMinibuffer ? (0, $2a60837ab2b03436$export$649e07e86b62d08f) : (0, $2a60837ab2b03436$export$e144e07a20daa9d);\n    }\n    signalError(text, isHtml, timeout) {\n        // Terminates a running macro\n        this.ymacs.indicateError();\n        this.callHooks(\"onMessage\", {\n            type: \"error\",\n            text: text,\n            isHtml: isHtml,\n            timeout: timeout\n        });\n    }\n    signalInfo(text, isHtml, timeout) {\n        this.callHooks(\"onMessage\", {\n            type: \"info\",\n            text: text,\n            isHtml: isHtml,\n            timeout: timeout\n        });\n    }\n    popupMessage(args) {\n        this.callHooks(\"onMessage\", args);\n    }\n    createMarker(pos, before, name) {\n        if (pos == null) pos = this.point();\n        return new (0, $c35b14db10f870d1$export$57a830c2aa4f8317)({\n            editor: this,\n            pos: pos,\n            name: name,\n            before: before\n        });\n    }\n    point() {\n        return this.caretMarker.getPosition();\n    }\n    dirty(dirty) {\n        if (dirty != null) {\n            this.__isDirty = dirty;\n            // XXX: what was this?\n            // this.__undoQueue.forEach(x => {\n            //     if (x.type !== 3) x.dirty = true;\n            // });\n            this.updateModeline();\n        }\n        return this.__isDirty;\n    }\n    setCode(code) {\n        // this.__code = code = code.replace(/\\t/g, \" \".repeat(this.getq(\"tab_width\")));\n        this.dirty(false);\n        this.__code = code;\n        this.__size = code.length;\n        this.__undoQueue = [];\n        this.__undoPointer = 0;\n        this.markers.map((m)=>m.setPosition(0, true, true));\n        this.code = code.split(/\\n/);\n        this._textProperties.reset();\n        if (this.tokenizer) this.tokenizer.reset();\n        this.callHooks(\"onResetCode\", this.code);\n        this.caretMarker.setPosition(0, false, true);\n        this.markMarker.setPosition(0, true);\n        this.forAllFrames((frame)=>{\n            frame.ensureCaretVisible();\n            frame.redrawModelineWithTimer();\n        });\n    }\n    setTokenizer(tok) {\n        if (this.tokenizer != null) this.tokenizer.removeEventListener(this._tokenizerEvents);\n        this.tokenizer = tok;\n        if (tok) {\n            tok.addEventListener(this._tokenizerEvents);\n            tok.reset();\n        } else {\n            this._textProperties.reset();\n            this.callHooks(\"onResetCode\", this.code);\n        }\n    }\n    getCode() {\n        return this.__code || (this.__code = this.code.join(\"\\n\"));\n    }\n    getCodeSize() {\n        if (this.__size) return this.__size;\n        var i = this.code.length, size = i > 0 ? -1 : 0;\n        while(--i >= 0)size += this.code[i].length + 1;\n        return this.__size = size;\n    }\n    getLine(row) {\n        if (row == null) row = this._rowcol.row;\n        return this.code[row];\n    }\n    charAtRowCol(row, col) {\n        let n = this.code.length;\n        if (row >= n--) return null;\n        var line = this.code[row];\n        if (col == line.length) return row == n ? null : \"\\n\";\n        return line.charAt(col);\n    }\n    charAt(point) {\n        if (point == null) point = this.point();\n        else {\n            point = $5e779a545e33325b$var$MRK(point);\n            if (point < 0) point += this.point();\n        }\n        var rc = this._positionToRowCol(point);\n        return this.charAtRowCol(rc.row, rc.col);\n    }\n    callInteractively(func, args, finalArgs) {\n        if (!args) args = [];\n        var cmd;\n        if (!(func instanceof Function)) {\n            cmd = func;\n            func = this.COMMANDS[func];\n        } else cmd = func.ymacsCommand || null;\n        if (func.ymacsCallInteractively && !finalArgs) // after prompting for eventual\n        // arguments, ymacsCallInteractively\n        // will actually call back again\n        // buffer's callInteractively, so we\n        // should STOP here.\n        return func.ymacsCallInteractively.apply(this, args);\n        this.currentCommand = cmd;\n        if (this.previousCommand != cmd) {\n            this.sameCommandCount(0);\n            if (cmd != \"undo\") this._placeUndoBoundary();\n        } else if (cmd != \"self_insert_command\" || this.sameCommandCount() % 20 == 0) {\n            if (cmd != \"undo\") this._placeUndoBoundary();\n        }\n        this.preventUpdates();\n        try {\n            this.callHooks(\"beforeInteractiveCommand\", cmd, func);\n            if (!func.ymacsMarkExtend && !this.getq(\"sticky_mark\")) this.clearTransientMark();\n            return func.apply(this, args);\n        } catch (ex) {\n            if (ex instanceof (0, $541ef653595620bf$export$c411e7bd03572a3a)) this.signalError(ex.message);\n            else throw ex;\n        } finally{\n            if (this.getq(\"sticky_mark\")) this.ensureTransientMark();\n            if (cmd != \"undo\") this.__undoPointer = this.__undoQueue.length;\n            this.resumeUpdates();\n            this.callHooks(\"afterInteractiveCommand\", cmd, func);\n            this.previousCommand = cmd;\n            this.sameCommandCount(1);\n            if (this.tokenizer) this.tokenizer.start();\n        }\n    }\n    resetOverwriteMode(om) {\n        if (arguments.length == 0) om = this.overwriteMode;\n        this.callHooks(\"onOverwriteMode\", this.overwriteMode = !om);\n        this.signalInfo(om ? \"Insert mode\" : \"Overwrite mode\");\n    }\n    getMinibuffer() {\n        return this.whenYmacs(function(ymacs) {\n            return ymacs.minibuffer;\n        });\n    }\n    getMinibufferFrame() {\n        return this.whenYmacs(function(ymacs) {\n            return ymacs.minibuffer_frame;\n        });\n    }\n    setMinibuffer(text) {\n        this.whenMinibuffer(function(mb) {\n            mb.setCode(text);\n            mb.cmd(\"end_of_buffer\");\n        });\n    }\n    cmd(cmd, ...args) {\n        return this.COMMANDS[cmd].apply(this, args);\n    }\n    cmdApply(cmd, args) {\n        return this.COMMANDS[cmd].apply(this, args);\n    }\n    forEachLine(func, begin = this.markMarker(), end = this.point()) {\n        begin = $5e779a545e33325b$var$MRK(begin);\n        end = $5e779a545e33325b$var$MRK(end);\n        if (end < begin) {\n            let tmp = begin;\n            begin = end;\n            end = tmp;\n        }\n        begin = this._positionToRowCol(begin);\n        end = this._positionToRowCol(end);\n        for(let i = begin.row; i <= end.row; ++i){\n            let c1 = i == begin.row ? begin.col : 0;\n            let c2 = i == end.row ? end.col : this.getLine(i).length;\n            func(i, c1, c2);\n        }\n    }\n    getActiveFrame() {\n        return this.whenYmacs(\"getActiveFrame\");\n    }\n    // This function receives a string and a continuation.  If\n    // there is an object property or variable named $what, then\n    // $cont is called in the context of this object and given the\n    // value of $what as first argument.  The returned value is\n    // passed back to caller.\n    //\n    // The continuation can also be a string, in which case it's\n    // assumed to be a method in the value of $what, thus called\n    // on it.\n    //\n    // This is a bit messy, but should work well as long as we\n    // don't use the same name for both an object property and a\n    // variable in this.variables.  Otherwise, the property takes\n    // precedence.\n    when(what, cont, ...args) {\n        what = this[what] || this.getq(what);\n        if (what != null) {\n            if (cont instanceof Function) return cont.call(this, what);\n            else return what[cont].apply(what, args);\n        }\n    }\n    // XXX: this is way too ugly. (15 years later: Oh Yeah.)\n    whenActiveFrame() {\n        var fr = this.getActiveFrame(); // miserable hack\n        if (fr.buffer === this) {\n            this.activeFrame = fr;\n            var a = [\n                \"activeFrame\",\n                ...arguments\n            ];\n            return this.when.apply(this, a);\n        } else this.activeFrame = null;\n    }\n    forAllFrames(cont) {\n        if (this.ymacs) this.ymacs.getBufferFrames(this).forEach(cont);\n    }\n    whenYmacs() {\n        var a = [\n            \"ymacs\",\n            ...arguments\n        ];\n        return this.when.apply(this, a);\n    }\n    whenMinibuffer(cont) {\n        // In fact, we should move when() into some base\n        // object... but which one?  JS doesn't have multiple\n        // inheritance, though we could easily \"invent\" it.\n        return this.whenYmacs(function(ymacs) {\n            if (ymacs.minibuffer) return cont.call(this, ymacs.minibuffer);\n        });\n    }\n    withMarkers(cont, ...args) {\n        let a = args.map((arg)=>this.createMarker(arg));\n        try {\n            return cont.apply(this, a);\n        } finally{\n            a.forEach((m)=>m.destroy());\n        }\n    }\n    preventUpdates() {\n        ++this.__preventUpdates;\n    }\n    resumeUpdates() {\n        if ((this.__preventUpdates = Math.max(this.__preventUpdates - 1, 0)) == 0) this.redrawDirtyLines();\n    }\n    getRegion(begin = this.caretMarker, end = this.markMarker) {\n        begin = $5e779a545e33325b$var$MRK(begin);\n        end = $5e779a545e33325b$var$MRK(end);\n        if (end < begin) {\n            var tmp = begin;\n            begin = end;\n            end = tmp;\n        }\n        return {\n            begin: begin,\n            end: end\n        };\n    }\n    redrawDirtyLines() {\n        this.callHooks(\"beforeRedraw\");\n        this.__dirtyLines.forEach((draw, row)=>{\n            if (draw) this.callHooks(\"onLineChange\", row);\n        });\n        this.__dirtyLines = [];\n        this.callHooks(\"afterRedraw\");\n    }\n    setOverlay(name, props) {\n        this.callHooks(\"onOverlayChange\", name, props);\n    }\n    deleteOverlay(name) {\n        this.callHooks(\"onOverlayDelete\", name);\n    }\n    setMark(pos = this.point()) {\n        this.markMarker.setPosition(pos);\n    }\n    ensureTransientMark() {\n        var rc = this._rowcol, tm;\n        if (!this.transientMarker) {\n            this.transientMarker = this.createMarker();\n            this.markMarker.setPosition(this.point());\n            tm = rc;\n        }\n        if (!tm) tm = this.transientMarker.getRowCol();\n        this.setOverlay(\"selection\", {\n            line1: tm.row,\n            col1: tm.col,\n            line2: rc.row,\n            col2: rc.col\n        });\n    }\n    clearTransientMark() {\n        if (this.transientMarker) {\n            this.transientMarker.destroy();\n            this.transientMarker = null;\n            this.deleteOverlay(\"selection\");\n            this.setq(\"sticky_mark\", false);\n        }\n    }\n    deleteTransientRegion() {\n        if (this.transientMarker) {\n            this._deleteText(this.caretMarker, this.transientMarker);\n            this.clearTransientMark();\n            this._placeUndoBoundary();\n            return true;\n        }\n    }\n    static #sameCommandCount = 0;\n    sameCommandCount(diff) {\n        if (diff == null) return $5e779a545e33325b$export$df331bdfc76955b4.#sameCommandCount;\n        if (diff == 0) return $5e779a545e33325b$export$df331bdfc76955b4.#sameCommandCount = 0;\n        return $5e779a545e33325b$export$df331bdfc76955b4.#sameCommandCount += diff;\n    }\n    static #lastKeyEvent = null;\n    interactiveEvent(ev) {\n        if (arguments.length == 0) return $5e779a545e33325b$export$df331bdfc76955b4.#lastKeyEvent;\n        return $5e779a545e33325b$export$df331bdfc76955b4.#lastKeyEvent = ev;\n    }\n    getPrefixArg(noDiscard) {\n        var ret = this.getq(\"universal_prefix\");\n        if (!noDiscard && ret !== undefined) {\n            this.setq(\"universal_prefix\", undefined);\n            if (!this.isMinibuffer) this.setMinibuffer(\"\");\n        }\n        return ret;\n    }\n    setPrefixArg(val) {\n        return this.setq(\"universal_prefix\", val);\n    }\n    updateModeline() {\n        this.callHooks(\"onModelineChange\");\n    }\n    renderModelineContent(rc, percent) {\n        var ml = (this.dirty() ? \"**\" : \"--\") + ` <span class=\"mode-line-buffer-id\">${(0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(this.name)}</span>` + \"\\xa0\\xa0\" + percent + \" of \" + (0, $08a06a2e99accb03$export$e1a3971de07c83b5)(this.getCodeSize(), 2).toLowerCase() + \"\\xa0\\xa0\" + \"(\" + (rc.row + 1) + \",\" + rc.col + \") \";\n        var custom = this.getq(\"modeline_custom_handler\");\n        if (custom) {\n            custom = custom.call(this, this, rc);\n            if (custom) ml += \"[\" + custom + \"] \";\n        }\n        return ml;\n    }\n    /* -----[ not-so-public API ]----- */ // BEGIN: undo queue\n    _recordChange(type, pos, len, text) {\n        if (len > 0) {\n            var q = this.__undoQueue;\n            if (!this.__preventUndo) {\n                q.push({\n                    type: type,\n                    pos: pos,\n                    len: len,\n                    text: text,\n                    dirty: this.dirty()\n                });\n                if (q.length > $5e779a545e33325b$var$MAX_UNDO_RECORDS) q.shift();\n                this.dirty(true);\n            } else q.forEach((x)=>{\n                if (x.type == 3) x.markers.forEach((m)=>{\n                    if (m[1] >= pos) m[1] += type == 1 ? len : -len;\n                });\n                else if (x.pos >= pos) x.pos += type == 1 ? len : -len;\n            });\n        }\n    }\n    _placeUndoBoundary() {\n        var q = this.__undoQueue;\n        var m = this.markers.map((m)=>[\n                m,\n                m.getPosition()\n            ]);\n        var last = q.at(-1);\n        if (!last || last.type != 3) q.push({\n            type: 3,\n            markers: m\n        });\n        else last.markers = m;\n    }\n    _playbackUndo() {\n        var q = this.__undoQueue;\n        if (q.length == 0) return false;\n        ++this.__undoInProgress;\n        var didit = false, action;\n        while(--this.__undoPointer >= 0){\n            action = q[this.__undoPointer];\n            if (action.type == 3) {\n                // restore markers\n                action.markers.forEach((m)=>m[0].setPosition(m[1]));\n                if (!didit) continue;\n                break;\n            }\n            didit = true;\n            var pos = action.pos;\n            switch(action.type){\n                case 1:\n                    this._deleteText(pos, pos + action.len);\n                    break;\n                case 2:\n                    this._insertText(action.text, pos);\n                    break;\n            }\n            this.dirty(action.dirty);\n        }\n        --this.__undoInProgress;\n        return didit;\n    }\n    // END: undo\n    _replaceLine(row, text) {\n        this.code[row] = text;\n        this._textProperties.replaceLine(row, text);\n        if (!this.__preventUpdates) this.callHooks(\"onLineChange\", row);\n        else this.__dirtyLines[row] = true;\n    }\n    _deleteLine(row) {\n        this.code.splice(row, 1);\n        this._textProperties.deleteLine(row);\n        if (this.tokenizer) this.tokenizer.quickDeleteLine(row);\n        this.__dirtyLines.splice(row, 1);\n        this.callHooks(\"onDeleteLine\", row);\n    }\n    _insertLine(row, text) {\n        this.code.splice(row, 0, text);\n        this._textProperties.insertLine(row);\n        if (this.tokenizer) this.tokenizer.quickInsertLine(row);\n        var drawIt = !this.__preventUpdates;\n        this.callHooks(\"onInsertLine\", row, drawIt);\n        if (!drawIt) {\n            if (this.__dirtyLines.length <= row) this.__dirtyLines[row] = true;\n            else this.__dirtyLines.splice(row, 0, true);\n        }\n    }\n    _insertText(text, pos) {\n        if (text.length == 0) return;\n        if (pos == null) pos = this.caretMarker.getPosition();\n        pos = $5e779a545e33325b$var$MRK(pos);\n        // *** UNDO RECORDING\n        this._recordChange(1, pos, text.length);\n        var rc = pos == this.point() ? this._rowcol : this._positionToRowCol(pos), i = rc.row;\n        if (/^\\n+$/.test(text) && rc.col == 0) // handle this case separately, since it's so\n        // frequently used (ENTER pressed) and the\n        // default algorithm messes up colorization\n        // for a fraction of a second, flashing badly.\n        for(let j = 0; j < text.length; ++j)this._insertLine(i + j, \"\");\n        else {\n            var lines = text.split(\"\\n\"), ln = this.code[i], rest = ln.substr(rc.col);\n            if (lines.length > 1) {\n                this._replaceLine(i, ln.substr(0, rc.col) + lines.shift());\n                lines.forEach((text)=>this._insertLine(++i, text));\n                this._replaceLine(i, this.code[i] + rest);\n            } else this._replaceLine(i, ln.substr(0, rc.col) + lines[0] + ln.substr(rc.col));\n        }\n        this._updateMarkers(pos, text.length);\n        this.callHooks(\"onChange\", 1, pos, text);\n    }\n    _deleteText(begin, end) {\n        begin = this._boundPosition($5e779a545e33325b$var$MRK(begin));\n        end = this._boundPosition($5e779a545e33325b$var$MRK(end));\n        if (begin == end) return;\n        if (end < begin) {\n            var tmp = begin;\n            begin = end;\n            end = tmp;\n        }\n        // *** UNDO RECORDING\n        this._recordChange(2, begin, end - begin, this._bufferSubstring(begin, end));\n        var brc = this._positionToRowCol(begin), erc = this._positionToRowCol(end);\n        var line = this.code[brc.row];\n        if (brc.row == erc.row) {\n            // same line, that's easy\n            line = line.substr(0, brc.col) + line.substr(erc.col);\n            this._replaceLine(brc.row, line);\n        } else {\n            // fix first line\n            line = line.substr(0, brc.col) + this.code[erc.row].substr(erc.col);\n            this._replaceLine(brc.row, line);\n            // delete lines in between\n            line = brc.row + 1;\n            for(let n = erc.row - brc.row; n-- > 0;)this._deleteLine(line);\n        }\n        this._updateMarkers(begin, begin - end, begin);\n        this.callHooks(\"onChange\", 2, begin, end);\n    }\n    _replaceText(begin, end, text) {\n        this._deleteText(begin, end);\n        this._insertText(text, begin);\n    }\n    _swapAreas(a) {\n        a = a.map($5e779a545e33325b$var$MRK).sort((a, b)=>a - b);\n        var b1 = a[0];\n        var e1 = a[1];\n        var b2 = a[2];\n        var e2 = a[3];\n        var t1 = this._bufferSubstring(b1, e1);\n        var t2 = this._bufferSubstring(b2, e2);\n        this._replaceText(b2, e2, t1);\n        this._replaceText(b1, e1, t2);\n        return e2;\n    }\n    _bufferSubstring(begin, end) {\n        if (begin == null) begin = this.point();\n        else begin = $5e779a545e33325b$var$MRK(begin);\n        if (end == null) end = this.getCodeSize();\n        else end = $5e779a545e33325b$var$MRK(end);\n        if (end < begin) {\n            var tmp = begin;\n            begin = end;\n            end = tmp;\n        }\n        // var brc = this._positionToRowCol(begin),\n        //     erc = this._positionToRowCol(end);\n        // if (brc.row == erc.row) {\n        //         return this.code[brc.row].substring(brc.col, erc.col);\n        // } else return [ this.code[brc.row].substr(brc.col) ].\n        //         concat(this.code.slice(brc.row + 1, erc.row)).\n        //         concat(this.code[erc.row].substr(0, erc.col)).\n        //         join(\"\\n\");\n        return this.getCode().substring(begin, end);\n    }\n    _killingAction(p1, p2, prepend, noDelete) {\n        p1 = $5e779a545e33325b$var$MRK(p1);\n        p2 = $5e779a545e33325b$var$MRK(p2);\n        var text = this._bufferSubstring(p1, p2);\n        this._saveKilledText(text, prepend);\n        if (!noDelete) this._deleteText(p1, p2);\n        this.clearTransientMark();\n    }\n    _saveKilledText(text, prepend) {\n        if (!this._lastCommandWasKill) this.ymacs.killRingToMaster();\n        this.ymacs.pushToKillRing(text, prepend);\n        this._lastCommandWasKill++;\n        if (this.interactiveEvent()) try {\n            navigator.clipboard.writeText(this.ymacs.killRingText());\n        } catch  {}\n    }\n    _positionToRowCol(pos) {\n        var line = 0, a = this.code, n = a.length;\n        while(pos > 0 && line < n){\n            var len = a[line].length;\n            if (len >= pos) break;\n            pos -= len + 1; // one for the newline\n            line++;\n        }\n        return {\n            row: line,\n            col: pos\n        };\n    }\n    _rowColToPosition(row, col) {\n        var pos = 0, a = this.code, i = Math.min(row, a.length - 1), n = i;\n        if (i < 0) return 0;\n        while(--i >= 0)pos += a[i].length + 1; // one for the newline\n        return pos + Math.min(col, a[n].length);\n    }\n    _boundPosition(pos) {\n        if (pos < 0) return 0;\n        return Math.min(pos, this.getCodeSize());\n    }\n    _repositionCaret(pos) {\n        var p = this.caretMarker.getPosition();\n        if (pos == null) pos = p;\n        pos = $5e779a545e33325b$var$MRK(pos);\n        pos = this._boundPosition(pos);\n        this.caretMarker.setPosition(pos);\n        return pos != p;\n    }\n    _updateMarkers(offset, delta, min = 0) {\n        this.__size = null;\n        this.__code = null;\n        // if (this.__undoInProgress == 0) {\n        this.markers.map((m)=>m.editorChange(offset, delta, min));\n        // }\n        if (this.tokenizer) {\n            let row = this._positionToRowCol(Math.min(offset, offset + delta)).row;\n            this.tokenizer.truncate(row);\n        }\n    }\n    _saveExcursion(cont, markerBefore) {\n        var tmp = this.createMarker(null, markerBefore);\n        ++this.__savingExcursion;\n        try {\n            return cont.call(this);\n        } finally{\n            --this.__savingExcursion;\n            this.caretMarker.swap(tmp, false, true);\n            tmp.destroy();\n        }\n    }\n    _disableUndo(cont) {\n        ++this.__preventUndo;\n        try {\n            return cont.call(this);\n        } finally{\n            --this.__preventUndo;\n        }\n    }\n    _handleKeyEvent(ev) {\n        var handled = false;\n        this.interactiveEvent(ev);\n        var lcwk = this._lastCommandWasKill;\n        if (this.__nextIsMeta) ev.ymacsMeta = true;\n        this.__nextIsMeta = false;\n        var key = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).unparseKey(ev);\n        var cc = this.currentKeys;\n        var foundPrefix = false;\n        cc.push(key);\n        for(let i = this.keymap.length; --i >= 0;){\n            let km = this.keymap[i];\n            let h = km.getHandler(cc);\n            if (h instanceof Array) {\n                this.callInteractively(h[0], h[1]);\n                handled = true;\n            } else if (h) handled = foundPrefix = true;\n            else if (km.defaultHandler && cc.length == 1) handled = this.callInteractively(km.defaultHandler[0], km.defaultHandler[1]);\n            if (handled) break;\n        }\n        if (!foundPrefix) {\n            if (!handled) {\n                if (cc.length > 1) {\n                    this.signalError(cc.join(\" \").bold() + \" is undefined\", true);\n                    handled = true;\n                }\n            }\n            cc.splice(0, cc.length);\n        }\n        if (this._lastCommandWasKill == lcwk && typeof handled != \"object\" && !this.__nextIsMeta) // selecting a prefix keymap shouldn't clear the killRing\n        this._lastCommandWasKill = 0;\n        this.callHooks(\"finishedEvent\", handled);\n        this.interactiveEvent(null);\n        // XXX: always preventDefault() in minibuffer (return true\n        // here); seems good, objections?\n        return handled || this.isMinibuffer;\n    }\n    _on_tokenizerFoundToken(row, c1, c2, what) {\n        if (what) this._textProperties.addLineProps(row, c1, c2, \"css\", what);\n        else this._textProperties.removeLineProps(row, c1, c2, \"css\");\n    }\n    _on_textPropertiesChange(row) {\n        if (!this.__preventUpdates) this.callHooks(\"onLineChange\", row);\n        else this.__dirtyLines[row] = true;\n    }\n    formatLineHTML(row, caret) {\n        var rc = this._rowcol;\n        if (caret instanceof (0, $c35b14db10f870d1$export$57a830c2aa4f8317)) rc = caret.getRowCol();\n        caret = row == rc.row ? rc.col : null;\n        return this._textProperties.getLineHTML(row, this.code[row], caret);\n    }\n    looking_at(needle) {\n        var haystack = this.getCode();\n        if (needle instanceof RegExp) {\n            var pos = needle.lastIndex = this.point();\n            var ret = needle.exec(haystack);\n            if (ret && ret.index == pos) {\n                ret.after = needle.lastIndex;\n                return this.matchData = ret;\n            }\n        } else if (typeof needle == \"string\") // XXX: account for case_fold_search here?\n        return haystack.substr(this.point(), needle.length) == needle;\n    }\n    looking_back(needle) {\n        var haystack = this.getCode();\n        if (needle instanceof RegExp) {\n            var m = this.lastIndexOfRegexp(haystack, needle, this.point());\n            if (m && m.after == this.point()) return m;\n        } else if (typeof needle == \"string\") // XXX: account for case_fold_search here?\n        return haystack.substr(this.point() - needle.length, needle.length) == needle;\n    }\n    capitalize(str) {\n        return str.replace(this.getq(\"syntax_capitalize_word\"), (_, a, b)=>a.toUpperCase() + b.toLowerCase());\n    }\n}\n// XXX: what a mess..\n$5e779a545e33325b$export$df331bdfc76955b4.prototype.COMMANDS = $5e779a545e33325b$export$df331bdfc76955b4.COMMANDS;\n$5e779a545e33325b$export$df331bdfc76955b4.prototype.newCommands = $5e779a545e33325b$export$df331bdfc76955b4.newCommands;\n$5e779a545e33325b$export$df331bdfc76955b4.prototype.replaceCommands = $5e779a545e33325b$export$df331bdfc76955b4.replaceCommands;\n$5e779a545e33325b$export$df331bdfc76955b4.prototype.newMode = $5e779a545e33325b$export$df331bdfc76955b4.newMode;\n$5e779a545e33325b$export$df331bdfc76955b4.prototype.addModeHook = $5e779a545e33325b$export$df331bdfc76955b4.addModeHook;\n$5e779a545e33325b$export$df331bdfc76955b4.prototype.removeModeHook = $5e779a545e33325b$export$df331bdfc76955b4.removeModeHook;\n$5e779a545e33325b$export$df331bdfc76955b4.setq = $5e779a545e33325b$export$df331bdfc76955b4.setGlobal = $5e779a545e33325b$export$df331bdfc76955b4.prototype.setGlobal = $5e779a545e33325b$export$df331bdfc76955b4.setVariable;\n$5e779a545e33325b$export$df331bdfc76955b4.prototype.setq = $5e779a545e33325b$export$df331bdfc76955b4.prototype.setVariable;\n$5e779a545e33325b$export$df331bdfc76955b4.prototype.getq = $5e779a545e33325b$export$df331bdfc76955b4.prototype.getVariable;\n$5e779a545e33325b$export$df331bdfc76955b4.getq = $5e779a545e33325b$export$df331bdfc76955b4.getVariable;\nclass $5e779a545e33325b$export$36a0d48d1b18d0fa extends $5e779a545e33325b$export$df331bdfc76955b4 {\n    constructor(...args){\n        super(...args);\n        this.promptMarker = this.createMarker(0, true, \"prompt\");\n        this.setq(\"minibuffer_validation\", (whatever)=>true);\n    }\n    // prompt(text) {\n    //     text = text.trim() + \" \";\n    //     this._disableUndo(() => {\n    //         this.setCode(text);\n    //         this._textProperties.addLineProps(0, 0, text.length - 1, \"css\", \"minibuffer-prompt\");\n    //         this._repositionCaret(text.length);\n    //         this.promptMarker.setPosition(text.length, true, true);\n    //     });\n    // }\n    prompt(text) {\n        text = text.trim() + \" \";\n        this._disableUndo(()=>{\n            let pos = this.promptMarker.getPosition();\n            this.promptMarker.setPosition(0, true, true);\n            this._replaceText(0, pos, text);\n            this.promptMarker.setPosition(text.length, true, true);\n            this._textProperties.spliceLineProps(0, 0, text.length - pos);\n            this._textProperties.addLineProps(0, 0, text.length - 1, \"css\", \"minibuffer-prompt\");\n        });\n    }\n    _boundPosition(pos) {\n        return Math.max($5e779a545e33325b$var$MRK(this.promptMarker), Math.min(pos, this.getCodeSize()));\n    }\n}\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\nlet $ec4394da1a74075f$var$MENU = Symbol(\"MENU\");\nclass $ec4394da1a74075f$export$731251e1d39d8621 extends (0, $08a06a2e99accb03$export$a829527ff4e4114a) {\n    static options = {};\n    constructor(...args){\n        super(...args);\n        this._cont = (0, $08a06a2e99accb03$export$cb0933279c36a66b).fromHTML(`<div class=\"Ymacs_Menu\"></div>`);\n        this.getElement().appendChild(this._cont);\n    }\n    getContentElement() {\n        return this._cont;\n    }\n    initClassName() {\n        return \"Ymacs_Popup\";\n    }\n}\nvar $ec4394da1a74075f$var$KEYMAP_MENU_ACTIVE = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(null, {\n    \"ArrowDown && C-n\": $ec4394da1a74075f$var$handle_arrow_down,\n    \"ArrowUp && C-p\": $ec4394da1a74075f$var$handle_arrow_up,\n    \"PageDown\": $ec4394da1a74075f$var$handle_arrow_down,\n    \"PageUp\": $ec4394da1a74075f$var$handle_arrow_up,\n    \"C-End && M->\": $ec4394da1a74075f$var$handle_popup_end,\n    \"C-Home && M-<\": $ec4394da1a74075f$var$handle_popup_home,\n    \"Enter\": $ec4394da1a74075f$var$handle_enter,\n    \"Escape\": $ec4394da1a74075f$var$handle_escape\n});\n$ec4394da1a74075f$var$KEYMAP_MENU_ACTIVE.defaultHandler = [\n    function() {\n        let buffer = this;\n        let menu = buffer[$ec4394da1a74075f$var$MENU];\n        menu.kill();\n        return false; // say it's not handled though\n    }\n];\nfunction $ec4394da1a74075f$export$7b89d1d66e79a77c({ buffer: buffer, items: items, onSelect: onSelect } = {}) {\n    let menuWidget = new $ec4394da1a74075f$export$731251e1d39d8621();\n    menuWidget.addClass(\"with-arrow\");\n    items.forEach((label, index)=>{\n        let value = label;\n        if (typeof label != \"string\") {\n            value = label.value;\n            label = label.label;\n        }\n        let el = (0, $08a06a2e99accb03$export$cb0933279c36a66b).fromHTML(`<div class=\"Ymacs_Menu_Item\" data-value=\"${(0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(value)}\"\n                                          data-index=\"${index}\">${(0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(label)}</div>`);\n        menuWidget.add(el);\n    });\n    buffer[$ec4394da1a74075f$var$MENU] = {\n        items: items,\n        widget: menuWidget,\n        onSelect: onSelect,\n        kill () {\n            menuWidget.destroy();\n            buffer[$ec4394da1a74075f$var$MENU] = null;\n        }\n    };\n    let activeElement = document.activeElement;\n    let ymacs = buffer.ymacs;\n    (0, $08a06a2e99accb03$export$cb0933279c36a66b).on(menuWidget.getContentElement(), {\n        click: (ev)=>{\n            activeElement.focus();\n            let item = ev.target;\n            if (!(0, $08a06a2e99accb03$export$cb0933279c36a66b).hasClass(item, \"Ymacs_Menu_Item\")) return;\n            $ec4394da1a74075f$var$select(buffer, +item.dataset.index);\n            $ec4394da1a74075f$var$handle_enter.call(buffer);\n        }\n    });\n    ymacs._popupAtCaret(menuWidget.getElement());\n    $ec4394da1a74075f$var$select(buffer, 0);\n    buffer.pushKeymap($ec4394da1a74075f$var$KEYMAP_MENU_ACTIVE);\n    menuWidget.addEventListener(\"onDestroy\", ()=>{\n        buffer.popKeymap($ec4394da1a74075f$var$KEYMAP_MENU_ACTIVE);\n    });\n}\nfunction $ec4394da1a74075f$var$handle_arrow_up() {\n    let buffer = this;\n    let menu = buffer[$ec4394da1a74075f$var$MENU];\n    $ec4394da1a74075f$var$select(buffer, menu.selectedIndex - 1);\n}\nfunction $ec4394da1a74075f$var$handle_arrow_down() {\n    let buffer = this;\n    let menu = buffer[$ec4394da1a74075f$var$MENU];\n    $ec4394da1a74075f$var$select(buffer, menu.selectedIndex + 1);\n}\nfunction $ec4394da1a74075f$var$handle_popup_home() {\n    let buffer = this;\n    let menu = buffer[$ec4394da1a74075f$var$MENU];\n    $ec4394da1a74075f$var$select(buffer, 0);\n}\nfunction $ec4394da1a74075f$var$handle_popup_end() {\n    let buffer = this;\n    let menu = buffer[$ec4394da1a74075f$var$MENU];\n    $ec4394da1a74075f$var$select(buffer, -1);\n}\nfunction $ec4394da1a74075f$var$handle_enter() {\n    let buffer = this;\n    let menu = buffer[$ec4394da1a74075f$var$MENU];\n    if (!(menu.onSelect(menu.selectedIndex) === false)) menu.kill();\n}\nfunction $ec4394da1a74075f$var$handle_escape() {\n    let buffer = this;\n    let menu = buffer[$ec4394da1a74075f$var$MENU];\n    menu.kill();\n}\nfunction $ec4394da1a74075f$var$select(buffer, index) {\n    let menu = buffer[$ec4394da1a74075f$var$MENU];\n    let cont = menu.widget.getContentElement();\n    let elements = [\n        ...cont.querySelectorAll(\".Ymacs_Menu_Item\")\n    ];\n    let n = elements.length;\n    index = menu.selectedIndex = (index % n + n) % n;\n    elements.forEach((el)=>{\n        let current = el.dataset.index == index;\n        if (current) menu.selectedItem = el;\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).condClass(el, current, \"selected\");\n    });\n    menu.selectedItem.scrollIntoView({\n        block: \"nearest\"\n    });\n}\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n    popup_menu: function(args) {\n        args.buffer = this;\n        $ec4394da1a74075f$export$7b89d1d66e79a77c(args);\n    }\n});\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\nfunction $9526afefc19b5eea$var$textColX(div, col) {\n    let range = document.createRange();\n    range.selectNodeContents(div);\n    let treeWalker = document.createTreeWalker(div, NodeFilter.SHOW_TEXT);\n    let len = 0;\n    while(treeWalker.nextNode()){\n        let node = treeWalker.currentNode;\n        let clen = node.nodeValue.length;\n        if (len + clen >= col) {\n            range.setStart(node, col - len);\n            range.setEnd(node, col - len);\n            break;\n        }\n        len += clen;\n    }\n    return range.getBoundingClientRect().right;\n}\nfunction $9526afefc19b5eea$var$normalizeRect(p) {\n    return p.line1 > p.line2 || p.line1 == p.line2 && p.col1 > p.col2 ? {\n        line1: p.line2,\n        col1: p.col2,\n        line2: p.line1,\n        col2: p.col1\n    } : p;\n}\nvar $9526afefc19b5eea$var$DBL_CLICK_SPEED = 300;\nvar $9526afefc19b5eea$var$CLICK_COUNT = 0, $9526afefc19b5eea$var$CLICK_COUNT_TIMER = null, $9526afefc19b5eea$var$CLICK_LAST_TIME = null;\nfunction $9526afefc19b5eea$var$CLEAR_CLICK_COUNT() {\n    $9526afefc19b5eea$var$CLICK_COUNT = null;\n}\nvar $9526afefc19b5eea$var$LINE_DIV = (0, $08a06a2e99accb03$export$cb0933279c36a66b).fromHTML(`<div class=\"line\"><br/></div>`);\nvar $9526afefc19b5eea$var$COUNT = 0;\nclass $9526afefc19b5eea$export$3230e5a51f22d844 extends (0, $08a06a2e99accb03$export$a829527ff4e4114a) {\n    static options = {\n        buffer: null,\n        ymacs: null,\n        isMinibuffer: false,\n        point: null\n    };\n    constructor(...args){\n        super(...args);\n        this.buffer = this.o.buffer;\n        this.ymacs = this.o.ymacs;\n        this.isMinibuffer = this.o.isMinibuffer;\n        this.id = `ymacs-frame-${++$9526afefc19b5eea$var$COUNT}`;\n        this.__caretId = `ymacs-caret-${$9526afefc19b5eea$var$COUNT}`;\n        this.redrawModelineWithTimer = (0, $08a06a2e99accb03$export$ad41d882ec94ba04)(this.redrawModeline.bind(this));\n        this.getElement().tabIndex = 0;\n        this.getElement().innerHTML = \"<div class='Ymacs-frame-overlays'><div class='Ymacs-frame-content'></div></div><div class='Ymacs_Modeline'></div>\";\n        this.addEventListener({\n            onDestroy: this._on_destroy\n        });\n        this._dragSelectHandlers = {\n            mousemove: this._dragSelect_onMouseMove.bind(this),\n            mouseup: this._dragSelect_onMouseUp.bind(this)\n        };\n        this._bufferEvents = {\n            onLineChange: this._on_bufferLineChange.bind(this),\n            onInsertLine: this._on_bufferInsertLine.bind(this),\n            onDeleteLine: this._on_bufferDeleteLine.bind(this),\n            onPointChange: this._on_bufferPointChange.bind(this),\n            onResetCode: this._on_bufferResetCode.bind(this),\n            onOverwriteMode: this._on_bufferOverwriteMode.bind(this),\n            onModelineChange: this._on_bufferModelineChange.bind(this),\n            beforeInteractiveCommand: this._on_bufferBeforeInteractiveCommand.bind(this),\n            afterInteractiveCommand: this._on_bufferAfterInteractiveCommand.bind(this),\n            onOverlayChange: this._on_bufferOverlayChange.bind(this),\n            onOverlayDelete: this._on_bufferOverlayDelete.bind(this)\n        };\n        this._moreBufferEvents = {\n            onMessage: this._on_bufferMessage.bind(this),\n            afterInteractiveCommand: (function() {\n                if (this.__ensureCaretVisible) this.ensureCaretVisible();\n            }).bind(this)\n        };\n        var buffer = this.buffer;\n        this.buffer = null;\n        if (buffer) this.setBuffer(buffer, this.o.point);\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).on(this.getOverlaysContainer(), \"scroll\", this._on_scroll.bind(this));\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).on(this.getElement(), {\n            mousedown: this._dragSelect_onMouseDown.bind(this),\n            focus: this._on_focus.bind(this),\n            blur: this._on_blur.bind(this),\n            keydown: this._on_keyDown.bind(this),\n            keyup: this._on_keyUp.bind(this),\n            wheel: this._on_mouseWheel.bind(this)\n        });\n    }\n    initClassName() {\n        return `Ymacs_Frame${this.o.isMinibuffer ? ' Ymacs_Minibuffer' : ''}`;\n    }\n    focus(exitAllowed) {\n        this.getElement().focus();\n    // if (exitAllowed instanceof Function) {\n    //     this.removeEventListener(\"onBlur\", this.__exitFocusHandler);\n    //     this.addEventListener(\"onBlur\", this.__exitFocusHandler = function(){\n    //         if (exitAllowed.call(this.buffer)) {\n    //             this.removeEventListener(\"onBlur\", this.__exitFocusHandler);\n    //         } else {\n    //             this.focus.delayed(2, this, null);\n    //         }\n    //     });\n    // }\n    }\n    blur(force) {\n    // if (force)\n    //     this.removeEventListener(\"onBlur\", this.__exitFocusHandler);\n    }\n    getOverlaysContainer() {\n        return this.getElement().firstChild;\n    }\n    getModelineElement() {\n        return this.getElement().childNodes[1];\n    }\n    getContentElement() {\n        return this.getElement().firstChild.firstChild;\n    }\n    getCaretElement() {\n        return document.getElementById(this.__caretId);\n    }\n    getLineDivElement(row) {\n        return this.getContentElement().childNodes[row] || null;\n    }\n    ensureCaretVisible() {\n        // return true if the scroll position has changed\n        let div = this.getOverlaysContainer();\n        let st = div.scrollTop;\n        this.redrawCaret();\n        let caret = this.getCaretElement();\n        if (caret) {\n            caret.scrollIntoView({\n                block: \"nearest\",\n                inline: \"nearest\"\n            });\n            if (caret.offsetLeft < div.clientWidth / 2) div.scrollLeft = 0;\n        }\n        return st != div.scrollTop;\n    }\n    focusInside() {\n        return document.activeElement === this.getElement();\n    }\n    setBuffer(buffer, point) {\n        if (buffer === this.buffer) return;\n        if (this.buffer) {\n            if (this.caretMarker && !this.o.isMinibuffer) {\n                this.caretMarker.destroy();\n                this.caretMarker = null;\n            }\n            this.buffer.removeEventListener(this._bufferEvents);\n            this.buffer.removeEventListener(this._moreBufferEvents);\n        }\n        this.buffer = buffer;\n        if (buffer) {\n            buffer.addEventListener(this._bufferEvents);\n            if (this.focusInside()) buffer.addEventListener(this._moreBufferEvents);\n            if (this.o.isMinibuffer) this.caretMarker = buffer.caretMarker;\n            else this.caretMarker = buffer.createMarker(point ?? +buffer.caretMarker, false, \"framecaret\");\n            this._redrawBuffer();\n            this.redrawCaret(true);\n            this.centerOnCaret();\n        }\n    }\n    recenterTopBottom(pos = 1) {\n        let row = this.buffer._rowcol.row;\n        let line = this.getLineDivElement(row);\n        let div = this.getOverlaysContainer();\n        let center = Math.round(line.offsetTop - div.clientHeight / 2 + line.offsetHeight / 2);\n        let top = Math.round(line.offsetTop);\n        let bottom = Math.round(line.offsetTop - div.clientHeight + line.offsetHeight);\n        if (pos == 0) div.scrollTop = center;\n        else if (pos == 1) div.scrollTop = top;\n        else div.scrollTop = bottom;\n    }\n    centerOnCaret() {\n        this.centerOnLine(this.buffer._rowcol.row);\n    }\n    centerOnLine(row) {\n        var line = this.getLineDivElement(row), div = this.getOverlaysContainer();\n        div.scrollTop = Math.round(line.offsetTop - div.clientHeight / 2 + line.offsetHeight / 2);\n    // this._redrawBuffer();\n    }\n    setModelineContent(html) {\n        this.getModelineElement().innerHTML = html;\n    }\n    deleteOtherFrames() {\n        this.ymacs.keepOnlyFrame(this);\n    }\n    deleteFrame() {\n        this.ymacs.deleteFrame(this);\n    }\n    _split(horiz) {\n        let ovdiv = this.getOverlaysContainer();\n        let scroll = ovdiv.scrollTop;\n        let fr = this.ymacs.createFrame({\n            buffer: this.buffer\n        });\n        let sc = new $9526afefc19b5eea$export$7b0e4d18ade0c4c9({\n            horiz: horiz\n        });\n        this.getElement().replaceWith(sc.getElement());\n        sc.setSplit(this, fr);\n        ovdiv.scrollTop = scroll;\n        fr.getOverlaysContainer().scrollTop = scroll;\n        this.focus(); // XXX: only if necessary\n        return fr;\n    }\n    vsplit() {\n        return this._split(true);\n    }\n    hsplit(percent) {\n        return this._split(false);\n    }\n    __showCaret() {\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).addClass(this.getCaretElement(), \"Ymacs-caret\");\n    }\n    redrawCaret(force) {\n        if (this.o.isMinibuffer) force = true;\n        var isActive = this.ymacs.getActiveFrame() === this;\n        if (!force && !isActive) return;\n        if (isActive && !this.o.isMinibuffer && this.focusInside()) this.caretMarker.setPosition(this.buffer.caretMarker.getPosition());\n        var rc = this.buffer._rowcol;\n        // hide stale carets :-\\\n        // mess everywhere.\n        [\n            ...this.getElement().querySelectorAll(\".Ymacs-caret, #\" + this.__caretId)\n        ].forEach((el)=>{\n            el.id = \"\";\n            el.className = \"\";\n        });\n        // redraw the line where the caret was previously, so that it disappears from there\n        if (this.__prevCaretLine != null) this._on_bufferLineChange(this.__prevCaretLine);\n        // redraw current line if it's different\n        if (this.__prevCaretLine != rc.row) {\n            this.__prevCaretLine = rc.row;\n            this._on_bufferLineChange(rc.row);\n        }\n        this.callHooks(\"onPointChange\", rc.row, rc.col);\n        this.redrawModelineWithTimer(rc);\n    }\n    _getLineHTML(row) {\n        var html = this.buffer.formatLineHTML(row, this.caretMarker);\n        // taking advantage of the fact that a literal > entered by the user will never appear in\n        // the generated HTML, since special HTMl characters are escaped.\n        var pos = html.indexOf(\"Ymacs-caret'>\");\n        if (pos >= 0) html = html.substr(0, pos + 12) + \" id='\" + this.__caretId + \"'\" + html.substr(pos + 12);\n        return html;\n    }\n    _redrawBuffer() {\n        this.setContent(this.buffer.code.map((line, i)=>`<div class=\"line\">${this._getLineHTML(i)}</div>`).join(\"\"));\n    }\n    coordinatesToRowCol(x, y) {\n        function findLine(r1, r2) {\n            if (r1 >= r2) return r1;\n            var row = Math.floor((r1 + r2) / 2);\n            var div = self.getLineDivElement(row);\n            var y1 = div.offsetTop;\n            var y2 = y1 + div.offsetHeight;\n            if (y2 < y) return findLine(row + 1, r2);\n            if (y < y1) return findLine(r1, row - 1);\n            return row;\n        }\n        function findCol(c1, c2) {\n            if (c1 >= c2) return c1;\n            var col = Math.floor((c1 + c2) / 2);\n            var p1 = self.coordinates(row, col), p2 = self.coordinates(row, col + 1);\n            if (p2.x < x) return findCol(col + 1, c2);\n            if (x < p1.x) return findCol(c1, col - 1);\n            return col;\n        }\n        var self = this, row = findLine(0, this.buffer.code.length - 1), col = findCol(0, this.buffer.code[row].length);\n        return {\n            row: row,\n            col: col\n        };\n    }\n    coordinates(row, col) {\n        var box = this.getContentElement().getBoundingClientRect();\n        var div = this.getLineDivElement(row);\n        return {\n            x: $9526afefc19b5eea$var$textColX(div, col) - box.left,\n            y: div.offsetTop,\n            h: div.offsetHeight\n        };\n    }\n    heightInLines() {\n        return Math.floor(this.getOverlaysContainer().clientHeight / this.getContentElement().firstChild.offsetHeight);\n    }\n    redrawModeline(rc) {\n        if (!rc) rc = this.caretMarker.getRowCol();\n        var maxline = this.buffer.code.length - 1;\n        var firstline = this.firstLineVisible();\n        var lastline = this.lastLineVisible();\n        var percent = firstline == 0 ? \"Top\" : lastline == maxline ? \"Bot\" : Math.round(lastline / maxline * 100) + \"%\";\n        this.setModelineContent(this.buffer.renderModelineContent(rc, percent));\n    }\n    /* -----[ event handlers ]----- */ _on_bufferLineChange(row) {\n        var div = this.getLineDivElement(row);\n        if (div) //console.log(\"Redrawing line %d [%s]\", row, this.buffer.code[row]);\n        //console.log(new Error().stack);\n        div.innerHTML = this._getLineHTML(row);\n    }\n    _on_bufferInsertLine(row, drawIt) {\n        var div = $9526afefc19b5eea$var$LINE_DIV.cloneNode(true);\n        this.getContentElement().insertBefore(div, this.getLineDivElement(row));\n        if (drawIt) div.innerHTML = this._getLineHTML(row);\n    }\n    _on_bufferDeleteLine(row) {\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).trash(this.getLineDivElement(row));\n    }\n    _on_bufferPointChange(rc, pos) {\n        this.redrawCaret();\n    }\n    _on_bufferResetCode() {\n        this._redrawBuffer();\n    }\n    _on_bufferOverwriteMode(om) {\n        this.condClass(om, \"Ymacs-overwrite-mode\");\n    }\n    _on_bufferMessage(args) {\n        this.ymacs.popupMessage(args);\n    }\n    _on_bufferBeforeInteractiveCommand() {\n        this.__ensureCaretVisible = true;\n        this.ymacs.clearPopupMessage();\n    }\n    _on_bufferAfterInteractiveCommand() {}\n    _on_bufferModelineChange() {\n        this.redrawModelineWithTimer(null);\n    }\n    getOverlayId(name) {\n        return this.id + \"-ovl-\" + name;\n    }\n    getOverlayHTML(name, props) {\n        var str = \"\";\n        props.forEach((p)=>{\n            if (p.line1 == p.line2 && p.col1 == p.col2) return;\n            p = $9526afefc19b5eea$var$normalizeRect(p);\n            var p1 = this.coordinates(p.line1, p.col1);\n            var p2 = this.coordinates(p.line2, p.col2);\n            var p0 = p.col1 == 0 ? p1 : this.coordinates(p.line1, 0);\n            if (p.line1 == p.line2) str += `<div class=\"${name}\" style=\"\n                    top: ${p1.y}px;\n                    left: ${p1.x}px;\n                    height: ${p1.h}px;\n                    width: ${p2.x - p1.x}px;\n                \"></div>`;\n            else {\n                str += `<div class=\"${name}\" style=\"\n                    top: ${p1.y}px;\n                    left: ${p1.x}px;\n                    height: ${p.col1 > 0 ? p1.h : p2.y - p1.y}px;\n                \"></div>`;\n                if (p.col1 > 0 && p.line2 - p.line1 > 1) str += `<div class=\"${name}\" style=\"\n                        top: ${p1.y + p1.h}px;\n                        left: ${p0.x}px;\n                        height: ${p2.y - p1.y - p1.h}px;\n                    \"></div>`;\n                if (p.col2 > 0) str += `<div class=\"${name}\" style=\"\n                        top: ${p2.y}px;\n                        left: ${p0.x}px;\n                        height: ${p2.h}px;\n                        width: ${p2.x - p0.x}px;\n                    \"></div>`;\n            }\n        });\n        return str ? `<div id=\"${this.getOverlayId(name)}\" data-ymacs-overlay=\"${name}\" class=\"Ymacs_Overlay ${name}\">${str}</div>` : null;\n    }\n    getOverlaysCount() {\n        return this.getOverlaysContainer().childNodes.length - 1; // XXX: subtract the div.content; we need to revisit this if we add new elements.\n    }\n    _on_bufferOverlayChange(name, props) {\n        let html = this.getOverlayHTML(name, Array.isArray(props) ? props : [\n            props\n        ]);\n        if (html) {\n            let div = (0, $08a06a2e99accb03$export$cb0933279c36a66b).fromHTML(html);\n            let old = document.getElementById(this.getOverlayId(name));\n            old ? old.replaceWith(div) : this.getOverlaysContainer().appendChild(div);\n            this._setOverlayClasses();\n        } else this._on_bufferOverlayDelete(name);\n    }\n    _on_bufferOverlayDelete(name) {\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).trash(document.getElementById(this.getOverlayId(name)));\n        this._setOverlayClasses();\n    }\n    _setOverlayClasses() {\n        let names = [\n            ...this.getOverlaysContainer().querySelectorAll(\":scope > [data-ymacs-overlay]\")\n        ].map((el)=>el.dataset.ymacsOverlay);\n        this.condClass(names.length > 0, \"Ymacs_Frame-hasOverlays\");\n        this.getElement().dataset.ymacsOverlays = names.join(\" \");\n    }\n    /* -----[ self events ]----- */ _on_destroy() {\n        this.setBuffer(null);\n    }\n    _on_focus() {\n        this.ymacs.setActiveFrame(this, true);\n        if (!this.o.isMinibuffer) this.buffer.cmd(\"goto_char\", this.caretMarker.getPosition());\n        this.buffer.addEventListener(this._moreBufferEvents);\n    }\n    _on_blur() {\n        if (!this.o.isMinibuffer) this.caretMarker.setPosition(this.buffer.caretMarker.getPosition());\n        this.buffer.removeEventListener(this._moreBufferEvents);\n    }\n    _dragSelect_onMouseDown(ev) {\n        if (ev.ctrlKey && ev.shiftKey) return;\n        if (ev.button != 0) {\n            setTimeout(()=>this.focus());\n            return;\n        }\n        this.focus();\n        ev.stopPropagation();\n        ev.preventDefault();\n        clearTimeout($9526afefc19b5eea$var$CLICK_COUNT_TIMER);\n        $9526afefc19b5eea$var$CLICK_COUNT++;\n        $9526afefc19b5eea$var$CLICK_COUNT_TIMER = setTimeout($9526afefc19b5eea$var$CLEAR_CLICK_COUNT, $9526afefc19b5eea$var$DBL_CLICK_SPEED);\n        let pos = (0, $08a06a2e99accb03$export$cb0933279c36a66b).mousePos(ev, this.getContentElement());\n        let rc = this.coordinatesToRowCol(pos.x, pos.y);\n        let buf = this.buffer;\n        setTimeout(()=>{\n            buf.clearTransientMark();\n            buf.cmd(\"goto_char\", buf._rowColToPosition(rc.row, rc.col));\n            buf.callInteractively(\"keyboard_quit\");\n            if ($9526afefc19b5eea$var$CLICK_COUNT == 1) {\n                buf.ensureTransientMark();\n                (0, $08a06a2e99accb03$export$cb0933279c36a66b).on(window, this._dragSelectHandlers);\n            } else if ($9526afefc19b5eea$var$CLICK_COUNT == 2) {\n                buf.cmd(\"forward_word\");\n                buf.cmd(\"backward_word\");\n                buf.cmd(\"forward_word_mark\");\n            } else if ($9526afefc19b5eea$var$CLICK_COUNT == 3) {\n                buf.cmd(\"beginning_of_line\");\n                buf.cmd(\"end_of_line_mark\");\n            } else if ($9526afefc19b5eea$var$CLICK_COUNT == 4) {\n                buf.cmd(\"backward_paragraph\");\n                buf.cmd(\"forward_whitespace\");\n                buf.cmd(\"beginning_of_line\");\n                buf.cmd(\"forward_paragraph_mark\");\n            }\n        });\n    }\n    _dragSelect_onMouseMove(ev) {\n        let pos = (0, $08a06a2e99accb03$export$cb0933279c36a66b).mousePos(ev, this.getContentElement());\n        let rc = this.coordinatesToRowCol(pos.x, pos.y);\n        this.buffer.cmd(\"goto_char\", this.buffer._rowColToPosition(rc.row, rc.col));\n        this.buffer.ensureTransientMark();\n        this.ensureCaretVisible();\n    }\n    _dragSelect_onMouseUp(ev) {\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).off(window, this._dragSelectHandlers);\n    }\n    _on_keyDown(ev) {\n        if (!$9526afefc19b5eea$var$isModifier(ev.key)) {\n            if (this.ymacs.processKeyEvent(ev)) {\n                ev.preventDefault();\n                ev.stopPropagation();\n            }\n        }\n    }\n    _on_keyUp(ev) {}\n    _on_scroll() {\n        this.redrawModelineWithTimer();\n    }\n    _on_mouseWheel(ev) {\n        ev.preventDefault();\n        this.buffer._handleKeyEvent(ev);\n    }\n    firstLineVisible() {\n        var div = this.getOverlaysContainer();\n        return this.coordinatesToRowCol(1, div.scrollTop + 1).row;\n    }\n    lastLineVisible() {\n        var div = this.getOverlaysContainer();\n        return this.coordinatesToRowCol(div.clientWidth - 2, div.scrollTop + div.clientHeight - 2).row;\n    }\n    scrollUp(lines) {\n        var div = this.getOverlaysContainer();\n        var line = Math.max(this.firstLineVisible() - lines, 0);\n        line = this.getLineDivElement(line);\n        div.scrollTop = line.offsetTop;\n        this.__ensureCaretVisible = false;\n    }\n    scrollDown(lines) {\n        var div = this.getOverlaysContainer();\n        var line = Math.min(this.firstLineVisible() + lines, this.buffer.code.length - 1);\n        line = this.getLineDivElement(line);\n        div.scrollTop = line.offsetTop;\n        this.__ensureCaretVisible = false;\n    }\n}\nfunction $9526afefc19b5eea$var$isModifier(key) {\n    return /^(?:Alt|AltGraph|CapsLock|Control|Fn|FnLock|Hyper|Meta|NumLock|ScrollLock|Shift|Super|Symbol|SymbolLock)$/.test(key);\n}\nclass $9526afefc19b5eea$export$7b0e4d18ade0c4c9 extends (0, $08a06a2e99accb03$export$a829527ff4e4114a) {\n    static options = {\n        horiz: false\n    };\n    #activeElement = null;\n    initClassName() {\n        return \"Ymacs_SplitCont \" + (this.o.horiz ? \"horiz\" : \"vert\");\n    }\n    createElement() {\n        super.createElement();\n        this._dragHandlers = {\n            mousemove: this._onMouseMove.bind(this),\n            mouseup: this._onMouseUp.bind(this)\n        };\n        this._rb = (0, $08a06a2e99accb03$export$cb0933279c36a66b).fromHTML(`<div class=\"bar\" tabindex=\"0\"></div>`);\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).on(this._rb, \"mousedown\", this._onMouseDown.bind(this));\n    }\n    setSplit(a, b, frac) {\n        this.add(a);\n        this.add(this._rb);\n        this.add(b);\n        if (frac != null) {\n            let cont = this.getElement();\n            if (this.o.horiz) cont.style.gridTemplateRows = `${frac}fr auto ${1 - frac}fr`;\n            else cont.style.gridTemplateColumns = `${frac}fr auto ${1 - frac}fr`;\n        }\n    }\n    _onMouseDown(ev) {\n        this.#activeElement = document.activeElement;\n        if (ev.target === this._rb) {\n            let first = this.getContentElement().children[0];\n            this._start = this.o.horiz ? ev.clientY : ev.clientX;\n            this._orig_sz = this.o.horiz ? first.offsetHeight : first.offsetWidth;\n            this.addClass(\"dragging\");\n            ev.stopPropagation();\n            (0, $08a06a2e99accb03$export$cb0933279c36a66b).on(window, this._dragHandlers);\n            (0, $08a06a2e99accb03$export$cb0933279c36a66b).overlayOn(this.o.horiz ? \"Ymacs_Resize_horiz\" : \"Ymacs_Resize_vert\");\n        } else if (this.#activeElement) this.#activeElement.focus();\n    }\n    _onMouseUp(ev) {\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).off(window, this._dragHandlers);\n        this.delClass(\"dragging\");\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).overlayOff();\n        if (this.#activeElement) this.#activeElement.focus();\n        this.#activeElement = null;\n    }\n    _onMouseMove(ev) {\n        let cont = this.getElement();\n        let max = this.o.horiz ? cont.offsetHeight : cont.offsetWidth;\n        let diff = (this.o.horiz ? ev.clientY : ev.clientX) - this._start;\n        let target = Math.min(max, Math.max(0, this._orig_sz + diff));\n        let frac = Math.min(0.9, Math.max(0.1, target / max));\n        if (this.o.horiz) cont.style.gridTemplateRows = `${frac}fr auto ${1 - frac}fr`;\n        else cont.style.gridTemplateColumns = `${frac}fr auto ${1 - frac}fr`;\n    }\n}\n\n\n\nfunction $2f9db344d0795d0e$var$minElement(array, f, obj, remove) {\n    if (array.length == 0) return null;\n    var i = 0, minEl = array[0], minValue = f.call(obj, minEl), minIndex = 0, tmp;\n    while(++i < array.length)if ((tmp = f.call(obj, array[i])) < minValue) {\n        minValue = tmp;\n        minIndex = i;\n        minEl = array[i];\n    }\n    if (remove) array.splice(minIndex, 1);\n    return minEl;\n}\nfunction $2f9db344d0795d0e$var$selectClosestFrameX(byx, pos) {\n    if (byx.length > 0) {\n        var x = byx.at(-1).getBox().left, a = [\n            byx.pop()\n        ];\n        while(byx.length > 0 && byx.at(-1).getBox().left == x)a.push(byx.pop());\n        return $2f9db344d0795d0e$var$minElement(a, function(f) {\n            return Math.abs(pos.top - f.getBox().top - f.getBox().height / 2);\n        });\n    }\n}\nfunction $2f9db344d0795d0e$var$selectClosestFrameY(byy, pos) {\n    if (byy.length > 0) {\n        var y = byy.at(-1).getBox().top, a = [\n            byy.pop()\n        ];\n        while(byy.length > 0 && byy.at(-1).getBox().top == y)a.push(byy.pop());\n        return $2f9db344d0795d0e$var$minElement(a, function(f) {\n            return Math.abs(pos.left - f.getBox().left - f.getBox().width / 2);\n        });\n    }\n}\nclass $2f9db344d0795d0e$export$e2cc12c8ba83ca65 extends (0, $08a06a2e99accb03$export$a829527ff4e4114a) {\n    static options = {\n        buffers: [],\n        frames: [],\n        cf_frameStyle: Object.create(null),\n        ls_keyName: \".ymacs\"\n    };\n    constructor(...args){\n        super(...args);\n        this.buffers = [\n            ...this.o.buffers\n        ];\n        this.frames = [\n            ...this.o.frames\n        ];\n        this.registers = Object.create(null);\n        this.cf_frameStyle = {\n            ...this.o.cf_frameStyle\n        };\n        this.buffers.forEach((b)=>{\n            b.ymacs = this;\n            this._addBufferListeners(b);\n        });\n        /* -----[ variables ]----- */ this.killRing = [];\n        this.killMasterOfRings = [];\n        /* -----[ macro vars ]----- */ // If present, keystrokes are stored in this list.\n        this.__macro_recording = null;\n        // This is the macro executed by C-x e and named by\n        // name-last-kbd-macro.\n        this.__macro_finished = null;\n        // Set when any buffer does signalError.  Tells us when to abort\n        // running a macro.\n        this.__error_thrown = false;\n        // A list if we're executing a macro.\n        this.__running_macro = null;\n        // A number of times to execute the current macro.\n        this.__macro_times = 0;\n        // Macro current step\n        this.__macro_step = 0;\n        // Timer for the macro\n        this.__macro_timer = null;\n        // Unbiased active frame\n        this.__input_frame = null;\n        /* -----[ minibuffer ]----- */ this.minibuffer = new (0, $5e779a545e33325b$export$36a0d48d1b18d0fa)({\n            ymacs: this\n        });\n        this.minibuffer.cmd(\"minibuffer_mode\");\n        this.minibuffer_frame = this.createFrame({\n            isMinibuffer: true,\n            buffer: this.minibuffer,\n            hidden: true\n        });\n        /* -----[ main content ]----- */ if (this.buffers.length == 0) this.createBuffer();\n        var frame = this.createFrame({\n            buffer: this.buffers[0]\n        });\n        this.add(frame);\n        this.add(this.minibuffer_frame);\n        this.setActiveFrame(frame);\n        frame.redrawCaret();\n    }\n    initClassName() {\n        return \"Ymacs Ymacs-cursor-block\";\n    }\n    _addBufferListeners(buf) {\n        buf.addEventListener(\"onDestroy\", ()=>{\n            var fr = this.getActiveFrame();\n            this.getBufferFrames(buf).forEach((f)=>{\n                if (f !== fr) this.deleteFrame(f);\n            });\n            (0, $08a06a2e99accb03$export$cd7f480d6b8286c3)(this.buffers, buf);\n            if (this.getActiveBuffer() === buf) this.nextHiddenBuffer(buf);\n        });\n    }\n    pushToKillRing(text, prepend) {\n        prepend ? this.killRing.unshift(text) : this.killRing.push(text);\n    }\n    killRingToMaster() {\n        if (this.killRing.length && (this.killMasterOfRings.length == 0 || this.killMasterOfRings.at(-1).join(\"\") != this.killRing.join(\"\"))) this.killMasterOfRings.push(this.killRing);\n        this.killRing = [];\n    }\n    killRingText() {\n        return this.killRing.join(\"\");\n    }\n    rotateKillRing(push) {\n        if (push) {\n            this.killMasterOfRings.push(this.killRing);\n            this.killRing = this.killMasterOfRings.shift();\n        } else {\n            this.killMasterOfRings.unshift(this.killRing);\n            this.killRing = this.killMasterOfRings.pop();\n        }\n    }\n    getBuffer(buf) {\n        if (!(buf instanceof (0, $5e779a545e33325b$export$df331bdfc76955b4))) buf = this.buffers.find((b)=>b.name == buf);\n        return buf;\n    }\n    killBuffer(buf) {\n        buf = this.getBuffer(buf);\n        this.callHooks(\"onDeleteBuffer\", buf);\n        buf.destroy();\n    }\n    renameBuffer(buf, name) {\n        buf = this.getBuffer(buf);\n        buf.name = name;\n        buf.callHooks(\"onModelineChange\");\n    }\n    _do_switchToBuffer(buf) {\n        this.getActiveFrame().setBuffer(buf);\n        this.callHooks(\"onBufferSwitch\", buf);\n    }\n    switchToBuffer(maybeName) {\n        var buf = this.getBuffer(maybeName), a = this.buffers;\n        if (!buf) // create new buffer\n        buf = this.createBuffer({\n            name: maybeName\n        });\n        (0, $08a06a2e99accb03$export$cd7f480d6b8286c3)(a, buf);\n        a.unshift(buf);\n        this._do_switchToBuffer(buf);\n        return buf;\n    }\n    nextHiddenBuffer(cur) {\n        var a = this.buffers.filter((buf)=>{\n            if (buf === cur) return false;\n            var hidden = true;\n            buf.forAllFrames(()=>hidden = false);\n            return hidden;\n        });\n        if (a.length > 0) {\n            var buf = a[0];\n            (0, $08a06a2e99accb03$export$cd7f480d6b8286c3)(this.buffers, buf);\n            this.buffers.push(buf);\n            this._do_switchToBuffer(buf);\n        } else this.switchToBuffer(\"*scratch*\");\n    }\n    switchToNextBuffer() {\n        var a = this.buffers;\n        if (a.length > 1) {\n            var buf = a.shift();\n            a.push(buf);\n            this._do_switchToBuffer(a[0]);\n        }\n    }\n    switchToPreviousBuffer() {\n        var a = this.buffers;\n        if (a.length > 1) {\n            var buf = a.pop();\n            a.unshift(buf);\n            this._do_switchToBuffer(buf);\n        }\n    }\n    getNextBuffer(buf, n) {\n        if (n == null) n = 1;\n        var a = this.buffers;\n        return a[(a.indexOf(buf) + n) % a.length];\n    }\n    getPrevBuffer(buf, n) {\n        if (n == null) n = 1;\n        return this.getNextBuffer(buf, -n);\n    }\n    getBufferFrames(buf) {\n        buf = this.getBuffer(buf);\n        return this.frames.filter((f)=>f.buffer === buf);\n    }\n    createBuffer(args = {}) {\n        var buf = new (0, $5e779a545e33325b$export$df331bdfc76955b4)({\n            ...args,\n            ymacs: this\n        });\n        this._addBufferListeners(buf);\n        if (!args.hidden) this.buffers.push(buf);\n        this.callHooks(\"onCreateBuffer\", buf);\n        return buf;\n    }\n    createFrame(args = {}) {\n        var frame = new (0, $9526afefc19b5eea$export$3230e5a51f22d844)({\n            ...args,\n            ymacs: this\n        });\n        if (!args.hidden) this.frames.unshift(frame);\n        frame.setStyle(this.cf_frameStyle);\n        return frame;\n    }\n    setFrameStyle(style) {\n        [\n            this.minibuffer_frame,\n            ...this.frames\n        ].forEach((frame)=>frame.setStyle(style));\n    }\n    keepOnlyFrame(frame) {\n        if (this.frames.length > 1) {\n            let el = frame.getElement();\n            while(el.parentNode != this.getContentElement())el = el.parentNode;\n            if (el !== frame) {\n                el.replaceWith(frame.getElement());\n                this.setActiveFrame(frame);\n                frame.centerOnCaret();\n                this.frames = [\n                    frame\n                ];\n            }\n        }\n    }\n    deleteFrame(frame) {\n        if (this.frames.length > 1) {\n            (0, $08a06a2e99accb03$export$cd7f480d6b8286c3)(this.frames, frame);\n            let parent = frame.getElement().parentNode;\n            let other = [\n                ...parent.children\n            ].find((el)=>{\n                let obj = el._ymacs_object;\n                return obj instanceof (0, $9526afefc19b5eea$export$7b0e4d18ade0c4c9) || obj instanceof (0, $9526afefc19b5eea$export$3230e5a51f22d844) && obj !== frame;\n            });\n            parent.replaceWith(other);\n            if (!(0, $08a06a2e99accb03$export$cb0933279c36a66b).hasClass(other, \"Ymacs_Frame\")) other = other.querySelector(\".Ymacs_Frame\");\n            other = other._ymacs_object;\n            this.setActiveFrame(other);\n            other.centerOnCaret();\n        }\n    }\n    focusOtherFrame() {\n        this.setActiveFrame(this.frames[0]);\n    }\n    getMainElement() {\n        const selector = `:scope > .Ymacs_Frame:not(.Ymacs_Minibuffer), :scope > .Ymacs_SplitCont`;\n        return this.getElement().querySelector(selector);\n    }\n    getFrameConfig() {\n        let dig = (el)=>{\n            if ((0, $08a06a2e99accb03$export$cb0933279c36a66b).hasClass(el, \"Ymacs_Frame\")) {\n                let frame = el._ymacs_object;\n                let div = frame.getOverlaysContainer();\n                return {\n                    buffer: frame.buffer.name,\n                    point: +frame.caretMarker,\n                    scroll: div.scrollTop / div.scrollHeight,\n                    active: frame === this.getActiveFrame()\n                };\n            } else {\n                let layout = el._ymacs_object;\n                let horiz = layout.o.horiz;\n                let style = window.getComputedStyle(el);\n                let rx = /^\\s*(\\d*(?:\\.\\d+)?)px\\s+(?:\\d*(?:\\.\\d+)?)px\\s+(\\d*(?:\\.\\d+)?)px\\s*$/;\n                let m = rx.exec(horiz ? style.gridTemplateRows : style.gridTemplateColumns);\n                let frac = +m[1] / (+m[1] + +m[2]);\n                return [\n                    horiz,\n                    frac,\n                    dig(el.children[0]),\n                    dig(el.children[2])\n                ];\n            }\n        };\n        return dig(this.getMainElement());\n    }\n    setFrameConfig(config) {\n        this.getMainElement()?.remove();\n        // 1. figure out if we already have some frames for the set of\n        // buffers that we'll need to switch to.\n        let buffers = [];\n        let frames = [\n            ...this.frames\n        ];\n        (function dig(el) {\n            if (Array.isArray(el)) {\n                dig(el[2]);\n                dig(el[3]);\n            } else {\n                for(let i = frames.length; --i >= 0;)if (frames[i].buffer?.name == el.buffer) {\n                    buffers.push([\n                        el.buffer,\n                        frames[i]\n                    ]);\n                    frames.splice(i, 1);\n                    break;\n                }\n            }\n        })(config);\n        let getBuffer = (bufferName)=>{\n            return this.getBuffer(bufferName) || this.createBuffer({\n                name: bufferName\n            });\n        };\n        // this will return a frame associated with the given buffer.\n        let getFrame = (bufferName, point)=>{\n            let i = buffers.findIndex(([buf])=>buf == bufferName);\n            if (i < 0) {\n                // if we don't have an associated frame...\n                if (frames.length > 0) {\n                    // there's still one to spare\n                    let fr = frames.pop();\n                    fr.setBuffer(getBuffer(bufferName, point));\n                    return fr;\n                } else // otherwise, create new frame.\n                return this.createFrame({\n                    buffer: getBuffer(bufferName),\n                    point: point\n                });\n            } else {\n                // found associated frame; remove it from the list.\n                let fr = buffers[i][1];\n                buffers.splice(i, 1);\n                return fr;\n            }\n        };\n        // 2. dig it again, this time creating widgets.\n        let ops = [];\n        let active = null;\n        let main = function dig(el) {\n            if (Array.isArray(el)) {\n                let split = new (0, $9526afefc19b5eea$export$7b0e4d18ade0c4c9)({\n                    horiz: el[0]\n                });\n                let frame1 = dig(el[2]);\n                let frame2 = dig(el[3]);\n                ops.push(()=>split.setSplit(frame1, frame2, el[1]));\n                return split;\n            } else {\n                let frame = getFrame(el.buffer, el.point);\n                if (el.active) active = frame;\n                ops.push(()=>{\n                    let div = frame.getOverlaysContainer();\n                    div.scrollTop = el.scroll * div.scrollHeight;\n                });\n                return frame;\n            }\n        }(config);\n        // at this point, if we still have any frames left (e.g. the\n        // editor had more frames than required by the new config),\n        // remove/destroy them.\n        frames.forEach((fr)=>{\n            (0, $08a06a2e99accb03$export$cd7f480d6b8286c3)(this.frames, fr);\n            fr.destroy();\n        });\n        let cont = this.getElement();\n        cont.insertBefore(main.getElement(), cont.firstElementChild);\n        // ops will contain operations to do after the elements are in\n        // the DOM.\n        ops.reverse().forEach((f)=>f());\n        // done, reset active frame.\n        this.setActiveFrame(active || this.frames[0]);\n    }\n    focus() {\n        this.frames.at(-1).focus();\n    }\n    setInputFrame(frame) {\n        this.__input_frame = frame;\n    }\n    setActiveFrame(frame, nofocus) {\n        if (!frame.isMinibuffer) {\n            var old = this.getActiveFrame();\n            if (old) old.delClass(\"Ymacs_Frame-active\");\n            (0, $08a06a2e99accb03$export$cd7f480d6b8286c3)(this.frames, frame);\n            this.frames.push(frame);\n            frame.addClass(\"Ymacs_Frame-active\");\n        }\n        this.__input_frame = frame;\n        if (!nofocus) frame.focus();\n    }\n    getActiveFrame() {\n        return this.frames.at(-1);\n    }\n    getActiveBuffer() {\n        var frame = this.getActiveFrame();\n        return frame ? frame.buffer : this.buffers.at(-1);\n    }\n    setColorTheme(themeId) {\n        this.delClass(/Ymacs-Theme-[^\\s]*/g);\n        if (!(themeId instanceof Array)) themeId = [\n            themeId\n        ];\n        themeId.forEach((themeId)=>{\n            this.addClass(\"Ymacs-Theme-\" + themeId);\n        });\n    }\n    cursorBar() {\n        this.delClass(\"Ymacs-cursor-block\");\n        this.addClass(\"Ymacs-cursor-bar\");\n    }\n    cursorBlock() {\n        this.delClass(\"Ymacs-cursor-bar\");\n        this.addClass(\"Ymacs-cursor-block\");\n    }\n    toggleBarCursor() {\n        if (this.hasClass(\"Ymacs-cursor-block\")) this.cursorBar();\n        else this.cursorBlock();\n    }\n    getFrameInDirection(dir) {\n        let frame = this.getActiveFrame();\n        let caret = frame.getCaretElement();\n        let box = caret.getBoundingClientRect();\n        var byx = [\n            ...this.frames\n        ].sort((a, b)=>a.getBox().left - b.getBox().left);\n        var byy = [\n            ...this.frames\n        ].sort((a, b)=>a.getBox().top - b.getBox().top);\n        switch(dir){\n            case \"left\":\n                return this._get_frameInDir_left(byx, byy, box, frame);\n            case \"right\":\n                return this._get_frameInDir_right(byx, byy, box, frame);\n            case \"up\":\n                return this._get_frameInDir_up(byx, byy, box, frame);\n            case \"down\":\n                return this._get_frameInDir_down(byx, byy, box, frame);\n        }\n        return this[\"_get_frameInDir_\" + dir](byx, byy, box, frame);\n    }\n    _get_frameInDir_left(byx, byy, pos, frame) {\n        byx = byx.filter((f)=>{\n            let p = f.getBox();\n            return f !== frame && p.left < pos.left && p.top - pos.height <= pos.top && p.top + p.height > pos.top;\n        });\n        return $2f9db344d0795d0e$var$selectClosestFrameX(byx, pos);\n    }\n    _get_frameInDir_right(byx, byy, pos, frame) {\n        byx.reverse();\n        byx = byx.filter((f)=>{\n            let p = f.getBox();\n            return f !== frame && p.left > pos.left && p.top - pos.height <= pos.top && p.top + p.height > pos.top;\n        });\n        return $2f9db344d0795d0e$var$selectClosestFrameX(byx, pos);\n    }\n    _get_frameInDir_up(byx, byy, pos, frame) {\n        byy = byy.filter((f)=>{\n            let p = f.getBox();\n            return f !== frame && p.top < pos.top && p.left - pos.width <= pos.left && p.left + p.width > pos.left;\n        });\n        return $2f9db344d0795d0e$var$selectClosestFrameY(byy, pos);\n    }\n    _get_frameInDir_down(byx, byy, pos, frame) {\n        byy.reverse();\n        byy = byy.filter((f)=>{\n            let p = f.getBox();\n            return f !== frame && p.top > pos.top && p.left - pos.width <= pos.left && p.left + p.width > pos.left;\n        });\n        return $2f9db344d0795d0e$var$selectClosestFrameY(byy, pos);\n    }\n    /* -----[ local storage ]----- */ ls_get() {\n        return this.ls_store || (this.ls_store = JSON.parse(localStorage.getItem(this.o.ls_keyName) || \"{}\"));\n    }\n    ls_set(src) {\n        this.ls_store = src;\n        localStorage.setItem(this.o.ls_keyName, JSON.stringify(src));\n    }\n    ls_getFileContents(name, nothrow) {\n        var info = this.ls_getFileDirectory(name), other = info.other, code;\n        if (other.length == 1) code = info.dir[other[0]];\n        if (code == null && !nothrow) throw new (0, $541ef653595620bf$export$c411e7bd03572a3a)(\"File not found\");\n        return code;\n    }\n    ls_setFileContents(name, content) {\n        var files = this.ls_getFileDirectory(name, \"file\");\n        files.dir[files.other[0]] = content;\n        this.ls_set(files.store);\n    }\n    ls_getFileDirectory(name, create) {\n        var store, dir = store = this.ls_get(), back = [];\n        name = name.replace(/^[~\\x2f]+/, \"\").split(/\\x2f+/);\n        var path = [], other = [];\n        while(name.length > 0){\n            var part = name.shift();\n            if (part == \".\") continue;\n            if (part == \"..\") {\n                path.pop();\n                dir = back.pop();\n            } else if (part == \"~\") {\n                path = [];\n                other = [];\n                back = [];\n                dir = store;\n            } else if (Object.hasOwn(dir, part) && typeof dir[part] != \"string\") {\n                back.push(dir);\n                dir = dir[part];\n                path.push(part);\n            } else other.push(part);\n        }\n        if (create) {\n            var n = create == \"file\" ? 1 : 0;\n            while(other.length > n)dir = dir[other.shift()] = {};\n            this.ls_set(store);\n        }\n        return {\n            store: store,\n            dir: dir,\n            path: path,\n            other: other,\n            full: path.concat(other).join(\"/\")\n        };\n    }\n    ls_deleteFile(name) {\n        var info = this.ls_getFileDirectory(name);\n        delete info.dir[info.other.join(\"/\")];\n        this.ls_set(info.store);\n    }\n    /* -----[ filesystem operations ]----- */ fs_normalizePath(path) {\n        path = path.replace(/^[~\\x2f]+/, \"\").split(/\\x2f+/);\n        var ret = [];\n        while(path.length > 0){\n            var x = path.shift();\n            if (x != \".\") {\n                if (x == \"..\") ret.pop();\n                else if (x == \"~\") ret = [];\n                else ret.push(x);\n            }\n        }\n        return ret.join(\"/\");\n    }\n    fs_fileType(name, cont) {\n        let { other: other, dir: dir } = this.ls_getFileDirectory(name);\n        if (other.length > 0) return cont(!other[0] ? \"directory\" : typeof dir[other[0]] == \"string\" ? \"file\" : \"new\");\n        else return cont(\"directory\");\n    }\n    fs_getFileContents(name, nothrow, cont) {\n        var code = this.ls_getFileContents(name, nothrow);\n        cont(code, code); // second parameter is file stamp, on a real fs it should be last modification time\n    }\n    fs_setFileContents(name, content, stamp, cont) {\n        if (stamp && (this.ls_getFileContents(name, true) || \"\") != stamp) cont(null); // did not change file because stamp is wrong\n        else {\n            this.ls_setFileContents(name, content);\n            cont(content);\n        }\n    }\n    fs_sortDirectoryEntries(dir) {\n        return Object.keys(dir).sort((a, b)=>{\n            a = a.toLowerCase();\n            b = b.toLowerCase();\n            let adir = typeof dir[a] != \"string\";\n            let bdir = typeof dir[b] != \"string\";\n            if (adir && !bdir) return -1;\n            if (bdir && !adir) return 1;\n            if (!adir && !bdir) {\n                let aobj = this.fs_isObjectFileName(a);\n                let bobj = this.fs_isObjectFileName(b);\n                if (aobj && !bobj) return 1;\n                if (bobj && !aobj) return -1;\n            }\n            return a < b ? -1 : a > b ? 1 : 0;\n        });\n    }\n    fs_isObjectFileName(filename) {\n        return /\\.fasl$/i.test(filename);\n    }\n    fs_getDirectory(dirname, cont) {\n        var info = this.ls_getFileDirectory(dirname, false);\n        dirname = info.path.join(\"/\"); // normalized\n        if (info) {\n            var files = {};\n            for (let f of this.fs_sortDirectoryEntries(info.dir))files[f] = {\n                name: f,\n                path: dirname + \"/\" + f,\n                type: typeof info.dir[f] == \"string\" ? \"file\" : \"directory\"\n            };\n            cont(files);\n        } else cont(null);\n    }\n    fs_deleteFile(name, cont) {\n        this.ls_deleteFile(name);\n        cont();\n    }\n    fs_remapDir(dir, cont) {\n        cont(dir);\n    }\n    isRunningMacro() {\n        return !!this.__running_macro;\n    }\n    isRecordingMacro() {\n        return !!this.__macro_recording;\n    }\n    indicateError() {\n        this.__error_thrown = true;\n    }\n    startMacro(do_append) {\n        if (this.isRecordingMacro()) return false;\n        if (do_append) {\n            this.__macro_recording = this.__macro_finished || [];\n            this.__macro_finished = null;\n        } else this.__macro_recording = [];\n        return true;\n    }\n    stopMacro() {\n        if (this.__macro_recording) {\n            this.__macro_finished = this.__macro_recording;\n            this.__macro_recording = null;\n        }\n    }\n    getLastMacro() {\n        return this.__macro_finished;\n    }\n    stepMacro() {\n        while(true){\n            if (this.__macro_step >= this.__running_macro.length) {\n                this.__macro_times--;\n                this.__macro_step = 0;\n            }\n            if (this.__macro_times == 0 || this.__error_thrown) {\n                this.__macro_times = 0;\n                this.__macro_step = 0;\n                this.__running_macro = null;\n                return;\n            }\n            var ev = this.__running_macro[this.__macro_step];\n            this.processKeyEvent(ev);\n            this.__macro_step++;\n        }\n    }\n    runMacro(times, macro) {\n        if (this.isRecordingMacro()) return false;\n        this.__error_thrown = false;\n        this.__running_macro = macro;\n        this.__macro_step = 0;\n        this.__macro_times = times;\n        var self = this;\n        setTimeout(function() {\n            self.stepMacro();\n        }, 0);\n        return true;\n    }\n    processKeyEvent(ev) {\n        var frame = this.__input_frame;\n        var buffer = frame.buffer;\n        if (this.__macro_recording) this.__macro_recording.push(ev);\n        return buffer._handleKeyEvent(ev);\n    }\n    #timer_popupMessage = null;\n    popupMessage({ type: type = \"info\", text: text, isHtml: isHtml = false, atCaret: atCaret = false, timeout: timeout }) {\n        let popup = this.__popup || (this.__popup = new (0, $ec4394da1a74075f$export$731251e1d39d8621)());\n        let el = popup.getElement();\n        popup.condClass(atCaret, \"with-arrow\");\n        if (!atCaret) {\n            el.style.removeProperty(\"left\");\n            el.style.removeProperty(\"top\");\n            el.style.removeProperty(\"bottom\");\n            el.style.removeProperty(\"right\");\n            el.style.removeProperty(\"transform\");\n        }\n        if (!isHtml) text = (0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(text);\n        popup.setContent(text);\n        if (atCaret) this._popupAtCaret(popup.getElement());\n        else this.add(popup);\n        clearTimeout(this.#timer_popupMessage);\n        if (timeout) this.#timer_popupMessage = setTimeout(this.clearPopupMessage.bind(this), timeout);\n    }\n    clearPopupMessage() {\n        if (this.__popup) this.__popup.getElement().remove();\n    }\n    requestFullScreen() {\n        return this.getElement().requestFullscreen();\n    }\n    _popupAtCaret(el) {\n        el.style.visibility = \"hidden\";\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).delClass(el, /ppos-[a-z-]+/ig);\n        this.add(el);\n        let mybox = this.getElement().getBoundingClientRect();\n        let caret = this.__input_frame.getCaretElement();\n        let cbox = caret.getBoundingClientRect();\n        let cbox_center = {\n            x: (cbox.left + cbox.right) / 2,\n            y: (cbox.top + cbox.bottom) / 2\n        };\n        let mybox_center = {\n            x: (mybox.left + mybox.right) / 2,\n            y: (mybox.top + mybox.bottom) / 2\n        };\n        if (cbox_center.y > mybox_center.y) {\n            if (cbox_center.x < mybox_center.x) {\n                (0, $08a06a2e99accb03$export$cb0933279c36a66b).addClass(el, \"ppos-top-right\");\n                el.style.transform = `translate(0, calc(-100% - ${cbox.height / 2}px))`;\n            } else {\n                (0, $08a06a2e99accb03$export$cb0933279c36a66b).addClass(el, \"ppos-top-left\");\n                el.style.transform = `translate(-100%, calc(-100% - ${cbox.height / 2}px))`;\n            }\n        } else if (cbox_center.x < mybox_center.x) {\n            (0, $08a06a2e99accb03$export$cb0933279c36a66b).addClass(el, \"ppos-bot-right\");\n            el.style.transform = `translate(0, ${cbox.height / 2}px)`;\n        } else {\n            (0, $08a06a2e99accb03$export$cb0933279c36a66b).addClass(el, \"ppos-bot-left\");\n            el.style.transform = `translate(-100%, ${cbox.height / 2}px)`;\n        }\n        el.style.left = cbox_center.x - mybox.left + \"px\";\n        el.style.top = cbox_center.y - mybox.top + \"px\";\n        el.style.removeProperty(\"visibility\");\n    }\n    jumpToRegister(reg) {\n        let value = this.registers[reg];\n        if (value == null) return false;\n        if (value.frames) {\n            this.setFrameConfig(value.frames);\n            return true;\n        }\n    }\n    makeDialog(options) {\n        let dlg = new $2f9db344d0795d0e$export$d74b4745301088ce({\n            ...options,\n            ymacs: this\n        });\n        this.add(dlg);\n        return dlg;\n    }\n}\nfunction $2f9db344d0795d0e$var$cssSize(prop) {\n    if (typeof prop == \"number\") {\n        if (prop <= 1 && prop > 0) prop = prop * 100 + \"%\";\n        else prop += \"px\";\n    }\n    return prop;\n}\nclass $2f9db344d0795d0e$export$d74b4745301088ce extends (0, $08a06a2e99accb03$export$a829527ff4e4114a) {\n    static options = {\n        draggable: false,\n        resizable: false,\n        closable: false,\n        content: null,\n        centered: false,\n        width: \"40%\",\n        height: \"50%\",\n        ymacs: null\n    };\n    constructor(...args){\n        super(...args);\n        this.ymacs = this.o.ymacs;\n        let cont = this.getElement();\n        let content = this.o.content;\n        if (typeof content == \"function\") content = content.call(this, cont, this);\n        if (content) cont.appendChild(content);\n        if (this.o.resizable) cont.style.resize = \"both\";\n        if (this.o.width) cont.style.width = $2f9db344d0795d0e$var$cssSize(this.o.width);\n        if (this.o.height) cont.style.height = $2f9db344d0795d0e$var$cssSize(this.o.height);\n        if (this.o.closable) {\n            if (this.o.closable === true) {\n                let el = (0, $08a06a2e99accb03$export$cb0933279c36a66b).fromHTML(`<div class=\"close-button\"></div>`);\n                cont.appendChild(el);\n                this.o.closable = el;\n            }\n            (0, $08a06a2e99accb03$export$cb0933279c36a66b).on(this.o.closable, {\n                mousedown: (ev)=>ev.stopPropagation(),\n                click: this._closeClick.bind(this)\n            });\n        }\n        if (this.o.draggable) {\n            if (this.o.draggable === true) this.o.draggable = cont;\n            this._dragHandlers = {\n                mousemove: this._dragMouseMove.bind(this),\n                mouseup: this._dragMouseUp.bind(this)\n            };\n            (0, $08a06a2e99accb03$export$cb0933279c36a66b).on(this.o.draggable, \"mousedown\", this._dragMouseDown.bind(this));\n        }\n    }\n    initClassName() {\n        let a = [\n            \"Ymacs_Dialog\"\n        ];\n        if (this.o.centered) a.push(\"centered\");\n        return a.join(\" \");\n    }\n    close() {\n        this.getElement().remove();\n        this.destroy();\n        this.ymacs.focus();\n        this.callHooks(\"onClose\");\n    }\n    _closeClick(ev) {\n        ev.stopPropagation();\n        this.close();\n    }\n    _dragMouseDown(ev) {\n        ev.stopPropagation();\n        let cont = this.getElement();\n        this._dragging = {\n            orig: (0, $08a06a2e99accb03$export$cb0933279c36a66b).relPos(cont),\n            start: (0, $08a06a2e99accb03$export$cb0933279c36a66b).mousePos(ev, cont.offsetParent),\n            focus: document.activeElement\n        };\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).on(window, this._dragHandlers);\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).overlayOn(\"Ymacs_Resize_move\");\n    }\n    _dragMouseMove(ev) {\n        let cont = this.getElement();\n        let mouse = (0, $08a06a2e99accb03$export$cb0933279c36a66b).mousePos(ev, cont.offsetParent);\n        let drg = this._dragging;\n        let dx = mouse.x - drg.start.x;\n        let dy = mouse.y - drg.start.y;\n        cont.style.removeProperty(\"bottom\");\n        cont.style.removeProperty(\"right\");\n        cont.style.left = drg.orig.x + dx + \"px\";\n        cont.style.top = drg.orig.y + dy + \"px\";\n    }\n    _dragMouseUp(ev) {\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).off(window, this._dragHandlers);\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).overlayOff();\n        this._dragging.focus?.focus();\n        this._dragging = null;\n    }\n}\n\n\n\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\nconst $c749180882ef16eb$var$TOK_DELAY = 10;\nclass $c749180882ef16eb$export$2f1022027d35d1bb {\n    constructor({ buffer: buffer = null, line: line = 0, col: col = 0 } = {}){\n        this.buffer = buffer;\n        this.line = line;\n        this.col = col;\n    }\n    nextLine() {\n        ++this.line;\n        this.col = 0;\n        return this.line < this.buffer.code.length;\n    }\n    prevLine() {\n        --this.line;\n        this.col = 0;\n        return this.line >= 0;\n    }\n    peek(n = 0) {\n        if (this.line < this.buffer.code.length) {\n            let pos = this.col + n;\n            let line = this.buffer.code[this.line];\n            if (pos < line.length) return line.charAt(pos);\n            if (pos == line.length) return \"\\n\";\n        }\n    }\n    lineText(row = this.line) {\n        return this.buffer.code[row];\n    }\n    lineIndentation(row = this.line) {\n        return /^\\s*/.exec(this.lineText(row))[0].length;\n    }\n    lookingAt(what) {\n        if (this.line < this.buffer.code.length) {\n            var line = this.buffer.code[this.line];\n            if (what instanceof RegExp) return what.exec(line.substr(this.col));\n            else return line.substr(this.col, what.length) == what ? [\n                what\n            ] : null;\n        }\n    }\n    textBefore(pos) {\n        if (pos == null) pos = this.buffer._rowColToPosition(this.line, this.col);\n        return this.buffer.getCode().substr(0, pos);\n    }\n    textAfter(pos) {\n        if (pos == null) pos = this.buffer._rowColToPosition(this.line, this.col);\n        return this.buffer.getCode().substr(pos);\n    }\n    substring(start, end) {\n        return this.buffer.getCode().substring(start, end);\n    }\n    substr(start, end) {\n        return this.buffer.getCode().substr(start, end);\n    }\n    eol() {\n        return this.col >= this.buffer.code[this.line].length;\n    }\n    eof() {\n        var n = this.buffer.code.length, l = this.line;\n        return l >= n || l == n - 1 && this.eol();\n    }\n    stopAt(line, col, stop = this.EOF) {\n        this.__stop = {\n            line: line,\n            col: col,\n            stop: stop\n        };\n    }\n    length() {\n        return this.buffer.code.length;\n    }\n    lineLength(line) {\n        if (line == null) line = this.line;\n        return this.buffer.code[line].length;\n    }\n    save() {\n        return {\n            buffer: this.buffer,\n            line: this.line,\n            col: this.col\n        };\n    }\n    restore(state) {\n        this.buffer = state.buffer;\n        this.line = state.line;\n        this.col = state.col;\n    }\n    checkStop() {\n        if (this.eof()) throw this.EOF;\n        if (this.eol()) throw this.EOL;\n        let stop = this.__stop;\n        if (stop) {\n            if (this.line > stop.line || this.line == stop.line && this.col >= stop.col) {\n                this.__stop = null;\n                throw stop.stop ?? this.EOF;\n            }\n        }\n    }\n}\n$c749180882ef16eb$export$2f1022027d35d1bb.prototype.EOL = {};\n$c749180882ef16eb$export$2f1022027d35d1bb.prototype.EOF = {};\nclass $c749180882ef16eb$export$825fc0b420d392c1 {\n    constructor({ buffer: buffer = null, line: line = 0, col: col = 0, pos: pos = null } = {}){\n        this.buffer = buffer;\n        this.line = line;\n        this.col = col;\n        this.pos = pos;\n        if (this.pos == null) this.pos = this.buffer._rowColToPosition(this.line, this.col);\n        else {\n            var rc = this.buffer._positionToRowCol(this.pos);\n            this.line = rc.row;\n            this.col = rc.col;\n        }\n    }\n    static is_whitespace(ch) {\n        switch(ch){\n            case \" \":\n            case \"\\n\":\n            case \"\\t\":\n            case \"\\x0C\":\n            case \"\\u2028\":\n            case \"\\u2029\":\n            case \"\\xA0\":\n                return true;\n        }\n    }\n    peek() {\n        var a = this.buffer.code;\n        var line = a[this.line];\n        if (line == null) return null;\n        if (this.col == line.length) return this.line == a.length - 1 ? null : \"\\n\";\n        return line.charAt(this.col);\n    }\n    next() {\n        var ch = this.peek();\n        if (ch) {\n            ++this.pos;\n            ++this.col;\n            if (this.col > this.buffer.code[this.line].length) {\n                this.col = 0;\n                ++this.line;\n            }\n        }\n        return ch;\n    }\n    read_while(pred) {\n        var ret = \"\", ch;\n        while((ch = this.peek()) && pred(ch))ret += this.next();\n        return ret;\n    }\n    skip_ws() {\n        return this.read_while(this.is_whitespace);\n    }\n    looking_at(what) {\n        var line = this.buffer.code[this.line];\n        if (what instanceof RegExp) return what.exec(line.substr(this.col));\n        else return line.substr(this.col, what.length) == what;\n    }\n}\n$c749180882ef16eb$export$825fc0b420d392c1.prototype.is_whitespace = $c749180882ef16eb$export$825fc0b420d392c1.is_whitespace;\nlet $c749180882ef16eb$var$LANGUAGES = Object.create(null);\nclass $c749180882ef16eb$export$3964ae1c660db960 extends (0, $08a06a2e99accb03$export$76712d54f90f7348) {\n    static define(name, func) {\n        $c749180882ef16eb$var$LANGUAGES[name.toLowerCase()] = func;\n    }\n    constructor({ buffer: buffer, type: type }){\n        super();\n        if (typeof type == \"string\") type = $c749180882ef16eb$var$LANGUAGES[type.toLowerCase()];\n        this.buffer = buffer;\n        this.type = type;\n    }\n    reset() {\n        this.stream = new $c749180882ef16eb$export$2f1022027d35d1bb({\n            buffer: this.buffer\n        });\n        this.theParser = this.type(this.stream, this);\n        this.parsers = [\n            this.theParser.copy()\n        ];\n        this.timerUpdate = null;\n        this.start();\n    }\n    stop() {\n        clearTimeout(this.timerUpdate);\n    }\n    getLanguage(name, options) {\n        return $c749180882ef16eb$var$LANGUAGES[name](this.stream, this, options);\n    }\n    start() {\n        this.stop();\n        let stream = this.stream, p, a = this.parsers;\n        stream.line = a.length - 1;\n        stream.col = 0;\n        while(!(p = a[stream.line]))stream.prevLine();\n        p = p();\n        let doit = ()=>{\n            this.buffer.preventUpdates();\n            let n = 100;\n            while(true)try {\n                while(true)p.next();\n            } catch (ex) {\n                if (ex === stream.EOL) {\n                    stream.nextLine();\n                    a[stream.line] = p.copy();\n                    if (--n == 0) {\n                        this.buffer.resumeUpdates();\n                        this.timerUpdate = setTimeout(doit, $c749180882ef16eb$var$TOK_DELAY);\n                        return;\n                    }\n                } else if (ex === stream.EOF) {\n                    this.buffer.resumeUpdates();\n                    break;\n                } else throw ex;\n            }\n        };\n        doit();\n    }\n    quickInsertLine(row) {\n        this.truncate(row);\n    }\n    quickDeleteLine(row) {\n        this.truncate(row);\n    }\n    onToken(line, c1, c2, type) {\n        this.callHooks(\"onFoundToken\", line, c1, c2, type);\n    }\n    getParserForLine(row, col = 0) {\n        this.stop();\n        let stream = this.stream, p, a = this.parsers;\n        stream.line = row;\n        stream.col = 0;\n        while(!(p = a[stream.line]))stream.prevLine();\n        if (col != null) stream.stopAt(row, col);\n        p = p();\n        try {\n            this.buffer.preventUpdates();\n            while(true){\n                if (col == null && stream.line == row) return p;\n                try {\n                    while(true)p.next();\n                } catch (ex) {\n                    if (ex === stream.EOL) {\n                        stream.nextLine();\n                        a[stream.line] = p.copy();\n                    } else if (ex === stream.EOF) return p;\n                    else throw ex;\n                }\n            }\n        } finally{\n            this.buffer.resumeUpdates();\n            if (stream.line < stream.length()) this.timerUpdate = setTimeout(this.start.bind(this, stream.line), $c749180882ef16eb$var$TOK_DELAY);\n        }\n    }\n    parseUntil(row, col) {\n        return this.getParserForLine(row, col);\n    }\n    reparseAll() {\n        this.truncate(0);\n        return this.finishParsing();\n    }\n    finishParsing() {\n        this.getParserForLine(this.stream.length(), null);\n        return this.getLastParser();\n    }\n    getLastParser() {\n        return this.parsers.at(-1);\n    }\n    getIndentation(row, buffer) {\n        var p = this.getParserForLine(row, null);\n        if (p && p.indentation instanceof Function) return p.indentation(buffer);\n    }\n    truncate(row) {\n        row++;\n        if (this.parsers.length > row) this.parsers.length = row;\n    }\n    getPP() {\n        let pp = this.theParser.passedParens;\n        if (pp instanceof Function) pp = pp();\n        return pp ? [\n            ...pp\n        ].sort($c749180882ef16eb$export$2b0c642afb0ae4ca) : [];\n    }\n}\nfunction $c749180882ef16eb$export$2b0c642afb0ae4ca(p1, p2) {\n    return (p1.row ?? p1.line) < (p2.row ?? p2.line) ? -1 : (p1.row ?? p1.line) > (p2.row ?? p2.line) ? 1 : (p1.col ?? p1.c1) - (p2.col ?? p2.c1);\n}\nfunction $c749180882ef16eb$export$f6a9bcac20db9551(caret, zone) {\n    return (p)=>p.closed && zone == \"outer\" && p.outer ? $c749180882ef16eb$export$2b0c642afb0ae4ca({\n            line: p.outer.l1,\n            col: p.outer.c1\n        }, caret) < 0 && $c749180882ef16eb$export$2b0c642afb0ae4ca({\n            line: p.outer.l2,\n            col: p.outer.c2\n        }, caret) >= 0 : zone == \"inner\" && p.inner ? $c749180882ef16eb$export$2b0c642afb0ae4ca({\n            line: p.inner.l1,\n            col: p.inner.c1\n        }, caret) <= 0 && $c749180882ef16eb$export$2b0c642afb0ae4ca({\n            line: p.inner.l2,\n            col: p.inner.c2\n        }, caret) >= 0 : $c749180882ef16eb$export$2b0c642afb0ae4ca(p, caret) < 0 && $c749180882ef16eb$export$2b0c642afb0ae4ca(p.closed, caret) >= 0;\n}\n\n\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\n\n\n\nfunction $c7731ae7d5abaea3$var$TMPL_CHAR_INFO({ ch: ch, code: code, codeHex: codeHex, point: point, sizeKB: sizeKB }) {\n    return `\n<table>\n  <tr><td style='text-align: right; font-weight: bold'>Char:</td><td><tt> ${ch} </tt></td></tr>\n  ${code != null ? `\n    <tr><td style='text-align: right; font-weight: bold'>Char code:</td><td> ${code} / 0x${codeHex} </td></tr>\n  ` : \"\"}\n  <tr><td style='text-align: right; font-weight: bold'>Position:</td><td> ${point} </td></tr>\n  <tr><td style='text-align: right; font-weight: bold'>Buffer size:</td><td> ${sizeKB} </td></tr>\n</table>`;\n}\nlet $c7731ae7d5abaea3$var$help_keymap = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"help\", {\n    \"q\": \"bury_buffer\"\n});\nlet $c7731ae7d5abaea3$var$read_register_keymap = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"read_register\", {\n    \"Escape && C-g\": function() {\n        this.popKeymap($c7731ae7d5abaea3$var$read_register_keymap);\n        this.setMinibuffer(\"\");\n    }\n});\n$c7731ae7d5abaea3$var$read_register_keymap.defaultHandler = [\n    function() {\n        var ev = this.interactiveEvent();\n        var ch = ev.key;\n        if (ch.length != 1) this.signalError(\"Non-character input event\");\n        else {\n            this.getq(\"read_register_callback\")(ch);\n            this.setq(\"read_register_callback\");\n        }\n        this.popKeymap($c7731ae7d5abaea3$var$read_register_keymap);\n        this.setMinibuffer(\"\");\n        return true;\n    }\n];\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n    forward_char: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(x) {\n        if (x == null) x = 1;\n        return this.cmd(\"goto_char\", this.point() + x);\n    }),\n    backward_char: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(x) {\n        if (x == null) x = 1;\n        return this.cmd(\"forward_char\", -x);\n    }),\n    forward_line: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(x) {\n        if (x == null) x = 1;\n        var rc = this._rowcol;\n        if (!/^(forward|backward)_line$/.test(this.previousCommand)) this.setq(\"line_movement_requested_col\", rc.col);\n        var ret = this.cmd(\"goto_char\", this._rowColToPosition(rc.row + x, Math.max(rc.col, this.getq(\"line_movement_requested_col\"))));\n        if (!ret) this.setq(\"line_movement_requested_col\", rc.col);\n        return ret;\n    }),\n    backward_line: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(x) {\n        if (x == null) x = 1;\n        return this.cmd(\"forward_line\", -x);\n    }),\n    forward_whitespace: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"P\", function(noLine) {\n        var re = noLine ? /[^\\x20\\t\\xA0]/g : /[^\\s]/g;\n        if (this.cmd(\"search_forward_regexp\", re)) {\n            this.cmd(\"backward_char\");\n            return true;\n        } else if (!noLine) return this.cmd(\"end_of_buffer\");\n    }),\n    backward_whitespace: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"P\", function(noLine) {\n        var re = noLine ? /[^\\x20\\t\\xA0]/g : /[^\\s]/g;\n        if (this.cmd(\"search_backward_regexp\", re)) {\n            this.cmd(\"forward_char\");\n            return true;\n        } else if (!noLine) return this.cmd(\"beginning_of_buffer\");\n    }),\n    beginning_of_line: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        return this.cmd(\"goto_char\", this._rowColToPosition(this._rowcol.row, 0));\n    }),\n    back_to_indentation: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        var rc = this._rowcol, line = this.code[rc.row], m = /\\S/.exec(line);\n        if (m) return this.cmd(\"goto_char\", this._rowColToPosition(rc.row, m.index));\n    }),\n    beginning_of_indentation_or_line: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        return this.cmd(\"back_to_indentation\") || this.cmd(\"beginning_of_line\");\n    }),\n    end_of_line: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        var rc = this._rowcol;\n        return this.cmd(\"goto_char\", this._rowColToPosition(rc.row, this.code[rc.row].length));\n    }),\n    beginning_of_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        return this.cmd(\"goto_char\", 0);\n    }),\n    end_of_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        return this.cmd(\"goto_char\", this.getCodeSize());\n    }),\n    eob_p: function() {\n        return this.point() == this.getCodeSize();\n    },\n    bob_p: function() {\n        return this.point() == 0;\n    },\n    eol_p: function() {\n        var rc = this._positionToRowCol(this.point());\n        return rc.col == this.code[rc.line].length;\n    },\n    bol_p: function() {\n        return this._positionToRowCol(this.point()).col == 0;\n    },\n    backward_delete_char: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^p\", function(n) {\n        if (!this.deleteTransientRegion()) {\n            if (n == null) n = 1;\n            var pos = this.point();\n            if (pos > 0) this._deleteText(pos - n, pos);\n        }\n    }),\n    delete_char: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^p\", function(n) {\n        if (!this.deleteTransientRegion()) {\n            if (n == null) n = 1;\n            var pos = this.point();\n            this._deleteText(pos, pos + n);\n        }\n    }),\n    delete_whitespace: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^P\", function(noLine) {\n        if (!this.deleteTransientRegion()) {\n            var p = this.point();\n            if (this.cmd(\"forward_whitespace\", noLine)) {\n                this._deleteText(p, this.point());\n                return true;\n            }\n        }\n    }),\n    backward_delete_whitespace: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^P\", function(noLine) {\n        if (!this.deleteTransientRegion()) {\n            var p = this.point();\n            if (this.cmd(\"backward_whitespace\", noLine)) {\n                this._deleteText(this.point(), p);\n                return true;\n            }\n        }\n    }),\n    delete_indentation: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"P\", function(nextLine) {\n        if (nextLine) this.cmd(\"forward_line\");\n        this.cmd(\"back_to_indentation\");\n        this.cmd(\"backward_delete_whitespace\");\n        this.cmd(\"insert\", \" \");\n    }),\n    universal_argument: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function() {\n        this.pushKeymap((0, $2a60837ab2b03436$export$7f1c7eed09402475));\n        if (!this.isMinibuffer) this.setMinibuffer(\"C-u\");\n    }),\n    overwrite_mode: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.resetOverwriteMode();\n    }),\n    self_insert_command: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^p\", function(repeat) {\n        var ev = this.interactiveEvent();\n        var ch = ev.key;\n        var rc = this._rowcol;\n        if (ch.length == 1 && !ev.altKey && !ev.ctrlKey) {\n            this.deleteTransientRegion();\n            if (repeat != null) ch = ch.repeat(repeat);\n            if (this.overwriteMode) {\n                var line = this.code[rc.row], left = line.length - rc.col;\n                if (left > 0) this.cmd(\"delete_char\", Math.min(left, repeat || 1));\n            }\n            this.cmd(\"insert\", ch);\n            return true;\n        }\n        return false;\n    }),\n    newline: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^p\", function(n) {\n        if (n == null) n = 1;\n        this.deleteTransientRegion();\n        this.cmd(\"insert\", \"\\n\".repeat(n));\n    }),\n    newline_and_indent: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^p\", function(n) {\n        if (n) this.cmd(\"newline\", n);\n        else {\n            this.cmd(\"backward_delete_whitespace\", true);\n            this.cmd(\"newline\");\n            this.cmd(\"indent_line\");\n        }\n    }),\n    stupid_indent: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {}),\n    indent_line: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"P\", function(noEmpty) {\n        if (!this.tokenizer) this.cmd(\"insert\", \" \".repeat(this.getq(\"indent_line\")));\n        else {\n            let indent = this.tokenizer.getIndentation(this._rowcol.row, this);\n            if (indent != null) {\n                let line = this.getLine();\n                if (!noEmpty || /\\S/.test(line)) {\n                    let rc = this._rowcol;\n                    let pos = this.point() - rc.col;\n                    let ci = /[^\\S\\r\\n]*/.exec(line)[0].length;\n                    if (ci > indent) this._deleteText(pos, pos + ci - indent);\n                    else if (indent > ci) this._insertText(\" \".repeat(indent - ci), pos);\n                    if (rc.col <= ci) this.cmd(\"goto_char\", pos + indent);\n                }\n            }\n        }\n    }),\n    indent_region: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\", function(begin, end) {\n        if (end < begin) [begin, end] = [\n            end,\n            begin\n        ];\n        this.cmd(\"save_excursion\", function() {\n            var m = this.createMarker(end);\n            this.cmd(\"goto_char\", begin);\n            while(this.point() < m.getPosition()){\n                this.cmd(\"indent_line\", true);\n                this.cmd(\"beginning_of_line\");\n                if (!this.cmd(\"forward_line\")) break;\n            }\n            m.destroy();\n        });\n    }),\n    make_marker: function(pos) {\n        return this.createMarker(pos);\n    },\n    looking_at: function() {\n        return this.looking_at.apply(this, arguments);\n    },\n    looking_back: function() {\n        return this.looking_back.apply(this, arguments);\n    },\n    search_forward: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"sSearch: \", function(str, bound) {\n        var code = this.getCode(), point = this.point();\n        if (this.getq(\"case_fold_search\")) {\n            code = code.toLowerCase();\n            str = str.toLowerCase();\n        }\n        var pos = code.indexOf(str, point);\n        if (pos >= 0 && (bound == null || pos <= bound)) return this.cmd(\"goto_char\", pos + str.length);\n    }),\n    search_backward: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"sSearch backward: \", function(str, bound) {\n        var code = this.getCode(), point = this.point();\n        if (this.getq(\"case_fold_search\")) {\n            code = code.toLowerCase();\n            str = str.toLowerCase();\n        }\n        var pos = code.lastIndexOf(str, point);\n        if (pos == point) pos = code.lastIndexOf(str, point - 1);\n        if (pos >= 0 && pos != point && (bound == null || pos >= bound)) return this.cmd(\"goto_char\", pos);\n    }),\n    make_regexp: function(rx) {\n        if (!(rx instanceof RegExp)) {\n            var matchCase = !this.getq(\"case_fold_search\");\n            try {\n                rx = new RegExp(rx, matchCase ? \"mug\" : \"mugi\");\n            } catch (ex) {\n                throw new (0, $541ef653595620bf$export$c411e7bd03572a3a)(\"Invalid regexp\");\n            }\n        }\n        return rx;\n    },\n    search_forward_regexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"sRegExp search: \", function(rx) {\n        rx = this.cmd(\"make_regexp\", rx);\n        let pos = rx.lastIndex = this.point();\n        let m = rx.exec(this.getCode());\n        if (m && rx.lastIndex != pos) {\n            m.after = rx.lastIndex;\n            this.matchData = m;\n            this.cmd(\"goto_char\", rx.lastIndex);\n            return true;\n        }\n    }),\n    search_backward_regexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"sBackward RegExp search: \", function(rx) {\n        rx = this.cmd(\"make_regexp\", rx);\n        var m = this.lastIndexOfRegexp(this.getCode(), rx, this.point());\n        if (m && m.index != this.point()) {\n            this.cmd(\"goto_char\", m.index);\n            return true;\n        }\n    }),\n    forward_word: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        var syntax_word = this.getq(\"syntax_word\"), end = false;\n        while(!end && !syntax_word.test(this.charAt()))if (!this.cmd(\"forward_char\")) end = true;\n        while(!end && syntax_word.test(this.charAt()))if (!this.cmd(\"forward_char\")) end = true;\n    }),\n    backward_word: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        var syntax_word = this.getq(\"syntax_word\"), end = false;\n        while(!end && !syntax_word.test(this.charAt(-1)))if (!this.cmd(\"backward_char\")) end = true;\n        while(!end && syntax_word.test(this.charAt(-1)))if (!this.cmd(\"backward_char\")) end = true;\n    }),\n    forward_paragraph: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        let rx = this.getq(\"syntax_paragraph_sep\");\n        this.cmd(\"beginning_of_line\");\n        this.cmd(\"backward_char\");\n        if (this.cmd(\"looking_at\", rx)) this.cmd(\"goto_char\", this.cmd(\"match_end\"));\n        if (this.cmd(\"search_forward_regexp\", rx)) this.cmd(\"goto_char\", this.cmd(\"match_beginning\") + 1);\n        else this.cmd(\"end_of_buffer\");\n    }),\n    backward_paragraph: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        let point = this.point();\n        let rx = this.getq(\"syntax_paragraph_sep\");\n        this.cmd(\"beginning_of_line\");\n        if (this.cmd(\"looking_back\", rx)) {\n            let pos = this.cmd(\"match_end\");\n            if (pos == point) pos = this.cmd(\"match_beginning\");\n            this.cmd(\"goto_char\", pos);\n        }\n        if (this.cmd(\"search_backward_regexp\", rx)) this.cmd(\"goto_char\", this.cmd(\"match_end\"));\n        else this.cmd(\"beginning_of_buffer\");\n    }),\n    mark_paragraph: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^r\", function(begin, end) {\n        if (!this.transientMarker) {\n            this.cmd(\"forward_paragraph\");\n            this.setMark(this.point());\n            this.ensureTransientMark();\n            this.cmd(\"backward_paragraph\");\n        } else this.cmd(\"save_excursion\", function() {\n            if (this.transientMarker) this.cmd(\"goto_char\", end);\n            this.ensureTransientMark();\n            this.cmd(\"forward_paragraph\");\n            this.setMark(this.point());\n            this.transientMarker.swap(this.caretMarker);\n        });\n        this.ensureTransientMark();\n        this.setq(\"sticky_mark\", true);\n    }),\n    transpose_words: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        // if we're in the middle of a word, some\n        // weird things happen; better skip it, just\n        // like Emacs does.\n        this.cmd(\"backward_char\");\n        if (this.getq(\"syntax_word\").test(this.charAt())) this.cmd(\"forward_word\");\n        var a = [];\n        this.cmd(\"forward_word\");\n        a.push(this.point());\n        this.cmd(\"backward_word\");\n        a.push(this.point());\n        this.cmd(\"backward_word\");\n        a.push(this.point());\n        this.cmd(\"forward_word\");\n        a.push(this.point());\n        this.cmd(\"goto_char\", this._swapAreas(a));\n    }),\n    transpose_lines: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        var a = [];\n        this.cmd(\"backward_line\");\n        this.cmd(\"beginning_of_line\");\n        a.push(this.point());\n        this.cmd(\"end_of_line\");\n        a.push(this.point());\n        this.cmd(\"forward_char\");\n        a.push(this.point());\n        this.cmd(\"end_of_line\");\n        a.push(this.point());\n        this.cmd(\"goto_char\", this._swapAreas(a) + 1);\n    }),\n    transpose_chars: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        var pos = this.point();\n        if (this.cmd(\"backward_char\")) this.cmd(\"goto_char\", this._swapAreas([\n            pos - 1,\n            pos,\n            pos,\n            pos + 1\n        ]));\n    }),\n    kill_word: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^p\", function(prefix) {\n        if (this.transientMarker) {\n            var r = this.getRegion();\n            this.cmd(\"kill_region\", r.begin, r.end);\n            this.clearTransientMark();\n        } else {\n            var pos = this.point();\n            this.cmd(\"forward_word\", prefix == null ? 1 : prefix);\n            var pos2 = this.point();\n            this._killingAction(pos, pos2, false);\n        }\n    }),\n    backward_kill_word: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        var pos = this.point();\n        this.cmd(\"backward_word\");\n        var pos2 = this.point();\n        this._killingAction(pos, pos2, true);\n    }),\n    _apply_operation_on_word: function(op, cc) {\n        var pos = this.point();\n        if (this.getq(\"syntax_word\").test(this.charAt())) {\n            var pos2 = this.cmd(\"save_excursion\", function() {\n                this.cmd(\"forward_word\");\n                return this.point();\n            });\n            var word = op.call(this._bufferSubstring(pos, pos2));\n            this._deleteText(pos, pos2);\n            this._insertText(word);\n        } else {\n            this.cmd(\"forward_word\");\n            this.cmd(\"backward_word\");\n            if (pos != this.point()) this.cmd(cc);\n        }\n    },\n    capitalize_word: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        this.cmd(\"_apply_operation_on_word\", function() {\n            return this.charAt(0).toUpperCase() + this.substr(1).toLowerCase();\n        }, \"capitalize_word\");\n    }),\n    downcase_word: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        this.cmd(\"_apply_operation_on_word\", String.prototype.toLowerCase, \"downcase_word\");\n    }),\n    upcase_word: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        this.cmd(\"_apply_operation_on_word\", String.prototype.toUpperCase, \"upcase_word\");\n    }),\n    goto_char: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"NGoto char: \", function(pos) {\n        return this._repositionCaret(pos);\n    }),\n    goto_line: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"NGoto line: \", function(row) {\n        var pos = this._rowColToPosition(row - 1, 0);\n        return this.cmd(\"goto_char\", pos);\n    }),\n    move_to_column: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"NMove to column: \", function(col, force) {\n        var rc = this._positionToRowCol(this.point());\n        var text = this.code[rc.row];\n        if (text.length < col) {\n            if (force) {\n                this.cmd(\"end_of_line\");\n                this.cmd(\"insert\", \" \".repeat(col - text.length));\n            } else this.cmd(\"end_of_line\");\n        } else this.cmd(\"goto_char\", this._rowColToPosition(rc.row, col));\n    }),\n    delete_region: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\", function(begin, end) {\n        this._deleteText(begin, end);\n    }),\n    insert: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"sInsert text: \", function(...args) {\n        return this._insertText(args.join(\"\"));\n    }),\n    keyboard_quit: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.clearTransientMark();\n        this.setPrefixArg(undefined);\n        this.setMinibuffer(\"\");\n    }),\n    buffer_substring: function(begin, end) {\n        if (arguments.length == 0) {\n            var r = this.getRegion();\n            begin = r.begin;\n            end = r.end;\n        }\n        return this._bufferSubstring(begin, end);\n    },\n    kill_line: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^p\", function(prefix) {\n        if (this.transientMarker) {\n            var r = this.getRegion();\n            this.cmd(\"kill_region\", r.begin, r.end);\n            this.clearTransientMark();\n        } else if (prefix != null) this._killingAction(this.point(), this.cmd(\"save_excursion\", ()=>{\n            this.cmd(\"forward_line\", prefix);\n            this.cmd(\"beginning_of_line\");\n            return this.point();\n        }));\n        else {\n            var pos = this.point(), rc = this._rowcol, line = this.code[rc.row], end = pos + line.length - rc.col;\n            if (rc.row < this.code.length - 1 && this.cmd(\"looking_at\", /\\s*$/my)) end++;\n            this._killingAction(pos, end);\n        }\n    }),\n    save_excursion: function() {\n        return this._saveExcursion.apply(this, arguments);\n    },\n    prevent_undo: function() {\n        return this._disableUndo.apply(this, arguments);\n    },\n    point: function() {\n        return this.caretMarker.getPosition();\n    },\n    kill_region: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\", function(begin, end) {\n        this._killingAction(begin, end);\n    }),\n    copy_region_as_kill: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\", function(begin, end) {\n        this._killingAction(begin, end, false, true);\n    }),\n    yank: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^P\", function(atStart) {\n        this.deleteTransientRegion();\n        var point = this.point();\n        this._insertText(this.ymacs.killRingText());\n        this.setMark(point);\n        if (atStart) this.caretMarker.swap(this.markMarker);\n    }),\n    yank_from_operating_system: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(async function() {\n        try {\n            let code = await navigator.clipboard.readText();\n            this._saveKilledText(code);\n            this.callInteractively(\"yank\");\n        } catch (ex) {\n            console.error(ex);\n            this.signalError(\"Cannot read the system clipboard. Error in devtools console.\");\n        }\n    }),\n    copy_for_operating_system: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\", async function(begin, end) {\n        try {\n            let code = this.cmd(\"buffer_substring\", begin, end);\n            await navigator.clipboard.writeText(code);\n        } catch (ex) {\n            console.error(ex);\n            this.signalError(\"Cannot write to system clipboard. Error in devtools console.\");\n        }\n    }),\n    yank_pop: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        if (/^yank/.test(this.previousCommand)) {\n            this.ymacs.rotateKillRing(false);\n            this._deleteText(this.caretMarker, this.markMarker);\n            this.cmd(\"yank\");\n        } else this.signalError(\"Previous command was not a yank\");\n    }),\n    yank_shift: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        if (/^yank/.test(this.previousCommand)) {\n            this.ymacs.rotateKillRing(true);\n            this._deleteText(this.caretMarker, this.markMarker);\n            this.cmd(\"yank\");\n        } else this.signalError(\"Previous command was not a yank\");\n    }),\n    mark: function() {\n        return this.markMarker.getPosition();\n    },\n    set_mark_command: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"d\", function(x) {\n        this.clearTransientMark();\n        this.setMark(x);\n        if (this.currentCommand == \"set_mark_command\") {\n            this.signalInfo(\"Mark set\", null, 1000);\n            this.setq(\"sticky_mark\", true);\n        }\n    }),\n    exchange_point_and_mark: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function() {\n        this.transientMarker = this.createMarker();\n        this.caretMarker.swap(this.markMarker);\n        this.ensureTransientMark();\n        this.setq(\"sticky_mark\", true);\n    }),\n    mark_whole_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.clearTransientMark();\n        this.cmd(\"end_of_buffer\");\n        this.ensureTransientMark();\n        this.cmd(\"beginning_of_buffer\");\n        this.ensureTransientMark();\n    }),\n    recenter_top_bottom: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function() {\n        this.whenActiveFrame(function(frame) {\n            frame.recenterTopBottom(this.sameCommandCount() % 3);\n        });\n    }),\n    recenter: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function() {\n        this.whenActiveFrame(function(frame) {\n            frame.centerOnCaret();\n        });\n    }),\n    ensure_caret_visible: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.whenActiveFrame(function(frame) {\n            if (frame.ensureCaretVisible()) frame.centerOnCaret();\n        });\n    }),\n    /* -----[ paragraphs ]----- */ get_fill_paragraph_region: function() {\n        let r1 = this.cmd(\"save_excursion\", ()=>{\n            if (!this.cmd(\"looking_at\", this.getq(\"syntax_paragraph_sep\"))) this.cmd(\"forward_paragraph\");\n            let end = this.point() - 1;\n            this.cmd(\"backward_paragraph\");\n            let begin = this.point();\n            return {\n                begin: begin,\n                end: end\n            };\n        });\n        let r2 = this.cmd(\"base_limit_fill_paragraph_region\") || this.cmd(\"xml_limit_fill_paragraph_region\");\n        if (r2) return {\n            begin: Math.max(r1.begin, r2.begin),\n            end: Math.min(r1.end, r2.end)\n        };\n        return r1;\n    },\n    fill_paragraph: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^rP\", function(begin, end, noPrefix) {\n        this.cmd(\"save_excursion\", function() {\n            if (!this.transientMarker) {\n                let r = this.cmd(\"get_fill_paragraph_region\");\n                begin = r.begin;\n                end = r.end;\n            } else this.clearTransientMark();\n            this.cmd(\"goto_char\", begin);\n            var eop = this.createMarker(end);\n            // identify the prefix to use for each line\n            var prefix = \"\", del = /\\s+/y;\n            if (this.cmd(\"looking_at\", /\\s*\\/\\/+\\s*/y)) {\n                prefix = this.matchData[0];\n                del = /\\s*\\/\\/+\\s*/y;\n            } else if (this.cmd(\"looking_at\", /\\s*\\/\\*\\s*/y)) {\n                prefix = \" \".repeat(this.matchData[0].length);\n                del = /\\s*\\**\\s*/y;\n            } else if (this.cmd(\"looking_at\", /\\s*[#>;\\s]+\\s*/y)) {\n                prefix = this.matchData[0];\n                del = /\\s*[#>;\\s]*\\s*/y;\n            } else if (this.cmd(\"looking_at\", /\\s*([-*]|[0-9]+\\.|\\(?[a-z][\\).])?\\s+/iy)) {\n                prefix = \" \".repeat(this.matchData[0].length);\n                del = /\\s*[#>;\\s]*\\s*/y;\n            }\n            if (noPrefix) {\n                this._deleteText(this.point(), this.point() + this.matchData[0].length);\n                prefix = \"\";\n            }\n            // remove newlines first\n            while(true){\n                this.cmd(\"end_of_line\");\n                this.cmd(\"backward_delete_whitespace\");\n                if (this.point() >= eop.getPosition()) break;\n                this._replaceText(this.point(), this.point() + 1, \" \");\n                if (del && this.cmd(\"looking_at\", del)) this._deleteText(this.point(), this.point() + this.matchData[0].length);\n            }\n            this.cmd(\"beginning_of_line\");\n            // main operation\n            var bol = this.point(), done = false;\n            while(!done){\n                var p = this.point();\n                if (!this.cmd(\"search_forward_regexp\", /\\s/g)) done = true;\n                if (this.point() >= eop.getPosition()) {\n                    this.cmd(\"goto_char\", eop);\n                    done = true;\n                }\n                if (this._rowcol.col > this.getq(\"fill_column\") + 1) {\n                    if (p > bol) this.cmd(\"goto_char\", p);\n                    this.cmd(\"backward_delete_whitespace\");\n                    this.cmd(\"newline\");\n                    this.cmd(\"insert\", prefix);\n                    bol = this.point();\n                }\n            }\n            eop.destroy();\n        });\n    }),\n    // this looks at the style of the current paragraph and starts\n    // a similar one, i.e. using same indentation level and prefix\n    // (list-like prefixes are incremented)\n    start_next_paragraph: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.cmd(\"backward_paragraph\");\n        // identify the prefix to use for each line\n        var prefix = \"\";\n        if (this.cmd(\"looking_at\", /(\\s*)([0-9]+)(\\.\\s+)/y)) prefix = this.matchData[1] + (parseInt(this.matchData[2], 10) + 1) + this.matchData[3];\n        else if (this.cmd(\"looking_at\", /(\\s*\\(?)([a-z])([\\.\\)]\\s+)/iy)) prefix = this.matchData[1] + String.fromCharCode(this.matchData[2].charCodeAt(0) + 1) + this.matchData[3];\n        else if (this.cmd(\"looking_at\", /\\s*[#>;*\\s-]+\\s*/y)) prefix = this.matchData[0];\n        this.cmd(\"forward_paragraph\");\n        if (this.cmd(\"eob_p\")) this.cmd(\"newline\");\n        this.cmd(\"insert\", \"\\n\", prefix);\n        if (!this.cmd(\"looking_at\", /\\n\\n/y)) {\n            this.cmd(\"newline\");\n            this.cmd(\"backward_char\");\n        }\n    }),\n    scroll_down_half: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        this.whenActiveFrame(function(frame) {\n            var hl = frame.heightInLines();\n            this.cmd(\"forward_line\", Math.round(hl / 1.33));\n            this.cmd(\"recenter\");\n        });\n    }),\n    scroll_up_half: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        this.whenActiveFrame(function(frame) {\n            var hl = frame.heightInLines();\n            this.cmd(\"backward_line\", Math.round(hl / 1.33));\n            this.cmd(\"recenter\");\n        });\n    }),\n    scroll_up: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(arg) {\n        if (arg == null) arg = 3;\n        this.whenActiveFrame(function(frame) {\n            frame.scrollUp(arg);\n        });\n    }),\n    scroll_down: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(arg) {\n        if (arg == null) arg = 3;\n        this.whenActiveFrame(function(frame) {\n            frame.scrollDown(arg);\n        });\n    }),\n    nuke_trailing_whitespace: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.cmd(\"save_excursion\", function() {\n            this.cmd(\"goto_char\", 0);\n            while(this._rowcol.row < this.code.length){\n                var line = this.code[this._rowcol.row], m = /\\s+$/.exec(line);\n                if (m) {\n                    this.cmd(\"beginning_of_line\");\n                    this._deleteText(this.point() + m.index, this.point() + line.length);\n                }\n                if (!this.cmd(\"forward_line\")) break;\n            }\n        });\n    }),\n    match_string: function(n) {\n        return this.matchData[n];\n    },\n    match_beginning: function() {\n        return this.matchData.index;\n    },\n    match_end: function() {\n        return this.matchData.index + this.matchData[0].length;\n    },\n    undo: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        this._placeUndoBoundary();\n        if (!this._playbackUndo()) this.signalError(\"No further undo information\");\n    }),\n    goto_last_change: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let a = [], pos = this.point();\n        this.__undoQueue.forEach((x)=>{\n            if (x.type == 3) {\n                let m = x.markers.find((m)=>m[0] === this.caretMarker);\n                if (m) a.push(m[1]);\n            }\n        });\n        if (a.length) {\n            a = a.reverse();\n            let i = this.sameCommandCount() % a.length;\n            this.cmd(\"goto_char\", a[i]);\n        }\n    }),\n    center_line: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(n) {\n        if (n == null) n = 1;\n        for(let i = 0; i < n; ++i){\n            if (i > 0) this.cmd(\"forward_line\");\n            this.cmd(\"save_excursion\", function() {\n                this.cmd(\"end_of_line\");\n                this.cmd(\"backward_delete_whitespace\", true);\n                this.cmd(\"beginning_of_line\");\n                this.cmd(\"delete_whitespace\", true);\n                var line = this.code[this._rowcol.row];\n                var indent = Math.floor((this.getq(\"fill_column\") - line.length) / 2);\n                this.cmd(\"insert\", \" \".repeat(indent));\n            });\n        }\n    }),\n    /* -----[ dabbrev ]----- */ dabbrev_expand: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        if (this.previousCommand != \"dabbrev_expand\") this.setq(\"dabbrev_context\", null);\n        var ctx = this.getq(\"dabbrev_context\");\n        if (!ctx) {\n            ctx = this.setq(\"dabbrev_context\", {});\n            var p1 = this.cmd(\"save_excursion\", function() {\n                this.cmd(\"bind_variables\", {\n                    syntax_word: this.getq(\"syntax_word_dabbrev\")\n                }, \"backward_word\");\n                return this.point();\n            });\n            if (p1 == this.point()) return this.signalError(\"Nothing to expand\");\n            ctx.search = this.cmd(\"buffer_substring\", p1, this.point());\n            ctx.point = p1;\n            ctx.length = this.point() - p1;\n            ctx.lastSearch = p1;\n            ctx.encountered = Object.create(null);\n            ctx.forward = false;\n            ctx.buffer = this;\n            ctx.seenBuffers = [\n                this\n            ];\n            ctx.startBuffer = this;\n        }\n        var expansion;\n        // in the following excursion, *this* is ctx.buffer,\n        // not necessarily the currently active buffer.  It's\n        // purpose is to determine the next expansion and\n        // setup the context so that the next invocation would\n        // continue.\n        ctx.buffer.cmd(\"save_excursion\", function repeat() {\n            var word = this.getq(\"syntax_word_dabbrev\");\n            var p1;\n            var found = false;\n            this.cmd(\"goto_char\", ctx.lastSearch);\n            // console.log(\"last at: %d\", ctx.lastSearch);\n            if (!ctx.forward) {\n                while(this.cmd(\"search_backward\", ctx.search))if (!word.test(this.charAt(-1))) {\n                    found = true;\n                    break;\n                }\n                if (found) {\n                    p1 = this.point();\n                    ctx.lastSearch = p1;\n                    this.cmd(\"goto_char\", p1 + ctx.search.length);\n                } else {\n                    ctx.forward = true;\n                    ctx.lastSearch = ctx.point + ctx.length;\n                    repeat.call(this);\n                    return;\n                }\n            } else {\n                while(this.cmd(\"search_forward\", ctx.search))if (!word.test(this.charAt(-ctx.search.length - 1))) {\n                    found = true;\n                    break;\n                }\n                if (found) {\n                    ctx.lastSearch = this.point();\n                    p1 = this.point() - ctx.search.length;\n                } else {\n                    ctx.buffer = this.whenYmacs(\"getNextBuffer\", this);\n                    if (ctx.seenBuffers.includes(ctx.buffer)) {\n                        expansion = ctx.search;\n                        ctx.startBuffer.signalError(\"No more completions\");\n                        ctx.lastSearch = ctx.point + ctx.length;\n                        ctx.startBuffer.setq(\"dabbrev_context\", null);\n                        return;\n                    } else {\n                        ctx.seenBuffers.push(ctx.buffer);\n                        ctx.lastSearch = 0;\n                        ctx.buffer.cmd(\"save_excursion\", repeat);\n                        return;\n                    }\n                }\n            }\n            if (p1 != null) {\n                // console.log(\"%s at %d, next from %d\", ctx.search, p1, ctx.lastSearch);\n                this.cmd(\"bind_variables\", {\n                    syntax_word: this.getq(\"syntax_word_dabbrev\")\n                }, \"forward_word\");\n                expansion = this.cmd(\"buffer_substring\", p1, this.point());\n                if (ctx.encountered[expansion]) repeat.call(this);\n            }\n        });\n        if (expansion != null) {\n            this._replaceText(ctx.point, ctx.point + ctx.length, expansion);\n            ctx.length = expansion.length;\n            ctx.encountered[expansion] = true;\n        }\n    }),\n    /* -----[ frames and buffers ]----- */ split_frame_vertically: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(percent) {\n        if (percent == null) percent = \"50%\";\n        else percent += \"%\";\n        this.whenActiveFrame(\"vsplit\", percent);\n    }),\n    split_frame_horizontally: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(percent) {\n        if (percent == null) percent = \"50%\";\n        else percent += \"%\";\n        this.whenActiveFrame(\"hsplit\", percent);\n    }),\n    delete_other_frames: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.whenActiveFrame(\"deleteOtherFrames\");\n    }),\n    delete_frame: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.whenActiveFrame(\"deleteFrame\");\n    }),\n    other_frame: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.whenYmacs(\"focusOtherFrame\");\n    }),\n    windmove: function(dir) {\n        this.whenYmacs(function(ymacs) {\n            var f = ymacs.getFrameInDirection(dir);\n            if (f) f.focus();\n        });\n    },\n    next_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.whenYmacs(\"switchToNextBuffer\", this.sameCommandCount() + 1);\n    }),\n    previous_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.whenYmacs(\"switchToPreviousBuffer\", this.sameCommandCount() + 1);\n    }),\n    switch_to_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"BSwitch to buffer: \", function(buffer) {\n        this.whenYmacs(function(ymacs) {\n            if (!/\\S/.test(buffer)) {\n                if (ymacs.buffers.length < 2) return;\n                buffer = ymacs.buffers[1];\n            }\n            ymacs.switchToBuffer(buffer);\n        });\n    }),\n    kill_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        var self = this;\n        function kill() {\n            self.whenYmacs(function(ymacs) {\n                ymacs.switchToNextBuffer();\n                ymacs.killBuffer(self);\n            });\n        }\n        if (self.dirty()) {\n            var msg = \"Buffer \" + self.name + \" modified; kill anyway?\";\n            self.cmd(\"minibuffer_yn\", msg, function(yes) {\n                if (yes) kill();\n            });\n        } else kill();\n    }),\n    rename_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"sRename current buffer to: \", function(name) {\n        this.whenYmacs(function(ymacs) {\n            ymacs.renameBuffer(this, name);\n        });\n    }),\n    /* -----[ other ]----- */ delete_region_or_line: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function() {\n        if (!this.deleteTransientRegion()) {\n            this.cmd(\"beginning_of_line\");\n            var pos = this.point();\n            this.cmd(\"end_of_line\");\n            this.cmd(\"forward_char\");\n            if (this.point() != pos) {\n                this._deleteText(pos, this.point());\n                return true;\n            }\n        }\n    }),\n    // http://mihai.bazon.net/blog/close-last-xml-tag-emacs\n    close_last_xml_tag: (0, $92bab0a532b3076f$export$8c34793404b3efcb)(function() {\n        var tag, quote;\n        this.cmd(\"save_excursion\", function() {\n            var skip = 1;\n            while(skip != 0 && this.cmd(\"search_backward_regexp\", /<\\x2f?([a-zA-Z0-9:_-]+)/g)){\n                tag = this.cmd(\"match_string\", 1);\n                if (this.cmd(\"looking_at\", /<\\x2f/y)) ++skip;\n                else if (!this.cmd(\"looking_at\", /<[^\\x2f][^>]*?\\x2f>/y)) --skip;\n            }\n            if (skip != 0) tag = null;\n        });\n        if (tag) this.cmd(\"insert\", \"</\", tag, \">\");\n        else throw new (0, $541ef653595620bf$export$c411e7bd03572a3a)(\"Couldn't find a tag to close\");\n    }),\n    bind_variables: function() {\n        return this.withVariables.apply(this, arguments);\n    },\n    for_region: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^r\\nCExecute command within region: \", function(begin, end, func) {\n        if (end < begin) {\n            var tmp = begin;\n            begin = end;\n            end = tmp;\n        } // MACROS!  I WANT MACROS!  EVAL SUCKS. x-(\n        if (!(func instanceof Function)) func = this.COMMANDS[func];\n        this.clearTransientMark();\n        this.cmd(\"goto_char\", begin);\n        begin = this.createMarker(begin, true);\n        end = this.createMarker(end);\n        this.withCommands({\n            goto_char: function(pos) {\n                if (pos >= begin.getPosition() && pos <= end.getPosition()) return this._repositionCaret(pos);\n                throw \"YMACS_RESTRICT\";\n            }\n        }, function() {\n            try {\n                while(true){\n                    var tmp = this.point();\n                    func.call(this);\n                    if (this.point() == tmp && !this.cmd(\"forward_line\")) break;\n                }\n            } catch (ex) {\n                if (ex !== \"YMACS_RESTRICT\") throw ex;\n            } finally{\n                begin.destroy();\n                end.destroy();\n            }\n        });\n    }),\n    comment_region: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^r\", function(begin, end) {\n        var cmmt = this.getq(\"syntax_comment_line\") || this.getq(\"syntax_comment_multi\");\n        if (!cmmt) return;\n        this.clearTransientMark();\n        this.cmd(\"save_excursion\", function() {\n            end = this.createMarker(end);\n            this.cmd(\"goto_char\", begin);\n            var min = 100000;\n            out: while(this.point() < end.getPosition()){\n                while(this.cmd(\"looking_at\", /\\s*$/my)){\n                    if (!this.cmd(\"forward_line\")) break out;\n                }\n                var col = this._rowcol.col;\n                while(this.cmd(\"looking_at\", /\\s/y) && col < min){\n                    if (!this.cmd(\"forward_char\")) break out;\n                    ++col;\n                }\n                if (col < min) min = col;\n                if (Array.isArray(cmmt.ch)) {\n                    this.cmd(\"insert\", cmmt.ch[0], \" \");\n                    this.cmd(\"end_of_line\");\n                    this.cmd(\"insert\", \" \", cmmt.ch[1]);\n                } else this.cmd(\"insert\", cmmt.ch, \" \");\n                this.cmd(\"beginning_of_line\");\n                if (!this.cmd(\"forward_line\")) break out;\n            }\n            this.cmd(\"goto_char\", end);\n            if (this._rowcol.col > 0 && !this.cmd(\"looking_at\", /\\s*$/my)) this.cmd(\"newline_and_indent\");\n        });\n    }),\n    uncomment_region: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\", function(begin, end) {\n        var cmmt1 = this.getq(\"syntax_comment_line\");\n        var cmmt2 = this.getq(\"syntax_comment_multi\");\n        if (!cmmt1 && !cmmt2) return;\n        this.clearTransientMark();\n        this.cmd(\"save_excursion\", function() {\n            end = this.createMarker(end);\n            this.cmd(\"goto_char\", begin);\n            while(this.point() < end.getPosition()){\n                this.cmd(\"forward_whitespace\");\n                if (cmmt1 && this.cmd(\"looking_at\", cmmt1.rx)) this.cmd(\"delete_char\", this.matchData[0].length);\n                else if (cmmt2 && this.cmd(\"looking_at\", cmmt2.rx)) this._replaceText(this.point(), this.point() + this.matchData[0].length, this.matchData[1]);\n                this.cmd(\"beginning_of_line\");\n                if (!this.cmd(\"forward_line\")) break;\n            }\n        });\n    }),\n    comment_dwim: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^r\", function(begin, end) {\n        var cmmt1 = this.getq(\"syntax_comment_line\");\n        var cmmt2 = this.getq(\"syntax_comment_multi\");\n        if (!cmmt1 && !cmmt2) return;\n        if (this.transientMarker) this.cmd(\"save_excursion\", function() {\n            this.cmd(\"goto_char\", begin);\n            var already_comment = cmmt1 && this.cmd(\"looking_at\", cmmt1.rx) || cmmt2 && this.cmd(\"looking_at\", cmmt2.rx);\n            if (already_comment) this.cmd(\"uncomment_region\", begin, end);\n            else this.cmd(\"comment_region\", begin, end);\n        });\n        else {\n            this.cmd(\"end_of_line\");\n            if (cmmt1) this.cmd(\"insert\", \" \", cmmt1.ch, \" \");\n            else {\n                this.cmd(\"insert\", \" \", cmmt2.ch[0], cmmt2.ch[1]);\n                this.cmd(\"backward_char\", cmmt2.ch[1].length);\n            }\n            this.cmd(\"indent_line\");\n        }\n    }),\n    what_cursor_position: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function() {\n        var ch = this.charAt(), chname = ch;\n        if (ch == null) chname = \"EOF\";\n        else if (ch == \" \") chname = \"Space\";\n        else if (ch == \"\\n\") chname = \"Newline\";\n        this.popupMessage({\n            isHtml: true,\n            atCaret: true,\n            text: $c7731ae7d5abaea3$var$TMPL_CHAR_INFO({\n                ch: (0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(chname),\n                code: ch ? ch.charCodeAt(0) : null,\n                codeHex: ch ? ch.charCodeAt().toString(16).toUpperCase() : null,\n                point: this.point(),\n                size: this.getCodeSize(),\n                sizeKB: (0, $08a06a2e99accb03$export$e1a3971de07c83b5)(this.getCodeSize(), 2)\n            })\n        });\n    }),\n    set_fill_column: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(value) {\n        let next = (value)=>{\n            let prev = this.getq(\"fill_column\");\n            this.setq(\"fill_column\", +value);\n            this.signalInfo(`Fill column set to ${value} (was ${prev})`, false, 5000);\n        };\n        if (value == null) this.whenMinibuffer((mb)=>{\n            this.cmd(\"minibuffer_prompt\", \"Set fill column to: \");\n            mb.setMark();\n            mb.transientMarker = mb.createMarker(mb.point(), true);\n            mb.cmd(\"insert\", String(this._rowcol.col));\n            mb.ensureTransientMark();\n            this.cmd(\"minibuffer_read_number\", next);\n        });\n        else next(value);\n    }),\n    bury_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let ymacs = this.ymacs;\n        ymacs.switchToNextBuffer();\n    }),\n    describe_mode: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let ymacs = this.ymacs;\n        let buf = ymacs.switchToBuffer(\"*Help*\");\n        ymacs.switchToBuffer(buf);\n        buf.pushKeymap($c7731ae7d5abaea3$var$help_keymap);\n        buf._disableUndo(()=>{\n            buf.setCode(`Active keymaps in buffer \"${this.name}\".\\nPress \\`q\\` to go back.\\n\\n`);\n            buf.cmd(\"end_of_buffer\");\n            let dumpKeymap = (prefix, definitions)=>{\n                for (let [key, val] of Object.entries(definitions)){\n                    let def = (prefix ? prefix + \" \" : \"\") + key;\n                    if (Array.isArray(val)) {\n                        let txt = \"  \";\n                        txt += def;\n                        for(let n = 20 - def.length; n-- >= 0;)txt += \" \";\n                        txt += \" : \" + (typeof val[0] == \"function\" ? \"(lambda)\" : JSON.stringify(val));\n                        buf.cmd(\"insert\", txt);\n                        buf.cmd(\"newline\");\n                    } else if (val && typeof val == \"object\") dumpKeymap(def, val);\n                }\n            };\n            [\n                ...this.keymap\n            ].reverse().forEach((keymap, index)=>{\n                if (index > 0) buf.cmd(\"insert\", \"\\n\");\n                buf.cmd(\"insert\", `Keymap: ${keymap.name || \"(unnamed)\"}\\n`);\n                buf.cmd(\"newline\");\n                dumpKeymap(\"\", keymap.definitions);\n            });\n        });\n        buf.dirty(false);\n        buf.cmd(\"goto_char\", 0);\n    }),\n    window_configuration_to_register: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.whenMinibuffer((mb)=>{\n            mb.prompt(\"Window configuration to register:\");\n            this.setq(\"read_register_callback\", (reg)=>{\n                let ymacs = this.ymacs;\n                ymacs.registers[reg] = {\n                    frames: ymacs.getFrameConfig()\n                };\n                this.signalInfo(`Saved to register \"${reg}\"`, null, 2000);\n            });\n            this.pushKeymap($c7731ae7d5abaea3$var$read_register_keymap);\n        });\n    }),\n    jump_to_register: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.whenMinibuffer((mb)=>{\n            mb.prompt(\"Jump to register:\");\n            this.setq(\"read_register_callback\", (reg)=>this.ymacs.jumpToRegister(reg));\n            this.pushKeymap($c7731ae7d5abaea3$var$read_register_keymap);\n        });\n    })\n});\n/* -----[ rectangle functions (vertical editing) ]----- */ (function() {\n    function apply_on_rectangle(buffer, begin, end, func) {\n        buffer.cmd(\"save_excursion\", function() {\n            var p1 = this._positionToRowCol(begin), p2 = this._positionToRowCol(end), width = Math.abs(p2.col - p1.col);\n            for(var line = p1.row; line <= p2.row; ++line){\n                this.cmd(\"goto_char\", this._rowColToPosition(line, 0));\n                var text = this.code[line], c1 = p1.col, c2 = p2.col, p = this.point(), ws = 0;\n                if (c1 > c2) {\n                    var tmp = c1;\n                    c1 = c2;\n                    c2 = tmp;\n                }\n                if (c1 > text.length) {\n                    ws = c1 - text.length;\n                    c1 = text.length;\n                }\n                if (c2 > text.length) c2 = text.length;\n                func.call(this, p + c1, p + c2, ws, width);\n            }\n        }, begin == buffer.point());\n    }\n    (0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n        string_rectangle: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\\nsString rectangle: \", function(begin, end, string) {\n            apply_on_rectangle(this, begin, end, function(c1, c2, ws) {\n                if (ws > 0) this._insertText(\" \".repeat(ws), c1);\n                else this._deleteText(c1, c2);\n                this._insertText(string, c1 + ws);\n            });\n        }),\n        kill_rectangle: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\", function(begin, end) {\n            var text = [];\n            apply_on_rectangle(this, begin, end, function(c1, c2, ws, width) {\n                var str = this._bufferSubstring(c1, c2);\n                if (c2 - c1 < width) str += \" \".repeat(width - c2 + c1);\n                text.push(str);\n                this._deleteText(c1, c2);\n            });\n            this.setq(\"killed_rectangle\", text);\n        }),\n        clear_rectangle: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\", function(begin, end) {\n            this.cmd(\"string_rectangle\", begin, end, \" \".repeat(Math.abs(this._positionToRowCol(end).col - this._positionToRowCol(begin).col)));\n        }),\n        insert_rectangle: function(point, rect) {\n            var col = this._positionToRowCol(point).col;\n            this.setMark(point);\n            rect.forEach((text, i)=>{\n                if (i > 0) {\n                    if (!this.cmd(\"forward_line\")) {\n                        this.cmd(\"end_of_line\");\n                        this.cmd(\"newline\");\n                    }\n                    this.cmd(\"move_to_column\", col, true);\n                }\n                this.cmd(\"insert\", text);\n            });\n        },\n        yank_rectangle: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"d\", function(point) {\n            var kr = this.getq(\"killed_rectangle\");\n            if (kr == null) throw new (0, $541ef653595620bf$export$c411e7bd03572a3a)(\"No killed rectangle\");\n            this.cmd(\"insert_rectangle\", point, kr);\n        }),\n        _next_is_meta: function() {\n            if (!this.__nextIsMeta) {\n                this.__nextIsMeta = true;\n                this.currentKeys.pop();\n            }\n        }\n    });\n})();\n(function() {\n    (0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n        kmacro_start_macro: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(arg) {\n            if (this.ymacs.isRunningMacro()) return;\n            if (this.ymacs.isRecordingMacro()) {\n                this.signalError(\"Already defining keyboard macro.\");\n                return;\n            }\n            this.signalInfo(\"Defining keyboard macro\");\n            this.ymacs.startMacro(arg !== null);\n        }),\n        kmacro_end_macro: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n            if (this.ymacs.isRunningMacro()) return;\n            if (!this.ymacs.isRecordingMacro()) {\n                this.signalInfo(\"Not defining kbd macro\");\n                return;\n            }\n            this.signalInfo(\"Keyboard macro defined\");\n            this.ymacs.stopMacro();\n        }),\n        kmacro_end_and_call_macro: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"p\", function(arg) {\n            this.ymacs.stopMacro();\n            if (arg === null) arg = 1;\n            var macro = this.ymacs.getLastMacro();\n            this.interactiveEvent(null);\n            this.ymacs.runMacro(arg, macro);\n        })\n    });\n})();\n/* -----[ transient mark extension commands ]----- */ [\n    \"forward_char\",\n    \"forward_word\",\n    \"forward_line\",\n    \"forward_paragraph\",\n    \"forward_sexp\",\n    \"beginning_of_line\",\n    \"beginning_of_indentation_or_line\",\n    \"beginning_of_buffer\",\n    \"backward_char\",\n    \"backward_word\",\n    \"backward_line\",\n    \"backward_paragraph\",\n    \"backward_sexp\",\n    \"end_of_line\",\n    \"end_of_buffer\"\n].forEach(function(cmd) {\n    (0, $5e779a545e33325b$export$df331bdfc76955b4).COMMANDS[cmd + \"_mark\"] = (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function() {\n        this.ensureTransientMark();\n        this.cmdApply(cmd, arguments);\n        this.ensureTransientMark();\n    });\n});\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\n\n\nvar $64ad30bda24c420e$var$$menu = null, $64ad30bda24c420e$var$$selectedIndex = null, $64ad30bda24c420e$var$$selectedItem = null;\nfunction $64ad30bda24c420e$var$popupCompletionMenu(frame, list, { noError: noError = false, noPrefix: noPrefix = false } = {}) {\n    $64ad30bda24c420e$var$killMenu();\n    let activeElement = document.activeElement;\n    let ymacs = this.ymacs; // `this` is the minibuffer\n    $64ad30bda24c420e$var$$menu = new (0, $ec4394da1a74075f$export$731251e1d39d8621)();\n    $64ad30bda24c420e$var$$menu.addClass(\"with-arrow\");\n    list.forEach((label, index)=>{\n        let value = label;\n        if (typeof label != \"string\") {\n            value = label.value;\n            label = label.label;\n        }\n        let el = (0, $08a06a2e99accb03$export$cb0933279c36a66b).fromHTML(`<div class=\"Ymacs_Menu_Item\" data-value=\"${(0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(value)}\"\n                                          data-index=\"${index}\">${(0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(label)}</div>`);\n        $64ad30bda24c420e$var$$menu.add(el);\n    });\n    (0, $08a06a2e99accb03$export$cb0933279c36a66b).on($64ad30bda24c420e$var$$menu.getContentElement(), {\n        click: (ev)=>{\n            activeElement.focus();\n            let item = ev.target;\n            if (!(0, $08a06a2e99accb03$export$cb0933279c36a66b).hasClass(item, \"Ymacs_Menu_Item\")) return;\n            $64ad30bda24c420e$var$select(+item.dataset.index);\n            $64ad30bda24c420e$var$handle_enter.call(this);\n        }\n    });\n    ymacs._popupAtCaret($64ad30bda24c420e$var$$menu.getElement());\n    $64ad30bda24c420e$var$select(0);\n    // XXX: this is some more aggressive, ivy-like completion, but\n    // it's not working very well with filename completion.\n    let onChange = this.getq(\"ivy_completion\") && (0, $08a06a2e99accb03$export$ad41d882ec94ba04)(()=>{\n        $64ad30bda24c420e$var$killMenu();\n        this.cmd(\"minibuffer_complete\", {\n            noError: noError,\n            noPrefix: noPrefix\n        });\n    }, 1);\n    this.pushKeymap($64ad30bda24c420e$var$KEYMAP_POPUP_ACTIVE);\n    if (onChange) this.addEventListener(\"onChange\", onChange);\n    $64ad30bda24c420e$var$$menu.addEventListener(\"onDestroy\", ()=>{\n        this.popKeymap($64ad30bda24c420e$var$KEYMAP_POPUP_ACTIVE);\n        if (onChange) this.removeEventListener(\"onChange\", onChange);\n    });\n}\nfunction $64ad30bda24c420e$var$killMenu() {\n    if ($64ad30bda24c420e$var$$menu) $64ad30bda24c420e$var$$menu.destroy();\n    $64ad30bda24c420e$var$$menu = null;\n    $64ad30bda24c420e$var$$selectedItem = null;\n    $64ad30bda24c420e$var$$selectedIndex = null;\n}\nfunction $64ad30bda24c420e$var$select(idx) {\n    let cont = $64ad30bda24c420e$var$$menu.getContentElement();\n    let items = [\n        ...cont.querySelectorAll(\".Ymacs_Menu_Item\")\n    ];\n    let n = items.length;\n    $64ad30bda24c420e$var$$selectedIndex = (idx % n + n) % n;\n    items.forEach((el)=>{\n        let current = el.dataset.index == $64ad30bda24c420e$var$$selectedIndex;\n        if (current) $64ad30bda24c420e$var$$selectedItem = el;\n        (0, $08a06a2e99accb03$export$cb0933279c36a66b).condClass(el, current, \"selected\");\n    });\n    $64ad30bda24c420e$var$$selectedItem.scrollIntoView({\n        block: \"nearest\"\n    });\n}\nfunction $64ad30bda24c420e$export$9cb120f8f6032a76(completions, cont, validate) {\n    this.whenMinibuffer(function(mb) {\n        let ivy = completions !== $64ad30bda24c420e$var$filename_completion;\n        var changed_vars = mb.setq({\n            ivy_completion: ivy,\n            completion_list: completions,\n            minibuffer_validation: (what, cont2)=>{\n                if (what == null) what = mb.cmd(\"minibuffer_contents\");\n                if (validate) validate.call(this, mb, what, cont2);\n                else cont2(true); // accept anything by default\n            },\n            minibuffer_continuation: (what)=>{\n                mb.setq(changed_vars);\n                if (cont) cont.call(this, what);\n            }\n        });\n        mb.cmd(\"minibuffer_complete\", {\n            noError: true,\n            noPrefix: !ivy\n        });\n    });\n}\nfunction $64ad30bda24c420e$var$filename_completion(mb, str, cont, { noPrefix: noPrefix = false } = {}) {\n    var self = this;\n    var lastslash = str.lastIndexOf(\"/\");\n    var dir = str.slice(0, lastslash + 1);\n    var partial = str.slice(lastslash + 1);\n    self.ymacs.fs_getDirectory(dir, function(files) {\n        function add_trailing_slash_to_dir(name) {\n            if (files[name].type == \"directory\") return name + \"/\";\n            else return name;\n        }\n        if (!files) {\n            mb.signalError(\"Not found\");\n            cont(null);\n        } else {\n            var completions = [];\n            for (let f of Object.keys(files))if (f.indexOf(partial) == 0) completions.push(add_trailing_slash_to_dir(f));\n            if (completions.length == 0) cont([]);\n            else {\n                var prefix = (0, $08a06a2e99accb03$export$b43564a9f178c38c)(completions);\n                if (prefix != partial && !noPrefix) {\n                    mb.cmd(\"minibuffer_replace_input\", dir + prefix);\n                    cont(completions.map((name)=>({\n                            label: name,\n                            value: dir + name\n                        })));\n                } else if (completions.length == 1) cont([\n                    str\n                ]);\n                else cont(completions.map((name)=>({\n                        label: name,\n                        value: dir + name\n                    })));\n            }\n        }\n    });\n}\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n    minibuffer_prompt: function(prompt, nofocus) {\n        this.whenMinibuffer(function(mb) {\n            var f = this.getMinibufferFrame();\n            this.ymacs.setInputFrame(f);\n            mb.prompt(prompt);\n            if (!nofocus) f.focus();\n        });\n    },\n    minibuffer_yn: function(prompt, cont) {\n        this.cmd(\"minibuffer_prompt\", prompt + \" (yes or no) \");\n        this.cmd(\"minibuffer_read_yn\", function(text) {\n            cont(text == \"yes\");\n        });\n    },\n    minibuffer_read_yn: function(cont) {\n        $64ad30bda24c420e$export$9cb120f8f6032a76.call(this, [\n            \"yes\",\n            \"no\"\n        ], cont, function(mb, text, cont2) {\n            if (text == \"yes\" || text == \"no\") cont2(true);\n            else mb.signalError(\"Please enter yes or no\");\n        });\n    },\n    minibuffer_read_number: function(cont) {\n        $64ad30bda24c420e$export$9cb120f8f6032a76.call(this, null, cont, function(mb, text, cont2) {\n            var n = parseInt(text, 10);\n            if (isNaN(n)) mb.signalError(\"Please enter a number\");\n            cont2(!isNaN(n));\n        });\n    },\n    minibuffer_read_command: function(cont) {\n        var completions = Object.keys(this.COMMANDS).filter((cmd)=>this.COMMANDS[cmd].ymacsInteractive).sort();\n        $64ad30bda24c420e$export$9cb120f8f6032a76.call(this, completions, cont, function(mb, name, cont2) {\n            var cmd = this.COMMANDS[name], ret = cmd && cmd.ymacsInteractive;\n            if (!ret) mb.signalError(\"No such command: \" + name);\n            cont2(ret);\n        });\n    },\n    minibuffer_read_function: function(cont) {\n        var commandNames = Array.hashKeys((0, $5e779a545e33325b$export$df331bdfc76955b4).COMMANDS).sort();\n        $64ad30bda24c420e$export$9cb120f8f6032a76.call(this, commandNames, cont, function(mb, name, cont2) {\n            var cmd = this.COMMANDS[name], ret = !!cmd;\n            if (!ret) mb.signalError(\"No such function: \" + name);\n            cont2(ret);\n        });\n    },\n    minibuffer_read_buffer: function(cont) {\n        this.whenYmacs(function(ymacs) {\n            var bufferNames = ymacs.buffers.map((b)=>b.name);\n            bufferNames.push(bufferNames.shift());\n            $64ad30bda24c420e$export$9cb120f8f6032a76.call(this, bufferNames, cont);\n        //handle_tab.call(this);\n        });\n    },\n    minibuffer_read_string: function(completions, cont, validate) {\n        $64ad30bda24c420e$export$9cb120f8f6032a76.call(this, completions, cont, validate);\n    },\n    minibuffer_read_variable: function(cont) {\n        var tmp = Object.assign({}, this.globalVariables, this.variables);\n        var completions = Object.keys(tmp).filter((name)=>!/^\\*/.test(name)).sort();\n        $64ad30bda24c420e$export$9cb120f8f6032a76.call(this, completions, function(name) {\n            let val = this.getq(name);\n            this.signalInfo(`Current value of <b>${(0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(name)}</b> = <b>${(0, $08a06a2e99accb03$export$cb0933279c36a66b).htmlEscape(val)}</b>`, true, 3000);\n            return cont.apply(this, arguments);\n        });\n    },\n    minibuffer_read_existing_file: function(cont) {\n        var self = this;\n        self.cmd(\"minibuffer_replace_input_by_current_dir\", function() {\n            $64ad30bda24c420e$export$9cb120f8f6032a76.call(self, $64ad30bda24c420e$var$filename_completion, cont, function(mb, name, cont2) {\n                self.ymacs.fs_fileType(name, function(type) {\n                    if (type != \"file\") {\n                        mb.signalError(\"No such file: \" + name);\n                        cont2(false);\n                    } else cont2(true);\n                });\n            });\n        });\n    },\n    minibuffer_read_file: function(cont) {\n        var self = this;\n        self.cmd(\"minibuffer_replace_input_by_current_dir\", function() {\n            $64ad30bda24c420e$export$9cb120f8f6032a76.call(self, $64ad30bda24c420e$var$filename_completion, cont, function(mb, name, cont2) {\n                self.ymacs.fs_fileType(name, function(type) {\n                    cont2(type != \"directory\");\n                });\n            });\n        });\n    },\n    minibuffer_read_file_or_directory: function(cont) {\n        var self = this;\n        self.cmd(\"minibuffer_replace_input_by_current_dir\", function() {\n            $64ad30bda24c420e$export$9cb120f8f6032a76.call(self, $64ad30bda24c420e$var$filename_completion, cont);\n        });\n    },\n    minibuffer_read_directory: function(cont) {\n        var self = this;\n        self.cmd(\"minibuffer_replace_input_by_current_dir\", function() {\n            $64ad30bda24c420e$export$9cb120f8f6032a76.call(self, $64ad30bda24c420e$var$filename_completion, cont);\n        });\n    },\n    minibuffer_prompt_end: function() {\n        return this.whenMinibuffer(function(mb) {\n            return mb.promptMarker.getPosition();\n        });\n    },\n    minibuffer_contents: function() {\n        return this.whenMinibuffer(function(mb) {\n            return mb._bufferSubstring(mb.promptMarker);\n        });\n    },\n    minibuffer_replace_input: function(value) {\n        this.whenMinibuffer(function(mb) {\n            mb._replaceText(mb.promptMarker, mb.getCodeSize(), value);\n            this.getMinibufferFrame().redrawCaret(true);\n        });\n    },\n    minibuffer_replace_input_by_current_dir: function(cont) {\n        this.whenYmacs(function(ymacs) {\n            var self = this;\n            var name = ymacs.getActiveBuffer().name;\n            var dir = name.slice(0, name.lastIndexOf(\"/\") + 1);\n            ymacs.fs_getDirectory(dir, function(info) {\n                if (info && Object.keys(info).length > 0) ymacs.fs_remapDir(dir, function(dir) {\n                    self.cmd(\"minibuffer_replace_input\", dir);\n                    self.cmd(\"minibuffer_complete\", {\n                        noError: true,\n                        noPrefix: true\n                    });\n                    cont();\n                });\n                else {\n                    self.cmd(\"minibuffer_replace_input\", \"\");\n                    cont();\n                }\n            });\n        });\n    },\n    minibuffer_complete: function({ noError: noError = false, noPrefix: noPrefix = false } = {}) {\n        var self = this;\n        self.whenMinibuffer(function(mb) {\n            let str = mb.cmd(\"minibuffer_contents\");\n            let a = mb.getq(\"completion_list\");\n            function complete(a) {\n                if (!a || a.length == 0) {\n                    if (!noError) mb.signalError(\"No completions\", false, 2000);\n                } else $64ad30bda24c420e$var$popupCompletionMenu.call(mb, self.getMinibufferFrame(), a, {\n                    noError: noError,\n                    noPrefix: noPrefix\n                });\n            }\n            if (a instanceof Function) a.call(self, mb, str, function(a) {\n                if (a) complete(a);\n            }, {\n                noPrefix: noPrefix\n            });\n            else if (a && a.length > 0) complete((0, $08a06a2e99accb03$export$acebde4da3d957e6)(a, str));\n            else complete(a);\n        });\n    },\n    minibuffer_complete_and_exit: function() {\n        this.whenMinibuffer((mb)=>{\n            mb.getq(\"minibuffer_validation\").call(mb, null, (valid)=>{\n                if (valid) mb.cmd(\"minibuffer_keyboard_quit\", this.getq(\"minibuffer_continuation\"));\n                else mb.cmd(\"minibuffer_complete\");\n            });\n        });\n    },\n    minibuffer_keyboard_quit: function(cont) {\n        this.whenMinibuffer(function(mb) {\n            var text = this.cmd(\"minibuffer_contents\");\n            mb.setCode(\"\");\n            this.ymacs.setInputFrame(this.ymacs.getActiveFrame());\n            this.ymacs.getActiveFrame().focus();\n            if (!cont) mb.callHooks(\"abort\");\n            setTimeout(()=>{\n                if (cont) cont.call(this, text);\n                this.getPrefixArg();\n            }, 1);\n        });\n        $64ad30bda24c420e$var$killMenu();\n    }\n});\nfunction $64ad30bda24c420e$var$handle_arrow_down() {\n    if ($64ad30bda24c420e$var$$menu) $64ad30bda24c420e$var$select($64ad30bda24c420e$var$$selectedIndex + 1);\n}\nfunction $64ad30bda24c420e$var$handle_arrow_up() {\n    if ($64ad30bda24c420e$var$$menu) $64ad30bda24c420e$var$select($64ad30bda24c420e$var$$selectedIndex - 1);\n}\nfunction $64ad30bda24c420e$var$handle_popup_home() {\n    if ($64ad30bda24c420e$var$$menu) $64ad30bda24c420e$var$select(0);\n}\nfunction $64ad30bda24c420e$var$handle_popup_end() {\n    if ($64ad30bda24c420e$var$$menu) $64ad30bda24c420e$var$select(-1);\n}\nfunction $64ad30bda24c420e$var$handle_enter() {\n    if ($64ad30bda24c420e$var$$menu) {\n        let item = $64ad30bda24c420e$var$$selectedItem;\n        if (item) {\n            $64ad30bda24c420e$var$killMenu();\n            this.cmd(\"minibuffer_replace_input\", item.dataset.value);\n            this.cmd(\"minibuffer_complete_and_exit\");\n        } else this.signalError(\"Select something...\");\n    } else this.cmd(\"minibuffer_complete_and_exit\");\n}\nfunction $64ad30bda24c420e$var$handle_tab() {\n    if (!$64ad30bda24c420e$var$$menu) this.cmd(\"minibuffer_complete\");\n    else $64ad30bda24c420e$var$handle_arrow_down.call(this);\n}\nfunction $64ad30bda24c420e$var$handle_s_tab() {\n    $64ad30bda24c420e$var$handle_arrow_up.call(this);\n}\nfunction $64ad30bda24c420e$var$handle_home() {\n    this.cmd(\"goto_char\", this.promptMarker);\n}\nfunction $64ad30bda24c420e$var$handle_home_mark() {\n    this.ensureTransientMark();\n    this.cmd(\"goto_char\", this.promptMarker);\n    this.ensureTransientMark();\n}\nfunction $64ad30bda24c420e$var$handle_tilde() {\n    if (this.getq(\"completion_list\") === $64ad30bda24c420e$var$filename_completion) {\n        if (this.cmd(\"looking_back\", \"/\")) {\n            $64ad30bda24c420e$var$killMenu();\n            this.cmd(\"minibuffer_replace_input\", \"~/\");\n            this.cmd(\"minibuffer_complete\", {\n                noError: true,\n                noPrefix: true\n            });\n            return;\n        }\n    }\n    this.cmd(\"self_insert_command\");\n}\nvar $64ad30bda24c420e$var$DEFAULT_KEYS = {\n    \"Tab\": $64ad30bda24c420e$var$handle_tab,\n    \"Enter\": $64ad30bda24c420e$var$handle_enter,\n    \"Home && C-a\": $64ad30bda24c420e$var$handle_home,\n    \"~\": $64ad30bda24c420e$var$handle_tilde,\n    \"S-Home && S-C-a\": (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", $64ad30bda24c420e$var$handle_home_mark)\n};\nvar $64ad30bda24c420e$var$KEYMAP_MB_ACTIVE = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(null, Object.assign({\n    \"C-g && Escape\": \"minibuffer_keyboard_quit\"\n}, $64ad30bda24c420e$var$DEFAULT_KEYS));\nvar $64ad30bda24c420e$var$KEYMAP_POPUP_ACTIVE = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(null, Object.assign({\n    \"S-Tab\": $64ad30bda24c420e$var$handle_s_tab,\n    \"ArrowDown && ArrowRight && C-n && C-f\": $64ad30bda24c420e$var$handle_arrow_down,\n    \"ArrowUp && ArrowLeft && C-p && C-b\": $64ad30bda24c420e$var$handle_arrow_up,\n    \"PageDown\": $64ad30bda24c420e$var$handle_arrow_down,\n    \"PageUp\": $64ad30bda24c420e$var$handle_arrow_up,\n    \"C-End && M->\": $64ad30bda24c420e$var$handle_popup_end,\n    \"C-Home && M-<\": $64ad30bda24c420e$var$handle_popup_home,\n    \"Escape\": function() {\n        $64ad30bda24c420e$var$killMenu();\n    }\n}, $64ad30bda24c420e$var$DEFAULT_KEYS));\n$64ad30bda24c420e$var$KEYMAP_POPUP_ACTIVE.defaultHandler = [\n    function() {\n        if (!this.getq(\"ivy_completion\")) $64ad30bda24c420e$var$killMenu();\n        return false; // say it's not handled though\n    }\n];\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newMode(\"minibuffer_mode\", function() {\n    this.pushKeymap($64ad30bda24c420e$var$KEYMAP_MB_ACTIVE);\n    return function() {\n        this.popKeymap($64ad30bda24c420e$var$KEYMAP_MB_ACTIVE);\n    };\n});\n\n\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n    get_region: function() {\n        return this.getRegion();\n    },\n    figure_out_mode: function(code) {\n        if (!code) code = this.getCode();\n        var lines = code.split(/\\n/);\n        if (lines.length > 4) lines.splice(2, lines.length - 4);\n        for (let line of lines){\n            let m = /-\\*-\\s*(.*?)\\s*-\\*-/i.exec(line);\n            if (m) return m[1];\n        }\n    },\n    // TODO: the mapping from extension to mode should be defined\n    // with each mode.\n    mode_from_name: function(name) {\n        if (!name) name = this.name;\n        var ext = (/\\.[^.]+$/.exec(name) || [\n            \"\"\n        ])[0];\n        switch(ext){\n            case \".css\":\n                return \"css\";\n            case \".js\":\n                return \"javascript\";\n            case \".lisp\":\n            case \".scm\":\n            case \".el\":\n                return \"lisp\";\n            case \".md\":\n                return \"markdown\";\n            case \".xml\":\n                return \"xml\";\n            case \".html\":\n                return \"html\";\n            case \".twig\":\n                return \"twig_html\";\n        }\n        return null;\n    },\n    set_buffer_mode: function(mode) {\n        if (!mode) mode = this.cmd(\"figure_out_mode\") || this.cmd(\"mode_from_name\");\n        if (mode) {\n            if (this.COMMANDS[mode]) this.cmd(mode, true);\n            else if (this.COMMANDS[mode + \"_mode\"]) this.cmd(mode + \"_mode\", true);\n        }\n    },\n    cperl_lineup: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\", function(begin, end) {\n        this.cmd(\"save_excursion\", function() {\n            var rcend = this._positionToRowCol(end), max = 0, lines = [];\n            this.cmd(\"goto_char\", begin);\n            this.cmd(\"forward_whitespace\", true);\n            var ch = this.charAt();\n            if (ch.toLowerCase() != ch.toUpperCase()) {\n                this.signalError(\"Cannot lineup here\");\n                return;\n            }\n            while(this._rowcol.row <= rcend.row){\n                var pos = this.getLine().indexOf(ch);\n                if (pos >= 0) {\n                    if (pos > max) max = pos;\n                    lines.push([\n                        this._rowcol.row,\n                        pos\n                    ]);\n                }\n                if (!this.cmd(\"forward_line\")) break;\n            }\n            ++max;\n            lines.forEach((l)=>{\n                this.cmd(\"goto_char\", this._rowColToPosition(l[0], l[1]));\n                this.cmd(\"insert\", \" \".repeat(max - l[1]));\n            });\n        });\n    }),\n    htmlize_region: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"r\\nP\", function(begin, end, lineNum) {\n        this.tokenizer.finishParsing();\n        var row = this._positionToRowCol(begin).row;\n        var html = \"\";\n        var line = row;\n        var pad;\n        if (lineNum && !lineNum.empty) line = parseInt(lineNum, 10);\n        end = this._positionToRowCol(end).row;\n        pad = String(end).length;\n        while(row <= end){\n            html += \"<div class='line'>\";\n            if (lineNum) html += \"<span class='line-number'>\" + (0, $08a06a2e99accb03$export$3cdc770bf8b2ed3d)(line, pad, \" \") + \"</span>\";\n            ++line;\n            html += this._textProperties.getLineHTML(row, this.code[row], null) + \"</div>\\n\";\n            ++row;\n        }\n        var tmp = this.ymacs.switchToBuffer(\"*Htmlize*\");\n        tmp.setCode(html);\n        tmp.cmd(\"xml_mode\", true);\n    }),\n    execute_extended_command: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^CM-x \", function(cmd) {\n        this.callInteractively(cmd);\n    }),\n    set_variable: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"vSet variable: \\nsTo value: \", function(variable, value) {\n        var tmp = parseFloat(value);\n        if (!isNaN(tmp)) value = tmp;\n        this.setq(variable, value);\n    }),\n    eval_string: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^MEval string: \", function(code) {\n        try {\n            var variables = [\n                this,\n                this.ymacs // ymacs\n            ];\n            code = new Function(\"buffer\", \"ymacs\", code);\n            code.apply(this, variables);\n            this.clearTransientMark();\n        } catch (ex) {\n            this.signalError(ex.type + \": \" + ex.message);\n            if (window.console) console.log(ex);\n        }\n    }),\n    eval_region: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^r\", function(begin, end) {\n        this.cmd(\"eval_string\", this.cmd(\"buffer_substring\", begin, end));\n    }),\n    eval_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.cmd(\"eval_string\", this.getCode());\n    }),\n    toggle_line_numbers: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function() {\n        this.ymacs.toggleClass(\"Ymacs-line-numbers\");\n    }),\n    save_file: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"FWrite file: \", function(name) {\n        this.ymacs.ls_setFileContents(name, this.getCode());\n        this.signalInfo(\"Saved in local storage\");\n    }),\n    load_file: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"fFind file: \", function(name) {\n        var code = this.ymacs.ls_getFileContents(name);\n        var buffer = this.ymacs.createBuffer({\n            name: name\n        });\n        buffer.setCode(code);\n        buffer.cmd(\"set_buffer_mode\");\n        buffer.cmd(\"switch_to_buffer\", name);\n    }),\n    find_file: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"FFind file: \", function(name) {\n        var self = this;\n        name = self.ymacs.fs_normalizePath(name);\n        self.ymacs.fs_fileType(name, function(type) {\n            if (type == \"directory\") self.signalInfo(\"Can't open directory\");\n            else self.ymacs.fs_getFileContents(name, true, function(code, stamp) {\n                var buffer = self.ymacs.getBuffer(name);\n                function find_file() {\n                    buffer.setCode(code || \"\");\n                    buffer.stamp = stamp;\n                    buffer.dirty(false);\n                    buffer.cmd(\"set_buffer_mode\");\n                    buffer.cmd(\"switch_to_buffer\", name);\n                }\n                if (buffer) {\n                    if (stamp == null) find_file();\n                    else if (buffer.stamp == stamp) buffer.cmd(\"switch_to_buffer\", name);\n                    else {\n                        var msg = \"File \" + name + \" changed on disk.  \" + (buffer.dirty() ? \"Discard your edits?\" : \"Reread from disk?\");\n                        buffer.cmd(\"minibuffer_yn\", msg, function(yes) {\n                            if (yes) find_file();\n                        });\n                    }\n                } else {\n                    buffer = self.ymacs.createBuffer({\n                        name: name,\n                        stamp: stamp\n                    });\n                    if (code == null) self.signalInfo(\"New file\");\n                    find_file();\n                }\n            });\n        });\n    }),\n    write_file: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"FWrite file: \", function(name) {\n        var self = this;\n        function write_file() {\n            self.ymacs.fs_setFileContents(name, self.getCode(), null, function(stamp) {\n                self.cmd(\"rename_buffer\", name);\n                self.dirty(false);\n                self.stamp = stamp; // refresh stamp\n                self.signalInfo(\"Wrote \" + name);\n            });\n        }\n        var buffer = self.ymacs.getBuffer(name);\n        if (!buffer) write_file();\n        else {\n            var msg = \"A buffer is visiting \" + name + \"; proceed?\";\n            buffer.cmd(\"minibuffer_yn\", msg, function(yes) {\n                if (yes) {\n                    self.ymacs.killBuffer(buffer);\n                    write_file();\n                }\n            });\n        }\n    }),\n    save_some_buffers: function() {\n        this.cmd(\"save_some_buffers_with_continuation\", true, function() {});\n    },\n    save_some_buffers_with_continuation: function(ask, cont) {\n        var bufs = this.ymacs.buffers.slice(); // get copy of buffers\n        function loop(saved) {\n            if (bufs.length > 0) bufs.shift().cmd(\"save_buffer_with_continuation\", ask, loop);\n            else cont();\n        }\n        loop(false);\n    },\n    save_buffer_with_continuation: function(ask, cont) {\n        var self = this;\n        function did_save(stamp) {\n            self.dirty(false);\n            self.stamp = stamp; // refresh stamp\n            cont(true);\n        }\n        function do_save() {\n            self.ymacs.fs_setFileContents(self.name, self.getCode(), self.stamp, function(stamp) {\n                if (stamp != null) did_save(stamp);\n                else self.cmd(\"minibuffer_yn\", self.name + \" has changed since visited or saved.  Save anyway?\", function(yes) {\n                    if (!yes) cont(false);\n                    else self.ymacs.fs_setFileContents(self.name, self.getCode(), null, function(stamp) {\n                        did_save(stamp);\n                    });\n                });\n            });\n        }\n        if (!self.dirty() || ask && self.name.match(/^\\*.*\\*$/)) cont(false);\n        else if (!ask) do_save();\n        else self.cmd(\"minibuffer_yn\", \"Save file \" + self.name + \"?\", function(yes) {\n            if (!yes) cont(false);\n            else do_save();\n        });\n    },\n    save_buffer: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"\", function() {\n        var self = this;\n        if (self.dirty()) self.cmd(\"save_buffer_with_continuation\", false, function(saved) {\n            if (saved) self.signalInfo(\"Wrote \" + self.name);\n        });\n        else self.signalInfo(\"No changes need to be saved\");\n    }),\n    delete_file: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"fDelete file: \", function(name) {\n        var self = this;\n        self.ymacs.fs_deleteFile(name, function() {\n            self.signalInfo(\"Deleted \" + name);\n        });\n    }),\n    eval_file: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"fEval file: \", function(name) {\n        var self = this;\n        self.ymacs.fs_getFileContents(name, false, function(code, stamp) {\n            self.cmd(\"eval_string\", code);\n        });\n    }),\n    request_full_screen: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(async function() {\n        try {\n            this.ymacs.requestFullScreen();\n        } catch (ex) {\n            console.error(ex);\n            this.signalError(\"Full-screen denied\", false, 3000);\n        }\n    }),\n    set_color_theme: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function(theme) {\n        if (theme) this.ymacs.setColorTheme(theme);\n        else {\n            let names = (0, $08a06a2e99accb03$export$2ceef881d0b4a563)().sort();\n            this.cmd(\"minibuffer_prompt\", \"Color theme: \");\n            (0, $64ad30bda24c420e$export$9cb120f8f6032a76).call(this, names, (theme)=>{\n                this.ymacs.setColorTheme(theme);\n            }, (mb, theme, cont)=>{\n                theme = theme.trim();\n                if (!theme) mb.cmd(\"minibuffer_complete\");\n                else if (names.indexOf(theme) < 0) {\n                    mb.signalError(\"No such theme\");\n                    return cont(false);\n                } else return cont(true);\n            });\n        }\n    }),\n    toggle_bar_cursor: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.ymacs.toggleBarCursor();\n    })\n});\n\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\nlet $f129722536e13624$var$Ymacs_Keymap_ISearch = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"isearch\", {\n    \"Escape\": [\n        \"isearch_abort\",\n        true\n    ],\n    \"C-g\": \"isearch_reset_or_abort\",\n    \"C-w && C-S-s\": \"isearch_yank_word_or_char\",\n    \"C-s\": \"isearch_forward\",\n    \"C-r\": \"isearch_backward\",\n    \"M-%\": \"query_replace\",\n    \"C-M-%\": \"query_replace_regexp\",\n    \"M-s w && M-w\": \"isearch_toggle_word\",\n    \"M-s c && M-c\": \"isearch_toggle_case_fold\",\n    \"M-s Space && M-Space\": \"isearch_toggle_lax_whitespace\",\n    \"Enter\": \"isearch_abort\",\n    \"C-l\": \"recenter_top_bottom\",\n    \"Backspace\": function() {\n        if (this.getMinibuffer().point() > this._isearchContext.mbMark.getPosition()) {\n            this.getMinibuffer().cmd(\"backward_delete_char\");\n            this.cmd(\"goto_char\", this._isearchContext.livepoint);\n            $f129722536e13624$var$isearchText.call(this);\n            $f129722536e13624$var$updateIsearch.call(this);\n        }\n    }\n});\n$f129722536e13624$var$Ymacs_Keymap_ISearch.defaultHandler = [\n    \"isearch_printing_char\"\n];\nfunction $f129722536e13624$var$initIsearch({ forward: forward = true, regexp: regexp = false, lax: lax = true, word: word = false, case_fold: case_fold = this.getq(\"case_fold_search\"), case_replace: case_replace = this.getq(\"case_replace\"), qreplace: qreplace = false, region: region = null } = {}) {\n    if (!this._isearchContext) {\n        this._isearchContext = {\n            forward: forward,\n            regexp: regexp,\n            lax: lax,\n            word: word,\n            case_fold: case_fold,\n            case_replace: case_replace,\n            livepoint: this.point(),\n            origpoint: this.point(),\n            current: {\n                begin: this.point(),\n                end: this.point()\n            },\n            mbMark: this.getMinibuffer().promptMarker,\n            query: \"\",\n            qreplace: qreplace,\n            region: region\n        };\n        if (!qreplace) {\n            this.pushKeymap($f129722536e13624$var$Ymacs_Keymap_ISearch);\n            $f129722536e13624$var$resetPrompt.call(this);\n        }\n        return true;\n    }\n}\nfunction $f129722536e13624$var$isearchText() {\n    return this._isearchContext.query = this.getMinibuffer()._bufferSubstring(this._isearchContext.mbMark);\n}\nfunction $f129722536e13624$var$updateIsearch({ forward: forward } = {}) {\n    var query = this._isearchContext.query;\n    if (!/\\S/.test(query) && this.getq(\"isearch_last_context\")) {\n        this._isearchContext = this.getq(\"isearch_last_context\");\n        query = this._isearchContext.query;\n        this.getMinibuffer()._placeUndoBoundary();\n        this.getMinibuffer().cmd(\"insert\", query);\n        this._isearchContext.origpoint = this.point();\n        this._isearchContext.current = {\n            begin: this.point(),\n            end: this.point()\n        };\n    }\n    this._isearchContext.livepoint = this.point();\n    if (forward != null) this._isearchContext.forward = forward;\n    return $f129722536e13624$var$doSearch.call(this);\n}\nfunction $f129722536e13624$var$caseFold() {\n    let ctx = this._isearchContext;\n    let query = ctx.query;\n    return ctx.case_fold ?? (ctx.regexp ? query = query.replace(/\\\\./g, \"\") : query) == query.toLowerCase();\n}\nfunction $f129722536e13624$var$lazyHighlight(qrx, prompt) {\n    let cursor = this._rowcol;\n    let minpos = this._rowColToPosition(cursor.row - 50, 0);\n    let maxpos = this._rowColToPosition(cursor.row + 50, Infinity);\n    let code = this.getCode();\n    let hl = [];\n    let ctx = this._isearchContext;\n    let point = this.point();\n    let count = 0;\n    let crnt = 0;\n    qrx.lastIndex = ctx.region?.begin || 0;\n    while(true){\n        let m = qrx.exec(code);\n        if (m && m[0].length) {\n            if (ctx.region && qrx.lastIndex > ctx.region.end) break;\n            count++;\n            if (m.index >= minpos && m.index <= maxpos) {\n                let p1 = this._positionToRowCol(m.index);\n                let p2 = this._positionToRowCol(qrx.lastIndex);\n                hl.push({\n                    line1: p1.row,\n                    col1: p1.col,\n                    line2: p2.row,\n                    col2: p2.col\n                });\n            }\n            if (point >= m.index && point < qrx.lastIndex || point == qrx.lastIndex && ctx.forward) crnt = count;\n        } else break;\n    }\n    $f129722536e13624$var$resetPrompt.call(this, count, crnt, prompt);\n    this.setOverlay(\"isearch-lazy\", hl);\n}\nfunction $f129722536e13624$var$resetPrompt(count, crnt, prompt) {\n    let ctx = this._isearchContext;\n    this.whenMinibuffer((mb)=>{\n        if (prompt) mb.prompt(prompt.call(this, count, crnt, ctx));\n        else {\n            let pos = ctx.qreplace && count ? `[${count}] ` : count && crnt ? `[${crnt}/${count}] ` : \"\";\n            mb.prompt(`${pos}${ctx.qreplace ? \"Query replace\" : \"I-search\"}${ctx.regexp ? \" regexp\" : ctx.word ? \" word\" : \"\"}${ctx.forward ? \"\" : \" backward\"}:`);\n        }\n        let start = ctx.mbMark;\n        let mid = start + ctx.lastFoundQuery?.length;\n        if (mid != null) {\n            mb.forEachLine((line, c1, c2)=>{\n                mb._textProperties.removeLineProps(line, c1, c2, \"css\");\n            }, start, mid);\n            mb.forEachLine((line, c1, c2)=>{\n                mb._textProperties.addLineProps(line, c1, c2, \"css\", \"isearch-fail\");\n            }, mid);\n        }\n    });\n}\nfunction $f129722536e13624$var$doSearch({ forward: forward } = this._isearchContext) {\n    let ctx = this._isearchContext;\n    let query = ctx.query;\n    let found = false;\n    try {\n        let rx = $f129722536e13624$var$searchRegExp.call(this);\n        found = this.cmd(forward ? \"search_forward_regexp\" : \"search_backward_regexp\", rx);\n        if (found) {\n            ctx.lastFoundQuery = query;\n            this.cmd(\"ensure_caret_visible\");\n            let p1 = this.point();\n            let p2 = p1 + (forward ? -1 : 1) * this.matchData[0].length;\n            if (forward) [p1, p2] = [\n                p2,\n                p1\n            ];\n            ctx.current = {\n                begin: p1,\n                end: p2\n            };\n            let p1rc = this._positionToRowCol(p1);\n            let p2rc = this._positionToRowCol(p2);\n            this.setOverlay(\"isearch\", {\n                line1: p1rc.row,\n                col1: p1rc.col,\n                line2: p2rc.row,\n                col2: p2rc.col\n            });\n        }\n        $f129722536e13624$var$lazyHighlight.call(this, rx);\n    } catch  {}\n    return found;\n}\nfunction $f129722536e13624$var$searchRegExp({ query: query = null, regexp: regexp = false, lax: lax = true, case_fold: case_fold = true, word: word = false } = this._isearchContext || {}) {\n    let searchRX = query;\n    if (!regexp) {\n        searchRX = query.replace(/[\\]\\[\\}\\{\\)\\(\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n        if (word) // XXX: I guess it would be nice to use syntax_word / syntax_word_dabbrev\n        searchRX = \"\\\\b\" + searchRX + \"\\\\b\";\n    }\n    if (lax) searchRX = searchRX.replace(/\\s+/g, \"\\\\s+\");\n    return new RegExp(searchRX, $f129722536e13624$var$caseFold.call(this) ? \"mugi\" : \"mug\");\n}\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n    isearch_forward: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let arg = {\n            forward: true\n        };\n        if (!$f129722536e13624$var$initIsearch.call(this, arg)) {\n            if (!$f129722536e13624$var$updateIsearch.call(this, arg)) this.signalError(\"No more forward occurrences of the search text\");\n        }\n    }),\n    isearch_backward: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let arg = {\n            forward: false\n        };\n        if (!$f129722536e13624$var$initIsearch.call(this, arg)) {\n            if (!$f129722536e13624$var$updateIsearch.call(this, arg)) this.signalError(\"No more backward occurrences of the search text\");\n        }\n    }),\n    isearch_forward_regexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let arg = {\n            forward: true,\n            regexp: true\n        };\n        if (!$f129722536e13624$var$initIsearch.call(this, arg)) {\n            if (!$f129722536e13624$var$updateIsearch.call(this, arg)) this.signalError(\"No more forward occurrences of the search text\");\n        }\n    }),\n    isearch_backward_regexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let arg = {\n            forward: false,\n            regexp: true\n        };\n        if (!$f129722536e13624$var$initIsearch.call(this, arg)) {\n            if (!$f129722536e13624$var$updateIsearch.call(this, arg)) this.signalError(\"No more forward occurrences of the search text\");\n        }\n    }),\n    isearch_yank_word_or_char: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        if (!this._isearchContext) $f129722536e13624$var$initIsearch.call(this, {\n            forward: true\n        });\n        let ctx = this._isearchContext;\n        var pos = ctx.current.end;\n        var pos2 = this.cmd(\"save_excursion\", function() {\n            this.cmd(\"goto_char\", pos);\n            this.cmd(\"forward_word\");\n            return this.point();\n        });\n        if (pos2 != pos) {\n            var word = this._bufferSubstring(pos, pos2);\n            this.getMinibuffer()._placeUndoBoundary();\n            this.getMinibuffer().cmd(\"insert\", word.toLowerCase());\n            word = $f129722536e13624$var$isearchText.call(this);\n            this.cmd(\"goto_char\", ctx.current.begin);\n            $f129722536e13624$var$doSearch.call(this, {\n                forward: true\n            });\n        }\n    }),\n    isearch_toggle_word: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let ctx = this._isearchContext;\n        ctx.word = !ctx.word;\n        if (ctx.word) ctx.regexp = false;\n        this.signalInfo(`Search word: ${ctx.word ? \"ON\" : \"OFF\"}`, false, 2000);\n        this.cmd(\"goto_char\", this._isearchContext.current.begin);\n        $f129722536e13624$var$doSearch.call(this);\n    }),\n    isearch_toggle_case_fold: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let ctx = this._isearchContext;\n        if (ctx.case_fold == null) ctx.case_fold = false;\n        else if (ctx.case_fold === false) ctx.case_fold = true;\n        else if (ctx.case_fold === true) ctx.case_fold = null;\n        this.signalInfo(`Case sensitive: ${ctx.case_fold == null ? \"AUTO\" : ctx.case_fold ? \"OFF\" : \"ON\"}`, false, 2000);\n        this.cmd(\"goto_char\", this._isearchContext.current.begin);\n        $f129722536e13624$var$doSearch.call(this);\n    }),\n    isearch_toggle_lax_whitespace: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let ctx = this._isearchContext;\n        ctx.lax = !ctx.lax;\n        this.signalInfo(`Loose whitespace: ${ctx.lax ? \"ON\" : \"OFF\"}`, false, 2000);\n        this.cmd(\"goto_char\", this._isearchContext.current.begin);\n        $f129722536e13624$var$doSearch.call(this);\n    }),\n    isearch_printing_char: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let ctx = this._isearchContext;\n        var ev = this.interactiveEvent();\n        if (ev?.key?.length == 1 && !ev.ctrlKey && !ev.altKey) {\n            this.whenMinibuffer((mb)=>{\n                mb.cmd(\"self_insert_command\");\n                this.cmd(\"goto_char\", ctx.livepoint);\n                $f129722536e13624$var$isearchText.call(this);\n                $f129722536e13624$var$doSearch.call(this);\n            });\n            return true;\n        } else {\n            this.cmd(\"isearch_abort\");\n            return false;\n        }\n    }),\n    isearch_abort: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function(cancelled) {\n        if (!cancelled) this.setGlobal(\"isearch_last_context\", this._isearchContext);\n        this.setMinibuffer(\"\");\n        this.popKeymap($f129722536e13624$var$Ymacs_Keymap_ISearch);\n        if (cancelled) this.cmd(\"goto_char\", this._isearchContext.origpoint);\n        else this.markMarker.setPosition(this._isearchContext.origpoint);\n        this._isearchContext = null;\n        this.deleteOverlay(\"isearch\");\n        this.deleteOverlay(\"isearch-lazy\");\n        return true;\n    }),\n    isearch_reset_or_abort: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let ctx = this._isearchContext;\n        if (!ctx.lastFoundQuery || ctx.query == ctx.lastFoundQuery) this.cmd(\"isearch_abort\", true);\n        else this.whenMinibuffer((mb)=>{\n            mb._replaceText(ctx.mbMark, mb.getCode().length, ctx.lastFoundQuery);\n            ctx.query = ctx.lastFoundQuery;\n            $f129722536e13624$var$doSearch.call(this);\n        });\n    })\n});\n/* -----[ query-replace ]----- */ let $f129722536e13624$var$Ymacs_Keymap_Query_Replace = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"query_replace\", {\n    \"y && Space\": \"query_replace_yes_this_occurrence\",\n    \".\": \"query_replace_yes_this_occurrence_and_stop\",\n    \"n && Delete && Backspace\": \"query_replace_no_this_occurrence\",\n    \"u\": \"query_replace_undo_previous\",\n    \"!\": \"query_replace_yes_all_occurrences\",\n    \"q && Enter\": [\n        \"query_replace_abort\",\n        true\n    ],\n    \"C-l\": \"recenter_top_bottom\"\n});\n$f129722536e13624$var$Ymacs_Keymap_Query_Replace.defaultHandler = [\n    \"query_replace_abort\"\n];\nfunction $f129722536e13624$var$query_replace_1(args = {}) {\n    this.whenMinibuffer((mb)=>{\n        $f129722536e13624$var$initIsearch.call(this, {\n            ...args,\n            qreplace: true\n        });\n        let ctx = this._isearchContext;\n        this.cmd(\"minibuffer_prompt\", `Query replace${ctx.regexp ? \" regexp\" : ctx.word ? \" word\" : \"\"}: `);\n        let hlOrig = ()=>{\n            $f129722536e13624$var$isearchText.call(this);\n            try {\n                $f129722536e13624$var$lazyHighlight.call(this, $f129722536e13624$var$searchRegExp.call(this));\n            } catch  {}\n        };\n        mb.addEventListener(\"afterInteractiveCommand\", hlOrig);\n        let onQuit = (continued)=>{\n            mb.removeEventListener(\"afterInteractiveCommand\", hlOrig);\n            mb.removeEventListener(\"abort\", onQuit);\n            if (!continued) {\n                this.deleteOverlay(\"isearch\");\n                this.deleteOverlay(\"isearch-lazy\");\n                this._isearchContext = null;\n            }\n        };\n        mb.addEventListener(\"abort\", onQuit);\n        this.cmd(\"minibuffer_read_string\", null, (orig)=>{\n            this._isearchContext.query = orig;\n            $f129722536e13624$var$query_replace_2.call(this);\n            onQuit(true);\n        }, (buf, query, cont)=>{\n            ctx.query = query;\n            try {\n                $f129722536e13624$var$lazyHighlight.call(this, $f129722536e13624$var$searchRegExp.call(this));\n                cont(query);\n            } catch  {\n                buf.popupMessage({\n                    type: \"error\",\n                    text: \"Incomplete regexp\",\n                    atCaret: true\n                });\n            }\n        });\n    });\n}\nfunction $f129722536e13624$var$query_replace_2() {\n    let mb = this.getMinibuffer();\n    let ctx = this._isearchContext;\n    let query = ctx.query;\n    let rxorig = $f129722536e13624$var$searchRegExp.call(this);\n    $f129722536e13624$var$lazyHighlight.call(this, rxorig);\n    if (rxorig) {\n        this.cmd(\"minibuffer_prompt\", `Replace ${ctx.regexp ? \"regexp \" : \"\"}\\u{201C}${query}\\u{201D} with: `);\n        let onQuit = ()=>{\n            this.deleteOverlay(\"isearch\");\n            this.deleteOverlay(\"isearch-lazy\");\n            this._isearchContext = null;\n            mb.removeEventListener(\"abort\", onQuit);\n        };\n        mb.addEventListener(\"abort\", onQuit);\n        this.cmd(\"minibuffer_read_string\", null, (replacement)=>{\n            this.clearTransientMark();\n            $f129722536e13624$var$query_replace_3.call(this, mb, rxorig, replacement);\n        });\n    }\n}\nfunction $f129722536e13624$var$similarCase(rplc) {\n    let ctx = this._isearchContext;\n    if (ctx.case_replace && rplc == rplc.toLowerCase()) {\n        let orig = this.matchData[0];\n        if (orig == orig.toUpperCase()) return rplc.toUpperCase();\n        if (orig == this.capitalize(orig)) return this.capitalize(rplc);\n    }\n    return rplc;\n}\nfunction $f129722536e13624$var$query_replace_3(mb, rxorig, replacement) {\n    let ctx = this._isearchContext;\n    this.pushKeymap($f129722536e13624$var$Ymacs_Keymap_Query_Replace);\n    let cmds, stop, curr, count = 0;\n    let queue = [];\n    let end = ctx.region && this.createMarker(ctx.region.end);\n    this.cmd(\"goto_char\", ctx.region ? ctx.region.begin : ctx.current.begin);\n    let domatch = (replacement)=>{\n        if (ctx.regexp) // look ma, I can write code like this.\n        replacement = replacement.replace(/(?:\\\\([\\\\\\&\\#]|\\d+|<.+?>))/g, (s, p)=>p == \"\\\\\" ? \"\\\\\" : p == \"#\" ? count : p == \"&\" ? this.matchData[0] : p[0] == \"<\" ? this.matchData.groups[p.substr(1, p.length - 2)] : this.matchData[+p]);\n        return $f129722536e13624$var$similarCase.call(this, replacement);\n    };\n    let gotoNext = (all)=>{\n        let point = this.point();\n        let found = this.cmd(\"search_forward_regexp\", rxorig);\n        if (found) {\n            let m = this.matchData;\n            if (ctx.region && (m.index < ctx.region.begin || m.after > end)) {\n                if (!all) this.cmd(\"goto_char\", point);\n                return null;\n            }\n            let begin = this.matchData.index;\n            found = {\n                begin: begin,\n                end: this.point()\n            };\n            if (!all) {\n                this.cmd(\"ensure_caret_visible\");\n                let rc_begin = this._positionToRowCol(begin);\n                this.setOverlay(\"isearch\", {\n                    line1: rc_begin.row,\n                    col1: rc_begin.col,\n                    line2: this._rowcol.row,\n                    col2: this._rowcol.col\n                });\n            }\n        }\n        if (!all) $f129722536e13624$var$lazyHighlight.call(this, rxorig, (count, crnt)=>`[${count}] Replace with \\u{201C}${domatch(replacement)}\\u{201D}? (y/n/u/!)`);\n        return found;\n    };\n    cmds = this.replaceCommands({\n        query_replace_yes_this_occurrence: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(()=>{\n            queue.push(curr);\n            this._replaceText(curr.begin, curr.end, domatch(replacement));\n            count++;\n            curr = gotoNext();\n            if (!curr) stop();\n        }),\n        query_replace_yes_this_occurrence_and_stop: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(()=>{\n            queue.push(curr);\n            this._replaceText(curr.begin, curr.end, domatch(replacement));\n            count++;\n            stop();\n        }),\n        query_replace_no_this_occurrence: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(()=>{\n            curr = gotoNext();\n            if (!curr) stop();\n        }),\n        query_replace_yes_all_occurrences: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(()=>{\n            let last;\n            while(curr){\n                last = curr;\n                this._replaceText(curr.begin, curr.end, domatch(replacement));\n                count++;\n                curr = gotoNext(true);\n            }\n            if (last) {\n                this.cmd(\"goto_char\", last.begin);\n                this.cmd(\"ensure_caret_visible\");\n            }\n            stop();\n        }),\n        query_replace_undo_previous: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(()=>{\n            let prev = queue.pop();\n            if (prev) {\n                count--;\n                this.cmd(\"undo\");\n                // XXX: this is ugly, but oh well.. We'd like to\n                // pretend this edit/undo operation never exist.\n                let uptr = this.__undoPointer;\n                let uq = this.__undoQueue.slice(0, uptr);\n                setTimeout(()=>{\n                    this.__undoPointer = uptr;\n                    this.__undoQueue = uq;\n                });\n                this.cmd(\"goto_char\", prev.begin);\n                curr = gotoNext();\n            } else this.signalError(\"No more undo\");\n        }),\n        query_replace_abort: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)((enter)=>{\n            stop();\n            return enter;\n        })\n    });\n    stop = ()=>{\n        if (end) end.destroy();\n        mb.removeEventListener(\"abort\", stop);\n        this.newCommands(cmds);\n        this.deleteOverlay(\"isearch\");\n        this.deleteOverlay(\"isearch-lazy\");\n        this._isearchContext = null;\n        this.popKeymap($f129722536e13624$var$Ymacs_Keymap_Query_Replace);\n        mb.cmd(\"minibuffer_keyboard_quit\");\n        this.signalInfo(`Replaced ${count} occurrences`);\n    };\n    curr = gotoNext();\n    if (!curr) stop();\n    else mb.addEventListener(\"abort\", stop);\n}\nfunction $f129722536e13624$var$query_replace(regexp) {\n    return (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^P\", function(word) {\n        let ctx = this._isearchContext;\n        let args = {\n            qreplace: true,\n            regexp: regexp == null && ctx ? ctx.regexp : !!regexp,\n            word: ctx ? ctx.word : !!word,\n            region: this.transientMarker && this.getRegion()\n        };\n        if (ctx) {\n            this.cmd(\"isearch_abort\");\n            this._isearchContext = Object.assign({}, ctx, args);\n            $f129722536e13624$var$query_replace_2.call(this);\n        } else $f129722536e13624$var$query_replace_1.call(this, args);\n    });\n}\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n    query_replace: $f129722536e13624$var$query_replace(null),\n    query_replace_regexp: $f129722536e13624$var$query_replace(true)\n});\n\n\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\nclass $1414b989ef7d55bc$export$96ac030efd09f62d {\n    _cont = (0, $08a06a2e99accb03$export$d5414a779ebfba6b);\n    _inParens = (0, $08a06a2e99accb03$export$d5414a779ebfba6b);\n    _parens = (0, $08a06a2e99accb03$export$d5414a779ebfba6b);\n    _inComment = null;\n    _inString = false;\n    _pmeta = null;\n    COMMENT = [\n        \"//\",\n        [\n            \"/*\",\n            \"*/\",\n            \"*\"\n        ]\n    ];\n    STRING = [\n        '\"',\n        \"'\"\n    ];\n    NUMBER = /^[+-]?(?:0x[0-9a-fA-F]+|(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)/u;\n    NAME = /^[\\p{L}_$][\\p{L}0-9_$]*/iu;\n    WHITESPACE = /^[ \\u00a0\\n\\r\\t\\f\\u000b\\u200b\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\uFEFF]+/;\n    OPEN_PAREN = {\n        \"(\": \")\",\n        \"{\": \"}\",\n        \"[\": \"]\"\n    };\n    CLOSE_PAREN = {\n        \")\": \"(\",\n        \"}\": \"{\",\n        \"]\": \"[\"\n    };\n    constructor({ stream: stream, tok: tok }){\n        this._stream = stream;\n        this._tok = tok;\n    }\n    next() {\n        this._stream.checkStop();\n        if (this._cont !== (0, $08a06a2e99accb03$export$d5414a779ebfba6b)) this._cont.car.call(this);\n        else this.read();\n    }\n    copy() {\n        let _cont = this._cont;\n        let _inParens = this._inParens;\n        let _parens = this._parens;\n        let _inComment = this._inComment;\n        let _inString = this._inString;\n        let _pmeta = this._pmeta;\n        return ()=>{\n            this._cont = _cont;\n            this._inParens = _inParens;\n            this._parens = _parens;\n            this._inComment = _inComment;\n            this._inString = _inString;\n            this._pmeta = _pmeta;\n            return this;\n        };\n    }\n    maybeSave() {\n        let s = this._stream;\n        if (s.eol() && s.nextLine()) {\n            this._tok.parsers[s.line] = this.copy();\n            return true;\n        }\n    }\n    skipWS(skipLines = true) {\n        let s = this._stream, m;\n        while(true){\n            if (m = s.lookingAt(this.WHITESPACE)) this.t(null, m[0].length);\n            if (skipLines) {\n                if (!this.maybeSave()) break;\n            } else break;\n        }\n    }\n    read() {\n        this.readComment() || this.readString() || this.readOpenParen() || this.readCloseParen() || this.readCustom() || this.readTrailingWhitespace() || this.t();\n    }\n    readComment() {\n        for (let syn of this.COMMENT){\n            if (Array.isArray(syn) && this.readCommentMulti(...syn)) return true;\n            if (this.readCommentLine(syn)) return true;\n        }\n    }\n    readCommentLine(start) {\n        let s = this._stream;\n        let p = null, end = null;\n        while(s.lookingAt(start)){\n            if (!p) p = {\n                line: s.line,\n                col: s.col,\n                c1: s.col,\n                c2: s.col,\n                comment: true,\n                type: \"\",\n                inner: {\n                    l1: s.line,\n                    c1: s.col\n                },\n                outer: {\n                    l1: s.line,\n                    c1: s.col\n                }\n            };\n            this.t(\"comment-starter\", start.length);\n            this.token({\n                line: s.line,\n                c1: s.col,\n                c2: s.col = s.lineLength()\n            }, \"comment\");\n            end = {\n                line: s.line,\n                col: s.col,\n                c1: s.col,\n                c2: s.col,\n                type: \"\",\n                opened: p\n            };\n        // XXX: this screws up the parse state after a line comment.\n        // this.maybeSave();\n        // this.skipWS(false);\n        }\n        if (p) {\n            p.closed = end;\n            p.inner.l2 = p.outer.l2 = end.line;\n            p.inner.c2 = p.outer.c2 = end.c1;\n            this.doneParen(p);\n        }\n        return p;\n    }\n    readCommentMulti(start, stop, inner, tok1 = \"mcomment-starter\", tok2 = \"mcomment\", tok3 = \"mcomment-stopper\") {\n        let s = this._stream, m;\n        if (this._inComment) {\n            if (m = s.lookingAt(stop)) {\n                let p = this.popInParen(start, m[0].length, tok3);\n                p.inner.l2 = p.closed.line;\n                p.inner.c2 = p.closed.c1;\n                p.outer.l2 = p.closed.line;\n                p.outer.c2 = p.closed.c2;\n                this.popCont();\n                this._inComment = null;\n            } else this.t(tok2);\n        } else if (s.lookingAt(start)) {\n            this._inComment = {\n                line: s.line,\n                c1: s.col,\n                inner: inner\n            };\n            let p = this.pushInParen(start, tok1);\n            p.comment = true;\n            p.inner = {\n                l1: p.line,\n                c1: p.c2\n            };\n            p.outer = {\n                l1: p.line,\n                c1: p.c1\n            };\n            this.pushCont(this.readCommentMulti.bind(this, start, stop, inner, tok1, tok2, tok3));\n            return true;\n        }\n    }\n    readString(start, stop, expStart, expStop, tokType) {\n        let s = this._stream;\n        if (this._inString) {\n            if (s.lookingAt(\"\\\\\")) {\n                this.t(tokType);\n                this.t(tokType);\n            } else if (s.lookingAt(stop)) {\n                this.popCont();\n                this._inString = false;\n                this.popInParen(start, stop.length, `${tokType}-stopper`);\n            } else if (expStart && s.lookingAt(expStart)) {\n                this._inString = false;\n                let op = this.pushInParen(expStart);\n                this.pushCont(()=>{\n                    if (s.lookingAt(expStop) && this._inParens.car === op) {\n                        this.popInParen(expStart, expStop.length);\n                        this.popCont();\n                        this._inString = true;\n                    } else this.read();\n                });\n            } else this.t(tokType);\n        } else for (let syn of this.STRING){\n            let start = syn, stop = syn, expStart, expStop, tokType = \"string\";\n            if (Array.isArray(syn)) [start, stop, expStart, expStop, tokType = \"string\"] = syn;\n            if (s.lookingAt(start)) {\n                this.pushInParen(start, `${tokType}-starter`);\n                this._inString = true;\n                this.pushCont(this.readString.bind(this, start, stop, expStart, expStop, tokType));\n                return true;\n            }\n        }\n    }\n    readCustom() {\n        return this.readNumber();\n    }\n    readName() {\n        let s = this._stream, m = s.lookingAt(this.NAME);\n        if (m) return {\n            line: s.line,\n            c1: s.col,\n            c2: s.col += m[0].length,\n            id: m[0]\n        };\n    }\n    maybeName(type = null) {\n        let name = this.readName();\n        if (name) this.token(name, name.type = type);\n        return name;\n    }\n    readNumber() {\n        let m = this._stream.lookingAt(this.NUMBER);\n        if (m) {\n            this.t(\"number\", m[0].length);\n            return true;\n        }\n    }\n    setParenMeta(info) {\n        this._pmeta = info;\n    }\n    readOpenParen() {\n        let ch = this._stream.peek();\n        if (this.OPEN_PAREN[ch]) {\n            this.pushInParen(ch).meta = this._pmeta;\n            this._pmeta = null;\n            return true;\n        }\n    }\n    readCloseParen() {\n        let type = this.CLOSE_PAREN[this._stream.peek()];\n        if (type) {\n            this.popInParen(type, 1);\n            return true;\n        }\n    }\n    readTrailingWhitespace() {\n        let m = this._stream.lookingAt(/^\\s+$/);\n        if (m) {\n            this.t(\"trailing-whitespace\", m[0].length);\n            return true;\n        }\n    }\n    t(type = null, len = 1) {\n        this.token({\n            line: this._stream.line,\n            c1: this._stream.col,\n            c2: this._stream.col += len\n        }, type);\n    }\n    token(tok, type = tok.type) {\n        this._tok.onToken(tok.line, tok.c1, tok.c2, type);\n    }\n    pushInParen(type, tokType = \"open-paren\") {\n        let s = this._stream;\n        let n = type.length;\n        let p = {\n            line: s.line,\n            col: s.col,\n            c1: s.col,\n            c2: s.col + n,\n            type: type\n        };\n        this._inParens = new (0, $08a06a2e99accb03$export$74c44e616647f5c0)(p, this._inParens);\n        if (n) this.t(tokType, n);\n        return p;\n    }\n    popInParen(start, n = start.length, tokType = \"close-paren\") {\n        let s = this._stream;\n        if (this._inParens !== (0, $08a06a2e99accb03$export$d5414a779ebfba6b)) {\n            let paren = this._inParens.car;\n            this._inParens = this._inParens.cdr;\n            if (start != paren.type) //debugger;\n            {\n                if (n) this.t(\"error\", n);\n            } else {\n                paren.closed = {\n                    line: s.line,\n                    col: s.col,\n                    c1: s.col,\n                    c2: s.col + n,\n                    opened: paren\n                };\n                this.doneParen(paren);\n                if (n) this.t(tokType, n);\n            }\n            return paren;\n        } else if (n) this.t(\"error\", n);\n    }\n    inParen() {\n        return this._inParens.car;\n    }\n    doneParen(p) {\n        this._parens = new (0, $08a06a2e99accb03$export$74c44e616647f5c0)(p, this._parens);\n    }\n    pushCont(cont) {\n        this._cont = new (0, $08a06a2e99accb03$export$74c44e616647f5c0)(cont, this._cont);\n    }\n    popCont() {\n        this._cont = this._cont.cdr;\n    }\n    // copied from JS mode; should be decent for C-like langs\n    indentation() {\n        let s = this._stream;\n        let row = s.line;\n        let currentLine = s.lineText();\n        let indent = 0;\n        let INDENT_LEVEL = ()=>this._stream.buffer.getq(\"indent_level\");\n        if (this._inString) {\n            // inside string literal\n            if (row > 0 && !/\\S/.test(currentLine)) // on an empty line, set indentation from previous line\n            return s.lineIndentation(row - 1);\n            // otherwise keep existing indentation\n            return null;\n        }\n        if (this._inComment) {\n            let commentStartLine = s.lineText(this._inComment.line);\n            indent = this._inComment.c1 + 1;\n            if (this._inComment.inner == \"*\" && !/^\\s*\\*/.test(currentLine)) {\n                // align with the first non-whitespace and non-asterisk character in the comment\n                let re = /[^\\s*]/g;\n                re.lastIndex = this._inComment.c1 + 1;\n                let m = re.exec(commentStartLine);\n                if (m) indent = m.index;\n            }\n            return indent;\n        }\n        let p = this._inParens.car;\n        if (p) {\n            // check if the current line closes the paren\n            let re = new RegExp(\"^\\\\s*\\\\\" + this.OPEN_PAREN[p.type]);\n            let thisLineCloses = re.test(currentLine);\n            // Check if there is text after the opening paren.  If so, indent to that column.\n            re = /\\S/g;\n            re.lastIndex = p.col + 1;\n            let m = re.exec(s.lineText(p.line));\n            if (m) // but if this line closes the paren, better use the column of the open paren\n            indent = thisLineCloses ? p.col : m.index;\n            else {\n                // Otherwise we should indent to one level more than the indentation of the line\n                // containing the opening paren. Except that if another paren is closed on that line\n                // before `p`, then we'd like to use that paren's opening line instead. Oh well.\n                let line = p.line;\n                if (this._parens.car?.closed?.line == line) line = this._parens.car.line;\n                indent = s.lineIndentation(line) + INDENT_LEVEL();\n                // but if this line closes the paren, then back one level\n                if (thisLineCloses) indent -= INDENT_LEVEL();\n                else if (this.C_STATEMENTS && /^\\s*(?:[.:?*=&|]|\\+[^+]|-[^-])/.test(currentLine)) indent += INDENT_LEVEL();\n            }\n        } else {\n            let i = row, m;\n            while(i-- > 0)if (m = /\\S/.exec(s.lineText(i))) {\n                let p = this._tok.getParserForLine(i);\n                if (!(p._inString || p._inComment)) break;\n            }\n            if (m) indent = m.index;\n        }\n        // Some more adjustments for continued statements.  Since we\n        // don't really have a rigorous parser, we have to rely on\n        // other regexps here, which sucks but will do for now.\n        if (row > 0) {\n            let before = s.textBefore();\n            if (/\\)\\s*$/.test(before) && this._parens !== (0, $08a06a2e99accb03$export$d5414a779ebfba6b)) {\n                // Ends in a paren, could be an if, while or for which demands smart\n                // indentation on the current line, let's check it out.\n                // Note that the passedParen saved for that close paren is actually\n                // the opening one, which suits us greatly.\n                p = this._parens.car;\n                let stmtLine = s.lineText(p.line);\n                if (/^\\s*(?:if|for|while)\\W/.test(stmtLine) && !/^\\s*\\{/.test(currentLine)) indent += INDENT_LEVEL();\n            } else if (/\\Welse\\s*$/.test(before) && !/^\\s*\\{/.test(currentLine)) indent += INDENT_LEVEL();\n        }\n        // switch labels use half the indent level, which is my favorite\n        if (/^\\s*(?:case|default)\\W/.test(currentLine)) indent -= INDENT_LEVEL() / 2;\n        return indent;\n    }\n    get passedParens() {\n        return [\n            ...this._parens\n        ];\n    }\n    get buffer() {\n        return this._stream.buffer;\n    }\n    get caret() {\n        return this.buffer._rowcol;\n    }\n}\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n    base_limit_fill_paragraph_region: function() {\n        if (!this.tokenizer) return;\n        let findComment = ()=>this.tokenizer.getPP().filter((0, $c749180882ef16eb$export$f6a9bcac20db9551)(this._rowcol)).findLast((p)=>p.comment);\n        let comment = findComment() || this.cmd(\"save_excursion\", ()=>{\n            this.cmd(\"end_of_line\");\n            return findComment();\n        });\n        if (comment?.closed) {\n            let r = {\n                begin: this._rowColToPosition(comment.outer.l1, comment.outer.c1),\n                end: this._rowColToPosition(comment.outer.l2, comment.outer.c2)\n            };\n            this.cmd(\"save_excursion\", ()=>{\n                this.cmd(\"goto_char\", r.begin);\n                this.cmd(\"backward_whitespace\", true);\n                r.begin = this.point();\n            });\n            return r;\n        }\n    }\n});\n\n\nclass $965e83e35c4dfcff$var$Ymacs_Lang_CSS extends (0, $1414b989ef7d55bc$export$96ac030efd09f62d) {\n    readCustom() {\n        let s = this._stream, m;\n        for (let [rx, ...types] of this.CSSRX)if (m = s.lookingAt(rx)) {\n            types.forEach((cls, i)=>cls && m[i] && this.t(cls, m[i].length));\n            return true;\n        }\n    }\n    CSSRX = [\n        [\n            /^(-?(?:\\d*\\.)?\\d+)(px|pt|em|ex|in|cm|mm|rem|vw|vh|fr|s|%)?/u,\n            ,\n            \"number\",\n            \"type\"\n        ],\n        [\n            /^((?:--+|\\$)[\\p{L}\\p{N}-]+)(:)?/u,\n            ,\n            \"variable-name\",\n            \"operator\"\n        ],\n        [\n            /^([\\p{L}\\p{N}-]+)(:)/u,\n            ,\n            \"keyword\",\n            \"operator\"\n        ],\n        [\n            /^\\.[\\p{L}\\p{N}_:-]+/u,\n            \"function-name\"\n        ],\n        [\n            /^#[\\p{L}\\p{N}_:-]+/u,\n            \"constant\"\n        ],\n        [\n            /^@[\\p{L}\\p{N}_:-]+/u,\n            \"builtin\"\n        ],\n        [\n            /^(?:url|none|auto|bold|italic|underline|normal|inherit|print|screen|all|important|calc|var)/,\n            \"builtin\"\n        ]\n    ];\n}\n(0, $c749180882ef16eb$export$3964ae1c660db960).define(\"css\", (stream, tok)=>new $965e83e35c4dfcff$var$Ymacs_Lang_CSS({\n        stream: stream,\n        tok: tok\n    }));\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newMode(\"css_mode\", function() {\n    var tok = this.tokenizer;\n    this.setTokenizer(new (0, $c749180882ef16eb$export$3964ae1c660db960)({\n        buffer: this,\n        type: \"css\"\n    }));\n    var was_paren_match = this.cmd(\"paren_match_mode\", true);\n    var changed_vars = this.setq({\n        syntax_paragraph_sep: /\\n(?:[ \\t\\/\\*]*\\n)+/g,\n        syntax_comment_line: {\n            rx: /[^\\S\\r\\n]*\\/\\/+ ?/ygu,\n            ch: \"//\"\n        },\n        syntax_comment_multi: {\n            rx: /[^\\S\\r\\n]*\\/\\*+(.*?)\\*+\\//ygu,\n            ch: [\n                \"/*\",\n                \"*/\"\n            ]\n        }\n    });\n    return function() {\n        this.setTokenizer(tok);\n        if (!was_paren_match) this.cmd(\"paren_match_mode\", false);\n        this.setq(changed_vars);\n    };\n});\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\n\n\nconst $8e1bdec65509308b$var$KEYWORDS = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(`abstract break case catch class const async await\ncontinue debugger default delete do else enum export final finally for\nfunction goto if implements import in instanceof interface native new package\nprivate protected public return super switch synchronized throw throws\ntransient try typeof var void let yield volatile while with`);\nconst $8e1bdec65509308b$var$KEYWORDS_TYPE = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(`boolean byte char double float int long short\nvoid Array Date Function Math Number Object RegExp String`);\nconst $8e1bdec65509308b$var$KEYWORDS_CONST = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(`false null undefined Infinity NaN true`);\nconst $8e1bdec65509308b$var$KEYWORDS_BUILTIN = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(`this Packages decodeURI decodeURIComponent\nencodeURI encodeURIComponent eval isFinite isNaN parseFloat parseInt window\ndocument alert arguments fetch`);\nconst $8e1bdec65509308b$var$ALLOW_REGEXP_AFTER = /[\\[({,;+\\-*=?&|!:>][\\x20\\t\\n\\xa0]*$|(?:return|typeof|case)\\s+$/;\nclass $8e1bdec65509308b$var$Ymacs_Lang_JS extends (0, $1414b989ef7d55bc$export$96ac030efd09f62d) {\n    STRING = [\n        '\"',\n        \"'\",\n        [\n            \"`\",\n            \"`\",\n            \"${\",\n            \"}\"\n        ]\n    ];\n    _isProp = null;\n    copy() {\n        let _super = super.copy();\n        let _isProp = this._isProp;\n        return ()=>{\n            let self = _super();\n            self._isProp = _isProp;\n            return self;\n        };\n    }\n    readCustom() {\n        let s = this._stream;\n        if (s.peek() == \"/\" && $8e1bdec65509308b$var$ALLOW_REGEXP_AFTER.test(s.textBefore())) {\n            let op = {\n                line: s.line,\n                col: s.col,\n                type: \"/\"\n            };\n            this.t(\"regexp-starter\");\n            this.pushCont(this.readLiteralRegexp.bind(this, op));\n            return true;\n        }\n        if (s.lookingAt(\"...\")) {\n            this.t(\"operator\", 3);\n            return true;\n        }\n        let isProp = this._isProp;\n        this._isProp = s.peek() == \".\";\n        let tok = this.readName();\n        if (tok) {\n            this.skipWS();\n            if (isProp) {\n                tok.type = s.lookingAt(\"(\") ? \"function-name\" : null;\n                this.token(tok);\n            } else if (s.lookingAt(\":\")) {\n                tok.type = tok.id == \"default\" ? \"keyword\" : null;\n                this.token(tok);\n            } else if (!this.parseALittle(tok)) {\n                tok.type = tok.id in $8e1bdec65509308b$var$KEYWORDS ? \"keyword\" : s.lookingAt(\"(\") ? \"function-name\" : tok.id in $8e1bdec65509308b$var$KEYWORDS_TYPE ? \"type\" : tok.id in $8e1bdec65509308b$var$KEYWORDS_CONST ? \"constant\" : tok.id in $8e1bdec65509308b$var$KEYWORDS_BUILTIN ? \"builtin\" : null;\n                this.token(tok);\n            }\n            return true;\n        }\n        return this.readNumber();\n    }\n    parseALittle(tok) {\n        let s = this._stream;\n        let paren = this.inParen();\n        let name;\n        switch(tok.id){\n            case \"class\":\n                if (s.lookingAt(\"{\") || (name = this.maybeName(\"type\"))) {\n                    this.token(tok, \"keyword\");\n                    this.skipWS();\n                    let ext = this.readName();\n                    if (ext) {\n                        if (ext.id == \"extends\") {\n                            this.token(ext, ext.type = \"keyword\");\n                            this.skipWS();\n                            this.maybeName(\"type\");\n                        } else this.token(ext, null);\n                    }\n                    this.setParenMeta({\n                        class: tok,\n                        name: name\n                    });\n                }\n                return true;\n            case \"for\":\n                this.token(tok, \"keyword\");\n                this.setParenMeta({\n                    for: tok\n                });\n                return true;\n            case \"of\":\n                if (paren?.meta?.for) {\n                    this.token(tok, \"keyword\");\n                    return true;\n                }\n                break;\n            case \"function\":\n                this.token(tok, \"keyword\");\n                this.maybeName(\"function-name\");\n                return true;\n            case \"new\":\n                this.token(tok, \"keyword\");\n                if (!s.lookingAt(/^class/)) this.maybeName(\"type\");\n                return true;\n            case \"get\":\n            case \"set\":\n            case \"static\":\n            case \"constructor\":\n                if (paren?.meta?.class) {\n                    this.token(tok, \"keyword\");\n                    return true;\n                }\n                break;\n        }\n        if (paren?.meta?.class && s.lookingAt(/^\\s*\\(/)) {\n            // method definition\n            this.token(tok, \"function-name\");\n            return true;\n        }\n    }\n    readLiteralRegexp(op) {\n        let s = this._stream;\n        let ch, esc = false, inset = 0, start = s.col;\n        while(!s.eol()){\n            ch = s.peek();\n            if (ch == \"[\" && !esc && !inset) inset++;\n            if (ch == \"]\" && !esc && inset) inset--;\n            if (ch == \"/\" && !esc && !inset) {\n                let c1 = s.col;\n                this.popCont();\n                this.token({\n                    line: s.line,\n                    c1: start,\n                    c2: s.col\n                }, \"regexp\");\n                this.t(\"regexp-stopper\");\n                let m = s.lookingAt(/^[dgimsuvy]+/);\n                if (m) this.t(\"regexp-modifier\", m[0].length);\n                op.closed = {\n                    line: s.line,\n                    c1: c1,\n                    c2: s.col,\n                    opened: op\n                };\n                this.doneParen(op);\n                return;\n            }\n            esc = !esc && ch === \"\\\\\";\n            ++s.col;\n        }\n        this.token({\n            line: s.line,\n            c1: start,\n            c2: s.col\n        }, \"regexp\");\n    }\n}\n$8e1bdec65509308b$var$Ymacs_Lang_JS.prototype.C_STATEMENTS = true;\n(0, $c749180882ef16eb$export$3964ae1c660db960).define(\"js\", (stream, tok)=>new $8e1bdec65509308b$var$Ymacs_Lang_JS({\n        stream: stream,\n        tok: tok\n    }));\nlet $8e1bdec65509308b$var$Ymacs_Keymap_JS = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"js\", {\n    \"`\": [\n        \"paredit_open_pair\",\n        \"`\",\n        \"`\",\n        /[\\`\\\\]/g\n    ],\n    \"'\": [\n        \"paredit_open_pair\",\n        \"'\",\n        \"'\",\n        /[\\'\\\\]/g\n    ],\n    \"M-`\": [\n        \"paredit_wrap_round\",\n        \"`\",\n        \"`\",\n        /[\\`\\\\]/g\n    ],\n    \"M-'\": [\n        \"paredit_wrap_round\",\n        \"'\",\n        \"'\",\n        /[\\'\\\\]/g\n    ]\n});\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newMode(\"javascript_mode\", function() {\n    let tok = this.tokenizer;\n    this.setTokenizer(new (0, $c749180882ef16eb$export$3964ae1c660db960)({\n        buffer: this,\n        type: \"js\"\n    }));\n    let was_paren_match = this.cmd(\"paren_match_mode\", true);\n    this.pushKeymap($8e1bdec65509308b$var$Ymacs_Keymap_JS);\n    let changed_vars = this.setq({\n        syntax_paragraph_sep: /\\n(?:[ \\t\\/\\*]*\\n)+/g,\n        syntax_comment_line: {\n            rx: /[^\\S\\r\\n]*\\/\\/+ ?/ygu,\n            ch: \"//\"\n        },\n        syntax_comment_multi: {\n            rx: /[^\\S\\r\\n]*\\/\\*+(.*?)\\*+\\//ygu,\n            ch: [\n                \"/*\",\n                \"*/\"\n            ]\n        }\n    });\n    return function() {\n        this.setTokenizer(tok);\n        if (!was_paren_match) this.cmd(\"paren_match_mode\", false);\n        this.popKeymap($8e1bdec65509308b$var$Ymacs_Keymap_JS);\n        this.setq(changed_vars);\n    };\n});\n\n\nvar $cd9400013ca46db2$exports = {};\n\n$parcel$export($cd9400013ca46db2$exports, \"Ymacs_Lang_Lisp\", () => $cd9400013ca46db2$export$b112841041e97d65);\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\n\n\n\n(function() {\n    function Partial(value) {\n        this.value = value;\n    }\n    function QuickParser(buffer, pos) {\n        var input = new (0, $c749180882ef16eb$export$825fc0b420d392c1)({\n            buffer: buffer,\n            pos: pos\n        });\n        function peek() {\n            return input.peek();\n        }\n        function next() {\n            return input.next();\n        }\n        function skip_ws() {\n            return input.read_while(function(ch) {\n                if (!caret_token && caret != null && input.pos == caret) return false;\n                return input.is_whitespace(ch);\n            });\n        }\n        function skip(ch) {\n            next();\n        }\n        function read_while(pred) {\n            return input.read_while(pred);\n        }\n        function read_escaped(start, end, inces) {\n            skip(start);\n            var escaped = false;\n            var str = \"\";\n            while(true){\n                var ch = next();\n                if (!ch) throw new Partial(str);\n                if (escaped) {\n                    str += ch;\n                    escaped = false;\n                } else if (ch == \"\\\\\") {\n                    if (inces) str += ch;\n                    escaped = true;\n                } else if (ch == end) break;\n                else str += ch;\n            }\n            return str;\n        }\n        function read_comment() {\n            return read_while(function(ch) {\n                return ch && ch != \"\\n\";\n            });\n        }\n        function read_multiline_comment() {\n            var comment = read_while(function() {\n                return !input.looking_at(\"|#\");\n            });\n            skip();\n            skip();\n            return comment;\n        }\n        function read_string() {\n            return read_escaped(\"\\\"\", \"\\\"\");\n        }\n        function read_list(beg, end) {\n            var save_list_index = list_index;\n            list_index = 0;\n            try {\n                var ret = [], p;\n                skip(beg);\n                out: while(true){\n                    skip_ws();\n                    switch(peek()){\n                        case end:\n                            break out;\n                        case null:\n                            throw new Partial(ret);\n                        default:\n                            ret.push(read_token());\n                            ++list_index;\n                    }\n                }\n                skip(end);\n                return ret;\n            } finally{\n                list_index = save_list_index;\n            }\n        }\n        function read_regexp() {\n            var str = read_escaped(\"/\", \"/\", true);\n            var mods = read_while(function(ch) {\n                if (ch) switch(ch.toLowerCase()){\n                    case \"y\":\n                    case \"m\":\n                    case \"g\":\n                    case \"i\":\n                        return true;\n                }\n            }).toLowerCase();\n            return {\n                pattern: str,\n                modifiers: mods\n            };\n        }\n        function is_symbol_char(ch) {\n            switch(ch){\n                case null:\n                case \"(\":\n                case \")\":\n                case \"{\":\n                case \"}\":\n                case \"[\":\n                case \"]\":\n                case \"#\":\n                case \";\":\n                case \"`\":\n                case \"'\":\n                case \"\\\"\":\n                case \"|\":\n                case \" \":\n                case \"\\n\":\n                case \"\\t\":\n                case \"\\x0C\":\n                case \"\\u2028\":\n                case \"\\u2029\":\n                case \"\\xA0\":\n                    return false;\n            }\n            return true;\n        }\n        function read_symbol() {\n            return read_while(is_symbol_char);\n        }\n        function read_char() {\n            return next() + read_while(function(ch) {\n                return ch >= \"a\" && ch <= \"z\" || ch >= \"A\" && ch <= \"z\" || ch >= \"0\" && ch <= \"9\" || ch == \"-\" || ch == \"_\";\n            });\n        }\n        function read_elisp_char() {\n            skip(\"?\");\n            if (peek() == \"\\\\\") next();\n            return next();\n        }\n        function read_sharp() {\n            skip(\"#\");\n            switch(peek()){\n                case \"\\\\\":\n                    next();\n                    return token(\"char\", read_char);\n                case \"/\":\n                    return token(\"regexp\", read_regexp);\n                case \"(\":\n                    return token(\"vector\", read_list.bind(null, \"(\", \")\"));\n                case \"'\":\n                    next();\n                    return token(\"function\", read_token);\n                case \"|\":\n                    next();\n                    return token(\"comment\", read_multiline_comment);\n                default:\n                    return token(\"unknown\", read_token);\n            }\n        }\n        function read_token() {\n            skip_ws();\n            if (!caret_token && caret != null && input.pos == caret && (!parent || parent.type == \"list\")) return caret_token = token(\"caret\");\n            switch(peek()){\n                case \";\":\n                    return token(\"comment\", read_comment);\n                case \"\\\"\":\n                    return token(\"string\", read_string);\n                case \"(\":\n                    return token(\"list\", read_list.bind(null, \"(\", \")\"));\n                case \"{\":\n                    return token(\"list\", read_list.bind(null, \"{\", \"}\"));\n                case \"[\":\n                    return token(\"list\", read_list.bind(null, \"[\", \"]\"));\n                case \"#\":\n                    return token(\"sharp\", read_sharp);\n                case \"?\":\n                    return token(\"char\", read_elisp_char);\n                case \"`\":\n                    next();\n                    return token(\"qq\", read_token, -1);\n                case \",\":\n                    next();\n                    if (peek() == \"@\") {\n                        next();\n                        return token(\"splice\", read_token, -2);\n                    }\n                    return token(\"unquote\", read_token, -1);\n                case \"'\":\n                    next();\n                    return token(\"quote\", read_token, -1);\n                case \")\":\n                    return null;\n                case null:\n                    return null; // EOF\n            }\n            return token(\"symbol\", read_symbol);\n        }\n        function read_all() {\n            var ret = [];\n            while(peek() != null){\n                var tok = read_token();\n                if (tok == null) break;\n                ret.push(tok);\n                ++list_index;\n            }\n            return ret;\n        }\n        var caret_token = null;\n        var list_index = 0;\n        var caret = null;\n        var parent = null;\n        var cont_exp = null;\n        function token(type, reader, adjust_start) {\n            if (adjust_start == null) adjust_start = 0;\n            var save_parent = parent;\n            try {\n                var tok = {\n                    value: null,\n                    index: list_index,\n                    type: type,\n                    start: input.pos + adjust_start,\n                    parent: parent,\n                    depth: parent ? parent.depth + 1 : 0,\n                    partial: false\n                };\n                if (type == \"list\") parent = tok;\n                try {\n                    if (reader) {\n                        tok.value = reader();\n                        if (tok.value === \"\" && type != \"string\") // couldn't figure this out, but let's not crash the browser.\n                        next();\n                    }\n                } catch (ex) {\n                    if (ex instanceof Partial) {\n                        tok.value = ex.value;\n                        tok.partial = true;\n                    } else throw ex;\n                }\n                tok.end = input.pos;\n                if (caret != null) {\n                    if (tok.start <= caret && tok.end >= caret) {\n                        if (!cont_exp) cont_exp = tok;\n                    }\n                }\n                return tok;\n            } finally{\n                parent = save_parent;\n            }\n        }\n        return {\n            parse: function(pos) {\n                caret = pos;\n                return token(\"list\", read_all);\n            },\n            read: function() {\n                return read_token();\n            },\n            prev_exp: function() {\n                if (caret_token) return caret_token.parent.value[caret_token.index - 1];\n                else if (cont_exp) {\n                    if (cont_exp.type == \"list\" && cont_exp.end == caret + 1) return cont_exp.value.at(-1);\n                    return cont_exp.parent.value[cont_exp.index];\n                }\n            },\n            caret_token: function() {\n                return caret_token;\n            },\n            cont_exp: function() {\n                return cont_exp;\n            },\n            sexp: function() {\n                var tok = cont_exp;\n                while(tok && (!/^(?:list|string)$/.test(tok.type) || tok.end == caret))tok = tok.parent;\n                return tok;\n            }\n        };\n    }\n    (0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n        test_lisp_parse: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n            try {\n                var p = QuickParser(this);\n                var ast = p.parse(this.point());\n                console.log(ast);\n                console.log(p.caret_token());\n                console.log(p.cont_exp());\n                console.log(p.prev_exp());\n            } catch (ex) {\n                console.log(ex);\n            }\n        }),\n        lisp_make_quick_parser: function() {\n            return QuickParser.apply(this, [\n                this,\n                ...arguments\n            ]);\n        },\n        lisp_forward_sexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n            var p = QuickParser(this, this.point());\n            var tok = p.read();\n            if (tok) this.cmd(\"goto_char\", tok.end);\n        }),\n        lisp_backward_sexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n            var p = QuickParser(this);\n            p.parse(this.point());\n            var tok = p.prev_exp();\n            if (tok) this.cmd(\"goto_char\", tok.start);\n        }),\n        lisp_backward_up_list: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n            var p = QuickParser(this);\n            p.parse(this.point());\n            var list = p.sexp();\n            if (list && list.parent) this.cmd(\"goto_char\", list.start);\n        }),\n        lisp_handle_string_quote: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n            var p = QuickParser(this);\n            p.parse(this.point());\n            var tok = p.prev_exp();\n            if (tok && tok.type == \"string\" && this.point() < tok.end) {\n                if (this.cmd(\"looking_at\", /\\\"/y)) this.cmd(\"forward_char\");\n                else if (!this.cmd(\"looking_back\", /\\\\/g)) this.cmd(\"insert\", \"\\\\\\\"\");\n                else this.cmd(\"insert\", \"\\\"\");\n            } else {\n                this.cmd(\"insert\", '\"\"');\n                this.cmd(\"backward_char\");\n            }\n        })\n    });\n})();\nconst $cd9400013ca46db2$var$SPECIAL_FORMS = (0, $08a06a2e99accb03$export$90e79c6ee773013e)(\"  define defvar defparameter declaim proclaim declare type inline   optimize speed safety space debug defconstant   deftype defstruct defclass defsetf destructuring-bind   defmacro defun defmethod defgeneric defpackage in-package defreadtable in-readtable   when cond unless [ec]?typecase e?case   lambda \\u03BB let load-time-value quote macrolet   progn begin prog1 prog2 progv go flet the   if throw eval-when multiple-value-prog1 multiple-value-bind unwind-protect let\\\\*   ignore-errors handler-case handler-bind invoke-restart restart-case restart-bind   labels function symbol-macrolet block tagbody catch locally   inc! dec! cons c[ad]{1,4}r list list\\\\* eq eql equal equalp and or not null null\\\\?   loop do while dotimes   return return-from setq set! set-car! set-cdr! setf multiple-value-call values\", \"i\");\nconst $cd9400013ca46db2$var$LOOP_KEYWORDS = (0, $08a06a2e99accb03$export$90e79c6ee773013e)(\"\\\r\n  for with and = as in on of then across by while until \\\r\n  from downfrom upfrom to upto below downto above \\\r\n  being each the hash-keys? using hash-values? \\\r\n  collect(?:ing)? nconc(?:ing)? sum(?:ming)? append(?:ing)? into \\\r\n  minimize minimizing maximize maximizing count counting \\\r\n  symbol symbols external-symbol external-symbols present-symbol present-symbols \\\r\n  named always never thereis \\\r\n  of-type \\\r\n  find maximizes minimizes that which \\\r\n  repeat finally initially return \\\r\n  if else when unless do doing\");\nconst $cd9400013ca46db2$var$ERROR_FORMS = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(\"error warn assert\");\nconst $cd9400013ca46db2$var$CONSTANTS = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(\"t nil\");\nconst $cd9400013ca46db2$var$DEFINES_FUNCTION = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(\"defun defmacro defgeneric defmethod\");\nconst $cd9400013ca46db2$var$DEFINES_TYPE = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(\"deftype defclass defstruct\");\nconst $cd9400013ca46db2$var$DEFINES_VARIABLE = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(\"defvar defparameter defconstant defconst\");\nconst $cd9400013ca46db2$var$FORM_ARGS = {\n    \"if\": \"3+\",\n    \"aif\": \"3+\",\n    \"when\": \"1*\",\n    \"awhen\": \"1*\",\n    \"once-only\": \"1*\",\n    \"lambda\": \"1*\",\n    \"unless\": \"1*\",\n    \"defun\": \"2*\",\n    \"defpackage\": \"1*\",\n    \"deftest\": \"1*\",\n    \"defgeneric\": \"2*\",\n    \"defmethod\": \"2*\",\n    \"defclass\": \"2*\",\n    \"defstruct\": \"1*\",\n    \"defmacro\": \"2*\",\n    \"progn\": \"0+\",\n    \"begin\": \"0+\",\n    \"prog1\": \"1*\",\n    \"multiple-value-prog1\": \"1*\",\n    \"prog2\": \"2*\",\n    \"let\": \"1*\",\n    \"labels\": \"1*\",\n    \"flet\": \"1*\",\n    \"macrolet\": \"1*\",\n    \"symbol-macrolet\": \"1*\",\n    \"unwind-protect\": \"1*\",\n    \"catch\": \"1*\",\n    \"case\": \"1*\",\n    \"ecase\": \"1*\",\n    \"typecase\": \"1*\",\n    \"etypecase\": \"1*\",\n    \"cond\": \"0+\",\n    \"handler-bind\": \"1*\",\n    \"handler-case\": \"1*\",\n    \"restart-bind\": \"1*\",\n    \"restart-case\": \"1*\",\n    \"return-from\": \"1*\",\n    \"block\": \"1*\",\n    \"dotimes\": \"1*\",\n    \"dolist\": \"1*\",\n    \"destructuring-bind\": \"2*\",\n    \"multiple-value-bind\": \"2*\",\n    \":method\": \"1*\",\n    \"eval-when\": \"1*\"\n};\nconst $cd9400013ca46db2$var$LOCAL_BODYDEF = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(\"labels flet macrolet\");\nclass $cd9400013ca46db2$export$b112841041e97d65 extends (0, $1414b989ef7d55bc$export$96ac030efd09f62d) {\n    _formStack = (0, $08a06a2e99accb03$export$d5414a779ebfba6b);\n    _formSym = null;\n    _formLen = 0;\n    _rxSpecial = null;\n    COMMENT = [\n        \";\",\n        [\n            \"#|\",\n            \"|#\"\n        ]\n    ];\n    STRING = [\n        '\"'\n    ];\n    NUMBER = /^[+-]?(?:#x[0-9a-fA-F]+|#\\d+r[0-9a-zA-Z]+|#o[0-7]+|#b[01]+|(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?|\\d+\\/\\d+)$/u;\n    NAME = /^[-_$\\p{L}0-9|!#$%&*+./:<=>?@\\^~]+/iu;\n    OPEN_PAREN = {\n        \"(\": \")\",\n        \"{\": \"}\",\n        \"[\": \"]\",\n        \"\\u2770\": \"\\u2771\",\n        \"\\xab\": \"\\xbb\"\n    };\n    CLOSE_PAREN = {\n        \")\": \"(\",\n        \"}\": \"{\",\n        \"]\": \"[\",\n        \"\\u2771\": \"\\u2770\",\n        \"\\xbb\": \"\\xab\"\n    };\n    constructor({ stream: stream, tok: tok, rx_special: rx_special }){\n        super({\n            stream: stream,\n            tok: tok\n        });\n        this._rxSpecial = rx_special;\n    }\n    isNameChar(ch) {\n        return this.NAME.test(ch) && !this._rxSpecial?.test(ch);\n    }\n    readName() {\n        if (!this._rxSpecial) return super.readName();\n        let s = this._stream, name = s.peek();\n        if (this.isNameChar(name)) {\n            let col = s.col++, ch;\n            while(this.isNameChar(ch = s.peek())){\n                name += ch;\n                s.col++;\n            }\n            return {\n                line: s.line,\n                c1: col,\n                c2: s.col,\n                id: name\n            };\n        }\n    }\n    copy() {\n        let _super = super.copy();\n        let _formStack = this._formStack;\n        let _formSym = this._formSym;\n        let _formLen = this._formLen;\n        let _rxSpecial = this._rxSpecial;\n        return ()=>{\n            let self = _super();\n            self._formStack = _formStack;\n            self._formSym = _formSym;\n            self._formLen = _formLen;\n            self._rxSpecial = _rxSpecial;\n            return self;\n        };\n    }\n    newArg(arg) {\n        if (arg?.id && !this._formLen) this._formSym = arg;\n        this._formLen++;\n    }\n    isForm(form) {\n        var f = this._formSym && this._formSym.id;\n        if (f) {\n            f = f.toLowerCase();\n            if (form == null) return f;\n            return typeof form == \"string\" ? f == form : form instanceof RegExp ? form.test(f) : f in form;\n        }\n    }\n    readCustom() {\n        let s = this._stream, m;\n        if (m = s.lookingAt(/^#\\\\.[a-z0-9_-]*/i)) {\n            this.newArg();\n            this.t(\"constant\", m[0].length);\n            return true;\n        }\n        if (s.lookingAt(\"#:\") && this.isNameChar(s.peek(2))) {\n            this.newArg();\n            s.col += 2;\n            this.maybeName(\"lisp-keyword\");\n            return true;\n        }\n        if (s.lookingAt(\"#'\") && this.isNameChar(s.peek(2))) {\n            this.newArg();\n            s.col += 2;\n            let c = this.maybeName(\"function-name\");\n            return true;\n        }\n        if (m = s.lookingAt(/^#\\/((?:\\\\.|[^\\/])*)\\/([dgimsuvy]+)?/)) {\n            this.newArg();\n            this.t(\"regexp-starter\", 2);\n            this.t(\"regexp\", m[1].length);\n            this.t(\"regexp-stopper\");\n            if (m[2]) this.t(\"regexp-modifier\", m[2].length);\n            return true;\n        }\n        if (m = s.lookingAt(/^\\?(?:\\\\?.)/u)) {\n            // elisp char syntax\n            this.newArg();\n            this.t(\"constant\", m[0].length);\n            return true;\n        }\n        if (m = this.readName()) {\n            let ch = m.id.charAt(0), type = null;\n            // message to future me: good luck figuring this out.\n            if (/^e?(?:type)?case$/i.test(this._formStack.cdr?.car?.id) && this._formStack.car > 2 && this._formLen == 0) type = \"constant\";\n            else if (/^e?(?:type)?case$/i.test(this._formStack.cdr?.cdr?.cdr?.car?.id) && this._formStack.cdr?.cdr?.car > 2 && this._formStack.car == 1) type = \"constant\";\n            else if (/^let\\*?$/i.test(this._formStack.cdr?.cdr?.cdr?.car?.id) && this._formStack.cdr?.cdr?.car == 2 && this._formLen == 0) type = \"variable-name\";\n            else if (/^let\\*?$/i.test(this._formStack.cdr?.car?.id) && this._formStack.car == 2) type = \"variable-name\";\n            else if (/^(?:flet|labels)$/i.test(this._formStack.cdr?.cdr?.cdr?.car?.id) && this._formStack.cdr?.cdr?.car == 2 && this._formLen == 0) type = \"function-name\";\n            else if (/^(?:flet|labels)$/i.test(this._formStack.cdr?.car?.id) && this._formStack.car == 2) type = \"function-name\";\n            if (!type) type = ch == \":\" ? \"lisp-keyword\" : ch == \"&\" ? \"type\" : m.id in $cd9400013ca46db2$var$ERROR_FORMS ? \"error\" : m.id in $cd9400013ca46db2$var$CONSTANTS ? \"constant\" : this.NUMBER.test(m.id) ? \"number\" : null;\n            if (!type && this._formStack.car == 2) {\n                let pform = this._formStack.cdr?.car?.id;\n                if (pform == \"define\" && this._formLen == 0) type = \"function-name\";\n                else if (/^def(?!un|ine|test)/.test(pform)) type = \"function-name\";\n            }\n            if (!type) {\n                if (this._formLen == 0 && $cd9400013ca46db2$var$SPECIAL_FORMS.test(m.id)) type = \"keyword\";\n                else if (this._formLen == 0 && /^(?::?with(out)?[-\\x2f]|def)/i.test(m.id)) type = \"keyword\";\n                else if (this._formLen == 1 && this.isForm($cd9400013ca46db2$var$DEFINES_FUNCTION)) type = \"function-name\";\n                else if (this._formLen == 1 && this.isForm($cd9400013ca46db2$var$DEFINES_TYPE)) type = \"type\";\n                else if (this._formLen == 1 && this.isForm(\"let\")) type = \"function-name\";\n                else if (this._formLen == 1 && this.isForm($cd9400013ca46db2$var$DEFINES_VARIABLE)) type = \"variable-name\";\n                else if (this._formLen == 1 && this.isForm(/^def/)) type = \"function-name\";\n                else if (this._formLen == 2 && this.isForm(/^def/)) type = \"type\";\n                else if (this.isForm(\"loop\") && $cd9400013ca46db2$var$LOOP_KEYWORDS.test(m.id)) type = \"directive\";\n            }\n            m.type = type;\n            this.newArg(m);\n            this.token(m, type);\n            return true;\n        }\n    }\n    readString(...args) {\n        if (super.readString(...args)) {\n            this.newArg();\n            return true;\n        }\n    }\n    readOpenParen() {\n        if (super.readOpenParen()) {\n            this.newArg();\n            this.pushFormStack(this._formSym);\n            this.pushFormStack(this._formLen);\n            this._formSym = null;\n            this._formLen = 0;\n            return true;\n        }\n    }\n    readCloseParen() {\n        if (super.readCloseParen()) {\n            if (this._backList !== (0, $08a06a2e99accb03$export$d5414a779ebfba6b)) {\n                this._formLen = this.popFormStack();\n                this._formSym = this.popFormStack();\n            }\n            return true;\n        }\n    }\n    pushFormStack(val) {\n        this._formStack = new (0, $08a06a2e99accb03$export$74c44e616647f5c0)(val, this._formStack);\n    }\n    popFormStack() {\n        let val = this._formStack.car;\n        this._formStack = this._formStack.cdr;\n        return val;\n    }\n    indentation() {\n        if (this._inString || this._inComment) return super.indentation();\n        let s = this._stream;\n        let INDENT_LEVEL = ()=>this._stream.buffer.getq(\"indent_level\");\n        var indent = 0;\n        // XXX: rewrite this mess.\n        var p = this._inParens.car;\n        if (p) {\n            var line = s.lineText(p.line);\n            indent = p.col + 1;\n            if (/[\\#\\']/.test(line.charAt(p.col - 1))) return indent;\n            var nextNonSpace;\n            if (this.isNameChar(line.charAt(indent))) {\n                var re = /\\s\\S/g;\n                re.lastIndex = p.col;\n                nextNonSpace = re.exec(line);\n                if (nextNonSpace) indent = nextNonSpace = nextNonSpace.index + 1;\n            }\n            if (this._formLen) {\n                var currentForm = this.isForm();\n                if (currentForm) {\n                    currentForm = currentForm.replace(/\\*$/, \"\");\n                    var formArgs = $cd9400013ca46db2$var$FORM_ARGS[currentForm];\n                    if (!formArgs && /^with|:with/.test(currentForm)) // \"with\" macros usually take one argument, then &body\n                    formArgs = \"0*\";\n                    if (!formArgs && /^def/.test(currentForm)) {\n                        // definitions usually take two arguments, then &body\n                        if (nextNonSpace && /[\\(\\[\\{]/.test(line.charAt(nextNonSpace))) formArgs = \"1*\";\n                        else formArgs = \"2*\";\n                    }\n                    if (!formArgs) try {\n                        if (this._formStack.cdr?.car?.id == \"handler-case\") formArgs = \"1*\";\n                        else if ($cd9400013ca46db2$var$LOCAL_BODYDEF[this._formStack.cdr.cdr.cdr.car.id] && this._formStack.cdr.cdr.car == 2) formArgs = \"1*\";\n                    } catch (ex) {}\n                    if (formArgs) {\n                        var n = parseInt(formArgs, 10);\n                        var hasRest = /\\+/.test(formArgs);\n                        var hasBody = /\\*/.test(formArgs);\n                        indent = p.col + INDENT_LEVEL();\n                        if (hasRest && nextNonSpace) indent = nextNonSpace;\n                        else if (n > 0 && this._formLen - 1 < n) {\n                            // still in the arguments\n                            if (nextNonSpace) indent = nextNonSpace;\n                            else indent += INDENT_LEVEL();\n                        }\n                    }\n                }\n            }\n        }\n        return indent;\n    }\n}\n(0, $c749180882ef16eb$export$3964ae1c660db960).define(\"lisp\", (stream, tok, options = {})=>new $cd9400013ca46db2$export$b112841041e97d65({\n        stream: stream,\n        tok: tok,\n        ...options\n    }));\nlet $cd9400013ca46db2$var$Ymacs_Keymap_LispMode = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"lisp\", {\n    '\"': [\n        \"lisp_handle_string_quote\"\n    ]\n});\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newMode(\"lisp_mode\", function() {\n    var tok = this.tokenizer;\n    this.setTokenizer(new (0, $c749180882ef16eb$export$3964ae1c660db960)({\n        buffer: this,\n        type: \"lisp\"\n    }));\n    var changed_vars = this.setq({\n        indent_level: 2,\n        syntax_paragraph_sep: /\\n(?:[ \\t;]*\\n)+/g,\n        syntax_comment_line: {\n            rx: /[^\\S\\r\\n]*;+ ?/gu,\n            ch: \";;\"\n        },\n        syntax_word_dabbrev: /^[-0-9_*%+/@&$.=~\\p{L}]$/u,\n        paredit_space_before () {\n            return !this.looking_back(/[\\s\\(\\)\\[\\]\\{\\},.@'`#\\\\\"]/g);\n        }\n    });\n    var was_paren_match = this.cmd(\"paren_match_mode\", true);\n    this.pushKeymap($cd9400013ca46db2$var$Ymacs_Keymap_LispMode);\n    var changed_commands = this.replaceCommands({\n        \"forward_sexp\": \"lisp_forward_sexp\",\n        \"backward_sexp\": \"lisp_backward_sexp\",\n        \"backward_up_list\": \"lisp_backward_up_list\"\n    });\n    return function() {\n        this.setTokenizer(tok);\n        this.setq(changed_vars);\n        this.newCommands(changed_commands);\n        if (!was_paren_match) this.cmd(\"paren_match_mode\", false);\n        this.popKeymap($cd9400013ca46db2$var$Ymacs_Keymap_LispMode);\n    };\n});\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\n\nlet $10729c6f32778394$var$RX_URL = /^\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?]))/i;\nclass $10729c6f32778394$var$Ymacs_Lang_Markdown extends (0, $1414b989ef7d55bc$export$96ac030efd09f62d) {\n    COMMENT = [];\n    STRING = [\n        [\n            \"`\",\n            \"`\",\n            null,\n            null,\n            \"markdown-code\"\n        ],\n        [\n            \"**\",\n            \"**\",\n            null,\n            null,\n            \"bold\"\n        ],\n        [\n            \"__\",\n            \"__\",\n            null,\n            null,\n            \"bold\"\n        ],\n        [\n            \"*\",\n            \"*\",\n            null,\n            null,\n            \"italic\"\n        ]\n    ];\n    OPEN_PAREN = {\n        \"(\": \")\",\n        \"{\": \"}\",\n        \"[\": \"]\",\n        \"\\xab\": \"\\xbb\",\n        \"\\u2770\": \"\\u2771\",\n        \"\\u201C\": \"\\u201D\"\n    };\n    CLOSE_PAREN = {\n        \")\": \"(\",\n        \"}\": \"{\",\n        \"]\": \"[\",\n        \"\\xbb\": \"\\xab\",\n        \"\\u2771\": \"\\u2770\",\n        \"\\u201D\": \"\\u201C\"\n    };\n    _block = null;\n    copy() {\n        let _super = super.copy();\n        let _block = this._block;\n        return ()=>{\n            let self = _super();\n            self._block = _block;\n            return self;\n        };\n    }\n    t(type = null, len = 1) {\n        if (this._block != null) type = this._block + (type != null ? \" \" + type : \"\");\n        this.token({\n            line: this._stream.line,\n            c1: this._stream.col,\n            c2: this._stream.col += len\n        }, type);\n    }\n    next() {\n        if (this._stream.eol()) this._block = null;\n        return super.next();\n    }\n    read() {\n        this._block != \"markdown-pre\" && this.readInline() || this.readCustom() || this.readOpenParen() || this.readCloseParen() || this.readTrailingWhitespace() || this.t();\n    }\n    readInline() {\n        return this.readString();\n    }\n    readCustom() {\n        let s = this._stream, m;\n        if (s.col == 0 && (m = s.lookingAt(/^#+/))) this._block = \"heading\" + m[0].length;\n        else if (s.col == 0 && (m = s.lookingAt(/^    /))) this._block = \"markdown-pre\";\n        else if (s.col == 0 && (m = s.lookingAt(/^>[>\\s]*/))) {\n            let level = m[0].replace(/\\s+/g, \"\").length - 1;\n            level = Math.min(3, level);\n            this._block = \"markdown-blockquote\" + (level > 0 ? level : \"\");\n        } else if (m = s.lookingAt($10729c6f32778394$var$RX_URL)) {\n            this.t(`hyperlink :href-${m[0]}`, m[0].length);\n            return true;\n        } else if (m = s.lookingAt(/^\\[[a-zA-Z0-9_-]+\\]/)) {\n            this.t(\"markdown-ref\", m[0].length);\n            return true;\n        }\n    }\n    indentation() {\n        let s = this._stream;\n        let row = s.line;\n        return row > 0 && s.lineIndentation(row - 1) || s.lineIndentation(row);\n    }\n}\nlet $10729c6f32778394$var$Ymacs_Keymap_Markdown = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"markdown\", {\n    \"`\": [\n        \"paredit_open_pair\",\n        \"`\",\n        \"`\",\n        /[\\`\\\\]/g\n    ],\n    \"M-`\": [\n        \"paredit_wrap_round\",\n        \"`\",\n        \"`\",\n        /[\\`\\\\]/g\n    ]\n});\n(0, $c749180882ef16eb$export$3964ae1c660db960).define(\"markdown\", (stream, tok)=>new $10729c6f32778394$var$Ymacs_Lang_Markdown({\n        stream: stream,\n        tok: tok\n    }));\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newMode(\"markdown_mode\", function() {\n    var tok = this.tokenizer;\n    this.setTokenizer(new (0, $c749180882ef16eb$export$3964ae1c660db960)({\n        buffer: this,\n        type: \"markdown\"\n    }));\n    var was_paren_match = this.cmd(\"paren_match_mode\", true);\n    this.pushKeymap($10729c6f32778394$var$Ymacs_Keymap_Markdown);\n    return function() {\n        this.setTokenizer(tok);\n        if (!was_paren_match) this.cmd(\"paren_match_mode\", false);\n        this.popKeymap($10729c6f32778394$var$Ymacs_Keymap_Markdown);\n    };\n});\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\n\n\n\nlet $0d1e4b05bb7aaeb3$var$Ymacs_Keymap_ParenMatch = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"parenmatch\", {\n    \"C-M-x\": \"goto_matching_paren\",\n    \"C-M-q\": \"indent_sexp\",\n    \"C-M-f && C-M-n\": \"forward_sexp\",\n    \"C-M-b && C-M-p\": \"backward_sexp\",\n    \"C-M-u && M-a && C-M-ArrowUp\": \"backward_up_list\",\n    \"C-M-a\": \"beginning_of_defun\",\n    \"C-M-e\": \"end_of_defun\",\n    \"M-e\": \"up_list\",\n    \"C-M-ArrowDown\": \"down_list\",\n    \"M-C-k\": \"kill_sexp\",\n    \"M-C-Space\": \"mark_sexp\",\n    \"M-C-t\": \"transpose_sexps\",\n    \"(\": [\n        \"paredit_open_pair\",\n        \"(\",\n        \")\"\n    ],\n    \"[\": [\n        \"paredit_open_pair\",\n        \"[\",\n        \"]\"\n    ],\n    \"{\": [\n        \"paredit_open_pair\",\n        \"{\",\n        \"}\"\n    ],\n    \"\\u2770\": [\n        \"paredit_open_pair\",\n        \"\\u2770\",\n        \"\\u2771\"\n    ],\n    \"\\xab\": [\n        \"paredit_open_pair\",\n        \"\\xab\",\n        \"\\xbb\"\n    ],\n    \"\\u201C\": [\n        \"paredit_open_pair\",\n        \"\\u201C\",\n        \"\\u201D\"\n    ],\n    '\"': [\n        \"paredit_open_pair\",\n        '\"',\n        '\"',\n        /[\\\"\\\\]/g\n    ],\n    \")\": [\n        \"paredit_close_pair\",\n        \"(\",\n        \")\"\n    ],\n    \"]\": [\n        \"paredit_close_pair\",\n        \"[\",\n        \"]\"\n    ],\n    \"}\": [\n        \"paredit_close_pair\",\n        \"{\",\n        \"}\"\n    ],\n    \"\\u2771\": [\n        \"paredit_close_pair\",\n        \"\\u2770\",\n        \"\\u2771\"\n    ],\n    \"\\xbb\": [\n        \"paredit_close_pair\",\n        \"\\xab\",\n        \"\\xbb\"\n    ],\n    \"\\u201D\": [\n        \"paredit_close_pair\",\n        \"\\u201C\",\n        \"\\u201D\"\n    ],\n    \"M-(\": [\n        \"paredit_wrap_round\",\n        \"(\",\n        \")\"\n    ],\n    \"M-[\": [\n        \"paredit_wrap_round\",\n        \"[\",\n        \"]\"\n    ],\n    \"M-{\": [\n        \"paredit_wrap_round\",\n        \"{\",\n        \"}\"\n    ],\n    \"M-\\u2770\": [\n        \"paredit_wrap_round\",\n        \"\\u2770\",\n        \"\\u2771\"\n    ],\n    \"M-\\xab\": [\n        \"paredit_wrap_round\",\n        \"\\xab\",\n        \"\\xbb\"\n    ],\n    \"M-\\u201C\": [\n        \"paredit_wrap_round\",\n        \"\\u201C\",\n        \"\\u201D\"\n    ],\n    'M-\"': [\n        \"paredit_wrap_round\",\n        '\"',\n        '\"',\n        /[\\\"\\\\]/g\n    ],\n    \"M-r\": \"paredit_raise_sexp\",\n    \"M-s\": \"paredit_splice_sexp\",\n    \"Backspace\": \"paredit_backward_delete_char\",\n    //\"Delete && C-d\"                : \"paredit_delete_char\",\n    \"Enter\": \"paredit_newline_and_indent\",\n    \"; && : && , && .\": \"paredit_electric_char\"\n});\nvar $0d1e4b05bb7aaeb3$var$PARENS = {\n    \"(\": \")\",\n    \"[\": \"]\",\n    \"{\": \"}\",\n    \"\\u2770\": \"\\u2771\",\n    \"\\xab\": \"\\xbb\",\n    \"\\u201C\": \"\\u201D\",\n    '\"': '\"',\n    \"'\": \"'\",\n    '`': '`'\n};\nvar $0d1e4b05bb7aaeb3$var$R_PARENS = {\n    \")\": \"(\",\n    \"]\": \"[\",\n    \"}\": \"{\",\n    \"\\u2771\": \"\\u2770\",\n    \"\\xbb\": \"\\xab\",\n    \"\\u201D\": \"\\u201C\",\n    '\"': '\"',\n    \"'\": \"'\",\n    '`': '`'\n};\nfunction $0d1e4b05bb7aaeb3$var$ERROR(o) {\n    throw new (0, $541ef653595620bf$export$c411e7bd03572a3a)(\"Balanced expression not found\");\n}\nfunction $0d1e4b05bb7aaeb3$var$startOf(paren) {\n    return paren.c1 ?? paren.col;\n}\nfunction $0d1e4b05bb7aaeb3$var$endOf(paren) {\n    return paren.c2 ?? paren.col + 1;\n}\nfunction $0d1e4b05bb7aaeb3$var$typeOf(paren) {\n    if (paren.opened) return paren.opened.type || \"\";\n    return paren.type || \"\";\n}\nfunction $0d1e4b05bb7aaeb3$var$touches(paren, caret) {\n    return paren.line == caret.row && $0d1e4b05bb7aaeb3$var$startOf(paren) <= caret.col && caret.col <= $0d1e4b05bb7aaeb3$var$endOf(paren);\n}\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n    get_paren_at_point () {\n        let rc = this._rowcol;\n        let parens = this.tokenizer.getPP();\n        let a = [];\n        for (let op of parens){\n            if (!op.type) continue;\n            let cp = op.closed;\n            if (!cp) continue;\n            if ($0d1e4b05bb7aaeb3$var$touches(op, rc)) a.push(op);\n            if ($0d1e4b05bb7aaeb3$var$touches(cp, rc)) a.push(cp);\n        }\n        if (!a.length) return null;\n        if (a.length == 1) return a[0].opened || a[0];\n        if (/\\w/.test($0d1e4b05bb7aaeb3$var$typeOf(a[0])) && !/\\w/.test($0d1e4b05bb7aaeb3$var$typeOf(a[1]))) return a[0].opened || a[0];\n        if (/\\w/.test($0d1e4b05bb7aaeb3$var$typeOf(a[1])) && !/\\w/.test($0d1e4b05bb7aaeb3$var$typeOf(a[0]))) return a[1].opened || a[1];\n        a = a.sort((0, $c749180882ef16eb$export$2b0c642afb0ae4ca));\n        a = a[0].opened ? a[0] : a[1];\n        return a.opened || a;\n    },\n    matching_paren () {\n        this.tokenizer.finishParsing();\n        let rc = this._rowcol;\n        let p = this.cmd(\"get_paren_at_point\");\n        if (p) {\n            if ($0d1e4b05bb7aaeb3$var$touches(p, rc)) return this._rowColToPosition(p.closed.line, $0d1e4b05bb7aaeb3$var$endOf(p.closed));\n            return this._rowColToPosition(p.line, $0d1e4b05bb7aaeb3$var$startOf(p));\n        }\n    },\n    indent_sexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        var pos = this.cmd(\"matching_paren\");\n        if (pos != null) this.cmd(\"indent_region\", this.point(), pos);\n        else $0d1e4b05bb7aaeb3$var$ERROR(this);\n    }),\n    goto_matching_paren: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        var pos = this.cmd(\"matching_paren\");\n        if (pos != null) {\n            this.cmd(\"goto_char\", pos);\n            return true;\n        }\n    }),\n    forward_sexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.tokenizer.finishParsing();\n        let next;\n        let rc = this._rowcol;\n        let parens = this.tokenizer.getPP();\n        for(let i = 0; i < parens.length; ++i){\n            let p = parens[i];\n            if (p.line > rc.row || p.line == rc.row && $0d1e4b05bb7aaeb3$var$startOf(p) >= rc.col) {\n                next = p;\n                break;\n            }\n        }\n        this.withVariables({\n            syntax_word: this.getq(\"syntax_word_sexp\")\n        }, \"forward_word\");\n        if (next && next.closed && (0, $c749180882ef16eb$export$2b0c642afb0ae4ca)(this._rowcol, next) > 0) this.cmd(\"goto_char\", this._rowColToPosition(next.closed.line, $0d1e4b05bb7aaeb3$var$endOf(next.closed)));\n    }),\n    backward_sexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.tokenizer.finishParsing();\n        let prev;\n        let rc = this._rowcol;\n        let parens = this.tokenizer.getPP().filter((p)=>p.closed).map((p)=>p.closed).sort((0, $c749180882ef16eb$export$2b0c642afb0ae4ca));\n        for(let i = parens.length; --i >= 0;){\n            let p = parens[i];\n            if (p.line < rc.row || p.line == rc.row && ($0d1e4b05bb7aaeb3$var$startOf(p) < rc.col || p.c1 == p.c2 && $0d1e4b05bb7aaeb3$var$startOf(p) == rc.col)) {\n                prev = p;\n                break;\n            }\n        }\n        this.withVariables({\n            syntax_word: this.getq(\"syntax_word_sexp\")\n        }, \"backward_word\");\n        if (prev && prev.opened && (0, $c749180882ef16eb$export$2b0c642afb0ae4ca)(this._rowcol, {\n            line: prev.line,\n            col: $0d1e4b05bb7aaeb3$var$endOf(prev)\n        }) < 0) this.cmd(\"goto_char\", this._rowColToPosition(prev.opened.line, $0d1e4b05bb7aaeb3$var$startOf(prev.opened)));\n    }),\n    mark_sexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^r\", function(begin, end) {\n        this.tokenizer.finishParsing();\n        let paren = this.cmd(\"get_paren_at_point\");\n        if (paren?.outer) {\n            this.cmd(\"goto_char\", this._rowColToPosition(paren.outer.l1, paren.outer.c1));\n            this.ensureTransientMark();\n            this.cmd(\"goto_char\", this._rowColToPosition(paren.outer.l2, paren.outer.c2));\n            this.setMark(this.point());\n            this.transientMarker.swap(this.caretMarker);\n        } else this.cmd(\"save_excursion\", function() {\n            if (this.transientMarker) this.cmd(\"goto_char\", end);\n            this.ensureTransientMark();\n            this.cmd(\"forward_sexp\");\n            this.setMark(this.point());\n            this.transientMarker.swap(this.caretMarker);\n        });\n        this.ensureTransientMark();\n        this.setq(\"sticky_mark\", true);\n    }),\n    kill_sexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this._killingAction(this.point(), this.cmd(\"save_excursion\", function() {\n            this.cmd(\"forward_sexp\");\n            return this.point();\n        }));\n    }),\n    transpose_sexps: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        var a = [];\n        this.cmd(\"forward_sexp\");\n        a.push(this.point());\n        this.cmd(\"backward_sexp\");\n        a.push(this.point());\n        this.cmd(\"backward_sexp\");\n        a.push(this.point());\n        this.cmd(\"forward_sexp\");\n        a.push(this.point());\n        this.cmd(\"goto_char\", this._swapAreas(a));\n    }),\n    down_list: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.tokenizer.finishParsing();\n        let rc = this._rowcol;\n        let lc = {\n            line: rc.row,\n            col: rc.col\n        };\n        let p = this.tokenizer.getPP().filter((p)=>p.closed).find((p)=>(0, $c749180882ef16eb$export$2b0c642afb0ae4ca)(p, lc) >= 0);\n        if (p != null) this.cmd(\"goto_char\", this._rowColToPosition(p.line, $0d1e4b05bb7aaeb3$var$endOf(p)));\n        else $0d1e4b05bb7aaeb3$var$ERROR(this);\n    }),\n    backward_up_list: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.tokenizer.finishParsing();\n        let rc = this._rowcol;\n        let p = this.tokenizer.getPP().filter((0, $c749180882ef16eb$export$f6a9bcac20db9551)(rc)).at(-1);\n        if (p != null) this.cmd(\"goto_char\", this._rowColToPosition(p.line, $0d1e4b05bb7aaeb3$var$startOf(p)));\n        else $0d1e4b05bb7aaeb3$var$ERROR(this);\n    }),\n    up_list: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.cmd(\"backward_up_list\");\n        this.cmd(\"forward_sexp\");\n    }),\n    beginning_of_defun: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.tokenizer.finishParsing();\n        let rc = this._rowcol;\n        let p = this.tokenizer.getPP().filter((0, $c749180882ef16eb$export$f6a9bcac20db9551)(rc))[0];\n        if (p != null) this.cmd(\"goto_char\", this._rowColToPosition(p.line, $0d1e4b05bb7aaeb3$var$startOf(p)));\n        else this.cmd(\"backward_sexp\");\n        this.cmd(\"back_to_indentation\");\n    }),\n    end_of_defun: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.tokenizer.finishParsing();\n        let rc = this._rowcol;\n        let p = this.tokenizer.getPP().filter((0, $c749180882ef16eb$export$f6a9bcac20db9551)(rc))[0];\n        if (p != null) {\n            p = p.closed;\n            this.cmd(\"goto_char\", this._rowColToPosition(p.line, $0d1e4b05bb7aaeb3$var$endOf(p)));\n        } else this.cmd(\"forward_sexp\");\n    }),\n    paredit_raise_sexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.tokenizer.finishParsing();\n        let p = this.tokenizer.getPP().filter((0, $c749180882ef16eb$export$f6a9bcac20db9551)(this._rowcol, \"inner\")).at(-1);\n        if (!p) {\n            this.signalError(\"No containing expression\");\n            return;\n        }\n        this.cmd(\"forward_sexp\");\n        this.cmd(\"backward_sexp\");\n        var start = this.point();\n        this.cmd(\"forward_sexp\");\n        var end = this.point();\n        this.cmd(\"backward_up_list\");\n        var kstart = this.point();\n        this.cmd(\"forward_sexp\");\n        var kend = this.point();\n        var sexp = this.cmd(\"buffer_substring\", start, end);\n        this._replaceText(kstart, kend, sexp);\n        this.cmd(\"goto_char\", kstart);\n        this.cmd(\"indent_region\", kstart, kstart + sexp.length);\n    }),\n    paredit_splice_sexp: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.tokenizer.finishParsing();\n        let p = this.tokenizer.getPP().filter((0, $c749180882ef16eb$export$f6a9bcac20db9551)(this._rowcol, \"inner\")).at(-1);\n        if (!p) {\n            this.signalError(\"No containing expression\");\n            return;\n        }\n        if (p.inner && p.outer) this.cmd(\"save_excursion\", function() {\n            let outer_begin = this._rowColToPosition(p.outer.l1, p.outer.c1);\n            let outer_end = this._rowColToPosition(p.outer.l2, p.outer.c2);\n            let inner_begin = this._rowColToPosition(p.inner.l1, p.inner.c1);\n            let inner_end = this._rowColToPosition(p.inner.l2, p.inner.c2);\n            this.withMarkers((m1, m2)=>{\n                this._deleteText(inner_end, outer_end);\n                this._deleteText(outer_begin, inner_begin);\n                this.cmd(\"indent_region\", m1, m2);\n            }, inner_begin, inner_end);\n        });\n        else this.cmd(\"save_excursion\", function() {\n            this.cmd(\"backward_up_list\");\n            var start = this.point();\n            this.cmd(\"forward_sexp\");\n            this.cmd(\"backward_delete_char\");\n            var end = this.point();\n            this.cmd(\"goto_char\", start);\n            this.cmd(\"delete_char\");\n            this.cmd(\"indent_region\", start, end - 1);\n        });\n    }),\n    paredit_backward_delete_char: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^p\", function(n) {\n        if (n != null) return this.cmd(\"backward_delete_char\", n);\n        if (!this.deleteTransientRegion()) {\n            if (this.cmd(\"looking_back\", /[\\(\\[\\{\\\"\\\\\\`\\']/g)) {\n                var close = $0d1e4b05bb7aaeb3$var$PARENS[this.matchData[0]];\n                if (close) {\n                    var rx = new RegExp(\"\\\\s*\\\\\" + close, \"my\");\n                    if (this.cmd(\"looking_at\", rx)) this.cmd(\"save_excursion\", function() {\n                        this.cmd(\"delete_whitespace\");\n                        this.cmd(\"delete_char\");\n                    });\n                }\n            }\n            this.cmd(\"backward_delete_char\");\n        }\n    }),\n    paredit_delete_char: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^p\", function(n) {\n        if (n != null) return this.cmd(\"delete_char\", n);\n        if (!this.deleteTransientRegion()) {\n            if (this.cmd(\"looking_at\", /[\\]\\}\\)\\\"\\\\\\`\\']/y)) {\n                var open = $0d1e4b05bb7aaeb3$var$R_PARENS[this.matchData[0]];\n                if (open) {\n                    var rx = new RegExp(\"\\\\\" + open + \"\\\\s*\", \"mg\");\n                    if (this.cmd(\"looking_back\", rx)) this.cmd(\"save_excursion\", function() {\n                        this.cmd(\"backward_delete_whitespace\");\n                        this.cmd(\"backward_delete_char\");\n                    });\n                }\n            }\n            this.cmd(\"delete_char\");\n        }\n    }),\n    paredit_open_pair: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function(pair_a, pair_b, backslash) {\n        if (this.transientMarker) {\n            this.cmd(\"paredit_wrap_round\", pair_a, pair_b, backslash);\n            return;\n        }\n        if (pair_a == pair_b && this.looking_at(pair_a)) // presumably close; it's already there, just skip it\n        this.cmd(\"forward_char\");\n        else {\n            let maybe_space = this.getq(\"paredit_space_before\");\n            if (typeof maybe_space == \"function\") maybe_space = maybe_space.apply(this, arguments);\n            if (maybe_space) this.cmd(\"insert\", \" \");\n            this.cmd(\"insert\", pair_a);\n            this.cmd(\"insert\", pair_b);\n            this.cmd(\"backward_char\", pair_b.length);\n        }\n        this.cmd(\"paredit_maybe_indent\");\n    }),\n    paredit_close_pair: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function(pair_a, pair_b) {\n        if (this.transientMarker) {\n            this.cmd(\"paredit_wrap_round\", pair_a, pair_b);\n            return;\n        }\n        var re = new RegExp(\"\\\\s*\\\\\" + pair_b, \"iy\");\n        if (this.cmd(\"looking_at\", re)) this._deleteText(this.point(), this.matchData.after);\n        this.cmd(\"insert\", pair_b);\n        this.cmd(\"paredit_maybe_indent\");\n    }),\n    paredit_wrap_round: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(\"^\", function(paren, closing, backslash) {\n        let r = this.transientMarker ? this.getRegion() : this.cmd(\"save_excursion\", function() {\n            let begin = this.point();\n            this.cmd(\"forward_sexp\");\n            return {\n                begin: begin,\n                end: this.point()\n            };\n        });\n        let txt = this._bufferSubstring(r.begin, r.end);\n        let before = this.point() < r.end;\n        if (backslash) txt = txt.replace(backslash, (s)=>\"\\\\\" + s);\n        let m = this.createMarker(r.end);\n        this.cmd(\"save_excursion\", function() {\n            this._replaceText(r.begin, r.end, paren + txt + closing);\n        }, before);\n        if (before) this.cmd(\"forward_char\");\n        this.clearTransientMark();\n        this.cmd(\"indent_region\", r.begin, m.getPosition());\n        m.destroy();\n    }),\n    paredit_newline_and_indent: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        var inparens = this.looking_at(/[ \\t]*([\\]\\}])/y) && this.looking_back(new RegExp(\"\\\\\" + $0d1e4b05bb7aaeb3$var$R_PARENS[this.matchData[1]] + \"[ \\\\t]*\", \"g\"));\n        this.cmd(\"newline_and_indent\");\n        if (inparens) {\n            this.cmd(\"newline_and_indent\");\n            this.cmd(\"backward_line\");\n            this.cmd(\"indent_line\");\n        }\n    }),\n    paredit_maybe_indent: function() {\n        if (this.getq(\"electric_indent\")) this.cmd(\"indent_line\");\n    },\n    paredit_electric_char: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.cmd(\"self_insert_command\");\n        this.cmd(\"paredit_maybe_indent\");\n    })\n});\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newMode(\"paren_match_mode\", function() {\n    this.pushKeymap($0d1e4b05bb7aaeb3$var$Ymacs_Keymap_ParenMatch);\n    var clearOvl = (function() {\n        this.deleteOverlay(\"match-paren\");\n    }).bind(this);\n    let events = {\n        beforeInteractiveCommand: function() {\n            clearOvl();\n        },\n        afterInteractiveCommand: (0, $08a06a2e99accb03$export$ad41d882ec94ba04)(()=>{\n            let rc = this._rowcol;\n            let hl = [];\n            let p = this.cmd(\"get_paren_at_point\");\n            if (p) hl.push({\n                line1: p.line,\n                col1: p.c1,\n                line2: p.line,\n                col2: p.c2\n            }, {\n                line1: p.closed.line,\n                col1: p.closed.c1,\n                line2: p.closed.line,\n                col2: p.closed.c2\n            });\n            this.setOverlay(\"match-paren\", hl);\n        }, 100)\n    };\n    this.addEventListener(events);\n    if (this.getq(\"electric_indent\") == null) this.setq(\"electric_indent\", true);\n    return function() {\n        clearOvl();\n        this.popKeymap($0d1e4b05bb7aaeb3$var$Ymacs_Keymap_ParenMatch);\n        this.removeEventListener(events);\n    };\n});\n\n\n/// This file is part of Ymacs - www.ymacs.org\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\n/// License: MIT\n\n\n\n\n\n\n\nconst $3aa295d5c8d5089e$var$RX_EMPTY_TAG = /^(?:area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)$/i;\nconst $3aa295d5c8d5089e$var$RX_BLOCK_TAG = /^(?:article|aside|blockquote|body|button|caption|col|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h[1-6]|header|hgroup|li|ol|p|pre|section|table|tbody|textarea|tfoot|th|thead|td|tr|ul)$/i;\nlet $3aa295d5c8d5089e$var$Ymacs_Keymap_XML = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"xml\", {\n    \"C-c /\": \"xml_close_tag\",\n    \"/\": \"xml_slash_complete_tag\",\n    \">\": \"xml_gt_complete_tag\",\n    \"%\": \"twig_insert_percent\",\n    \"M--\": \"twig_block_toggle_whitespace\",\n    \"C-Enter\": \"xml_zen_expand\",\n    \"Enter\": \"xml_newline_and_indent\"\n});\nlet $3aa295d5c8d5089e$var$markup_mode = (tok_type)=>function() {\n        var tok = this.tokenizer;\n        this.setTokenizer(new (0, $c749180882ef16eb$export$3964ae1c660db960)({\n            buffer: this,\n            type: tok_type\n        }));\n        var was_paren_match = this.cmd(\"paren_match_mode\", true);\n        this.pushKeymap($3aa295d5c8d5089e$var$Ymacs_Keymap_XML);\n        var changed_vars = this.setq({\n            indent_level: 2,\n            syntax_comment_multi: {\n                rx: /[^\\S\\r\\n]*<!--+[^\\S\\r\\n]*(.*?)[^\\S\\r\\n]*-->/ygu,\n                ch: [\n                    \"<!--\",\n                    \"-->\"\n                ]\n            },\n            syntax_word_dabbrev: /^[\\p{N}_$\\p{L}:#-]$/u,\n            syntax_word_sexp: /^[\\p{N}_$\\p{L}:#-]$/u\n        });\n        return function() {\n            if (!was_paren_match) this.cmd(\"paren_match_mode\", false);\n            this.popKeymap($3aa295d5c8d5089e$var$Ymacs_Keymap_XML);\n            this.setq(changed_vars);\n            this.setTokenizer(tok);\n        };\n    };\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newMode(\"xml_mode\", $3aa295d5c8d5089e$var$markup_mode(\"xml\"));\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newMode(\"html_mode\", $3aa295d5c8d5089e$var$markup_mode(\"html\"));\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newMode(\"twig_html_mode\", $3aa295d5c8d5089e$var$markup_mode(\"twig_html\"));\nclass $3aa295d5c8d5089e$var$Ymacs_Lang_XML extends (0, $1414b989ef7d55bc$export$96ac030efd09f62d) {\n    _tags = (0, $08a06a2e99accb03$export$d5414a779ebfba6b);\n    _inTag = null;\n    _inline = 0;\n    COMMENT = [\n        [\n            \"<!--\",\n            \"-->\",\n            \"-\"\n        ],\n        [\n            \"<![CDATA[\",\n            \"]]>\",\n            null,\n            \"xml-cdata-starter\",\n            \"xml-cdata\",\n            \"xml-cdata-stopper\"\n        ]\n    ];\n    NAME = /^[\\p{L}:_$-][\\p{L}0-9:_$-]*/iu;\n    OPEN_PAREN = {\n        \"(\": \")\",\n        \"{\": \"}\",\n        \"[\": \"]\",\n        \"\\xab\": \"\\xbb\",\n        \"\\u2770\": \"\\u2771\",\n        \"\\u201C\": \"\\u201D\"\n    };\n    CLOSE_PAREN = {\n        \")\": \"(\",\n        \"}\": \"{\",\n        \"]\": \"[\",\n        \"\\xbb\": \"\\xab\",\n        \"\\u2771\": \"\\u2770\",\n        \"\\u201D\": \"\\u201C\"\n    };\n    constructor({ stream: stream, tok: tok, emptyTags: emptyTags, inline: inline }){\n        super({\n            stream: stream,\n            tok: tok\n        });\n        this.emptyTags = emptyTags;\n        this.inline = inline;\n    }\n    copy() {\n        let _super = super.copy();\n        let _tags = this._tags;\n        let _inTag = this._inTag;\n        let _inline = this._inline;\n        return ()=>{\n            let self = _super();\n            self._tags = _tags;\n            self._inTag = _inTag;\n            self._inline = _inline;\n            return self;\n        };\n    }\n    read() {\n        this.readComment() || this.readDeclaration() || this.readCloseTag() || this.readOpenTag() || this.readOpenParen() || this.readCloseParen() || this.readTrailingWhitespace() || this.t(null, 1, this._stream.peek() != \" \");\n    }\n    t(type = null, len = 1, addInline) {\n        if (addInline && this.inline) {\n            let cls = this.inline.cls(this._inline);\n            if (cls != null) type = cls + (type != null ? \" \" + type : \"\");\n        }\n        this.token({\n            line: this._stream.line,\n            c1: this._stream.col,\n            c2: this._stream.col += len\n        }, type);\n    }\n    readDeclaration() {\n        let s = this._stream, m = s.lookingAt(/^<[?!]/);\n        if (m) {\n            let sp = m[0];\n            this.pushInParen(sp, \"xml-open-bracket\");\n            this.pushCont(()=>{\n                let m = s.lookingAt(/^\\??>/);\n                if (m) {\n                    this.popInParen(sp, m[0].length, \"xml-close-bracket\");\n                    this.popCont();\n                } else this.readString() || this.readTrailingWhitespace() || this.t(\"directive\");\n            });\n            return true;\n        }\n    }\n    readOpenTag() {\n        let s = this._stream;\n        if (s.lookingAt(\"<\") && this.NAME.test(s.peek(1))) {\n            let outer = {\n                l1: s.line,\n                c1: s.col\n            };\n            this.pushInParen(\"<\", \"xml-open-bracket\");\n            let tag = this.maybeName(\"xml-open-tag\");\n            tag.outer = outer;\n            this._inTag = tag;\n            this.pushCont(this.contOpenTag);\n            return true;\n        }\n    }\n    contOpenTag() {\n        let s = this._stream;\n        let ch = s.peek(), name;\n        if (s.lookingAt(\"/>\")) {\n            this.popInParen(\"<\", 2, \"xml-close-bracket\");\n            this.popCont();\n            this._inTag = null;\n        } else if (ch === \">\") {\n            this.popInParen(\"<\", 1, \"xml-close-bracket\");\n            this.popCont();\n            if (!this.emptyTags?.test(this._inTag.id)) {\n                this._inTag.inner = {\n                    l1: s.line,\n                    c1: s.col\n                };\n                this.pushTag(this._inTag);\n                if (this.inline) this._inline ^= this.inline.code(this._inTag.id);\n            }\n            this._inTag = null;\n        } else if (name = this.maybeName(\"xml-attribute\")) ;\n        else if (ch === '\"' || ch === \"'\") this.readString();\n        else this.readTrailingWhitespace() || this.t();\n    }\n    readCloseTag() {\n        let s = this._stream;\n        if (s.lookingAt(\"</\") && this.NAME.test(s.peek(2))) {\n            let otag = this.popTag();\n            if (otag) {\n                otag.inner.l2 = s.line;\n                otag.inner.c2 = s.col;\n                if (this.inline) this._inline ^= this.inline.code(otag.id);\n            }\n            this.pushInParen(\"</\", \"xml-open-bracket\");\n            let ctag = this.readName();\n            this.token(ctag, otag?.id == ctag.id ? \"xml-close-tag\" : \"error\");\n            if (otag) {\n                let popen = {\n                    line: otag.line,\n                    c1: otag.c1,\n                    c2: otag.c2,\n                    type: otag.id,\n                    inner: otag.inner,\n                    outer: otag.outer\n                };\n                let pclose = {\n                    line: ctag.line,\n                    c1: ctag.c1,\n                    c2: ctag.c2,\n                    opened: popen\n                };\n                popen.closed = pclose;\n                this.doneParen(popen);\n            }\n            this.pushCont(this.contCloseTag.bind(this, otag));\n            return true;\n        }\n    }\n    contCloseTag(otag) {\n        let s = this._stream, m = s.lookingAt(/^([\\s\\xA0]*)(>?)/);\n        if (m && m[0]) {\n            if (m[1]) this.t(null, m[1].length);\n            if (m[2]) {\n                this.popInParen(\"</\", 1, \"xml-close-bracket\");\n                this.popCont();\n                if (otag) {\n                    otag.outer.l2 = s.line;\n                    otag.outer.c2 = s.col;\n                }\n            }\n        } else this.readTrailingWhitespace() || this.t(\"error\");\n    }\n    indentation() {\n        let s = this._stream;\n        var indent, lastTag;\n        let INDENT_LEVEL = ()=>this._stream.buffer.getq(\"indent_level\");\n        if (this._inComment) indent = s.lineIndentation(this._inComment.line) + INDENT_LEVEL();\n        else if (this._inTag) {\n            var txt = s.lineText(this._inTag.line);\n            if (/^\\s*$/.test(txt.substr(0, this._inTag.c1 - 1))) indent = this._inTag.c1 + this._inTag.id.length + 1;\n            else indent = s.lineIndentation(this._inTag.line);\n        } else if (lastTag = this._tags.car) {\n            indent = s.lineIndentation(lastTag.line);\n            if (!/^\\s*<\\x2f/.test(s.lineText())) indent += INDENT_LEVEL();\n        }\n        if (indent == null) {\n            let line = s.line;\n            while(line > 0 && !/\\S/.test(s.lineText(line)))line--;\n            indent = s.lineIndentation(line);\n        }\n        return indent;\n    }\n    pushTag(tag) {\n        this._tags = new (0, $08a06a2e99accb03$export$74c44e616647f5c0)(tag, this._tags);\n    }\n    popTag() {\n        let tag = this._tags.car;\n        this._tags = this._tags.cdr;\n        return tag;\n    }\n    get tag() {\n        return this._tags.car;\n    }\n}\nclass $3aa295d5c8d5089e$var$Ymacs_Lang_HTML extends $3aa295d5c8d5089e$var$Ymacs_Lang_XML {\n    _mode = this;\n    _js = this._tok.getLanguage(\"js\");\n    _css = this._tok.getLanguage(\"css\");\n    get passedParens() {\n        return [\n            ...super.passedParens,\n            ...this._js.passedParens,\n            ...this._css.passedParens\n        ];\n    }\n    next() {\n        let s = this._stream;\n        if (this._mode === this && this.tag) {\n            if (this.tag.id == \"script\") this._mode = this._js;\n            if (this.tag.id == \"style\") this._mode = this._css;\n        }\n        if (this._mode === this._js && s.lookingAt(\"</script\")) this._mode = this;\n        if (this._mode === this._css && s.lookingAt(\"</style\")) this._mode = this;\n        this._mode === this ? super.next() : this._mode.next();\n    }\n    copy() {\n        let _super = super.copy();\n        let _js = this._js.copy();\n        let _css = this._css.copy();\n        let _mode = this._mode;\n        return ()=>{\n            let self = _super();\n            self._js = _js();\n            self._css = _css();\n            self._mode = _mode;\n            return self;\n        };\n    }\n    indentation() {\n        let s = this._stream;\n        let INDENT_LEVEL = ()=>this._stream.buffer.getq(\"indent_level\");\n        if (this._mode === this || !this._mode._inString && /^\\s*<\\//.test(s.lineText())) {\n            let indent = super.indentation();\n            let tag = this._tags.car;\n            if (tag) {\n                let txt = s.lineText(tag.outer.l1).substr(0, tag.outer.c1);\n                if (/\\S/.test(txt)) // there is text before the innermost tag, let's assume\n                // it's inline text and back one level\n                indent -= INDENT_LEVEL();\n            }\n            return indent > 0 ? indent : 0;\n        } else {\n            let tag = this.tag;\n            if (tag) {\n                let line = s.line;\n                while(--line > tag.line && !/\\S/.test(s.lineText(line)));\n                if (line == tag.line) return s.lineIndentation(line) + this._stream.buffer.getq(\"indent_level\");\n            }\n            return this._mode.indentation();\n        }\n    }\n}\nconst $3aa295d5c8d5089e$var$TWIG_BUILTIN = (0, $08a06a2e99accb03$export$da43f679ba2e9167)(`in or and not is defined constant divisible empty\neven iterable null true false odd same from as starts with only ends matches`);\nclass $3aa295d5c8d5089e$var$Ymacs_Lang_Twig extends (0, $1414b989ef7d55bc$export$96ac030efd09f62d) {\n    STRING = [\n        \"'\",\n        [\n            '\"',\n            '\"',\n            \"#{\",\n            \"}\"\n        ]\n    ];\n    _blocks = (0, $08a06a2e99accb03$export$d5414a779ebfba6b);\n    _inBlock = null;\n    _alt = this._tok.getLanguage(\"html\");\n    _mode = this._alt;\n    get passedParens() {\n        return [\n            ...super.passedParens,\n            ...this._alt.passedParens\n        ];\n    }\n    copy() {\n        let _super = super.copy();\n        let _alt = this._alt.copy();\n        let _mode = this._mode;\n        let _blocks = this._blocks;\n        let _inBlock = this._inBlock;\n        return ()=>{\n            let self = _super();\n            self._alt = _alt();\n            self._mode = _mode;\n            self._blocks = _blocks;\n            self._inBlock = _inBlock;\n            return self;\n        };\n    }\n    next() {\n        let s = this._stream, m;\n        if (this._mode === this._alt) {\n            if (m = s.lookingAt(/^\\{%-?/)) {\n                this._mode = this;\n                this.pushCont(this.readBlock.bind(this, m[0]));\n            } else if (m = s.lookingAt(/^\\{\\{-?/)) {\n                this._mode = this;\n                this.pushInParen(m[0], \"exp-starter\");\n                return;\n            } else if (m = s.lookingAt(/^\\{#-?/)) {\n                this._alt.readCommentMulti(m[0], /^-?#\\}/, \"#\");\n                return this.next();\n            }\n        } else if ((m = s.lookingAt(/^-?\\}\\}/)) && /^\\{\\{/.test(this._inParens.car?.type)) {\n            this.popInParen(this._inParens.car?.type, m[0].length, \"exp-stopper\");\n            this._mode = this._alt;\n            return this.next();\n        }\n        this._mode === this ? super.next() : this._alt.next();\n    }\n    readCustom() {\n        let s = this._stream;\n        let filter = /\\|\\s*$/.test(s.textBefore());\n        let tok = this.readName();\n        if (tok) {\n            this.skipWS();\n            tok.type = filter || s.lookingAt(\"(\") ? \"function-name\" : tok.id in $3aa295d5c8d5089e$var$TWIG_BUILTIN ? \"builtin\" : null;\n            this.token(tok);\n            return true;\n        }\n        return this.readNumber();\n    }\n    readBlock(start) {\n        let s = this._stream, m;\n        if (this._inBlock) {\n            this.skipWS();\n            if (m = s.lookingAt(/^-?%\\}/)) {\n                this.popInParen(start, m[0].length, \"block-stopper\");\n                this._mode = this._alt;\n                this.popCont();\n                if (this._inBlock.hasBody) {\n                    this._inBlock.inner = {\n                        l1: s.line,\n                        c1: s.col\n                    };\n                    this.pushBlock(this._inBlock);\n                } else if (this._inBlock.outer) {\n                    this._inBlock.outer.l2 = s.line;\n                    this._inBlock.outer.c2 = s.col;\n                }\n                this._inBlock = null;\n            } else this.read();\n        } else {\n            let outer = {\n                l1: s.line,\n                c1: s.col\n            };\n            this.pushInParen(start, \"block-starter\");\n            this.skipWS();\n            let ctag = this.readName();\n            if (ctag) {\n                let isEndTag = /^end/.test(ctag.id);\n                if (isEndTag) {\n                    let otag = this.popBlock();\n                    let name = ctag.id.substr(3);\n                    this.token(ctag, otag?.id == name ? \"keyword\" : \"error\");\n                    if (otag) {\n                        if (otag.inner) {\n                            otag.inner.l2 = outer.l1;\n                            otag.inner.c2 = outer.c1;\n                        }\n                        let popen = {\n                            line: otag.line,\n                            c1: otag.c1,\n                            c2: otag.c2,\n                            type: otag.id,\n                            inner: otag.inner,\n                            outer: otag.outer\n                        };\n                        let pclose = {\n                            line: ctag.line,\n                            c1: ctag.c1,\n                            c2: ctag.c2,\n                            opened: popen\n                        };\n                        popen.closed = pclose;\n                        this.doneParen(popen);\n                        this._inBlock = otag; // waiting for %}\n                        delete otag.hasBody; // no more body to parse\n                    }\n                    this.skipWS();\n                    if (/^(?:macro|block)$/.test(name)) {\n                        let fname = this.readName();\n                        if (fname) this.token(fname, fname.id == otag?.fname?.id ? \"function-name\" : \"error\");\n                        this.skipWS();\n                    }\n                } else {\n                    this.token(ctag, \"keyword\");\n                    ctag.outer = outer;\n                    this._inBlock = ctag;\n                    this.littleParseTag(ctag);\n                }\n            } else if (m = s.lookingAt(/^-?%\\}/)) {\n                // incomplete input but auto-completed end paren\n                this.popInParen(start, m[0].length, \"error\");\n                this._mode = this._alt;\n                this.popCont();\n            } else {\n                this.t(\"error\");\n                this._inBlock = {\n                    hasBody: false\n                };\n            }\n        }\n    }\n    littleParseTag(ctag) {\n        let s = this._stream;\n        ctag.hasBody = !/^(import|do|from|include|extends|use|else(?:if)?)$/.test(ctag.id);\n        this.skipWS();\n        if (ctag.id == \"set\") {\n            while(this.maybeName(\"variable-name\")){\n                this.skipWS();\n                if (s.lookingAt(\",\")) {\n                    s.col++;\n                    this.skipWS();\n                } else break;\n            }\n            this.skipWS();\n            ctag.hasBody = s.lookingAt(/^-?%\\}/);\n        } else if (ctag.id == \"block\" || ctag.id == \"macro\") ctag.fname = this.maybeName(\"function-name\");\n    }\n    indentation() {\n        let s = this._stream;\n        let INDENT_LEVEL = ()=>this._stream.buffer.getq(\"indent_level\");\n        if (this._mode === this) return super.indentation();\n        else if (this.block) {\n            if (this._mode._inTag) return this._mode.indentation();\n            let indent = s.lineIndentation(this.block.line);\n            let closing = /^\\s*\\{%-?\\s*(?:end|else)/.test(s.lineText());\n            if (closing) return indent;\n            if (!this._mode.tag || this._mode.tag.line <= this.block.line) return indent + INDENT_LEVEL();\n        }\n        return this._mode.indentation();\n    }\n    pushBlock(block) {\n        this._blocks = new (0, $08a06a2e99accb03$export$74c44e616647f5c0)(block, this._blocks);\n    }\n    popBlock() {\n        let block = this._blocks.car;\n        this._blocks = this._blocks.cdr;\n        return block;\n    }\n    get block() {\n        return this._blocks.car;\n    }\n    get tag() {\n        return this._alt.tag;\n    }\n}\nfunction $3aa295d5c8d5089e$var$inlineCode(tag) {\n    return tag == \"i\" || tag == \"em\" ? 1 : tag == \"b\" || tag == \"strong\" ? 2 : tag == \"a\" ? 4 : tag == \"h1\" ? 8 : tag == \"h2\" ? 16 : tag == \"h3\" ? 32 : tag == \"h4\" ? 64 : 0;\n}\nfunction $3aa295d5c8d5089e$var$inlineCls(inline) {\n    let out = \"\";\n    if (inline & 1) out += \" italic\";\n    if (inline & 2) out += \" bold\";\n    if (inline & 4) out += \" link\";\n    if (inline & 8) out += \" heading1\";\n    if (inline & 16) out += \" heading2\";\n    if (inline & 32) out += \" heading3\";\n    if (inline & 64) out += \" heading4\";\n    return out.trim() || null;\n}\n(0, $c749180882ef16eb$export$3964ae1c660db960).define(\"xml\", (stream, tok)=>new $3aa295d5c8d5089e$var$Ymacs_Lang_XML({\n        stream: stream,\n        tok: tok\n    }));\n(0, $c749180882ef16eb$export$3964ae1c660db960).define(\"html\", (stream, tok)=>new $3aa295d5c8d5089e$var$Ymacs_Lang_HTML({\n        stream: stream,\n        tok: tok,\n        emptyTags: $3aa295d5c8d5089e$var$RX_EMPTY_TAG,\n        inline: {\n            code: $3aa295d5c8d5089e$var$inlineCode,\n            cls: $3aa295d5c8d5089e$var$inlineCls\n        }\n    }));\n(0, $c749180882ef16eb$export$3964ae1c660db960).define(\"twig_html\", (stream, tok)=>new $3aa295d5c8d5089e$var$Ymacs_Lang_Twig({\n        stream: stream,\n        tok: tok\n    }));\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n    xml_limit_fill_paragraph_region: function() {\n        // XXX: this function should somehow be a property of the language (for mixed modes),\n        // rather than a top-level method. Not yet decided how to best handle this...\n        if (!this.tokenizer) return;\n        this.tokenizer.finishParsing();\n        let blk = this.tokenizer.getPP().filter((0, $c749180882ef16eb$export$f6a9bcac20db9551)(this._rowcol, \"outer\")).findLast((p)=>$3aa295d5c8d5089e$var$RX_BLOCK_TAG.test(p.type));\n        if (blk) {\n            let r = {\n                begin: this._rowColToPosition(blk.inner.l1, blk.inner.c1),\n                end: this._rowColToPosition(blk.inner.l2, blk.inner.c2)\n            };\n            this.cmd(\"save_excursion\", ()=>{\n                this.cmd(\"goto_char\", r.begin);\n                if (this.cmd(\"looking_at\", /[^\\S\\r\\n]*\\n/gy)) {\n                    this.cmd(\"goto_char\", this.matchData.after);\n                    r.begin = this.point();\n                }\n                this.cmd(\"goto_char\", r.end);\n                if (this.cmd(\"looking_back\", /\\n[^\\S\\r\\n]*/g)) {\n                    this.cmd(\"backward_whitespace\");\n                    r.end = this.point();\n                }\n            });\n            return r;\n        }\n    },\n    xml_close_tag: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let rc = this._rowcol;\n        this.tokenizer.parseUntil(rc.row, rc.col);\n        let tag = this.tokenizer.theParser.tag; // XML\n        let block = this.tokenizer.theParser.block; // Twig\n        let closeTwig = ()=>{\n            this.cmd(\"insert\", `{% end${block.id} %}`);\n            this.cmd(\"indent_line\");\n        };\n        let closeXML = ()=>{\n            this.cmd(\"insert\", `</${tag.id}>`);\n            this.cmd(\"indent_line\");\n        };\n        if (!tag && !block) return;\n        if (!tag && block) return closeTwig();\n        if (!block && tag) return closeXML();\n        if ((0, $c749180882ef16eb$export$2b0c642afb0ae4ca)(block, tag) < 0) return closeXML();\n        closeTwig();\n    }),\n    xml_slash_complete_tag: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.cmd(\"self_insert_command\");\n        if (this.looking_back(\"</\")) {\n            let rc = this._rowcol;\n            this.tokenizer.parseUntil(rc.row, rc.col);\n            let tag = this.tokenizer.theParser.tag;\n            if (tag) {\n                this._placeUndoBoundary();\n                this.cmd(\"insert\", tag.id, \">\");\n                this.cmd(\"indent_line\");\n            }\n        }\n    }),\n    xml_gt_complete_tag: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.cmd(\"self_insert_command\");\n        let rc = this._rowcol;\n        this.tokenizer.parseUntil(rc.row, rc.col);\n        let tag = this.tokenizer.theParser.tag;\n        if (tag?.inner?.l1 == rc.row && tag.inner.c1 == rc.col) {\n            this._placeUndoBoundary();\n            let pos = this.point();\n            this.cmd(\"insert\", \"</\", tag.id, \">\");\n            this.cmd(\"goto_char\", pos);\n        }\n    }),\n    xml_newline_and_indent: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let inparens = this.looking_at(\"</\") && this.looking_back(\">\");\n        this.cmd(\"newline_and_indent\");\n        if (inparens) {\n            this.cmd(\"newline_and_indent\");\n            this.cmd(\"backward_line\");\n            this.cmd(\"indent_line\");\n        }\n    }),\n    twig_insert_percent: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.cmd(\"self_insert_command\");\n        let rc = this._rowcol;\n        this.tokenizer.parseUntil(rc.row, rc.col);\n        let mode = this.tokenizer.theParser._mode;\n        if (mode instanceof $3aa295d5c8d5089e$var$Ymacs_Lang_Twig && this.looking_back(\"{%\")) {\n            this._placeUndoBoundary();\n            this.cmd(\"insert\", \"  %\");\n            this.cmd(\"backward_char\", 2);\n        }\n    }),\n    twig_block_toggle_whitespace: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.tokenizer.finishParsing();\n        let p = this.tokenizer.getPP().filter((0, $c749180882ef16eb$export$f6a9bcac20db9551)(this._rowcol)).filter((x)=>/^\\{[{%#]/.test(x.type)).at(-1);\n        if (p?.closed) {\n            let doFront = ()=>{\n                if (this.looking_back(\"-\")) this.cmd(\"backward_delete_char\");\n                else this.cmd(\"insert\", \"-\");\n            };\n            let doBack = ()=>{\n                if (this.looking_at(\"-\")) this.cmd(\"delete_char\");\n                else this.cmd(\"insert\", \"-\");\n            };\n            this.cmd(\"save_excursion\", ()=>{\n                this.cmd(\"goto_char\", this._rowColToPosition(p.closed.line, p.closed.c1));\n                doBack();\n                this.cmd(\"goto_char\", this._rowColToPosition(p.line, p.c2));\n                doFront();\n            });\n        }\n    })\n});\n/*------------- zen mode -------------*/ // not sure \"zen mode\" is of any interest these days, but let's leave it for now.\nlet $3aa295d5c8d5089e$var$Ymacs_Keymap_XML_Zen = (0, $d9a61832b63ddf79$export$6b6e17e3540cb3d2).define(\"xml_zen\", {\n    \"Tab\": \"xml_zen_next_poi\",\n    \"S-Tab\": \"xml_zen_prev_poi\",\n    \"C-g\": \"xml_zen_stop\"\n});\nlet $3aa295d5c8d5089e$var$MODE_TYPE = 1, $3aa295d5c8d5089e$var$MODE_CLASS = 2, $3aa295d5c8d5089e$var$MODE_ID = 3, $3aa295d5c8d5089e$var$MODE_REPEAT = 4, $3aa295d5c8d5089e$var$MODE_ATTR = 5;\nfunction $3aa295d5c8d5089e$var$zen_render(el, html) {\n    var n = el.repeat || 1;\n    for(var i = 1; i <= n; ++i){\n        if (i > 1) html(\"\\n\");\n        html(\"<\", el.type);\n        if (el.id) html(' id=\"', el.id.replace(/\\$/g, i), '\"');\n        if (el.klass) html(' class=\"', el.klass.replace(/\\$/g, i), '\"');\n        if (el.attributes) el.attributes.forEach((attr)=>html(\" \", attr, '=\"|\"'));\n        html(\">\");\n        if (el.child) {\n            html(\"\\n\");\n            $3aa295d5c8d5089e$var$zen_render(el.child, html);\n            html(\"\\n\");\n        } else html(\"|\");\n        html(\"</\", el.type, \">\");\n        if (el.next) {\n            html(\"\\n\");\n            $3aa295d5c8d5089e$var$zen_render(el.next, html);\n        }\n    }\n}\nfunction $3aa295d5c8d5089e$var$zen_parse(str, i) {\n    var el = {\n        type: \"\"\n    }, mode = $3aa295d5c8d5089e$var$MODE_TYPE;\n    OUTER: while(i < str.length){\n        var ch = str.charAt(i++);\n        switch(ch){\n            case \"#\":\n                mode = $3aa295d5c8d5089e$var$MODE_ID;\n                el.id = \"\";\n                break;\n            case \".\":\n                mode = $3aa295d5c8d5089e$var$MODE_CLASS;\n                if (el.klass != null) el.klass += \" \";\n                else el.klass = \"\";\n                break;\n            case \":\":\n                mode = $3aa295d5c8d5089e$var$MODE_ATTR;\n                if (el.attributes == null) el.attributes = [];\n                el.attributes.push(\"\");\n                break;\n            case \"*\":\n                mode = $3aa295d5c8d5089e$var$MODE_REPEAT;\n                el.repeat = \"\";\n                break;\n            case \">\":\n                el.child = $3aa295d5c8d5089e$var$zen_parse(str, i);\n                i = el.child.i;\n                break OUTER;\n            case \"(\":\n                el.child = $3aa295d5c8d5089e$var$zen_parse(str, i);\n                i = el.child.i;\n                break;\n            case \")\":\n                break OUTER;\n            case \"+\":\n                el.next = $3aa295d5c8d5089e$var$zen_parse(str, i);\n                i = el.next.i;\n                break OUTER;\n            default:\n                switch(mode){\n                    case $3aa295d5c8d5089e$var$MODE_TYPE:\n                        el.type += ch;\n                        break;\n                    case $3aa295d5c8d5089e$var$MODE_CLASS:\n                        el.klass += ch;\n                        break;\n                    case $3aa295d5c8d5089e$var$MODE_ID:\n                        el.id += ch;\n                        break;\n                    case $3aa295d5c8d5089e$var$MODE_REPEAT:\n                        el.repeat = parseInt(String(el.repeat) + ch, 10);\n                        break;\n                    case $3aa295d5c8d5089e$var$MODE_ATTR:\n                        el.attributes.push(el.attributes.pop() + ch);\n                        break;\n                }\n        }\n    }\n    el.i = i;\n    return el;\n}\nfunction $3aa295d5c8d5089e$var$maybe_stop_zen() {\n    var point = this.point(), a = this.getq(\"xml_zen_markers\"), start = a[0], end = a.at(-1);\n    if (point < start.getPosition() || point > end.getPosition() || end.getPosition() == a.at(-2).getPosition()) this.cmd(\"xml_zen_stop\");\n}\n(0, $5e779a545e33325b$export$df331bdfc76955b4).newCommands({\n    xml_zen_expand: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        this.cmd(\"xml_zen_stop\");\n        var html = \"\";\n        var start = this.cmd(\"save_excursion\", function() {\n            this.cmd(\"backward_whitespace\");\n            while(!this.cmd(\"looking_back\", /[\\x20\\xa0\\s\\t\\n;&]/g))if (!this.cmd(\"backward_char\")) break;\n            return this.point();\n        });\n        var point = this.point();\n        try {\n            $3aa295d5c8d5089e$var$zen_render($3aa295d5c8d5089e$var$zen_parse(this.cmd(\"buffer_substring\", start, point).trim(), 0), (...args)=>html += args.join(\"\"));\n        } catch (ex) {\n            throw new (0, $541ef653595620bf$export$c411e7bd03572a3a)(\"The Zen is not strong today :-/\");\n        }\n        this.cmd(\"delete_region\", start, point);\n        this.cmd(\"insert\", html);\n        start = this.createMarker(start, false, \"xml_zen\");\n        // locate points of interest\n        var end = this.createMarker(this.point(), true, \"xml_zen\"), markers = [];\n        this.cmd(\"goto_char\", start.getPosition());\n        while(this.cmd(\"search_forward\", \"|\", end.getPosition())){\n            this.cmd(\"backward_delete_char\");\n            markers.push(this.createMarker(this.point(), true, \"xml_zen_start\"));\n            markers.push(this.createMarker(this.point(), false, \"xml_zen_end\"));\n        }\n        this.cmd(\"indent_region\", start.getPosition(), end.getPosition());\n        var count = markers.length;\n        if (count > 0) {\n            // move to first POI\n            this.cmd(\"goto_char\", markers[0]);\n            markers.unshift(start);\n            markers.push(end);\n            this.setq(\"xml_zen_markers\", markers);\n            this.pushKeymap($3aa295d5c8d5089e$var$Ymacs_Keymap_XML_Zen);\n            this.addEventListener(\"afterInteractiveCommand\", $3aa295d5c8d5089e$var$maybe_stop_zen);\n        } else {\n            start.destroy();\n            end.destroy();\n        }\n    }),\n    xml_zen_stop: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        var tmp = this.getq(\"xml_zen_markers\");\n        if (tmp) {\n            tmp.map((m)=>m.destroy());\n            this.setq(\"xml_zen_markers\", null);\n        }\n        this.popKeymap($3aa295d5c8d5089e$var$Ymacs_Keymap_XML_Zen);\n        this.removeEventListener(\"afterInteractiveCommand\", $3aa295d5c8d5089e$var$maybe_stop_zen);\n    }),\n    xml_zen_next_poi: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let markers = this.getq(\"xml_zen_markers\"), pos = this.point();\n        for(let i = 0; i < markers.length; ++i){\n            let m = markers[i];\n            if (m.getPosition() > pos) {\n                this.cmd(\"goto_char\", m.getPosition());\n                break;\n            }\n        }\n    }),\n    xml_zen_prev_poi: (0, $92bab0a532b3076f$export$1c2a1b3d78098030)(function() {\n        let markers = this.getq(\"xml_zen_markers\"), pos = this.point();\n        for(let i = markers.length; --i >= 0;){\n            let m = markers[i];\n            if (m.getPosition() < pos) {\n                this.cmd(\"goto_char\", m.getPosition());\n                break;\n            }\n        }\n    })\n});\n\n\n\n\n\n\n\n\nexport {$2f9db344d0795d0e$export$e2cc12c8ba83ca65 as Ymacs, $5e779a545e33325b$export$df331bdfc76955b4 as Ymacs_Buffer, $d9a61832b63ddf79$export$6b6e17e3540cb3d2 as Ymacs_Keymap, $2a60837ab2b03436$export$e144e07a20daa9d as Ymacs_Keymap_Emacs, $c749180882ef16eb$export$3964ae1c660db960 as Ymacs_Tokenizer, $92bab0a532b3076f$export$1c2a1b3d78098030 as Ymacs_Interactive, $541ef653595620bf$export$c411e7bd03572a3a as Ymacs_Exception, $cd9400013ca46db2$export$b112841041e97d65 as Ymacs_Lang_Lisp};\n//# sourceMappingURL=ymacs.mjs.map\n","import { Ymacs } from \"./js/ymacs.js\";\r\nimport { Ymacs_Buffer } from \"./js/ymacs-buffer.js\";\r\nimport { Ymacs_Keymap } from \"./js/ymacs-keymap.js\";\r\nimport { Ymacs_Keymap_Emacs } from \"./js/ymacs-keymap-emacs.js\";\r\nimport { Ymacs_Tokenizer } from \"./js/ymacs-tokenizer.js\";\r\nimport { Ymacs_Interactive } from \"./js/ymacs-interactive.js\";\r\nimport { Ymacs_Exception } from \"./js/ymacs-exception.js\";\r\n\r\nimport \"./js/ymacs-commands.js\";\r\nimport \"./js/ymacs-commands-utils.js\";\r\nimport \"./js/ymacs-frame.js\";\r\nimport \"./js/ymacs-isearch.js\";\r\nimport \"./js/ymacs-marker.js\";\r\nimport \"./js/ymacs-minibuffer.js\";\r\nimport \"./js/ymacs-mode-css.js\";\r\nimport \"./js/ymacs-mode-js.js\";\r\nexport * from \"./js/ymacs-mode-lisp.js\";\r\nimport \"./js/ymacs-mode-markdown.js\";\r\nimport \"./js/ymacs-mode-paren-match.js\";\r\nimport \"./js/ymacs-mode-xml.js\";\r\nimport \"./js/ymacs-popup.js\";\r\nimport \"./js/ymacs-textprop.js\";\r\nimport \"./js/ymacs-baselang.js\";\r\nimport \"./js/ymacs-utils.js\";\r\n\r\nexport { Ymacs, Ymacs_Buffer, Ymacs_Keymap,\r\n         Ymacs_Keymap_Emacs, Ymacs_Tokenizer,\r\n         Ymacs_Interactive, Ymacs_Exception };\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { DOM, Widget, remove } from \"./ymacs-utils.js\";\r\nimport { Ymacs_Buffer, Ymacs_Minibuffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Popup } from \"./ymacs-popup.js\";\r\nimport { Ymacs_Frame, Ymacs_SplitCont } from \"./ymacs-frame.js\";\r\nimport { Ymacs_Exception } from \"./ymacs-exception.js\";\r\n\r\nfunction minElement(array, f, obj, remove) {\r\n    if (array.length == 0)\r\n        return null;\r\n    var i = 0, minEl = array[0], minValue = f.call(obj, minEl), minIndex = 0, tmp;\r\n    while (++i < array.length) if ((tmp = f.call(obj, array[i])) < minValue) {\r\n        minValue = tmp;\r\n        minIndex = i;\r\n        minEl = array[i];\r\n    }\r\n    if (remove)\r\n        array.splice(minIndex, 1);\r\n    return minEl;\r\n}\r\n\r\nfunction selectClosestFrameX(byx, pos) {\r\n    if (byx.length > 0) {\r\n        var x = byx.at(-1).getBox().left, a = [ byx.pop() ];\r\n        while (byx.length > 0 && byx.at(-1).getBox().left == x)\r\n            a.push(byx.pop());\r\n        return minElement(a, function(f){\r\n            return Math.abs(pos.top - f.getBox().top - f.getBox().height/2);\r\n        });\r\n    }\r\n}\r\n\r\nfunction selectClosestFrameY(byy, pos) {\r\n    if (byy.length > 0) {\r\n        var y = byy.at(-1).getBox().top, a = [ byy.pop() ];\r\n        while (byy.length > 0 && byy.at(-1).getBox().top == y)\r\n            a.push(byy.pop());\r\n        return minElement(a, function(f){\r\n            return Math.abs(pos.left - f.getBox().left - f.getBox().width/2);\r\n        });\r\n    }\r\n}\r\n\r\nexport class Ymacs extends Widget {\r\n\r\n    static options = {\r\n        buffers       : [],\r\n        frames        : [],\r\n        cf_frameStyle : Object.create(null),\r\n        ls_keyName    : \".ymacs\",\r\n    };\r\n\r\n    constructor(...args) {\r\n        super(...args);\r\n\r\n        this.buffers = [...this.o.buffers];\r\n        this.frames = [...this.o.frames];\r\n        this.registers = Object.create(null);\r\n        this.cf_frameStyle = {...this.o.cf_frameStyle};\r\n\r\n        this.buffers.forEach(b => {\r\n            b.ymacs = this;\r\n            this._addBufferListeners(b);\r\n        });\r\n\r\n        /* -----[ variables ]----- */\r\n        this.killRing = [];\r\n        this.killMasterOfRings = [];\r\n\r\n        /* -----[ macro vars ]----- */\r\n        // If present, keystrokes are stored in this list.\r\n        this.__macro_recording = null;\r\n        // This is the macro executed by C-x e and named by\r\n        // name-last-kbd-macro.\r\n        this.__macro_finished = null;\r\n        // Set when any buffer does signalError.  Tells us when to abort\r\n        // running a macro.\r\n        this.__error_thrown = false;\r\n        // A list if we're executing a macro.\r\n        this.__running_macro = null;\r\n        // A number of times to execute the current macro.\r\n        this.__macro_times = 0;\r\n        // Macro current step\r\n        this.__macro_step = 0;\r\n        // Timer for the macro\r\n        this.__macro_timer = null;\r\n        // Unbiased active frame\r\n        this.__input_frame = null;\r\n\r\n        /* -----[ minibuffer ]----- */\r\n        this.minibuffer = new Ymacs_Minibuffer({ ymacs: this });\r\n        this.minibuffer.cmd(\"minibuffer_mode\");\r\n        this.minibuffer_frame = this.createFrame({\r\n            isMinibuffer : true,\r\n            buffer       : this.minibuffer,\r\n            hidden       : true,\r\n        });\r\n\r\n        /* -----[ main content ]----- */\r\n        if (this.buffers.length == 0)\r\n            this.createBuffer();\r\n\r\n        var frame = this.createFrame({ buffer: this.buffers[0] });\r\n\r\n        this.add(frame);\r\n        this.add(this.minibuffer_frame);\r\n\r\n        this.setActiveFrame(frame);\r\n        frame.redrawCaret();\r\n    }\r\n\r\n    initClassName() {\r\n        return \"Ymacs Ymacs-cursor-block\";\r\n    }\r\n\r\n    _addBufferListeners(buf) {\r\n        buf.addEventListener(\"onDestroy\", () => {\r\n            var fr = this.getActiveFrame();\r\n            this.getBufferFrames(buf).forEach(f => {\r\n                if (f !== fr) {\r\n                    this.deleteFrame(f);\r\n                }\r\n            });\r\n            remove(this.buffers, buf);\r\n            if (this.getActiveBuffer() === buf)\r\n                this.nextHiddenBuffer(buf);\r\n        });\r\n    }\r\n\r\n    pushToKillRing(text, prepend) {\r\n        prepend ? this.killRing.unshift(text)\r\n            : this.killRing.push(text);\r\n    }\r\n\r\n    killRingToMaster() {\r\n        if (this.killRing.length && (this.killMasterOfRings.length == 0 ||\r\n                                     this.killMasterOfRings.at(-1).join(\"\") != this.killRing.join(\"\")))\r\n            this.killMasterOfRings.push(this.killRing);\r\n        this.killRing = [];\r\n    }\r\n\r\n    killRingText() {\r\n        return this.killRing.join(\"\");\r\n    }\r\n\r\n    rotateKillRing(push) {\r\n        if (push) {\r\n            this.killMasterOfRings.push(this.killRing);\r\n            this.killRing = this.killMasterOfRings.shift();\r\n        } else {\r\n            this.killMasterOfRings.unshift(this.killRing);\r\n            this.killRing = this.killMasterOfRings.pop();\r\n        }\r\n    }\r\n\r\n    getBuffer(buf) {\r\n        if (!(buf instanceof Ymacs_Buffer)) {\r\n            buf = this.buffers.find(b => b.name == buf);\r\n        }\r\n        return buf;\r\n    }\r\n\r\n    killBuffer(buf) {\r\n        buf = this.getBuffer(buf);\r\n        this.callHooks(\"onDeleteBuffer\", buf);\r\n        buf.destroy();\r\n    }\r\n\r\n    renameBuffer(buf, name) {\r\n        buf = this.getBuffer(buf);\r\n        buf.name = name;\r\n        buf.callHooks(\"onModelineChange\");\r\n    }\r\n\r\n    _do_switchToBuffer(buf) {\r\n        this.getActiveFrame().setBuffer(buf);\r\n        this.callHooks(\"onBufferSwitch\", buf);\r\n    }\r\n\r\n    switchToBuffer(maybeName) {\r\n        var buf = this.getBuffer(maybeName), a = this.buffers;\r\n        if (!buf) {\r\n            // create new buffer\r\n            buf = this.createBuffer({ name: maybeName });\r\n        }\r\n        remove(a, buf);\r\n        a.unshift(buf);\r\n        this._do_switchToBuffer(buf);\r\n        return buf;\r\n    }\r\n\r\n    nextHiddenBuffer(cur) {\r\n        var a = this.buffers.filter(buf => {\r\n            if (buf === cur) return false;\r\n            var hidden = true;\r\n            buf.forAllFrames(() => hidden = false);\r\n            return hidden;\r\n        });\r\n        if (a.length > 0) {\r\n            var buf = a[0];\r\n            remove(this.buffers, buf);\r\n            this.buffers.push(buf);\r\n            this._do_switchToBuffer(buf);\r\n        } else {\r\n            this.switchToBuffer(\"*scratch*\");\r\n        }\r\n    }\r\n\r\n    switchToNextBuffer() {\r\n        var a = this.buffers;\r\n        if (a.length > 1) {\r\n            var buf = a.shift();\r\n            a.push(buf);\r\n            this._do_switchToBuffer(a[0]);\r\n        }\r\n    }\r\n\r\n    switchToPreviousBuffer() {\r\n        var a = this.buffers;\r\n        if (a.length > 1) {\r\n            var buf = a.pop();\r\n            a.unshift(buf);\r\n            this._do_switchToBuffer(buf);\r\n        }\r\n    }\r\n\r\n    getNextBuffer(buf, n) {\r\n        if (n == null) n = 1;\r\n        var a = this.buffers;\r\n        return a[(a.indexOf(buf) + n) % a.length];\r\n    }\r\n\r\n    getPrevBuffer(buf, n) {\r\n        if (n == null) n = 1;\r\n        return this.getNextBuffer(buf, -n);\r\n    }\r\n\r\n    getBufferFrames(buf) {\r\n        buf = this.getBuffer(buf);\r\n        return this.frames.filter(f => f.buffer === buf);\r\n    }\r\n\r\n    createBuffer(args = {}) {\r\n        var buf = new Ymacs_Buffer({ ...args, ymacs: this });\r\n        this._addBufferListeners(buf);\r\n        if (!args.hidden)\r\n            this.buffers.push(buf);\r\n        this.callHooks(\"onCreateBuffer\", buf);\r\n        return buf;\r\n    }\r\n\r\n    createFrame(args = {}) {\r\n        var frame = new Ymacs_Frame({ ...args, ymacs: this });\r\n        if (!args.hidden)\r\n            this.frames.unshift(frame);\r\n        frame.setStyle(this.cf_frameStyle);\r\n        return frame;\r\n    }\r\n\r\n    setFrameStyle(style) {\r\n        [ this.minibuffer_frame, ...this.frames ].forEach(frame => frame.setStyle(style));\r\n    }\r\n\r\n    keepOnlyFrame(frame) {\r\n        if (this.frames.length > 1) {\r\n            let el = frame.getElement();\r\n            while (el.parentNode != this.getContentElement())\r\n                el = el.parentNode;\r\n            if (el !== frame) {\r\n                el.replaceWith(frame.getElement());\r\n                this.setActiveFrame(frame);\r\n                frame.centerOnCaret();\r\n                this.frames = [ frame ];\r\n            }\r\n        }\r\n    }\r\n\r\n    deleteFrame(frame) {\r\n        if (this.frames.length > 1) {\r\n            remove(this.frames, frame);\r\n            let parent = frame.getElement().parentNode;\r\n            let other = [...parent.children].find(el => {\r\n                let obj = el._ymacs_object;\r\n                return obj instanceof Ymacs_SplitCont\r\n                    || (obj instanceof Ymacs_Frame && obj !== frame);\r\n            });\r\n            parent.replaceWith(other);\r\n            if (!DOM.hasClass(other, \"Ymacs_Frame\")) {\r\n                other = other.querySelector(\".Ymacs_Frame\");\r\n            }\r\n            other = other._ymacs_object;\r\n            this.setActiveFrame(other);\r\n            other.centerOnCaret();\r\n        }\r\n    }\r\n\r\n    focusOtherFrame() {\r\n        this.setActiveFrame(this.frames[0]);\r\n    }\r\n\r\n    getMainElement() {\r\n        const selector = `:scope > .Ymacs_Frame:not(.Ymacs_Minibuffer), :scope > .Ymacs_SplitCont`;\r\n        return this.getElement().querySelector(selector);\r\n    }\r\n\r\n    getFrameConfig() {\r\n        let dig = (el) => {\r\n            if (DOM.hasClass(el, \"Ymacs_Frame\")) {\r\n                let frame = el._ymacs_object;\r\n                let div = frame.getOverlaysContainer();\r\n                return {\r\n                    buffer: frame.buffer.name,\r\n                    point: +frame.caretMarker,\r\n                    scroll: div.scrollTop / div.scrollHeight,\r\n                    active: frame === this.getActiveFrame(),\r\n                };\r\n            } else {\r\n                let layout = el._ymacs_object;\r\n                let horiz = layout.o.horiz;\r\n                let style = window.getComputedStyle(el);\r\n                let rx = /^\\s*(\\d*(?:\\.\\d+)?)px\\s+(?:\\d*(?:\\.\\d+)?)px\\s+(\\d*(?:\\.\\d+)?)px\\s*$/;\r\n                let m = rx.exec(horiz ? style.gridTemplateRows : style.gridTemplateColumns);\r\n                let frac = +m[1] / (+m[1] + +m[2]);\r\n                return [ horiz, frac, dig(el.children[0]), dig(el.children[2]) ];\r\n            }\r\n        };\r\n        return dig(this.getMainElement());\r\n    }\r\n\r\n    setFrameConfig(config) {\r\n        this.getMainElement()?.remove();\r\n\r\n        // 1. figure out if we already have some frames for the set of\r\n        // buffers that we'll need to switch to.\r\n        let buffers = [];\r\n        let frames = [ ...this.frames ];\r\n        (function dig(el){\r\n            if (Array.isArray(el)) {\r\n                dig(el[2]);\r\n                dig(el[3]);\r\n            } else {\r\n                for (let i = frames.length; --i >= 0;) {\r\n                    if (frames[i].buffer?.name == el.buffer) {\r\n                        buffers.push([ el.buffer, frames[i] ]);\r\n                        frames.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        })(config);\r\n\r\n        let getBuffer = bufferName => {\r\n            return this.getBuffer(bufferName) || this.createBuffer({ name: bufferName });\r\n        };\r\n\r\n        // this will return a frame associated with the given buffer.\r\n        let getFrame = (bufferName, point) => {\r\n            let i = buffers.findIndex(([ buf ]) => buf == bufferName);\r\n            if (i < 0) {\r\n                // if we don't have an associated frame...\r\n                if (frames.length > 0) {\r\n                    // there's still one to spare\r\n                    let fr = frames.pop();\r\n                    fr.setBuffer(getBuffer(bufferName, point));\r\n                    return fr;\r\n                } else {\r\n                    // otherwise, create new frame.\r\n                    return this.createFrame({ buffer: getBuffer(bufferName), point: point });\r\n                }\r\n            } else {\r\n                // found associated frame; remove it from the list.\r\n                let fr = buffers[i][1];\r\n                buffers.splice(i, 1);\r\n                return fr;\r\n            }\r\n        };\r\n\r\n        // 2. dig it again, this time creating widgets.\r\n        let ops = [];\r\n        let active = null;\r\n        let main = (function dig(el){\r\n            if (Array.isArray(el)) {\r\n                let split = new Ymacs_SplitCont({ horiz: el[0] });\r\n                let frame1 = dig(el[2]);\r\n                let frame2 = dig(el[3]);\r\n                ops.push(() => split.setSplit(frame1, frame2, el[1]));\r\n                return split;\r\n            } else {\r\n                let frame = getFrame(el.buffer, el.point);\r\n                if (el.active) active = frame;\r\n                ops.push(() => {\r\n                    let div = frame.getOverlaysContainer();\r\n                    div.scrollTop = el.scroll * div.scrollHeight;\r\n                });\r\n                return frame;\r\n            }\r\n        })(config);\r\n\r\n        // at this point, if we still have any frames left (e.g. the\r\n        // editor had more frames than required by the new config),\r\n        // remove/destroy them.\r\n        frames.forEach(fr => {\r\n            remove(this.frames, fr);\r\n            fr.destroy();\r\n        });\r\n\r\n        let cont = this.getElement();\r\n        cont.insertBefore(main.getElement(), cont.firstElementChild);\r\n\r\n        // ops will contain operations to do after the elements are in\r\n        // the DOM.\r\n        ops.reverse().forEach(f => f());\r\n\r\n        // done, reset active frame.\r\n        this.setActiveFrame(active || this.frames[0]);\r\n    }\r\n\r\n    focus() {\r\n        this.frames.at(-1).focus();\r\n    }\r\n\r\n    setInputFrame(frame) {\r\n        this.__input_frame = frame;\r\n    }\r\n\r\n    setActiveFrame(frame, nofocus) {\r\n        if (!frame.isMinibuffer) {\r\n            var old = this.getActiveFrame();\r\n            if (old) {\r\n                old.delClass(\"Ymacs_Frame-active\");\r\n            }\r\n            remove(this.frames, frame);\r\n            this.frames.push(frame);\r\n            frame.addClass(\"Ymacs_Frame-active\");\r\n        }\r\n        this.__input_frame = frame;\r\n        if (!nofocus)\r\n            frame.focus();\r\n    }\r\n\r\n    getActiveFrame() {\r\n        return this.frames.at(-1);\r\n    }\r\n\r\n    getActiveBuffer() {\r\n        var frame = this.getActiveFrame();\r\n        return frame ? frame.buffer : this.buffers.at(-1);\r\n    }\r\n\r\n    setColorTheme(themeId) {\r\n        this.delClass(/Ymacs-Theme-[^\\s]*/g);\r\n        if (!(themeId instanceof Array))\r\n            themeId = [ themeId ];\r\n        themeId.forEach(themeId => {\r\n            this.addClass(\"Ymacs-Theme-\" + themeId);\r\n        });\r\n    }\r\n\r\n    cursorBar() {\r\n        this.delClass(\"Ymacs-cursor-block\");\r\n        this.addClass(\"Ymacs-cursor-bar\");\r\n    }\r\n    cursorBlock() {\r\n        this.delClass(\"Ymacs-cursor-bar\");\r\n        this.addClass(\"Ymacs-cursor-block\");\r\n    }\r\n    toggleBarCursor() {\r\n        if (this.hasClass(\"Ymacs-cursor-block\")) {\r\n            this.cursorBar();\r\n        } else {\r\n            this.cursorBlock();\r\n        }\r\n    }\r\n\r\n    getFrameInDirection(dir) {\r\n        let frame = this.getActiveFrame();\r\n        let caret = frame.getCaretElement();\r\n        let box = caret.getBoundingClientRect();\r\n        var byx = [...this.frames].sort((a, b) => a.getBox().left - b.getBox().left);\r\n        var byy = [...this.frames].sort((a, b) => a.getBox().top - b.getBox().top);\r\n        switch (dir) {\r\n          case \"left\":\r\n            return this._get_frameInDir_left(byx, byy, box, frame);\r\n          case \"right\":\r\n            return this._get_frameInDir_right(byx, byy, box, frame);\r\n          case \"up\":\r\n            return this._get_frameInDir_up(byx, byy, box, frame);\r\n          case \"down\":\r\n            return this._get_frameInDir_down(byx, byy, box, frame);\r\n        }\r\n        return this[\"_get_frameInDir_\" + dir](byx, byy, box, frame);\r\n    }\r\n\r\n    _get_frameInDir_left(byx, byy, pos, frame) {\r\n        byx = byx.filter(f => {\r\n            let p = f.getBox();\r\n            return (f !== frame) && (p.left < pos.left) && (p.top - pos.height <= pos.top) && (p.top + p.height > pos.top);\r\n        });\r\n        return selectClosestFrameX(byx, pos);\r\n    }\r\n\r\n    _get_frameInDir_right(byx, byy, pos, frame) {\r\n        byx.reverse();\r\n        byx = byx.filter(f => {\r\n            let p = f.getBox();\r\n            return (f !== frame) && (p.left > pos.left) && (p.top - pos.height <= pos.top) && (p.top + p.height > pos.top);\r\n        });\r\n        return selectClosestFrameX(byx, pos);\r\n    }\r\n\r\n    _get_frameInDir_up(byx, byy, pos, frame) {\r\n        byy = byy.filter(f => {\r\n            let p = f.getBox();\r\n            return (f !== frame) && (p.top < pos.top) && (p.left - pos.width <= pos.left) && (p.left + p.width > pos.left);\r\n        });\r\n        return selectClosestFrameY(byy, pos);\r\n    }\r\n\r\n    _get_frameInDir_down(byx, byy, pos, frame) {\r\n        byy.reverse();\r\n        byy = byy.filter(f => {\r\n            let p = f.getBox();\r\n            return (f !== frame) && (p.top > pos.top) && (p.left - pos.width <= pos.left) && (p.left + p.width > pos.left);\r\n        });\r\n        return selectClosestFrameY(byy, pos);\r\n    }\r\n\r\n    /* -----[ local storage ]----- */\r\n\r\n    ls_get() {\r\n        return this.ls_store || (\r\n            this.ls_store = JSON.parse(localStorage.getItem(this.o.ls_keyName) || \"{}\")\r\n        );\r\n    }\r\n\r\n    ls_set(src) {\r\n        this.ls_store = src;\r\n        localStorage.setItem(this.o.ls_keyName, JSON.stringify(src));\r\n    }\r\n\r\n    ls_getFileContents(name, nothrow) {\r\n        var info = this.ls_getFileDirectory(name), other = info.other, code;\r\n        if (other.length == 1) {\r\n            code = info.dir[other[0]];\r\n        }\r\n        if (code == null && !nothrow) {\r\n            throw new Ymacs_Exception(\"File not found\");\r\n        }\r\n        return code;\r\n    }\r\n\r\n    ls_setFileContents(name, content) {\r\n        var files = this.ls_getFileDirectory(name, \"file\");\r\n        files.dir[files.other[0]] = content;\r\n        this.ls_set(files.store);\r\n    }\r\n\r\n    ls_getFileDirectory(name, create) {\r\n        var store, dir = store = this.ls_get(), back = [];\r\n        name = name.replace(/^[~\\x2f]+/, \"\").split(/\\x2f+/);\r\n        var path = [], other = [];\r\n        while (name.length > 0) {\r\n            var part = name.shift();\r\n            if (part == \".\") continue;\r\n            if (part == \"..\") {\r\n                path.pop();\r\n                dir = back.pop();\r\n            }\r\n            else if (part == \"~\") {\r\n                path = [];\r\n                other = [];\r\n                back = [];\r\n                dir = store;\r\n            }\r\n            else if (Object.hasOwn(dir, part) && (typeof dir[part] != \"string\")) {\r\n                back.push(dir);\r\n                dir = dir[part];\r\n                path.push(part);\r\n            }\r\n            else {\r\n                other.push(part);\r\n            }\r\n        }\r\n        if (create) {\r\n            var n = create == \"file\" ? 1 : 0;\r\n            while (other.length > n) {\r\n                dir = dir[other.shift()] = {};\r\n            }\r\n            this.ls_set(store);\r\n        }\r\n        return {\r\n            store : store,\r\n            dir   : dir,\r\n            path  : path,\r\n            other : other,\r\n            full  : path.concat(other).join(\"/\")\r\n        };\r\n    }\r\n\r\n    ls_deleteFile(name) {\r\n        var info = this.ls_getFileDirectory(name);\r\n        delete info.dir[info.other.join(\"/\")];\r\n        this.ls_set(info.store);\r\n    }\r\n\r\n    /* -----[ filesystem operations ]----- */\r\n\r\n    fs_normalizePath(path) {\r\n        path = path.replace(/^[~\\x2f]+/, \"\").split(/\\x2f+/);\r\n        var ret = [];\r\n        while (path.length > 0) {\r\n            var x = path.shift();\r\n            if (x != \".\") {\r\n                if (x == \"..\") {\r\n                    ret.pop();\r\n                } else if (x == \"~\") {\r\n                    ret = [];\r\n                } else {\r\n                    ret.push(x);\r\n                }\r\n            }\r\n        }\r\n        return ret.join(\"/\");\r\n    }\r\n\r\n    fs_fileType(name, cont) {\r\n        let { other, dir } = this.ls_getFileDirectory(name);\r\n        if (other.length > 0) {\r\n            return cont(!other[0] ? \"directory\"\r\n                        : typeof dir[other[0]] == \"string\" ? \"file\"\r\n                        : \"new\");\r\n        } else {\r\n            return cont(\"directory\");\r\n        }\r\n    }\r\n\r\n    fs_getFileContents(name, nothrow, cont) {\r\n        var code = this.ls_getFileContents(name, nothrow);\r\n        cont(code, code); // second parameter is file stamp, on a real fs it should be last modification time\r\n    }\r\n\r\n    fs_setFileContents(name, content, stamp, cont) {\r\n        if (stamp && (this.ls_getFileContents(name, true) || \"\") != stamp) {\r\n            cont(null); // did not change file because stamp is wrong\r\n        } else {\r\n            this.ls_setFileContents(name, content);\r\n            cont(content);\r\n        }\r\n    }\r\n\r\n    fs_sortDirectoryEntries(dir) {\r\n        return Object.keys(dir).sort((a, b) => {\r\n            a = a.toLowerCase();\r\n            b = b.toLowerCase();\r\n            let adir = typeof dir[a] != \"string\";\r\n            let bdir = typeof dir[b] != \"string\";\r\n            if (adir && !bdir) return -1;\r\n            if (bdir && !adir) return 1;\r\n            if (!adir && !bdir) {\r\n                let aobj = this.fs_isObjectFileName(a);\r\n                let bobj = this.fs_isObjectFileName(b);\r\n                if (aobj && !bobj) return 1;\r\n                if (bobj && !aobj) return -1;\r\n            }\r\n            return a < b ? -1 : a > b ? 1 : 0;\r\n        });\r\n    }\r\n\r\n    fs_isObjectFileName(filename) {\r\n        return /\\.fasl$/i.test(filename);\r\n    }\r\n\r\n    fs_getDirectory(dirname, cont) {\r\n        var info = this.ls_getFileDirectory(dirname, false);\r\n        dirname = info.path.join(\"/\"); // normalized\r\n        if (info) {\r\n            var files = {};\r\n            for (let f of this.fs_sortDirectoryEntries(info.dir)) {\r\n                files[f] = {\r\n                    name : f,\r\n                    path : dirname + \"/\" + f,\r\n                    type : typeof info.dir[f] == \"string\" ? \"file\" : \"directory\"\r\n                };\r\n            }\r\n            cont(files);\r\n        } else {\r\n            cont(null);\r\n        }\r\n    }\r\n\r\n    fs_deleteFile(name, cont) {\r\n        this.ls_deleteFile(name);\r\n        cont();\r\n    }\r\n\r\n    fs_remapDir(dir, cont) {\r\n        cont(dir);\r\n    }\r\n\r\n    isRunningMacro() {\r\n        return !!this.__running_macro;\r\n    }\r\n\r\n    isRecordingMacro() {\r\n        return !!this.__macro_recording;\r\n    }\r\n\r\n    indicateError() {\r\n        this.__error_thrown = true;\r\n    }\r\n\r\n    startMacro(do_append) {\r\n        if (this.isRecordingMacro())\r\n            return false;\r\n        if (do_append) {\r\n            this.__macro_recording = this.__macro_finished || [];\r\n            this.__macro_finished = null;\r\n        } else\r\n            this.__macro_recording = [];\r\n        return true;\r\n    }\r\n\r\n    stopMacro() {\r\n        if (this.__macro_recording) {\r\n            this.__macro_finished = this.__macro_recording;\r\n            this.__macro_recording = null;\r\n        }\r\n    }\r\n\r\n    getLastMacro() {\r\n        return this.__macro_finished;\r\n    }\r\n\r\n    stepMacro() {\r\n        while (true) {\r\n            if (this.__macro_step >= this.__running_macro.length) {\r\n                this.__macro_times--;\r\n                this.__macro_step = 0;\r\n            }\r\n            if (this.__macro_times == 0 || this.__error_thrown) {\r\n                this.__macro_times = 0;\r\n                this.__macro_step = 0;\r\n                this.__running_macro = null;\r\n                return;\r\n            }\r\n            var ev = this.__running_macro[this.__macro_step];\r\n            this.processKeyEvent(ev);\r\n            this.__macro_step++;\r\n        }\r\n    }\r\n\r\n    runMacro(times, macro) {\r\n        if (this.isRecordingMacro())\r\n            return false;\r\n        this.__error_thrown = false;\r\n        this.__running_macro = macro;\r\n        this.__macro_step = 0;\r\n        this.__macro_times = times;\r\n        var self = this;\r\n        setTimeout(function() { self.stepMacro(); }, 0);\r\n        return true;\r\n    }\r\n\r\n    processKeyEvent(ev) {\r\n        var frame = this.__input_frame;\r\n        var buffer = frame.buffer;\r\n\r\n        if (this.__macro_recording) {\r\n            this.__macro_recording.push(ev);\r\n        }\r\n        return buffer._handleKeyEvent(ev);\r\n    }\r\n\r\n    #timer_popupMessage = null;\r\n    popupMessage({\r\n        type = \"info\",\r\n        text,\r\n        isHtml = false,\r\n        atCaret = false,\r\n        timeout\r\n    }) {\r\n        let popup = this.__popup || (this.__popup = new Ymacs_Popup());\r\n        let el = popup.getElement();\r\n        popup.condClass(atCaret, \"with-arrow\");\r\n        if (!atCaret) {\r\n            el.style.removeProperty(\"left\");\r\n            el.style.removeProperty(\"top\");\r\n            el.style.removeProperty(\"bottom\");\r\n            el.style.removeProperty(\"right\");\r\n            el.style.removeProperty(\"transform\");\r\n        }\r\n        if (!isHtml) {\r\n            text = DOM.htmlEscape(text);\r\n        }\r\n        popup.setContent(text);\r\n        if (atCaret) {\r\n            this._popupAtCaret(popup.getElement());\r\n        } else {\r\n            this.add(popup);\r\n        }\r\n        clearTimeout(this.#timer_popupMessage);\r\n        if (timeout) {\r\n            this.#timer_popupMessage = setTimeout(this.clearPopupMessage.bind(this), timeout);\r\n        }\r\n    }\r\n\r\n    clearPopupMessage() {\r\n        if (this.__popup) {\r\n            this.__popup.getElement().remove();\r\n        }\r\n    }\r\n\r\n    requestFullScreen() {\r\n        return this.getElement().requestFullscreen();\r\n    }\r\n\r\n    _popupAtCaret(el) {\r\n        el.style.visibility = \"hidden\";\r\n        DOM.delClass(el, /ppos-[a-z-]+/ig);\r\n        this.add(el);\r\n        let mybox = this.getElement().getBoundingClientRect();\r\n        let caret = this.__input_frame.getCaretElement();\r\n        let cbox = caret.getBoundingClientRect();\r\n        let cbox_center = { x: (cbox.left + cbox.right) / 2,\r\n                            y: (cbox.top + cbox.bottom) / 2 };\r\n        let mybox_center = { x: (mybox.left + mybox.right) / 2,\r\n                             y: (mybox.top + mybox.bottom) / 2 };\r\n        if (cbox_center.y > mybox_center.y) {\r\n            if (cbox_center.x < mybox_center.x) {\r\n                DOM.addClass(el, \"ppos-top-right\");\r\n                el.style.transform = `translate(0, calc(-100% - ${cbox.height / 2}px))`;\r\n            } else {\r\n                DOM.addClass(el, \"ppos-top-left\");\r\n                el.style.transform = `translate(-100%, calc(-100% - ${cbox.height / 2}px))`;\r\n            }\r\n        } else {\r\n            if (cbox_center.x < mybox_center.x) {\r\n                DOM.addClass(el, \"ppos-bot-right\");\r\n                el.style.transform = `translate(0, ${cbox.height / 2}px)`;\r\n            } else {\r\n                DOM.addClass(el, \"ppos-bot-left\");\r\n                el.style.transform = `translate(-100%, ${cbox.height / 2}px)`;\r\n            }\r\n        }\r\n        el.style.left = (cbox_center.x - mybox.left) + \"px\";\r\n        el.style.top = (cbox_center.y - mybox.top) + \"px\";\r\n        el.style.removeProperty(\"visibility\");\r\n    }\r\n\r\n    jumpToRegister(reg) {\r\n        let value = this.registers[reg];\r\n        if (value == null) return false;\r\n        if (value.frames) {\r\n            this.setFrameConfig(value.frames);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    makeDialog(options) {\r\n        let dlg = new Ymacs_Dialog({ ...options, ymacs: this });\r\n        this.add(dlg);\r\n        return dlg;\r\n    }\r\n}\r\n\r\nfunction cssSize(prop) {\r\n    if (typeof prop == \"number\") {\r\n        if (prop <= 1 && prop > 0) prop = prop * 100 + \"%\";\r\n        else prop += \"px\";\r\n    }\r\n    return prop;\r\n}\r\n\r\nexport class Ymacs_Dialog extends Widget {\r\n    static options = {\r\n        draggable: false,\r\n        resizable: false,\r\n        closable: false,\r\n        content: null,\r\n        centered: false,\r\n        width: \"40%\",\r\n        height: \"50%\",\r\n        ymacs: null,\r\n    };\r\n\r\n    constructor(...args) {\r\n        super(...args);\r\n        this.ymacs = this.o.ymacs;\r\n\r\n        let cont = this.getElement();\r\n        let content = this.o.content;\r\n        if (typeof content == \"function\") {\r\n            content = content.call(this, cont, this);\r\n        }\r\n        if (content) {\r\n            cont.appendChild(content);\r\n        }\r\n        if (this.o.resizable) {\r\n            cont.style.resize = \"both\";\r\n        }\r\n        if (this.o.width) {\r\n            cont.style.width = cssSize(this.o.width);\r\n        }\r\n        if (this.o.height) {\r\n            cont.style.height = cssSize(this.o.height);\r\n        }\r\n        if (this.o.closable) {\r\n            if (this.o.closable === true) {\r\n                let el = DOM.fromHTML(`<div class=\"close-button\"></div>`);\r\n                cont.appendChild(el);\r\n                this.o.closable = el;\r\n            }\r\n            DOM.on(this.o.closable, {\r\n                mousedown: ev => ev.stopPropagation(),\r\n                click: this._closeClick.bind(this),\r\n            });\r\n        }\r\n        if (this.o.draggable) {\r\n            if (this.o.draggable === true) this.o.draggable = cont;\r\n            this._dragHandlers = {\r\n                mousemove : this._dragMouseMove.bind(this),\r\n                mouseup   : this._dragMouseUp.bind(this),\r\n            };\r\n            DOM.on(this.o.draggable, \"mousedown\", this._dragMouseDown.bind(this));\r\n        }\r\n    }\r\n\r\n    initClassName() {\r\n        let a = [ \"Ymacs_Dialog\" ];\r\n        if (this.o.centered) a.push(\"centered\");\r\n        return a.join(\" \");\r\n    }\r\n\r\n    close() {\r\n        this.getElement().remove();\r\n        this.destroy();\r\n        this.ymacs.focus();\r\n        this.callHooks(\"onClose\");\r\n    }\r\n\r\n    _closeClick(ev) {\r\n        ev.stopPropagation();\r\n        this.close();\r\n    }\r\n\r\n    _dragMouseDown(ev) {\r\n        ev.stopPropagation();\r\n        let cont = this.getElement();\r\n        this._dragging = {\r\n            orig: DOM.relPos(cont),\r\n            start: DOM.mousePos(ev, cont.offsetParent),\r\n            focus: document.activeElement,\r\n        };\r\n        DOM.on(window, this._dragHandlers);\r\n        DOM.overlayOn(\"Ymacs_Resize_move\");\r\n    }\r\n\r\n    _dragMouseMove(ev) {\r\n        let cont = this.getElement();\r\n        let mouse = DOM.mousePos(ev, cont.offsetParent);\r\n        let drg = this._dragging;\r\n        let dx = mouse.x - drg.start.x;\r\n        let dy = mouse.y - drg.start.y;\r\n        cont.style.removeProperty(\"bottom\");\r\n        cont.style.removeProperty(\"right\");\r\n        cont.style.left = drg.orig.x + dx + \"px\";\r\n        cont.style.top = drg.orig.y + dy + \"px\";\r\n    }\r\n\r\n    _dragMouseUp(ev) {\r\n        DOM.off(window, this._dragHandlers);\r\n        DOM.overlayOff();\r\n        this._dragging.focus?.focus();\r\n        this._dragging = null;\r\n    }\r\n}\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nlet TEMPLATE = document.createElement(\"template\");\r\nlet OVERLAY;\r\n\r\nclass Raw {\r\n    constructor(value) { this._value = value }\r\n    toString() { return this._value }\r\n    valueOf() { return this._value }\r\n}\r\n\r\nexport let DOM = new class {\r\n    fromHTML(html) {\r\n        TEMPLATE.innerHTML = html.trim();\r\n        let cont = TEMPLATE.content;\r\n        return cont.children.length > 1 ? cont : cont.children[0];\r\n    }\r\n    addClass(el, cls) {\r\n        el.classList.add(cls);\r\n    }\r\n    delClass(el, cls) {\r\n        if (cls instanceof RegExp) {\r\n            el.className = el.className.replace(cls, \"\");\r\n        } else {\r\n            el.classList.remove(cls);\r\n        }\r\n    }\r\n    hasClass(el, cls) {\r\n        return el.classList.contains(cls);\r\n    }\r\n    condClass(el, cond, clsTrue, clsFalse) {\r\n        el.classList.toggle(clsTrue, !!cond);\r\n        if (clsFalse) {\r\n            el.classList.toggle(clsFalse, !cond);\r\n        }\r\n    }\r\n    toggleClass(el, ...args) {\r\n        el.classList.toggle(...args);\r\n    }\r\n    trash(el) {\r\n        el && el.remove();\r\n    }\r\n    on(element, event, handler, options) {\r\n        if (typeof event == \"string\") {\r\n            element.addEventListener(event, handler, options || {});\r\n        } else {\r\n            Object.keys(event).forEach(ev => DOM.on(element, ev, event[ev], handler || {}));\r\n        }\r\n    }\r\n    off(element, event, handler, options) {\r\n        if (typeof event == \"string\") {\r\n            element.removeEventListener(event, handler, options || {});\r\n        } else {\r\n            Object.keys(event).forEach(ev => DOM.off(element, ev, event[ev], handler || {}));\r\n        }\r\n    }\r\n    overlayOn(cls) {\r\n        document.body.appendChild(OVERLAY);\r\n        if (cls) {\r\n            OVERLAY.className = cls;\r\n        }\r\n        return OVERLAY;\r\n    }\r\n    overlayOff() {\r\n        OVERLAY.remove();\r\n    }\r\n    mousePos(ev, el) {\r\n        let box = el.getBoundingClientRect();\r\n        return {\r\n            x: ev.clientX - box.left,\r\n            y: ev.clientY - box.top\r\n        };\r\n    }\r\n    relPos(src, tgt = src.offsetParent) {\r\n        let srcbox = src.getBoundingClientRect();\r\n        let tgtbox = tgt.getBoundingClientRect();\r\n        return {\r\n            x: srcbox.left - tgtbox.left,\r\n            y: srcbox.top - tgtbox.top,\r\n        };\r\n    }\r\n    htmlEscape(str) {\r\n        return str instanceof Raw ? (str+\"\")\r\n            : (str+\"\").replace(/&/g, \"&amp;\")\r\n            .replace(/\\x22/g, \"&quot;\")\r\n            .replace(/\\x27/g, \"&#x27;\")\r\n            .replace(/</g, \"&lt;\")\r\n            .replace(/>/g, \"&gt;\")\r\n            .replace(/\\u00A0/g, \"&#xa0;\");\r\n    }\r\n    htmlSafe(str) {\r\n        return new Raw(str);\r\n    }\r\n};\r\n\r\nconst nextDone = { next: () => ({ done: true }) };\r\n\r\nexport const NIL = new class NIL {\r\n    car = null;\r\n    cdr = this;\r\n    toString() { return \"NIL\" }\r\n    valueOf() { return null }\r\n    [Symbol.iterator]() { return nextDone }\r\n    get length() { return 0 }\r\n};\r\n\r\nexport class Cons {\r\n    constructor(car, cdr = NIL) {\r\n        this.car = car;\r\n        this.cdr = cdr;\r\n    }\r\n    [Symbol.iterator]() {\r\n        let p = this;\r\n        return {\r\n            next() {\r\n                if (p === NIL) return { done: true };\r\n                let value = p.car;\r\n                p = p.cdr;\r\n                return { value };\r\n            }\r\n        };\r\n    }\r\n    get length() {\r\n        let p = this, count = 0;\r\n        while (p !== NIL) ++count, p = p.cdr;\r\n        return count;\r\n    }\r\n}\r\n\r\nOVERLAY = DOM.fromHTML(`<div style=\"position: fixed; z-index: 20000; left: 0; top: 0; right: 0; bottom: 0\"></div>`);\r\n\r\nexport class EventProxy {\r\n    constructor(options) {\r\n        this._ev_handlers = Object.create(null);\r\n        this.o = Object.assign(Object.create(this.constructor.options || null), options);\r\n    }\r\n    addEventListener(event, handler) {\r\n        if (typeof event == \"string\") {\r\n            let a = this._getHandlers(event);\r\n            remove(a, handler);\r\n            a.push(handler);\r\n        } else {\r\n            Object.keys(event).forEach(ev => this.addEventListener(ev, event[ev]));\r\n        }\r\n    }\r\n    removeEventListener(event, handler) {\r\n        if (typeof event == \"string\") {\r\n            remove(this._getHandlers(event), handler);\r\n        } else {\r\n            Object.keys(event).forEach(ev => this.removeEventListener(ev, event[ev]));\r\n        }\r\n    }\r\n    listenOnce(event, handler) {\r\n        this.addEventListener(event, function fn(...args) {\r\n            this.removeEventListener(event, fn);\r\n            return handler.apply(this, args);\r\n        });\r\n    }\r\n    callHooks(ev, ...args) {\r\n        this._getHandlers(ev).forEach(f => f.apply(this, args));\r\n    }\r\n    destroy() {\r\n        this.callHooks(\"onDestroy\");\r\n    }\r\n    _getHandlers(ev) {\r\n        return this._ev_handlers[ev] || (this._ev_handlers[ev] = []);\r\n    }\r\n}\r\n\r\nexport class Widget extends EventProxy {\r\n    constructor(...args) {\r\n        super(...args);\r\n        this.createElement();\r\n    }\r\n    createElement() {\r\n        let el = document.createElement(\"div\");\r\n        el.className = this.initClassName();\r\n        el._ymacs_object = this;\r\n        this.el = el;\r\n        return el;\r\n    }\r\n    initClassName() {\r\n        return this.constructor.name; // XXX: fail after minification\r\n    }\r\n    getContentElement() {\r\n        return this.el;\r\n    }\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n    add(thing) {\r\n        if (thing instanceof Widget) {\r\n            thing = thing.getElement();\r\n        }\r\n        this.getContentElement().appendChild(thing);\r\n    }\r\n    addClass(cls) {\r\n        DOM.addClass(this.getElement(), cls);\r\n    }\r\n    delClass(cls) {\r\n        DOM.delClass(this.getElement(), cls);\r\n    }\r\n    hasClass(cls) {\r\n        return DOM.hasClass(this.getElement(), cls);\r\n    }\r\n    condClass(cond, clsTrue, clsFalse) {\r\n        DOM.condClass(this.getElement(), cond, clsTrue, clsFalse);\r\n    }\r\n    toggleClass(...args) {\r\n        DOM.toggleClass(this.getElement(), ...args);\r\n    }\r\n    setContent(cont) {\r\n        this.getContentElement().innerHTML = cont;\r\n    }\r\n    setStyle(prop, val) {\r\n        let style = this.getElement().style;\r\n        if (typeof prop == \"string\") {\r\n            style[prop] = val;\r\n        } else {\r\n            Object.assign(style, prop);\r\n        }\r\n    }\r\n    getBox() {\r\n        return this.getElement().getBoundingClientRect();\r\n    }\r\n    destroy() {\r\n        DOM.trash(this.getElement());\r\n        super.destroy(...arguments);\r\n    }\r\n}\r\n\r\nexport function remove(array, element) {\r\n    let pos = 0;\r\n    while ((pos = array.indexOf(element, pos)) >= 0) {\r\n        array.splice(pos, 1);\r\n    }\r\n}\r\n\r\nexport function delayed(fn, timeout = 0, obj, ...args) {\r\n    if (arguments.length > 2) {\r\n        fn = fn.bind(obj, ...args);\r\n    }\r\n    let timer = null;\r\n    return function() {\r\n        clearTimeout(timer);\r\n        timer = setTimeout(fn, timeout);\r\n    };\r\n}\r\n\r\nvar $1K = 1024, $1M = $1K * 1024, $1G = $1M * 1024, $1T = $1G * 1024;\r\nexport function formatBytes(number, fixed) {\r\n    var sz = number, spec, r;\r\n    if (sz < $1K) {\r\n        spec = \"B\";\r\n    } else if (sz < $1M) {\r\n        sz /= $1K;\r\n        spec = \"K\";\r\n    } else if (sz < $1G) {\r\n        sz /= $1M;\r\n        spec = \"M\";\r\n    } else if (sz < $1T) {\r\n        sz /= $1G;\r\n        spec = \"G\";\r\n    }\r\n    // spec = \"\" + spec;\r\n    r = Math.round(sz);\r\n    if (fixed && sz != r)\r\n        return sz.toFixed(fixed) + spec;\r\n    else\r\n        return r + spec;\r\n}\r\n\r\nexport function zeroPad(thing, width, zero = \"0\") {\r\n    if (typeof thing == \"number\") {\r\n        thing = Math.round(thing);\r\n    }\r\n    var s = \"\" + thing;\r\n    while (s.length < width)\r\n        s = zero + s;\r\n    return s;\r\n}\r\n\r\nexport function qw(str) {\r\n    return str.trim().split(/\\s+/);\r\n}\r\n\r\nexport function toHash(str) {\r\n    return qw(str).reduce((a, key, i) => (a[key] = i + 1, a), Object.create(null));\r\n}\r\n\r\nexport function regexp_opt(x, mods) {\r\n    if (typeof x == \"string\") x = qw(x);\r\n    return new RegExp(\"^(\" + x.join(\"|\") + \")$\", mods);\r\n}\r\n\r\nexport function common_prefix(strings) {\r\n    switch (strings.length) {\r\n      case 0:\r\n        return \"\";\r\n      case 1:\r\n        return strings[0];\r\n      case 2:\r\n        let a = strings[0];\r\n        let b = strings[1];\r\n        let n = Math.min(a.length, b.length);\r\n        let i = 0;\r\n        while (i < n && a.charAt(i) === b.charAt(i)) ++i;\r\n        return a.substring(0, i);\r\n      default:\r\n        return common_prefix([ strings[0], common_prefix(strings.slice(1)) ]);\r\n    }\r\n}\r\n\r\nexport function getYmacsThemes() {\r\n    let themes = [];\r\n    for (let st of document.styleSheets) digStyle(st);\r\n    return themes;\r\n\r\n    function digStyle(st) {\r\n        for (let rule of st.cssRules) digRule(rule);\r\n    }\r\n\r\n    function digRule(rule) {\r\n        if (rule instanceof CSSImportRule) {\r\n            digStyle(rule.styleSheet);\r\n        } else {\r\n            let m = /\\.Ymacs-Theme-([\\p{L}0-9_-]+)/u.exec(rule.selectorText);\r\n            if (m) {\r\n                if (themes.indexOf(m[1]) < 0) {\r\n                    themes.push(m[1]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction fuzzy_regexp(query) {\r\n    return new RegExp([...query].map(ch => {\r\n        ch = ch.replace(/[\\]\\[\\}\\{\\)\\(\\*\\+\\?\\.\\\\\\^\\$\\|]/ug, \"\\\\$&\")\r\n            .replace(/[\\s_-]/ug, \"[\\\\s_-]\");\r\n        return `(${ch})(.*?)`;\r\n    }).join(\"\"), \"guid\");\r\n}\r\n\r\nexport function fuzzy_filter(candidates, query) {\r\n    query = query.trim();\r\n    if (!query) return candidates;\r\n    let query_rx = fuzzy_regexp(query);\r\n    let word_rx = /(?<![\\p{L}\\p{N}])/uy;\r\n    let results = [];\r\n    candidates.forEach(item => {\r\n        let label = typeof item == \"string\" ? item : item.label;\r\n        let value = typeof item == \"string\" ? item : item.value;\r\n        query_rx.lastIndex = 0;\r\n        while (true) {\r\n            let m = query_rx.exec(label);\r\n            if (!m) break;\r\n            let score = 0;\r\n            let hil = \"\";\r\n            let j = 0;\r\n            for (let i = 1; i < m.indices.length;) {\r\n                let [ li_beg, li_end ] = m.indices[i++];\r\n                let [ fi_beg, fi_end ] = m.indices[i++];\r\n                score += fi_end - fi_beg;\r\n                word_rx.lastIndex = li_beg;\r\n                if (word_rx.test(label)) score -= 2;\r\n                hil += DOM.htmlEscape(label.substring(j, li_beg))\r\n                    + `<b>${label.substring(li_beg, li_end)}</b>`;\r\n                j = li_end;\r\n            }\r\n            if (j != null) hil += DOM.htmlEscape(label.substr(j));\r\n            results.push({ label: DOM.htmlSafe(hil), value: value, score: score });\r\n            query_rx.lastIndex = m.index + 1;\r\n        }\r\n    });\r\n    return results.sort((a, b) => a.score - b.score).reduce((a, item) => {\r\n        if (!a.some(el => el.value == item.value)) a.push(item);\r\n        return a;\r\n    }, []);\r\n}\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Ymacs_Marker } from \"./ymacs-marker.js\";\r\nimport { DOM, EventProxy, remove, delayed, formatBytes } from \"./ymacs-utils.js\";\r\nimport { Ymacs_Keymap } from \"./ymacs-keymap.js\";\r\nimport { Ymacs_Keymap_Emacs, Ymacs_Keymap_Minibuffer } from \"./ymacs-keymap-emacs.js\";\r\nimport { Ymacs_Text_Properties } from \"./ymacs-textprop.js\";\r\nimport { Ymacs_Exception } from \"./ymacs-exception.js\";\r\nimport { Ymacs_Interactive } from \"./ymacs-interactive.js\";\r\n\r\nlet GLOBAL_VARS = {\r\n    case_fold_search            : null,\r\n    case_replace                : true,\r\n    line_movement_requested_col : 0,\r\n    fill_column                 : 78,\r\n    tab_width                   : 8,\r\n    indent_level                : 4,\r\n    sticky_mark                 : false,\r\n\r\n    // syntax variables\r\n    syntax_word                 : /^[\\p{N}\\p{L}]$/u,\r\n    syntax_capitalize_word      : /([\\p{N}\\p{L}])([\\p{N}\\p{L}]*)/ug,\r\n    syntax_word_dabbrev         : /^[\\p{N}_$\\p{L}]$/u,\r\n    syntax_word_sexp            : /^[\\p{N}_$\\p{L}]$/u,\r\n    syntax_paragraph_sep        : /\\n(?:[^\\S\\r\\n]*\\n)+/g,\r\n};\r\n\r\nconst MAX_UNDO_RECORDS = 50000; // XXX: should we not limit?\r\n\r\nfunction setq(key, val) {\r\n    if (typeof key == \"string\") {\r\n        if (val === undefined)\r\n            delete this[key];\r\n        else\r\n            this[key] = val;\r\n        if (val instanceof Function)\r\n            val.ymacsCommand = key;\r\n        return val;\r\n    } else {\r\n        var changed = Object.create(null);\r\n        for (var i in key) {\r\n            changed[i] = this[i];\r\n            setq.call(this, i, key[i]);\r\n        }\r\n        return changed;\r\n    }\r\n}\r\n\r\nfunction MRK(x) {\r\n    return x instanceof Ymacs_Marker ? x.getPosition() : x;\r\n}\r\n\r\nexport class Ymacs_Buffer extends EventProxy {\r\n\r\n    static options = {\r\n        name         : \"*scratch*\",\r\n        code         : \"\",\r\n        ymacs        : null,\r\n        tokenizer    : null,\r\n    };\r\n\r\n    static COMMANDS = Object.create(null);\r\n\r\n    static newCommands(...args) {\r\n        return setq.apply(this.COMMANDS, args);\r\n    }\r\n\r\n    static replaceCommands(cmds) {\r\n        this.COMMANDS = Object.assign(Object.create(null), this.COMMANDS);\r\n        let replacements = Object.create(null);\r\n        Object.keys(cmds).forEach(oldcmd => {\r\n            let newcmd = cmds[oldcmd];\r\n            if (typeof newcmd == \"string\") {\r\n                newcmd = this.COMMANDS[newcmd];\r\n            }\r\n            replacements[oldcmd] = newcmd;\r\n        });\r\n        return this.newCommands(replacements);\r\n    }\r\n\r\n    static newMode(name, activate) {\r\n        let modevar = \"*\" + name + \"*\", hookvar = modevar + \"hooks\";\r\n        Ymacs_Buffer.setGlobal(hookvar, []);\r\n        this.COMMANDS[name] = Ymacs_Interactive(\"P\", function(force){\r\n            let status = this.getq(modevar);\r\n            if (status) {\r\n                // currently active\r\n                if (force !== true) {\r\n                    // deactivate\r\n                    this.getq(hookvar).forEach(hook => hook.call(this, false));\r\n                    if (status instanceof Function) {\r\n                        // clean-up\r\n                        status.call(this);\r\n                    }\r\n                    this.setq(modevar, null);\r\n                    remove(this.modes, name);\r\n                }\r\n            }\r\n            else {\r\n                // inactive\r\n                if (force !== false) {\r\n                    let off = activate.apply(this, arguments);\r\n                    if (!(off instanceof Function))\r\n                        off = true;\r\n                    this.setq(modevar, off);\r\n                    this.modes.push(name);\r\n                    this.getq(hookvar).forEach(hook => hook.call(this, true));\r\n                }\r\n            }\r\n            return status;\r\n        });\r\n    }\r\n\r\n    static getVariable(key) {\r\n        return GLOBAL_VARS[key];\r\n    }\r\n\r\n    static setVariable() {\r\n        return setq.apply(GLOBAL_VARS, arguments);\r\n    }\r\n\r\n    constructor(...args) {\r\n        super(...args);\r\n\r\n        this.isMinibuffer = this instanceof Ymacs_Minibuffer;\r\n        this.COMMANDS = Object.assign(Object.create(null), this.COMMANDS);\r\n        this.name = this.o.name;\r\n        this.ymacs = this.o.ymacs;\r\n        this.tokenizer = this.o.tokenizer;\r\n\r\n        this.__savingExcursion = 0;\r\n        this.__preventUpdates = 0;\r\n        this.__preventUndo = 0;\r\n        this.__undoInProgress = 0;\r\n        this.__dirtyLines = [];\r\n        this.__undoQueue = [];\r\n        this.__undoPointer = 0;\r\n\r\n        this.markers = [];\r\n        this.caretMarker = this.createMarker(0, false, \"point\");\r\n        this.markMarker = this.createMarker(0, true, \"mark\");\r\n        this.matchData = [];\r\n        this.previousCommand = null;\r\n        this.currentCommand = null;\r\n        this.currentKeys = [];\r\n\r\n        this.variables = Object.create(null);\r\n        this.globalVariables = GLOBAL_VARS;\r\n        this.modes = [];\r\n\r\n        this.caretMarker.onChange.push(function(pos) {\r\n            this._rowcol = this.caretMarker.getRowCol();\r\n            // XXX: this shouldn't be needed\r\n            if (!this.__preventUpdates) {\r\n                this.callHooks(\"onPointChange\", this._rowcol, this.point());\r\n            }\r\n        });\r\n\r\n        this._tokenizerEvents = {\r\n            \"onFoundToken\": this._on_tokenizerFoundToken.bind(this)\r\n        };\r\n\r\n        this._textProperties = new Ymacs_Text_Properties({ buffer: this });\r\n        this._textProperties.addEventListener(\"onChange\", this._on_textPropertiesChange.bind(this));\r\n\r\n        this.keymap = [];\r\n        this.pushKeymap(this.makeDefaultKeymap());\r\n        this.setCode(this.o.code);\r\n        this._lastCommandWasKill = 0;\r\n    }\r\n\r\n    addModeHook(name, func) {\r\n        if (typeof func == \"string\")\r\n            func = this.COMMANDS[func];\r\n        let hookvar = \"*\" + name + \"*hooks\";\r\n        this.getq(hookvar).pushUnique(func);\r\n    }\r\n\r\n    removeModeHook(name, func) {\r\n        if (typeof func == \"string\")\r\n            func = this.COMMANDS[func];\r\n        let hookvar = \"*\" + name + \"*hooks\";\r\n        remove(this.getq(hookvar), func);\r\n    }\r\n\r\n    withVariables(vars, cont) {\r\n        var saved = this.variables;\r\n        this.variables = Object.assign(Object.create(this.variables), vars);\r\n        try {\r\n            if (cont instanceof Function) {\r\n                return cont.apply(this, [...arguments].slice(2));\r\n            } else {\r\n                return this.cmdApply(cont, [...arguments].slice(2));\r\n            }\r\n        } finally {\r\n            this.variables = saved;\r\n        }\r\n    }\r\n\r\n    withCommands(cmds, cont) {\r\n        var saved = this.COMMANDS;\r\n        this.COMMANDS = Object.assign(Object.create(this.COMMANDS), cmds);\r\n        try {\r\n            if (cont instanceof Function) {\r\n                return cont.apply(this, [...arguments].slice(2));\r\n            } else {\r\n                return this.cmdApply(cont, [...arguments].slice(2));\r\n            }\r\n        } finally {\r\n            this.COMMANDS = saved;\r\n        }\r\n    }\r\n\r\n    getVariable(name) {\r\n        return (name in this.variables)\r\n            ? this.variables[name]\r\n            : GLOBAL_VARS[name];\r\n    }\r\n\r\n    setVariable() {\r\n        return setq.apply(this.variables, arguments);\r\n    }\r\n\r\n    /* -----[ public API ]----- */\r\n\r\n    lastIndexOfRegexp(str, rx, caret, bound = 0) {\r\n        if (!rx.global) rx = new RegExp(rx.source, rx.flags + \"g\");\r\n        rx.lastIndex = bound;\r\n        let match;\r\n        while (true) {\r\n            let pos = rx.lastIndex;\r\n            let m = rx.exec(str);\r\n            if (!m || rx.lastIndex > caret) break;\r\n            match = m;\r\n            match.after = rx.lastIndex;\r\n            if (rx.lastIndex <= pos) {\r\n                // this can happer when rx matches the empty string in the middle of an unicode\r\n                // surrogate pair (which we don't properly support for now). the browser will rewind\r\n                // lastIndex to the proper start of the code point (:-o I'm impressed!), so let's\r\n                // skip it to avoid an endless loop.\r\n                let skipOne = /[^]/ug;\r\n                skipOne.lastIndex = rx.lastIndex;\r\n                skipOne.exec(str);\r\n                rx.lastIndex = skipOne.lastIndex;\r\n            }\r\n        }\r\n        if (match) {\r\n            return this.matchData = match;\r\n        }\r\n    }\r\n\r\n    pushKeymap(keymap) {\r\n        if (keymap instanceof Array) {\r\n            keymap.forEach(this.pushKeymap, this);\r\n        } else {\r\n            this.popKeymap(keymap);\r\n            this.keymap.push(keymap);\r\n            keymap.attached(this);\r\n        }\r\n    }\r\n\r\n    popKeymap(keymap) {\r\n        remove(this.keymap, keymap);\r\n        keymap.detached(this);\r\n    }\r\n\r\n    makeDefaultKeymap() {\r\n        return this.isMinibuffer ? Ymacs_Keymap_Minibuffer : Ymacs_Keymap_Emacs;\r\n    }\r\n\r\n    signalError(text, isHtml, timeout) {\r\n        // Terminates a running macro\r\n        this.ymacs.indicateError();\r\n        this.callHooks(\"onMessage\", { type: \"error\", text, isHtml, timeout });\r\n    }\r\n\r\n    signalInfo(text, isHtml, timeout) {\r\n        this.callHooks(\"onMessage\", { type: \"info\", text, isHtml, timeout });\r\n    }\r\n\r\n    popupMessage(args) {\r\n        this.callHooks(\"onMessage\", args);\r\n    }\r\n\r\n    createMarker(pos, before, name) {\r\n        if (pos == null)\r\n            pos = this.point();\r\n        return new Ymacs_Marker({ editor: this, pos: pos, name: name, before: before });\r\n    }\r\n\r\n    point() {\r\n        return this.caretMarker.getPosition();\r\n    }\r\n\r\n    dirty(dirty) {\r\n        if (dirty != null) {\r\n            this.__isDirty = dirty;\r\n            // XXX: what was this?\r\n            // this.__undoQueue.forEach(x => {\r\n            //     if (x.type !== 3) x.dirty = true;\r\n            // });\r\n            this.updateModeline();\r\n        }\r\n        return this.__isDirty;\r\n    }\r\n\r\n    setCode(code) {\r\n        // this.__code = code = code.replace(/\\t/g, \" \".repeat(this.getq(\"tab_width\")));\r\n        this.dirty(false);\r\n        this.__code = code;\r\n        this.__size = code.length;\r\n        this.__undoQueue = [];\r\n        this.__undoPointer = 0;\r\n        this.markers.map(m => m.setPosition(0, true, true));\r\n        this.code = code.split(/\\n/);\r\n        this._textProperties.reset();\r\n        if (this.tokenizer) {\r\n            this.tokenizer.reset();\r\n        }\r\n        this.callHooks(\"onResetCode\", this.code);\r\n        this.caretMarker.setPosition(0, false, true);\r\n        this.markMarker.setPosition(0, true);\r\n        this.forAllFrames(frame => {\r\n            frame.ensureCaretVisible();\r\n            frame.redrawModelineWithTimer();\r\n        });\r\n    }\r\n\r\n    setTokenizer(tok) {\r\n        if (this.tokenizer != null) {\r\n            this.tokenizer.removeEventListener(this._tokenizerEvents);\r\n        }\r\n        this.tokenizer = tok;\r\n        if (tok) {\r\n            tok.addEventListener(this._tokenizerEvents);\r\n            tok.reset();\r\n        } else {\r\n            this._textProperties.reset();\r\n            this.callHooks(\"onResetCode\", this.code);\r\n        }\r\n    }\r\n\r\n    getCode() {\r\n        return this.__code || (this.__code = this.code.join(\"\\n\"));\r\n    }\r\n\r\n    getCodeSize() {\r\n        if (this.__size)\r\n            return this.__size;\r\n        var i = this.code.length, size = i > 0 ? -1 : 0;\r\n        while (--i >= 0)\r\n            size += this.code[i].length + 1;\r\n        return this.__size = size;\r\n    }\r\n\r\n    getLine(row) {\r\n        if (row == null)\r\n            row = this._rowcol.row;\r\n        return this.code[row];\r\n    }\r\n\r\n    charAtRowCol(row, col) {\r\n        let n = this.code.length;\r\n        if (row >= n--) return null;\r\n        var line = this.code[row];\r\n        if (col == line.length)\r\n            return row == n ? null : \"\\n\";\r\n        return line.charAt(col);\r\n    }\r\n\r\n    charAt(point) {\r\n        if (point == null)\r\n            point = this.point();\r\n        else {\r\n            point = MRK(point);\r\n            if (point < 0)\r\n                point += this.point();\r\n        }\r\n        var rc = this._positionToRowCol(point);\r\n        return this.charAtRowCol(rc.row, rc.col);\r\n    }\r\n\r\n    callInteractively(func, args, finalArgs) {\r\n        if (!args) args = [];\r\n        var cmd;\r\n        if (!(func instanceof Function)) {\r\n            cmd = func;\r\n            func = this.COMMANDS[func];\r\n        } else {\r\n            cmd = func.ymacsCommand || null;\r\n        }\r\n        if (func.ymacsCallInteractively && !finalArgs) {\r\n            // after prompting for eventual\r\n            // arguments, ymacsCallInteractively\r\n            // will actually call back again\r\n            // buffer's callInteractively, so we\r\n            // should STOP here.\r\n            return func.ymacsCallInteractively.apply(this, args);\r\n        }\r\n        this.currentCommand = cmd;\r\n        if (this.previousCommand != cmd) {\r\n            this.sameCommandCount(0);\r\n            if (cmd != \"undo\") {\r\n                this._placeUndoBoundary();\r\n            }\r\n        } else if (cmd != \"self_insert_command\" || this.sameCommandCount() % 20 == 0) {\r\n            if (cmd != \"undo\") {\r\n                this._placeUndoBoundary();\r\n            }\r\n        }\r\n        this.preventUpdates();\r\n        try {\r\n            this.callHooks(\"beforeInteractiveCommand\", cmd, func);\r\n            if (!func.ymacsMarkExtend && !this.getq(\"sticky_mark\")) {\r\n                this.clearTransientMark();\r\n            }\r\n            return func.apply(this, args);\r\n        } catch(ex) {\r\n            if (ex instanceof Ymacs_Exception) {\r\n                this.signalError(ex.message);\r\n            } else {\r\n                throw ex;\r\n            }\r\n        } finally {\r\n            if (this.getq(\"sticky_mark\")) {\r\n                this.ensureTransientMark();\r\n            }\r\n            if (cmd != \"undo\") {\r\n                this.__undoPointer = this.__undoQueue.length;\r\n            }\r\n            this.resumeUpdates();\r\n            this.callHooks(\"afterInteractiveCommand\", cmd, func);\r\n            this.previousCommand = cmd;\r\n            this.sameCommandCount(+1);\r\n            if (this.tokenizer) {\r\n                this.tokenizer.start();\r\n            }\r\n        }\r\n    }\r\n\r\n    resetOverwriteMode(om) {\r\n        if (arguments.length == 0)\r\n            om = this.overwriteMode;\r\n        this.callHooks(\"onOverwriteMode\", this.overwriteMode = !om);\r\n        this.signalInfo(om ? \"Insert mode\" : \"Overwrite mode\");\r\n    }\r\n\r\n    getMinibuffer() {\r\n        return this.whenYmacs(function(ymacs) { return ymacs.minibuffer; });\r\n    }\r\n\r\n    getMinibufferFrame() {\r\n        return this.whenYmacs(function(ymacs) { return ymacs.minibuffer_frame; });\r\n    }\r\n\r\n    setMinibuffer(text) {\r\n        this.whenMinibuffer(function(mb){\r\n            mb.setCode(text);\r\n            mb.cmd(\"end_of_buffer\");\r\n        });\r\n    }\r\n\r\n    cmd(cmd, ...args) {\r\n        return this.COMMANDS[cmd].apply(this, args);\r\n    }\r\n\r\n    cmdApply(cmd, args) {\r\n        return this.COMMANDS[cmd].apply(this, args);\r\n    }\r\n\r\n    forEachLine(func, begin = this.markMarker(), end = this.point()) {\r\n        begin = MRK(begin);\r\n        end = MRK(end);\r\n        if (end < begin) { let tmp = begin; begin = end; end = tmp; }\r\n        begin = this._positionToRowCol(begin);\r\n        end = this._positionToRowCol(end);\r\n        for (let i = begin.row; i <= end.row; ++i) {\r\n            let c1 = i == begin.row ? begin.col : 0;\r\n            let c2 = i == end.row ? end.col : this.getLine(i).length;\r\n            func(i, c1, c2);\r\n        }\r\n    }\r\n\r\n    getActiveFrame() {\r\n        return this.whenYmacs(\"getActiveFrame\");\r\n    }\r\n\r\n    // This function receives a string and a continuation.  If\r\n    // there is an object property or variable named $what, then\r\n    // $cont is called in the context of this object and given the\r\n    // value of $what as first argument.  The returned value is\r\n    // passed back to caller.\r\n    //\r\n    // The continuation can also be a string, in which case it's\r\n    // assumed to be a method in the value of $what, thus called\r\n    // on it.\r\n    //\r\n    // This is a bit messy, but should work well as long as we\r\n    // don't use the same name for both an object property and a\r\n    // variable in this.variables.  Otherwise, the property takes\r\n    // precedence.\r\n    when(what, cont, ...args) {\r\n        what = this[what] || this.getq(what);\r\n        if (what != null) {\r\n            if (cont instanceof Function)\r\n                return cont.call(this, what);\r\n            else {\r\n                return what[cont].apply(what, args);\r\n            }\r\n        }\r\n    }\r\n\r\n    // XXX: this is way too ugly. (15 years later: Oh Yeah.)\r\n    whenActiveFrame() {\r\n        var fr = this.getActiveFrame(); // miserable hack\r\n        if (fr.buffer === this) {\r\n            this.activeFrame = fr;\r\n            var a = [\"activeFrame\", ...arguments];\r\n            return this.when.apply(this, a);\r\n        } else {\r\n            this.activeFrame = null;\r\n        }\r\n    }\r\n\r\n    forAllFrames(cont) {\r\n        if (this.ymacs)\r\n            this.ymacs.getBufferFrames(this).forEach(cont);\r\n    }\r\n\r\n    whenYmacs() {\r\n        var a = [\"ymacs\", ...arguments];\r\n        return this.when.apply(this, a);\r\n    }\r\n\r\n    whenMinibuffer(cont) {\r\n        // In fact, we should move when() into some base\r\n        // object... but which one?  JS doesn't have multiple\r\n        // inheritance, though we could easily \"invent\" it.\r\n        return this.whenYmacs(function(ymacs){\r\n            if (ymacs.minibuffer)\r\n                return cont.call(this, ymacs.minibuffer);\r\n        });\r\n    }\r\n\r\n    withMarkers(cont, ...args) {\r\n        let a = args.map(arg => this.createMarker(arg));\r\n        try {\r\n            return cont.apply(this, a);\r\n        } finally {\r\n            a.forEach(m => m.destroy());\r\n        }\r\n    }\r\n\r\n    preventUpdates() {\r\n        ++this.__preventUpdates;\r\n    }\r\n\r\n    resumeUpdates() {\r\n        if ((this.__preventUpdates = Math.max(this.__preventUpdates - 1, 0)) == 0) {\r\n            this.redrawDirtyLines();\r\n        }\r\n    }\r\n\r\n    getRegion(begin = this.caretMarker, end = this.markMarker) {\r\n        begin = MRK(begin);\r\n        end = MRK(end);\r\n        if (end < begin) { var tmp = begin; begin = end; end = tmp; }\r\n        return { begin: begin, end: end };\r\n    }\r\n\r\n    redrawDirtyLines() {\r\n        this.callHooks(\"beforeRedraw\");\r\n        this.__dirtyLines.forEach((draw, row) => {\r\n            if (draw) {\r\n                this.callHooks(\"onLineChange\", row);\r\n            }\r\n        });\r\n        this.__dirtyLines = [];\r\n        this.callHooks(\"afterRedraw\");\r\n    }\r\n\r\n    setOverlay(name, props) {\r\n        this.callHooks(\"onOverlayChange\", name, props);\r\n    }\r\n\r\n    deleteOverlay(name) {\r\n        this.callHooks(\"onOverlayDelete\", name);\r\n    }\r\n\r\n    setMark(pos = this.point()) {\r\n        this.markMarker.setPosition(pos);\r\n    }\r\n\r\n    ensureTransientMark() {\r\n        var rc = this._rowcol, tm;\r\n        if (!this.transientMarker) {\r\n            this.transientMarker = this.createMarker();\r\n            this.markMarker.setPosition(this.point());\r\n            tm = rc;\r\n        }\r\n        if (!tm)\r\n            tm = this.transientMarker.getRowCol();\r\n        this.setOverlay(\"selection\", {\r\n            line1 : tm.row,\r\n            col1  : tm.col,\r\n            line2 : rc.row,\r\n            col2  : rc.col\r\n        });\r\n    }\r\n\r\n    clearTransientMark() {\r\n        if (this.transientMarker) {\r\n            this.transientMarker.destroy();\r\n            this.transientMarker = null;\r\n            this.deleteOverlay(\"selection\");\r\n            this.setq(\"sticky_mark\", false);\r\n        }\r\n    }\r\n\r\n    deleteTransientRegion() {\r\n        if (this.transientMarker) {\r\n            this._deleteText(this.caretMarker, this.transientMarker);\r\n            this.clearTransientMark();\r\n            this._placeUndoBoundary();\r\n            return true;\r\n        }\r\n    }\r\n\r\n    static #sameCommandCount = 0;\r\n    sameCommandCount(diff) {\r\n        if (diff == null) return Ymacs_Buffer.#sameCommandCount;\r\n        if (diff == 0) return Ymacs_Buffer.#sameCommandCount = 0;\r\n        return Ymacs_Buffer.#sameCommandCount += diff;\r\n    }\r\n\r\n    static #lastKeyEvent = null;\r\n    interactiveEvent(ev) {\r\n        if (arguments.length == 0)\r\n            return Ymacs_Buffer.#lastKeyEvent;\r\n        return Ymacs_Buffer.#lastKeyEvent = ev;\r\n    }\r\n\r\n    getPrefixArg(noDiscard) {\r\n        var ret = this.getq(\"universal_prefix\");\r\n        if (!noDiscard && ret !== undefined) {\r\n            this.setq(\"universal_prefix\", undefined);\r\n            if (!this.isMinibuffer)\r\n                this.setMinibuffer(\"\");\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    setPrefixArg(val) {\r\n        return this.setq(\"universal_prefix\", val);\r\n    }\r\n\r\n    updateModeline() {\r\n        this.callHooks(\"onModelineChange\");\r\n    }\r\n\r\n    renderModelineContent(rc, percent) {\r\n        var ml = (this.dirty() ? \"**\" : \"--\") +\r\n            ` <span class=\"mode-line-buffer-id\">${DOM.htmlEscape(this.name)}</span>` +\r\n            \"\" + percent + \" of \" + formatBytes(this.getCodeSize(), 2).toLowerCase() + \"\" +\r\n            \"(\" + (rc.row + 1) + \",\" + rc.col + \") \";\r\n        var custom = this.getq(\"modeline_custom_handler\");\r\n        if (custom) {\r\n            custom = custom.call(this, this, rc);\r\n            if (custom) ml += \"[\" + custom + \"] \";\r\n        }\r\n        return ml;\r\n    }\r\n\r\n    /* -----[ not-so-public API ]----- */\r\n\r\n    // BEGIN: undo queue\r\n\r\n    _recordChange(type, pos, len, text) {\r\n        if (len > 0) {\r\n            var q = this.__undoQueue;\r\n            if (!this.__preventUndo) {\r\n                q.push({\r\n                    type  : type,\r\n                    pos   : pos,\r\n                    len   : len,\r\n                    text  : text,\r\n                    dirty : this.dirty(),\r\n                });\r\n                if (q.length > MAX_UNDO_RECORDS)\r\n                    q.shift();\r\n                this.dirty(true);\r\n            } else {\r\n                q.forEach(x => {\r\n                    if (x.type == 3) {\r\n                        x.markers.forEach(m => {\r\n                            if (m[1] >= pos) {\r\n                                m[1] += type == 1 ? len : -len;\r\n                            }\r\n                        });\r\n                    } else if (x.pos >= pos) {\r\n                        x.pos += type == 1 ? len : -len;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    _placeUndoBoundary() {\r\n        var q = this.__undoQueue;\r\n        var m = this.markers.map(m => [ m, m.getPosition() ]);\r\n        var last = q.at(-1);\r\n        if (!last || last.type != 3) {\r\n            q.push({ type: 3, markers: m });\r\n        } else {\r\n            last.markers = m;\r\n        }\r\n    }\r\n\r\n    _playbackUndo() {\r\n        var q = this.__undoQueue;\r\n        if (q.length == 0) return false;\r\n        ++this.__undoInProgress;\r\n        var didit = false, action;\r\n        while (--this.__undoPointer >= 0) {\r\n            action = q[this.__undoPointer];\r\n            if (action.type == 3) { // boundary\r\n                // restore markers\r\n                action.markers.forEach(m => m[0].setPosition(m[1]));\r\n                if (!didit) continue;\r\n                break;\r\n            }\r\n            didit = true;\r\n            var pos = action.pos;\r\n            switch (action.type) {\r\n              case 1: // insert\r\n                this._deleteText(pos, pos + action.len);\r\n                break;\r\n              case 2: // delete\r\n                this._insertText(action.text, pos);\r\n                break;\r\n            }\r\n            this.dirty(action.dirty);\r\n        }\r\n        --this.__undoInProgress;\r\n        return didit;\r\n    }\r\n\r\n    // END: undo\r\n\r\n    _replaceLine(row, text) {\r\n        this.code[row] = text;\r\n        this._textProperties.replaceLine(row, text);\r\n        if (!this.__preventUpdates) {\r\n            this.callHooks(\"onLineChange\", row);\r\n        } else {\r\n            this.__dirtyLines[row] = true;\r\n        }\r\n    }\r\n\r\n    _deleteLine(row) {\r\n        this.code.splice(row, 1);\r\n        this._textProperties.deleteLine(row);\r\n        if (this.tokenizer)\r\n            this.tokenizer.quickDeleteLine(row);\r\n        this.__dirtyLines.splice(row, 1);\r\n        this.callHooks(\"onDeleteLine\", row);\r\n    }\r\n\r\n    _insertLine(row, text) {\r\n        this.code.splice(row, 0, text);\r\n        this._textProperties.insertLine(row);\r\n        if (this.tokenizer)\r\n            this.tokenizer.quickInsertLine(row);\r\n        var drawIt = !this.__preventUpdates;\r\n        this.callHooks(\"onInsertLine\", row, drawIt);\r\n        if (!drawIt) {\r\n            if (this.__dirtyLines.length <= row)\r\n                this.__dirtyLines[row] = true;\r\n            else\r\n                this.__dirtyLines.splice(row, 0, true);\r\n        }\r\n    }\r\n\r\n    _insertText(text, pos) {\r\n        if (text.length == 0)\r\n            return;\r\n        if (pos == null)\r\n            pos = this.caretMarker.getPosition();\r\n        pos = MRK(pos);\r\n        // *** UNDO RECORDING\r\n        this._recordChange(1, pos, text.length);\r\n        var rc = pos == this.point() ? this._rowcol : this._positionToRowCol(pos),\r\n            i = rc.row;\r\n        if (/^\\n+$/.test(text) && rc.col == 0) {\r\n            // handle this case separately, since it's so\r\n            // frequently used (ENTER pressed) and the\r\n            // default algorithm messes up colorization\r\n            // for a fraction of a second, flashing badly.\r\n            for (let j = 0; j < text.length; ++j) {\r\n                this._insertLine(i + j, \"\");\r\n            }\r\n        } else {\r\n            var lines = text.split(\"\\n\"), ln = this.code[i], rest = ln.substr(rc.col);\r\n            if (lines.length > 1) {\r\n                this._replaceLine(i, ln.substr(0, rc.col) + lines.shift());\r\n                lines.forEach(text => this._insertLine(++i, text));\r\n                this._replaceLine(i, this.code[i] + rest);\r\n            } else {\r\n                this._replaceLine(i, ln.substr(0, rc.col) + lines[0] + ln.substr(rc.col));\r\n            }\r\n        }\r\n        this._updateMarkers(pos, text.length);\r\n        this.callHooks(\"onChange\", 1, pos, text);\r\n    }\r\n\r\n    _deleteText(begin, end) {\r\n        begin = this._boundPosition(MRK(begin));\r\n        end = this._boundPosition(MRK(end));\r\n        if (begin == end)\r\n            return;\r\n        if (end < begin) { var tmp = begin; begin = end; end = tmp; }\r\n        // *** UNDO RECORDING\r\n        this._recordChange(2, begin, end - begin, this._bufferSubstring(begin, end));\r\n        var brc = this._positionToRowCol(begin),\r\n            erc = this._positionToRowCol(end);\r\n        var line = this.code[brc.row];\r\n        if (brc.row == erc.row) {\r\n            // same line, that's easy\r\n            line = line.substr(0, brc.col) + line.substr(erc.col);\r\n            this._replaceLine(brc.row, line);\r\n        } else {\r\n            // fix first line\r\n            line = line.substr(0, brc.col) + this.code[erc.row].substr(erc.col);\r\n            this._replaceLine(brc.row, line);\r\n            // delete lines in between\r\n            line = brc.row + 1;\r\n            for (let n = erc.row - brc.row; n-- > 0;) this._deleteLine(line);\r\n        }\r\n        this._updateMarkers(begin, begin - end, begin);\r\n        this.callHooks(\"onChange\", 2, begin, end);\r\n    }\r\n\r\n    _replaceText(begin, end, text) {\r\n        this._deleteText(begin, end);\r\n        this._insertText(text, begin);\r\n    }\r\n\r\n    _swapAreas(a) {\r\n        a = a.map(MRK).sort((a, b) => a - b);\r\n        var b1 = a[0];\r\n        var e1 = a[1];\r\n        var b2 = a[2];\r\n        var e2 = a[3];\r\n        var t1 = this._bufferSubstring(b1, e1);\r\n        var t2 = this._bufferSubstring(b2, e2);\r\n        this._replaceText(b2, e2, t1);\r\n        this._replaceText(b1, e1, t2);\r\n        return e2;\r\n    }\r\n\r\n    _bufferSubstring(begin, end) {\r\n        if (begin == null) begin = this.point();\r\n        else begin = MRK(begin);\r\n\r\n        if (end == null) end = this.getCodeSize();\r\n        else end = MRK(end);\r\n\r\n        if (end < begin) { var tmp = begin; begin = end; end = tmp; }\r\n        // var brc = this._positionToRowCol(begin),\r\n        //     erc = this._positionToRowCol(end);\r\n        // if (brc.row == erc.row) {\r\n        //         return this.code[brc.row].substring(brc.col, erc.col);\r\n        // } else return [ this.code[brc.row].substr(brc.col) ].\r\n        //         concat(this.code.slice(brc.row + 1, erc.row)).\r\n        //         concat(this.code[erc.row].substr(0, erc.col)).\r\n        //         join(\"\\n\");\r\n        return this.getCode().substring(begin, end);\r\n    }\r\n\r\n    _killingAction(p1, p2, prepend, noDelete) {\r\n        p1 = MRK(p1);\r\n        p2 = MRK(p2);\r\n        var text = this._bufferSubstring(p1, p2);\r\n        this._saveKilledText(text, prepend);\r\n        if (!noDelete)\r\n            this._deleteText(p1, p2);\r\n        this.clearTransientMark();\r\n    }\r\n\r\n    _saveKilledText(text, prepend) {\r\n        if (!this._lastCommandWasKill)\r\n            this.ymacs.killRingToMaster();\r\n        this.ymacs.pushToKillRing(text, prepend);\r\n        this._lastCommandWasKill++;\r\n        if (this.interactiveEvent()) try {\r\n            navigator.clipboard.writeText(this.ymacs.killRingText());\r\n        } catch {}\r\n    }\r\n\r\n    _positionToRowCol(pos) {\r\n        var line = 0, a = this.code, n = a.length;\r\n        while (pos > 0 && line < n) {\r\n            var len = a[line].length;\r\n            if (len >= pos)\r\n                break;\r\n            pos -= len + 1; // one for the newline\r\n            line++;\r\n        }\r\n        return { row: line, col: pos };\r\n    }\r\n\r\n    _rowColToPosition(row, col) {\r\n        var pos = 0, a = this.code, i = Math.min(row, a.length - 1), n = i;\r\n        if (i < 0)\r\n            return 0;\r\n        while (--i >= 0)\r\n            pos += a[i].length + 1; // one for the newline\r\n        return pos + Math.min(col, a[n].length);\r\n    }\r\n\r\n    _boundPosition(pos) {\r\n        if (pos < 0)\r\n            return 0;\r\n        return Math.min(pos, this.getCodeSize());\r\n    }\r\n\r\n    _repositionCaret(pos) {\r\n        var p = this.caretMarker.getPosition();\r\n        if (pos == null)\r\n            pos = p;\r\n        pos = MRK(pos);\r\n        pos = this._boundPosition(pos);\r\n        this.caretMarker.setPosition(pos);\r\n        return pos != p;\r\n    }\r\n\r\n    _updateMarkers(offset, delta, min = 0) {\r\n        this.__size = null;\r\n        this.__code = null;\r\n        // if (this.__undoInProgress == 0) {\r\n        this.markers.map(m => m.editorChange(offset, delta, min));\r\n        // }\r\n        if (this.tokenizer) {\r\n            let row = this._positionToRowCol(Math.min(offset, offset + delta)).row;\r\n            this.tokenizer.truncate(row);\r\n        }\r\n    }\r\n\r\n    _saveExcursion(cont, markerBefore) {\r\n        var tmp = this.createMarker(null, markerBefore);\r\n        ++this.__savingExcursion;\r\n        try {\r\n            return cont.call(this);\r\n        } finally {\r\n            --this.__savingExcursion;\r\n            this.caretMarker.swap(tmp, false, true);\r\n            tmp.destroy();\r\n        }\r\n    }\r\n\r\n    _disableUndo(cont) {\r\n        ++this.__preventUndo;\r\n        try {\r\n            return cont.call(this);\r\n        } finally {\r\n            --this.__preventUndo;\r\n        }\r\n    }\r\n\r\n    _handleKeyEvent(ev) {\r\n        var handled = false;\r\n        this.interactiveEvent(ev);\r\n        var lcwk = this._lastCommandWasKill;\r\n\r\n        if (this.__nextIsMeta)\r\n            ev.ymacsMeta = true;\r\n        this.__nextIsMeta = false;\r\n\r\n        var key = Ymacs_Keymap.unparseKey(ev);\r\n        var cc = this.currentKeys;\r\n        var foundPrefix = false;\r\n        cc.push(key);\r\n\r\n        for (let i = this.keymap.length; --i >= 0;) {\r\n            let km = this.keymap[i];\r\n            let h = km.getHandler(cc);\r\n            if (h instanceof Array) {\r\n                this.callInteractively(h[0], h[1]);\r\n                handled = true;\r\n            }\r\n            else if (h) {\r\n                handled = foundPrefix = true;\r\n            }\r\n            else if (km.defaultHandler && cc.length == 1) {\r\n                handled = this.callInteractively(km.defaultHandler[0], km.defaultHandler[1]);\r\n            }\r\n            if (handled)\r\n                break;\r\n        }\r\n\r\n        if (!foundPrefix) {\r\n            if (!handled) {\r\n                if (cc.length > 1) {\r\n                    this.signalError(cc.join(\" \").bold() + \" is undefined\", true);\r\n                    handled = true;\r\n                }\r\n            }\r\n            cc.splice(0, cc.length);\r\n        }\r\n\r\n        if (this._lastCommandWasKill == lcwk && typeof handled != \"object\" && !this.__nextIsMeta) {\r\n            // selecting a prefix keymap shouldn't clear the killRing\r\n            this._lastCommandWasKill = 0;\r\n        }\r\n\r\n        this.callHooks(\"finishedEvent\", handled);\r\n        this.interactiveEvent(null);\r\n\r\n        // XXX: always preventDefault() in minibuffer (return true\r\n        // here); seems good, objections?\r\n        return handled || this.isMinibuffer;\r\n    }\r\n\r\n    _on_tokenizerFoundToken(row, c1, c2, what) {\r\n        if (what) {\r\n            this._textProperties.addLineProps(row, c1, c2, \"css\", what);\r\n        } else {\r\n            this._textProperties.removeLineProps(row, c1, c2, \"css\");\r\n        }\r\n    }\r\n\r\n    _on_textPropertiesChange(row) {\r\n        if (!this.__preventUpdates) {\r\n            this.callHooks(\"onLineChange\", row);\r\n        } else {\r\n            this.__dirtyLines[row] = true;\r\n        }\r\n    }\r\n\r\n    formatLineHTML(row, caret) {\r\n        var rc = this._rowcol;\r\n        if (caret instanceof Ymacs_Marker)\r\n            rc = caret.getRowCol();\r\n        caret = row == rc.row ? rc.col : null;\r\n        return this._textProperties.getLineHTML(row, this.code[row], caret);\r\n    }\r\n\r\n    looking_at(needle) {\r\n        var haystack = this.getCode();\r\n        if (needle instanceof RegExp) {\r\n            var pos = needle.lastIndex = this.point();\r\n            var ret = needle.exec(haystack);\r\n            if (ret && ret.index == pos) {\r\n                ret.after = needle.lastIndex;\r\n                return this.matchData = ret;\r\n            }\r\n        } else if (typeof needle == \"string\") {\r\n            // XXX: account for case_fold_search here?\r\n            return haystack.substr(this.point(), needle.length) == needle;\r\n        }\r\n    }\r\n\r\n    looking_back(needle) {\r\n        var haystack = this.getCode();\r\n        if (needle instanceof RegExp) {\r\n            var m = this.lastIndexOfRegexp(haystack, needle, this.point());\r\n            if (m && m.after == this.point())\r\n                return m;\r\n        } else if (typeof needle == \"string\") {\r\n            // XXX: account for case_fold_search here?\r\n            return haystack.substr(this.point() - needle.length, needle.length) == needle;\r\n        }\r\n    }\r\n\r\n    capitalize(str) {\r\n        return str.replace(this.getq(\"syntax_capitalize_word\"),\r\n                           (_, a, b) => a.toUpperCase() + b.toLowerCase());\r\n    }\r\n}\r\n\r\n// XXX: what a mess..\r\nYmacs_Buffer.prototype.COMMANDS = Ymacs_Buffer.COMMANDS;\r\nYmacs_Buffer.prototype.newCommands = Ymacs_Buffer.newCommands;\r\nYmacs_Buffer.prototype.replaceCommands = Ymacs_Buffer.replaceCommands;\r\nYmacs_Buffer.prototype.newMode = Ymacs_Buffer.newMode;\r\nYmacs_Buffer.prototype.addModeHook = Ymacs_Buffer.addModeHook;\r\nYmacs_Buffer.prototype.removeModeHook = Ymacs_Buffer.removeModeHook;\r\nYmacs_Buffer.setq =\r\n    Ymacs_Buffer.setGlobal =\r\n    Ymacs_Buffer.prototype.setGlobal = Ymacs_Buffer.setVariable;\r\nYmacs_Buffer.prototype.setq = Ymacs_Buffer.prototype.setVariable;\r\nYmacs_Buffer.prototype.getq = Ymacs_Buffer.prototype.getVariable;\r\nYmacs_Buffer.getq = Ymacs_Buffer.getVariable;\r\n\r\nexport class Ymacs_Minibuffer extends Ymacs_Buffer {\r\n    constructor(...args) {\r\n        super(...args);\r\n        this.promptMarker = this.createMarker(0, true, \"prompt\");\r\n        this.setq(\"minibuffer_validation\", whatever => true);\r\n    }\r\n\r\n    // prompt(text) {\r\n    //     text = text.trim() + \" \";\r\n    //     this._disableUndo(() => {\r\n    //         this.setCode(text);\r\n    //         this._textProperties.addLineProps(0, 0, text.length - 1, \"css\", \"minibuffer-prompt\");\r\n    //         this._repositionCaret(text.length);\r\n    //         this.promptMarker.setPosition(text.length, true, true);\r\n    //     });\r\n    // }\r\n\r\n    prompt(text) {\r\n        text = text.trim() + \" \";\r\n        this._disableUndo(() => {\r\n            let pos = this.promptMarker.getPosition();\r\n            this.promptMarker.setPosition(0, true, true);\r\n            this._replaceText(0, pos, text);\r\n            this.promptMarker.setPosition(text.length, true, true);\r\n            this._textProperties.spliceLineProps(0, 0, text.length - pos);\r\n            this._textProperties.addLineProps(0, 0, text.length - 1, \"css\", \"minibuffer-prompt\");\r\n        });\r\n    }\r\n\r\n    _boundPosition(pos) {\r\n        return Math.max(MRK(this.promptMarker),\r\n                        Math.min(pos, this.getCodeSize()));\r\n    }\r\n}\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { EventProxy, remove } from \"./ymacs-utils.js\";\r\n\r\n/* markers are objects that hold a position which is automatically\r\n   maintained as text is inserted or removed */\r\n\r\nexport class Ymacs_Marker {\r\n\r\n    constructor({\r\n        pos = null,\r\n        editor = null,\r\n        before = false,\r\n        name = null\r\n    } = {}) {\r\n        this.position = pos;\r\n        this.editor = editor;\r\n        this.before = before;\r\n        this.name = name;\r\n\r\n        this.editor.markers.push(this);\r\n        this.rowcol = null;\r\n        this.onChange = [];\r\n    };\r\n\r\n    destroy() {\r\n        remove(this.editor.markers, this);\r\n        this.editor = null;\r\n    }\r\n\r\n    editorChange(pos, diff, min) {\r\n        var p = this.position;\r\n        if (this.before)\r\n            --p;\r\n        if (diff != 0 && pos <= p) {\r\n            this.rowcol = null;\r\n            this.position += diff;\r\n            if (this.position < min)\r\n                this.position = min;\r\n            this.callHooks(this.onChange, this.position);\r\n        }\r\n    }\r\n\r\n    callHooks(a, arg) {\r\n        for (var i = a.length; --i >= 0;)\r\n            a[i].call(this.editor, arg);\r\n    }\r\n\r\n    getPosition() {\r\n        return this.position;\r\n    }\r\n\r\n    valueOf() {\r\n        return this.position;\r\n    }\r\n\r\n    setPosition(pos, noHooks, force) {\r\n        if (force || this.position != pos) {\r\n            this.rowcol = null;\r\n            this.position = pos;\r\n            if (!noHooks)\r\n                this.callHooks(this.onChange, this.position);\r\n        }\r\n    }\r\n\r\n    getRowCol() {\r\n        return this.rowcol || (this.rowcol = this.editor._positionToRowCol(this.position));\r\n    }\r\n\r\n    swap(other, noHooks, force) {\r\n        var tmp = this.getPosition();\r\n        this.setPosition(other.getPosition(), noHooks, force);\r\n        other.setPosition(tmp, noHooks, force);\r\n    }\r\n\r\n}\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nlet KEYMAPS = Object.create(null);\r\n\r\nexport class Ymacs_Keymap {\r\n\r\n    constructor(keys) {\r\n        this.definitions = Object.create(null);\r\n        this.defineKeys(keys);\r\n    }\r\n\r\n    static define(name, keys) {\r\n        let obj = name && KEYMAPS[name];\r\n        if (!obj) {\r\n            obj = keys instanceof this ? keys : new this(keys);\r\n            if (name) {\r\n                KEYMAPS[name] = obj;\r\n                obj.name = name;\r\n            }\r\n        }\r\n        return obj;\r\n    }\r\n\r\n    static get(name) {\r\n        return KEYMAPS[name];\r\n    }\r\n\r\n    static parseKey(orig) {\r\n        let key = { str: \"\" };\r\n        let p = orig;\r\n        for (;;) {\r\n            let m = /^([CMS])-/.exec(p);\r\n            if (m) {\r\n                if (m[1] == \"C\") key.ctrlKey = true;\r\n                if (m[1] == \"M\") key.metaKey = true;\r\n                if (m[1] == \"S\") key.shiftKey = true;\r\n                p = p.substr(2);\r\n            } else {\r\n                key.key = p == \"Space\" ? \" \"\r\n                    : p.length == 1 ? p.toLowerCase()\r\n                    : p;\r\n                break;\r\n            }\r\n        }\r\n        if (key.ctrlKey) key.str += \"C-\";\r\n        if (key.metaKey) key.str += \"M-\";\r\n        if (key.shiftKey) key.str += \"S-\";\r\n        key.str += p;\r\n        return key;\r\n    }\r\n\r\n    static unparseKey(ev) {\r\n        var key, a = [];\r\n        if (\"wheelDelta\" in ev) {\r\n            key = ev.wheelDelta > 0 ? \"WheelUp\" : \"WheelDown\";\r\n        } else {\r\n            key = ev.key;\r\n            if (key == \" \" || (key == \"Unidentified\" && ev.code == \"Space\"))\r\n                key = \"Space\";\r\n            if (key.length == 1) key = key.toLowerCase();\r\n        }\r\n        if (ev.ctrlKey)\r\n            a.push(\"C\");\r\n        if (ev.altKey || ev.ymacsMeta)\r\n            a.push(\"M\");\r\n        if (ev.shiftKey && (key.length > 1 || key.toLowerCase() != key.toUpperCase()))\r\n            a.push(\"S\");\r\n        a.sort();\r\n        a.push(key);\r\n        return a.join(\"-\");\r\n    }\r\n\r\n    defineKey(key, func, args) {\r\n        if (func instanceof Array) {\r\n            args = func.slice(1);\r\n            func = func[0];\r\n        }\r\n        key = key.trim().split(/\\s*&&\\s*/);\r\n        if (key.length > 1) {\r\n            key.forEach(key => this.defineKey(key, func, args));\r\n        } else {\r\n            key = key[0].trim();\r\n            var dfn = this.definitions;\r\n            if (key.indexOf(\" \") >= 0) {\r\n                var a = key.split(/\\s+/);\r\n                key = a.pop();\r\n                a.forEach(key => {\r\n                    key = this.parseKey(key).str;\r\n                    if (!dfn[key])\r\n                        dfn[key] = {};\r\n                    dfn = dfn[key];\r\n                });\r\n            }\r\n            key = this.parseKey(key);\r\n            dfn[key.str] = [ func, args ];\r\n        }\r\n    }\r\n\r\n    defineKeys(map) {\r\n        Object.keys(map).forEach(key => this.defineKey(key, map[key]));\r\n    }\r\n\r\n    getHandler(keys) {\r\n        let handler = null, def = this.definitions;\r\n        for (let key of keys) {\r\n            let tmp = handler ? handler[key] : def[key];\r\n            if (tmp) {\r\n                handler = tmp;\r\n                if (Array.isArray(handler)) {\r\n                    break;\r\n                }\r\n            } else {\r\n                handler = null;\r\n                break;\r\n            }\r\n        }\r\n        return handler;\r\n    }\r\n\r\n    attached(){}\r\n    detached(){}\r\n\r\n}\r\n\r\nYmacs_Keymap.prototype.parseKey = Ymacs_Keymap.parseKey;\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Ymacs_Keymap } from \"./ymacs-keymap.js\";\r\nimport { Ymacs_Interactive } from \"./ymacs-interactive.js\";\r\n\r\n// This is the default keymap, as configured in\r\n// Ymacs_Buffer::makeDefaultKeymap.  It follows closely the standard\r\n// Emacs keybindings, with some small deviations that match my taste\r\n// (search for \"my stuff\" below).\r\n\r\n// It would be nice to have more options, such as an Eclipse keymap,\r\n// or Visual Studio -- but I'm not familiar with any of them.\r\n// Contributions welcome.\r\n\r\n// A keymap inherits from Ymacs_Keymap and should define its bindings\r\n// in D.KEYS.  They can also define a defaultHandler property to take\r\n// whatever action they consider necessary -- for example the Isearch\r\n// keymap will, by default, print the entered character in the\r\n// minibuffer and trigger a search action.  Isearch mode is almost\r\n// completely defined in a keymap -- with the minor note that\r\n// isearch_forward and isearch_backward are assigned below to key\r\n// combinations; once pressed, they will push the Isearch keymap onto\r\n// the buffer's keymap stack, and it will be used until isearch is\r\n// ended.\r\n\r\n/* KEY DEFINITIONS.  A key is generally defined in standard Emacs\r\n   notation, with the following notes:\r\n\r\n   - it is possible to define multiple keys at once for the same\r\n     operation, by using the \"&&\" combination (separate with spaces\r\n     from the actual keys)\r\n\r\n   - some special characters are named literally (see event.key\r\n     https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key)\r\n\r\n   Normally you would define commands using Ymacs_Buffer.newCommands\r\n   (see ymacs-commands.js) and specify the command name for key\r\n   bindings, but you can directly use a function as well:\r\n\r\n   \"C-8\": function() {\r\n     alert(\"You pressed CTRL-8\");\r\n   }\r\n\r\n   It is advised to define commands for more than simple cases, for\r\n   two reasons:\r\n\r\n   1. they can be used for \"non-interactive\" calls too\r\n\r\n   2. the command name is saved in this.currentCommand /\r\n      this.previousCommand, which is useful in a number of cases.\r\n\r\n*/\r\n\r\nlet minibuffer_keys = {\r\n    // movement\r\n    \"ArrowLeft   && C-b\"                      : \"backward_char\",\r\n    \"ArrowRight  && C-f\"                      : \"forward_char\",\r\n    \"Home\"                                    : \"beginning_of_indentation_or_line\",\r\n    \"End && C-e\"                              : \"end_of_line\",\r\n    \"C-a\"                                     : \"beginning_of_line\",\r\n    \"C-Home && M-<\"                           : \"beginning_of_buffer\",\r\n    \"C-End && M->\"                            : \"end_of_buffer\",\r\n    \"C-ArrowRight && M-f\"                     : \"forward_word\",\r\n    \"C-ArrowLeft && M-b\"                      : \"backward_word\",\r\n\r\n    // transient mark\r\n    \"S-ArrowLeft     && S-C-b\"                : \"backward_char_mark\",\r\n    \"S-ArrowRight    && S-C-f\"                : \"forward_char_mark\",\r\n    \"S-C-ArrowRight  && S-M-f\"                : \"forward_word_mark\",\r\n    \"S-C-ArrowLeft   && S-M-b\"                : \"backward_word_mark\",\r\n    \"S-Home\"                                  : \"beginning_of_indentation_or_line_mark\",\r\n    \"S-C-a\"                                   : \"beginning_of_line_mark\",\r\n    \"S-End && S-C-e\"                          : \"end_of_line_mark\",\r\n    \"S-C-Home\"                                : \"beginning_of_buffer_mark\",\r\n    \"S-C-End\"                                 : \"end_of_buffer_mark\",\r\n\r\n    // basic editing\r\n    \"Backspace\"                               : \"backward_delete_char\",\r\n    \"Delete && C-d\"                           : \"delete_char\",\r\n    \"M-d && C-Delete\"                         : \"kill_word\",\r\n    \"C-Backspace && M-Backspace && M-Delete\"  : \"backward_kill_word\",\r\n    \"C-k\"                                     : \"kill_line\",\r\n    \"C-y && S-Insert\"                         : \"yank\",\r\n    \"M-y\"                                     : \"yank_pop\",\r\n    \"C-Space\"                                 : \"set_mark_command\",\r\n    \"C-x C-x\"                                 : \"exchange_point_and_mark\",\r\n    \"C-w\"                                     : \"kill_region\",\r\n    \"M-t\"                                     : \"transpose_words\",\r\n    \"C-t\"                                     : \"transpose_chars\",\r\n    \"M-w\"                                     : \"copy_region_as_kill\",\r\n    \"M-c\"                                     : \"capitalize_word\",\r\n    \"M-u\"                                     : \"upcase_word\",\r\n    \"M-l\"                                     : \"downcase_word\",\r\n    \"F11\"                                     : \"nuke_trailing_whitespace\",\r\n    \"C-/ && C-x u && C-_ && C-z\"              : \"undo\",\r\n    \"Insert\"                                  : \"overwrite_mode\",\r\n    \"M-/\"                                     : \"dabbrev_expand\",\r\n    \"C-g\"                                     : \"keyboard_quit\",\r\n    \"Escape\"                                  : \"keyboard_quit\",\r\n\r\n    // \"Escape\"                                  : \"_next_is_meta\",\r\n    // \"M-Escape Escape\"                         : \"keyboard_quit\",\r\n\r\n    \"C-S-y && C-v\"                            : \"yank_from_operating_system\",\r\n    \"M-S-w\"                                   : \"copy_for_operating_system\",\r\n\r\n    \"C-c /\"                                   : \"close_last_xml_tag\",\r\n    \"S-Backspace\"                             : \"backward_delete_whitespace\",\r\n    \"S-Delete\"                                : \"delete_whitespace\",\r\n\r\n    \"C-x =\"                                   : \"what_cursor_position\",\r\n};\r\n\r\nlet emacs_keys = Object.assign({}, minibuffer_keys, {\r\n    // movement\r\n    \"ArrowUp     && C-p\"                      : \"backward_line\",\r\n    \"ArrowDown   && C-n\"                      : \"forward_line\",\r\n    \"ArrowLeft   && C-b\"                      : \"backward_char\",\r\n    \"ArrowRight  && C-f\"                      : \"forward_char\",\r\n    \"Home\"                                    : \"beginning_of_indentation_or_line\",\r\n    \"End && C-e\"                              : \"end_of_line\",\r\n    \"C-a\"                                     : \"beginning_of_line\",\r\n    \"C-Home && M-<\"                           : \"beginning_of_buffer\",\r\n    \"C-End && M->\"                            : \"end_of_buffer\",\r\n    \"C-ArrowRight && M-f\"                     : \"forward_word\",\r\n    \"C-ArrowLeft && M-b\"                      : \"backward_word\",\r\n    \"C-ArrowDown\"                             : \"forward_paragraph\",\r\n    \"C-ArrowUp\"                               : \"backward_paragraph\",\r\n    \"M-h\"                                     : \"mark_paragraph\",\r\n    \"C-l\"                                     : \"recenter_top_bottom\",\r\n    \"PageUp\"                                  : \"scroll_up_half\",\r\n    \"PageDown\"                                : \"scroll_down_half\",\r\n    \"WheelUp\"                                 : \"scroll_up\",\r\n    \"WheelDown\"                               : \"scroll_down\",\r\n\r\n    // transient mark\r\n    \"S-ArrowUp       && S-C-p\"                : \"backward_line_mark\",\r\n    \"S-ArrowDown     && S-C-n\"                : \"forward_line_mark\",\r\n    \"S-ArrowLeft     && S-C-b\"                : \"backward_char_mark\",\r\n    \"S-ArrowRight    && S-C-f\"                : \"forward_char_mark\",\r\n    \"S-C-ArrowRight  && S-M-f\"                : \"forward_word_mark\",\r\n    \"S-C-ArrowLeft   && S-M-b\"                : \"backward_word_mark\",\r\n    \"S-C-ArrowDown\"                           : \"forward_paragraph_mark\",\r\n    \"S-C-ArrowUp\"                             : \"backward_paragraph_mark\",\r\n    \"S-Home\"                                  : \"beginning_of_indentation_or_line_mark\",\r\n    \"S-C-a\"                                   : \"beginning_of_line_mark\",\r\n    \"S-End && S-C-e\"                          : \"end_of_line_mark\",\r\n    \"S-C-Home\"                                : \"beginning_of_buffer_mark\",\r\n    \"S-C-End\"                                 : \"end_of_buffer_mark\",\r\n\r\n    // basic editing\r\n    \"Backspace\"                               : \"backward_delete_char\",\r\n    \"Delete && C-d\"                           : \"delete_char\",\r\n    \"Enter && C-m\"                            : \"newline\",\r\n    \"M-d && C-Delete\"                         : \"kill_word\",\r\n    \"C-Backspace && M-Backspace && M-Delete\"  : \"backward_kill_word\",\r\n    \"C-k\"                                     : \"kill_line\",\r\n    \"C-y && S-Insert\"                         : \"yank\",\r\n    \"M-y\"                                     : \"yank_pop\",\r\n    \"C-Space\"                                 : \"set_mark_command\",\r\n    \"C-x C-x\"                                 : \"exchange_point_and_mark\",\r\n    \"C-w\"                                     : \"kill_region\",\r\n    \"M-t\"                                     : \"transpose_words\",\r\n    \"C-t\"                                     : \"transpose_chars\",\r\n    \"C-x C-t\"                                 : \"transpose_lines\",\r\n    \"M-w\"                                     : \"copy_region_as_kill\",\r\n    \"M-c\"                                     : \"capitalize_word\",\r\n    \"M-u\"                                     : \"upcase_word\",\r\n    \"M-l\"                                     : \"downcase_word\",\r\n    \"F11\"                                     : \"nuke_trailing_whitespace\",\r\n    \"Tab\"                                     : \"indent_line\",\r\n    \"C-M-\\\\\"                                  : \"indent_region\",\r\n    \"M-q\"                                     : \"fill_paragraph\",\r\n    \"C-/ && C-x u && C-_ && C-z\"              : \"undo\",\r\n    \"Insert\"                                  : \"overwrite_mode\",\r\n    \"M-s\"                                     : \"center_line\",\r\n    \"M-/\"                                     : \"dabbrev_expand\",\r\n    \"C-s\"                                     : \"isearch_forward\",\r\n    \"C-r\"                                     : \"isearch_backward\",\r\n    \"C-S-s\"                                   : \"isearch_yank_word_or_char\",\r\n    \"M-C-s\"                                   : \"isearch_forward_regexp\",\r\n    \"M-C-r\"                                   : \"isearch_backward_regexp\",\r\n    \"M-%\"                                     : \"query_replace\",\r\n    \"C-M-%\"                                   : \"query_replace_regexp\",\r\n    \"C-u\"                                     : \"universal_argument\",\r\n    \"M-g\"                                     : \"goto_line\",\r\n    \"C-x h\"                                   : \"mark_whole_buffer\",\r\n    \"C-g\"                                     : \"keyboard_quit\",\r\n    \"M-^\"                                     : \"delete_indentation\",\r\n    \"M-;\"                                     : \"comment_dwim\",\r\n    \"C-x =\"                                   : \"what_cursor_position\",\r\n    \"C-x f\"                                   : \"set_fill_column\",\r\n    \"C-x C-\\\\\"                                : \"goto_last_change\",\r\n\r\n    // vertical editing\r\n    \"C-x r t\"                                 : \"string_rectangle\",\r\n    \"C-x r c\"                                 : \"clear_rectangle\",\r\n    \"C-x r k\"                                 : \"kill_rectangle\",\r\n    \"C-x r y\"                                 : \"yank_rectangle\",\r\n\r\n    // buffers\r\n    \"C-x C-ArrowRight && C-x ArrowRight && C-Tab\"    : \"next_buffer\",\r\n    \"C-x C-ArrowLeft && C-x ArrowLeft && C-S-Tab\"    : \"previous_buffer\",\r\n    \"C-x b\"                                          : \"switch_to_buffer\",\r\n    \"C-x k\"                                          : \"kill_buffer\",\r\n\r\n    // frames\r\n    \"C-x 0\"                                   : \"delete_frame\",\r\n    \"C-x 1\"                                   : \"delete_other_frames\",\r\n    \"C-x 2\"                                   : \"split_frame_vertically\",\r\n    \"C-x 3\"                                   : \"split_frame_horizontally\",\r\n    \"C-x o && M-o\"                            : \"other_frame\",\r\n    \"C-x l\"                                   : \"toggle_line_numbers\",\r\n\r\n    // eval\r\n    \"M-x\"                                     : \"execute_extended_command\",\r\n\r\n    \"C-S-y && C-v\"                            : \"yank_from_operating_system\",\r\n    \"M-S-w\"                                   : \"copy_for_operating_system\",\r\n\r\n    // my stuff, sorry if these have different meanings in the standard Emacs keys\r\n    \"M-S-y\"                                   : \"yank_shift\", // that's the reverse of yank_shift\r\n    \"C-c /\"                                   : \"close_last_xml_tag\",\r\n    \"S-Backspace\"                             : \"backward_delete_whitespace\",\r\n    \"S-Delete\"                                : \"delete_whitespace\",\r\n    \"C-M-d\"                                   : \"delete_region_or_line\",\r\n    \"M-Enter\"                                 : \"start_next_paragraph\",\r\n    \"C-M-|\"                                   : \"cperl_lineup\",\r\n    \"C-F4\"                                    : \"kill_buffer\",\r\n    \"M-ArrowLeft\"                             : [ \"windmove\", \"left\" ],\r\n    \"M-ArrowRight\"                            : [ \"windmove\", \"right\" ],\r\n    \"M-ArrowUp\"                               : [ \"windmove\", \"up\" ],\r\n    \"M-ArrowDown\"                             : [ \"windmove\", \"down\" ],\r\n\r\n    \"C-x e\"                                   : \"kmacro_end_and_call_macro\",\r\n    \"C-x (\"                                   : \"kmacro_start_macro\",\r\n    \"C-x )\"                                   : \"kmacro_end_macro\",\r\n\r\n    // file system commands\r\n    \"C-x C-f\"                                 : \"find_file\",\r\n    \"C-x C-w\"                                 : \"write_file\",\r\n    \"C-x C-s\"                                 : \"save_buffer\",\r\n    \"C-x s\"                                   : \"save_some_buffers\",\r\n\r\n    \"C-x r w\"                                 : \"window_configuration_to_register\",\r\n    \"C-x r j\"                                 : \"jump_to_register\",\r\n\r\n    \"C-h m\"                                   : \"describe_mode\",\r\n});\r\n\r\nlet minibuffer_keymap = Ymacs_Keymap.define(\"emacs_mb\", minibuffer_keys);\r\nminibuffer_keymap.defaultHandler = [ \"self_insert_command\" ];\r\n\r\nlet emacs_keymap = Ymacs_Keymap.define(\"emacs\", emacs_keys);\r\nemacs_keymap.defaultHandler = [ \"self_insert_command\" ];\r\n\r\nlet keymap_universal_arg = Ymacs_Keymap.define(\"universal_arg\", {});\r\nkeymap_universal_arg.defaultHandler = [ Ymacs_Interactive(\"^\", function(){\r\n    var ev = this.interactiveEvent();\r\n    var ch = ev.key;\r\n    var prefix = this.getPrefixArg(true);\r\n    if ((/^[0-9]$/.test(ch) || (ch === \"-\" && prefix === \"\")) && !ev.altKey && !ev.ctrlKey) {\r\n        prefix += ch;\r\n        this.setPrefixArg(prefix);\r\n        if (!this.isMinibuffer) {\r\n            this.whenMinibuffer(function(mb){\r\n                mb.cmd(\"insert\", \" \", ch);\r\n            });\r\n        }\r\n        return true;\r\n    }\r\n    this.popKeymap(keymap_universal_arg);\r\n    return false;\r\n}) ];\r\nkeymap_universal_arg.attached = buffer => buffer.setPrefixArg(\"\");\r\n\r\nexport {\r\n    emacs_keymap as Ymacs_Keymap_Emacs,\r\n    minibuffer_keymap as Ymacs_Keymap_Minibuffer,\r\n    keymap_universal_arg as Ymacs_Keymap_UniversalArgument,\r\n};\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Ymacs_Exception } from \"./ymacs-exception.js\";\r\n\r\n/*\r\n * Ymacs_Interactive(args_description, function_reference)\r\n *\r\n * This is a wrapper that makes it easy to define \"interactive\" commands.  Pass two arguments: arguments\r\n * description (args), and a function (func).  args can be null, or a string, an array or a function.  When null\r\n * it is assumed that the function should not receive any arguments.  When an array or a string, it contains\r\n * some argument descriptions similar to Emacs:\r\n *\r\n *    http://www.gnu.org/s/emacs/manual/html_node/elisp/Interactive-Codes.html#Interactive-Codes\r\n *\r\n * (note that Emacs does not take a list for this argument).\r\n *\r\n * Ymacs_Interactive returns func.  When not called interactively, the code should supply all the required\r\n * arguments and the function is called with no performance penalty.  To call it interactively, use\r\n * func.ymacsCallInteractively(), which will read arguments from the minibuffer according to their description.\r\n */\r\n\r\nexport function Ymacs_Interactive(args, func) {\r\n    if (arguments.length == 1) {\r\n        func = args;\r\n        args = null;\r\n    } else {\r\n        let documentation;\r\n        if (!(func instanceof Function)) {\r\n            documentation = func;\r\n            func = arguments[2];\r\n            func.ymacsDoc = documentation;\r\n        }\r\n    }\r\n    func.ymacsInteractive = true;\r\n    if (args != null) {\r\n        if (!Array.isArray(args)) {\r\n            var m = /^[\\^\\@\\*]+/.exec(args);\r\n            if (m) {\r\n                m = m[0];\r\n                args = args.substr(m.length);\r\n                if (m.indexOf(\"^\") >= 0) {\r\n                    func.ymacsMarkExtend = true;\r\n                }\r\n                if (m.indexOf(\"*\") >= 0) {\r\n                    func.ymacsWarnReadonly = true;\r\n                }\r\n                if (m.indexOf(\"@\") >= 0) {\r\n                    func.ymacsSelectFrame = true;\r\n                }\r\n            }\r\n            if (args)\r\n                args = args.split(/\\n+/);\r\n        }\r\n        if (args) {\r\n            let collect;\r\n            let execute = function(...rest) {\r\n                collect = collect.concat(rest);\r\n                return this.callInteractively(func, collect, true);\r\n            };\r\n            while (args.length > 0) {\r\n                let next = execute;\r\n                execute = createArgumentFunction(args.pop(), function(...rest) {\r\n                    collect = collect.concat(rest);\r\n                    return next.call(this);\r\n                });\r\n            }\r\n            func.ymacsCallInteractively = function(){\r\n                collect = [];\r\n                return execute.call(this);\r\n            };\r\n        }\r\n    }\r\n    return func;\r\n}\r\n\r\nexport function Ymacs_Interactive_X(func) {\r\n    return Ymacs_Interactive(\"p\", function(n){\r\n        if (n == null) n = 1;\r\n        while (n-- > 0) func.call(this);\r\n    });\r\n}\r\n\r\nvar $TRUE = (function(){});\r\n$TRUE.toString = function() { return \"\" };\r\n$TRUE.empty = true;\r\n\r\n/* -----[ argument reader functions ]----- */\r\n\r\nfunction prompt(arg) {\r\n    var pr = this.getPrefixArg(true /* noDiscard */);\r\n    if (pr) {\r\n        arg = pr + \" \" + arg;\r\n    }\r\n    return this.cmd(\"minibuffer_prompt\", arg);\r\n}\r\n\r\nfunction read_function_name(arg, cont) {\r\n    console.log(\"read_function_name\", arg);\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_function\", cont);\r\n    // XXX: enforce it!\r\n}\r\n\r\nfunction read_existing_buffer_name(arg, cont) {\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_buffer\", cont);\r\n    // XXX: enforce it!\r\n}\r\n\r\nfunction read_buffer_name(arg, cont) {\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_buffer\", cont);\r\n}\r\n\r\nfunction read_character(arg, cont) {\r\n\r\n}\r\n\r\nfunction read_command_name(arg, cont) {\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_command\", cont);\r\n    // XXX: enforce it!\r\n}\r\n\r\nfunction get_point(arg, cont) {\r\n    return cont.call(this, this.point());\r\n}\r\n\r\nfunction get_mouse_event(arg, cont) {\r\n\r\n}\r\n\r\nfunction irrelevant(arg, cont) {\r\n    return cont.call(this, null);\r\n}\r\n\r\nfunction read_key_sequence(arg, cont) {\r\n\r\n}\r\n\r\nfunction read_key_sequence2(arg, cont) {\r\n\r\n}\r\n\r\nfunction get_mark(arg, cont) {\r\n    return cont.call(this, this.markMarker.getPosition());\r\n}\r\n\r\nfunction read_arbitrary_text(arg, cont) {\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_string\", null, cont);\r\n}\r\n\r\nfunction read_number(arg, cont) {\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_number\", cont);\r\n}\r\n\r\nfunction read_number_or_prefix(arg, cont) {\r\n    var n = parseInt(this.getPrefixArg(), 10);\r\n    if (!isNaN(n))\r\n        return cont.call(this, n);\r\n    else\r\n        return read_number.call(this, arg, cont);\r\n}\r\n\r\nfunction get_numeric_prefix(arg, cont) {\r\n    var n = parseInt(this.getPrefixArg(), 10);\r\n    if (isNaN(n))\r\n        n = null;\r\n    return cont.call(this, n);\r\n}\r\n\r\nfunction get_raw_prefix(arg, cont) {\r\n    arg = this.getPrefixArg();\r\n    if (arg === \"\")\r\n        arg = $TRUE;\r\n    return cont.call(this, arg);\r\n}\r\n\r\nfunction get_point_and_mark(arg, cont) {\r\n    var r = this.getRegion();\r\n    return cont.call(this, r.begin, r.end);\r\n}\r\n\r\nfunction read_key_sequence3(arg, cont) {\r\n\r\n}\r\n\r\nfunction read_variable_name(arg, cont) {\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_variable\", cont);\r\n}\r\n\r\nfunction read_existing_file_name(arg, cont) {\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_existing_file\", cont);\r\n}\r\n\r\nfunction read_file_name(arg, cont) {\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_file\", cont);\r\n}\r\n\r\nfunction read_file_or_directory_name(arg, cont) {\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_file_or_directory\", cont);\r\n}\r\n\r\nfunction read_existing_directory_name(arg, cont) {\r\n    prompt.call(this, arg);\r\n    return this.cmd(\"minibuffer_read_directory\", cont);\r\n}\r\n\r\nvar ARG_READERS = {\r\n    a: read_function_name,\r\n    b: read_existing_buffer_name,\r\n    B: read_buffer_name,\r\n    c: read_character,\r\n    C: read_command_name,\r\n    d: get_point,\r\n    e: get_mouse_event,\r\n    i: irrelevant,\r\n    k: read_key_sequence,\r\n    K: read_key_sequence2,\r\n    m: get_mark,\r\n    M: read_arbitrary_text,\r\n    n: read_number,\r\n    N: read_number_or_prefix,\r\n    p: get_numeric_prefix,\r\n    P: get_raw_prefix,\r\n    r: get_point_and_mark,\r\n    s: read_arbitrary_text,\r\n    U: read_key_sequence3,\r\n    v: read_variable_name,\r\n\r\n    f: read_existing_file_name,\r\n    F: read_file_name,\r\n    G: read_file_or_directory_name,\r\n    D: read_existing_directory_name\r\n\r\n    // S: no reader for interned symbols in Ymacs\r\n    // no x, X, z and Z either\r\n};\r\n\r\nfunction createArgumentFunction(arg, cont) {\r\n    let reader = ARG_READERS[arg.charAt(0)];\r\n    arg = arg.substr(1);\r\n    return function() {\r\n        return reader.call(this, arg, cont);\r\n    };\r\n}\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nexport function Ymacs_Exception(why) {\r\n    this.message = why;\r\n};\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { DOM, EventProxy } from \"./ymacs-utils.js\";\r\n\r\nexport class Ymacs_Text_Properties extends EventProxy {\r\n\r\n    constructor({ buffer }) {\r\n        super(...arguments);\r\n        this.buffer = buffer;\r\n        this.reset();\r\n    }\r\n\r\n    reset() {\r\n        this.props = [];\r\n    }\r\n\r\n    insertLine(row) {\r\n        if (this.props.length < row)\r\n            this.props[row] = null;\r\n        else {\r\n            this.props.splice(row, 0, null);\r\n        }\r\n    }\r\n\r\n    deleteLine(row) {\r\n        this.props.splice(row, 1);\r\n    }\r\n\r\n    replaceLine(row, text) {\r\n        var p = this.props[row];\r\n        if (p && p.length > text.length) {\r\n            // remove extra-properties\r\n            p.splice(text.length);\r\n        }\r\n    }\r\n\r\n    addLineProps(row, i, j, prop, val) {\r\n        var p = this.props, o, changed = false;\r\n        if (i < j) {\r\n            p = p[row] || (p[row] = []);\r\n            while (i < j) {\r\n                o = p[i] || (p[i] = {});\r\n                if (o[prop] != val)\r\n                    changed = true;\r\n                o[prop] = val;\r\n                ++i;\r\n            }\r\n            if (changed)\r\n                this.callHooks(\"onChange\", row);\r\n        }\r\n        return changed;\r\n    }\r\n\r\n    removeLineProps(row, i, j, prop) {\r\n        var p = this.props[row], o, changed = false;\r\n        if (p && i < j) {\r\n            while (i < j) {\r\n                o = p[i];\r\n                if (o && prop in o) {\r\n                    changed = true;\r\n                    delete o[prop];\r\n                }\r\n                ++i;\r\n            }\r\n            if (changed)\r\n                this.callHooks(\"onChange\", row);\r\n        }\r\n        return changed;\r\n    }\r\n\r\n    spliceLineProps(row, i, diff) {\r\n        let p = this.props[row];\r\n        if (p) {\r\n            if (diff > 0) {\r\n                p.splice(i, 0, ...new Array(diff));\r\n            } else if (diff < 0) {\r\n                p.splice(i, -diff);\r\n            }\r\n        }\r\n    }\r\n\r\n    // this uses the \"css\" text property to intercalate <span class=\"$css\"> ... </span> tags in the given text.\r\n    // \"css\" properties are added as the tokenizer parses the code and sends onFoundToken events.\r\n    //\r\n    // XXX: this function will be called a lot of times; seems complicated for what it does. Figure out if it can be\r\n    // optimized.\r\n    //\r\n    // Update: the mess got bigger once I decided to embed the caret in the text, rather than have it absolutely\r\n    // positioned (which seems to be the only practical way to position the cursor at the correct location).  It is\r\n    // ESSENTIAL that the start tag of the element that defines the caret ends with \"Ymacs-caret'>\", so that the\r\n    // frame widget can find it.\r\n    getLineHTML(row, text, caret) {\r\n        var p = this.props[row];\r\n        if (caret === null) {\r\n            if (text == \"\")\r\n                return \"<br/>\";\r\n            if (!p || p.length == 0) {\r\n                return DOM.htmlEscape(text);\r\n            }\r\n        } else {\r\n            if (text == \"\")\r\n                return \"<span class='Ymacs-caret'>&nbsp;</span>\";\r\n            if (!p || p.length == 0) {\r\n                if (caret === text.length)\r\n                    return DOM.htmlEscape(text) + \"<span class='Ymacs-caret'>&nbsp;</span>\";\r\n                return DOM.htmlEscape(text.substr(0, caret)) +\r\n                    \"<span class='Ymacs-caret'>\" +\r\n                    DOM.htmlEscape(text.charAt(caret)) +\r\n                    \"</span>\" +\r\n                    DOM.htmlEscape(text.substr(caret + 1));\r\n            }\r\n        }\r\n        var i = 0, n = text.length, last = null, o, ret = \"\", ch;\r\n        while (i < n) {\r\n            o = p[i];\r\n            o = o && o.css;\r\n            if (i === caret) {\r\n                o = o ? o + \" Ymacs-caret\" : \"Ymacs-caret\";\r\n            }\r\n            if (o && o != last) {\r\n                if (last)\r\n                    ret += \"</a>\";\r\n                ret += \"<a \";\r\n                let prev = o;\r\n                o = o.replace(/:href-([^\\s]*)/g, function(s, p){\r\n                    if (p) ret += `href=\"${p}\" `;\r\n                    return \"\";\r\n                });\r\n                ret += \"class='\" + o + \"'>\";\r\n                o = prev;\r\n            }\r\n            else if (!o && last) {\r\n                ret += \"</a>\";\r\n            }\r\n            last = o;\r\n            // XXX: Should have used a hash rather than a\r\n            // switch statement?  I'm not sure but I have\r\n            // a feeling that switch is faster.\r\n            ch = text.charAt(i);\r\n            switch (ch) {\r\n              case \"<\" : ret += \"&lt;\"; break;\r\n              case \">\" : ret += \"&gt;\"; break;\r\n              case \"&\" : ret += \"&amp;\"; break;\r\n              default  : ret += ch; break;\r\n            }\r\n            ++i;\r\n        }\r\n        if (last)\r\n            ret += \"</a>\";\r\n        if (i === caret) {\r\n            // caret is at EOL\r\n            ret += \"<span class='Ymacs-caret'>&nbsp;</span>\";\r\n        }\r\n        return ret;\r\n    }\r\n\r\n}\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { DOM, Widget } from \"./ymacs-utils.js\";\r\nimport { Ymacs_Keymap } from \"./ymacs-keymap.js\";\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\n\r\nlet MENU = Symbol(\"MENU\");\r\n\r\nexport class Ymacs_Popup extends Widget {\r\n    static options = {};\r\n\r\n    constructor(...args) {\r\n        super(...args);\r\n        this._cont = DOM.fromHTML(`<div class=\"Ymacs_Menu\"></div>`);\r\n        this.getElement().appendChild(this._cont);\r\n    }\r\n\r\n    getContentElement() {\r\n        return this._cont;\r\n    }\r\n\r\n    initClassName() {\r\n        return \"Ymacs_Popup\";\r\n    }\r\n\r\n}\r\n\r\nvar KEYMAP_MENU_ACTIVE = Ymacs_Keymap.define(null, {\r\n    \"ArrowDown && C-n\" : handle_arrow_down,\r\n    \"ArrowUp && C-p\"   : handle_arrow_up,\r\n    \"PageDown\"         : handle_arrow_down,\r\n    \"PageUp\"           : handle_arrow_up,\r\n    \"C-End && M->\"     : handle_popup_end,\r\n    \"C-Home && M-<\"    : handle_popup_home,\r\n    \"Enter\"            : handle_enter,\r\n    \"Escape\"           : handle_escape,\r\n});\r\n\r\nKEYMAP_MENU_ACTIVE.defaultHandler = [ function() {\r\n    let buffer = this;\r\n    let menu = buffer[MENU];\r\n    menu.kill();\r\n    return false; // say it's not handled though\r\n} ];\r\n\r\nexport function popupMenu({\r\n    buffer,\r\n    items,\r\n    onSelect,\r\n} = {}) {\r\n    let menuWidget = new Ymacs_Popup();\r\n    menuWidget.addClass(\"with-arrow\");\r\n    items.forEach((label, index) => {\r\n        let value = label;\r\n        if (typeof label != \"string\") {\r\n            value = label.value;\r\n            label = label.label;\r\n        }\r\n        let el = DOM.fromHTML(`<div class=\"Ymacs_Menu_Item\" data-value=\"${DOM.htmlEscape(value)}\"\r\n                                          data-index=\"${index}\">${DOM.htmlEscape(label)}</div>`);\r\n        menuWidget.add(el);\r\n    });\r\n\r\n    buffer[MENU] = {\r\n        items: items,\r\n        widget: menuWidget,\r\n        onSelect: onSelect,\r\n        kill() {\r\n            menuWidget.destroy();\r\n            buffer[MENU] = null;\r\n        }\r\n    };\r\n\r\n    let activeElement = document.activeElement;\r\n    let ymacs = buffer.ymacs;\r\n    DOM.on(menuWidget.getContentElement(), {\r\n        click: ev => {\r\n            activeElement.focus();\r\n            let item = ev.target;\r\n            if (!DOM.hasClass(item, \"Ymacs_Menu_Item\")) return;\r\n            select(buffer, +item.dataset.index);\r\n            handle_enter.call(buffer);\r\n        },\r\n    });\r\n    ymacs._popupAtCaret(menuWidget.getElement());\r\n    select(buffer, 0);\r\n\r\n    buffer.pushKeymap(KEYMAP_MENU_ACTIVE);\r\n    menuWidget.addEventListener(\"onDestroy\", () => {\r\n        buffer.popKeymap(KEYMAP_MENU_ACTIVE);\r\n    });\r\n}\r\n\r\nfunction handle_arrow_up() {\r\n    let buffer = this;\r\n    let menu = buffer[MENU];\r\n    select(buffer, menu.selectedIndex - 1);\r\n}\r\n\r\nfunction handle_arrow_down() {\r\n    let buffer = this;\r\n    let menu = buffer[MENU];\r\n    select(buffer, menu.selectedIndex + 1);\r\n}\r\n\r\nfunction handle_popup_home() {\r\n    let buffer = this;\r\n    let menu = buffer[MENU];\r\n    select(buffer, 0);\r\n}\r\n\r\nfunction handle_popup_end() {\r\n    let buffer = this;\r\n    let menu = buffer[MENU];\r\n    select(buffer, -1);\r\n}\r\n\r\nfunction handle_enter() {\r\n    let buffer = this;\r\n    let menu = buffer[MENU];\r\n    if (!(menu.onSelect(menu.selectedIndex) === false)) {\r\n        menu.kill();\r\n    }\r\n}\r\n\r\nfunction handle_escape() {\r\n    let buffer = this;\r\n    let menu = buffer[MENU];\r\n    menu.kill();\r\n}\r\n\r\nfunction select(buffer, index) {\r\n    let menu = buffer[MENU];\r\n    let cont = menu.widget.getContentElement();\r\n    let elements = [...cont.querySelectorAll(\".Ymacs_Menu_Item\")];\r\n    let n = elements.length;\r\n    index = menu.selectedIndex = ((index % n) + n) % n;\r\n    elements.forEach(el => {\r\n        let current = el.dataset.index == index;\r\n        if (current) menu.selectedItem = el;\r\n        DOM.condClass(el, current, \"selected\");\r\n    });\r\n    menu.selectedItem.scrollIntoView({ block: \"nearest\" });\r\n}\r\n\r\nYmacs_Buffer.newCommands({\r\n    popup_menu: function(args) {\r\n        args.buffer = this;\r\n        popupMenu(args);\r\n    }\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { DOM, Widget, delayed } from \"./ymacs-utils.js\";\r\n\r\nfunction textColX(div, col) {\r\n    let range = document.createRange();\r\n    range.selectNodeContents(div);\r\n    let treeWalker = document.createTreeWalker(div, NodeFilter.SHOW_TEXT);\r\n    let len = 0;\r\n    while (treeWalker.nextNode()) {\r\n        let node = treeWalker.currentNode;\r\n        let clen = node.nodeValue.length;\r\n        if (len + clen >= col) {\r\n            range.setStart(node, col - len);\r\n            range.setEnd(node, col - len);\r\n            break;\r\n        }\r\n        len += clen;\r\n    }\r\n    return range.getBoundingClientRect().right;\r\n}\r\n\r\nfunction normalizeRect(p) {\r\n    return p.line1 > p.line2 || (p.line1 == p.line2 && p.col1 > p.col2) ?\r\n        { line1: p.line2, col1: p.col2, line2: p.line1, col2: p.col1 } : p;\r\n}\r\n\r\nvar DBL_CLICK_SPEED = 300;\r\nvar CLICK_COUNT = 0, CLICK_COUNT_TIMER = null, CLICK_LAST_TIME = null;\r\nfunction CLEAR_CLICK_COUNT() { CLICK_COUNT = null };\r\n\r\nvar LINE_DIV = DOM.fromHTML(`<div class=\"line\"><br/></div>`);\r\n\r\nvar COUNT = 0;\r\n\r\nexport class Ymacs_Frame extends Widget {\r\n\r\n    static options = {\r\n        buffer               : null,\r\n        ymacs                : null,\r\n        isMinibuffer         : false,\r\n        point                : null,\r\n    };\r\n\r\n    constructor(...args) {\r\n        super(...args);\r\n\r\n        this.buffer = this.o.buffer;\r\n        this.ymacs = this.o.ymacs;\r\n        this.isMinibuffer = this.o.isMinibuffer;\r\n\r\n        this.id = `ymacs-frame-${++COUNT}`;\r\n        this.__caretId = `ymacs-caret-${COUNT}`;\r\n        this.redrawModelineWithTimer = delayed(this.redrawModeline.bind(this));\r\n\r\n        this.getElement().tabIndex = 0;\r\n        this.getElement().innerHTML = \"<div class='Ymacs-frame-overlays'>\"\r\n            + \"<div class='Ymacs-frame-content'></div>\"\r\n            + \"</div>\"\r\n            + \"<div class='Ymacs_Modeline'></div>\";\r\n\r\n        this.addEventListener({\r\n            onDestroy    : this._on_destroy,\r\n        });\r\n\r\n        this._dragSelectHandlers = {\r\n            mousemove : this._dragSelect_onMouseMove.bind(this),\r\n            mouseup   : this._dragSelect_onMouseUp.bind(this)\r\n        };\r\n\r\n        this._bufferEvents = {\r\n            onLineChange             : this._on_bufferLineChange.bind(this),\r\n            onInsertLine             : this._on_bufferInsertLine.bind(this),\r\n            onDeleteLine             : this._on_bufferDeleteLine.bind(this),\r\n            onPointChange            : this._on_bufferPointChange.bind(this),\r\n            onResetCode              : this._on_bufferResetCode.bind(this),\r\n            onOverwriteMode          : this._on_bufferOverwriteMode.bind(this),\r\n            onModelineChange         : this._on_bufferModelineChange.bind(this),\r\n            beforeInteractiveCommand : this._on_bufferBeforeInteractiveCommand.bind(this),\r\n            afterInteractiveCommand  : this._on_bufferAfterInteractiveCommand.bind(this),\r\n            onOverlayChange          : this._on_bufferOverlayChange.bind(this),\r\n            onOverlayDelete          : this._on_bufferOverlayDelete.bind(this),\r\n        };\r\n\r\n        this._moreBufferEvents = {\r\n            onMessage               : this._on_bufferMessage.bind(this),\r\n            afterInteractiveCommand : function(){\r\n                if (this.__ensureCaretVisible)\r\n                    this.ensureCaretVisible();\r\n            }.bind(this)\r\n        };\r\n\r\n        var buffer = this.buffer;\r\n        this.buffer = null;\r\n        if (buffer)\r\n            this.setBuffer(buffer, this.o.point);\r\n\r\n        DOM.on(this.getOverlaysContainer(), \"scroll\", this._on_scroll.bind(this));\r\n        DOM.on(this.getElement(), {\r\n            mousedown   : this._dragSelect_onMouseDown.bind(this),\r\n            focus       : this._on_focus.bind(this),\r\n            blur        : this._on_blur.bind(this),\r\n            keydown     : this._on_keyDown.bind(this),\r\n            keyup       : this._on_keyUp.bind(this),\r\n            wheel       : this._on_mouseWheel.bind(this),\r\n        });\r\n    }\r\n\r\n    initClassName() {\r\n        return `Ymacs_Frame${this.o.isMinibuffer ? ' Ymacs_Minibuffer' : ''}`;\r\n    }\r\n\r\n    focus(exitAllowed) {\r\n        this.getElement().focus();\r\n        // if (exitAllowed instanceof Function) {\r\n        //     this.removeEventListener(\"onBlur\", this.__exitFocusHandler);\r\n        //     this.addEventListener(\"onBlur\", this.__exitFocusHandler = function(){\r\n        //         if (exitAllowed.call(this.buffer)) {\r\n        //             this.removeEventListener(\"onBlur\", this.__exitFocusHandler);\r\n        //         } else {\r\n        //             this.focus.delayed(2, this, null);\r\n        //         }\r\n        //     });\r\n        // }\r\n    }\r\n\r\n    blur(force) {\r\n        // if (force)\r\n        //     this.removeEventListener(\"onBlur\", this.__exitFocusHandler);\r\n    }\r\n\r\n    getOverlaysContainer() {\r\n        return this.getElement().firstChild;\r\n    }\r\n\r\n    getModelineElement() {\r\n        return this.getElement().childNodes[1];\r\n    }\r\n\r\n    getContentElement() {\r\n        return this.getElement().firstChild.firstChild;\r\n    }\r\n\r\n    getCaretElement() {\r\n        return document.getElementById(this.__caretId);\r\n    }\r\n\r\n    getLineDivElement(row) {\r\n        return this.getContentElement().childNodes[row] || null;\r\n    }\r\n\r\n    ensureCaretVisible() {\r\n        // return true if the scroll position has changed\r\n        let div = this.getOverlaysContainer();\r\n        let st = div.scrollTop;\r\n        this.redrawCaret();\r\n        let caret = this.getCaretElement();\r\n        if (caret) {\r\n            caret.scrollIntoView({ block: \"nearest\", inline: \"nearest\" });\r\n            if (caret.offsetLeft < div.clientWidth / 2) {\r\n                div.scrollLeft = 0;\r\n            }\r\n        }\r\n        return st != div.scrollTop;\r\n    }\r\n\r\n    focusInside() {\r\n        return document.activeElement === this.getElement();\r\n    }\r\n\r\n    setBuffer(buffer, point) {\r\n        if (buffer === this.buffer) return;\r\n        if (this.buffer) {\r\n            if (this.caretMarker && !this.o.isMinibuffer) {\r\n                this.caretMarker.destroy();\r\n                this.caretMarker = null;\r\n            }\r\n            this.buffer.removeEventListener(this._bufferEvents);\r\n            this.buffer.removeEventListener(this._moreBufferEvents);\r\n        }\r\n        this.buffer = buffer;\r\n        if (buffer) {\r\n            buffer.addEventListener(this._bufferEvents);\r\n            if (this.focusInside()) {\r\n                buffer.addEventListener(this._moreBufferEvents);\r\n            }\r\n            if (this.o.isMinibuffer) {\r\n                this.caretMarker = buffer.caretMarker;\r\n            } else {\r\n                this.caretMarker = buffer.createMarker(point ?? +buffer.caretMarker, false, \"framecaret\");\r\n            }\r\n            this._redrawBuffer();\r\n            this.redrawCaret(true);\r\n            this.centerOnCaret();\r\n        }\r\n    }\r\n\r\n    recenterTopBottom(pos = 1) {\r\n        let row = this.buffer._rowcol.row;\r\n        let line = this.getLineDivElement(row);\r\n        let div = this.getOverlaysContainer();\r\n        let center = Math.round(line.offsetTop - div.clientHeight / 2 + line.offsetHeight / 2);\r\n        let top = Math.round(line.offsetTop);\r\n        let bottom = Math.round(line.offsetTop - div.clientHeight + line.offsetHeight);\r\n        if (pos == 0) div.scrollTop = center;\r\n        else if (pos == 1) div.scrollTop = top;\r\n        else div.scrollTop = bottom;\r\n    }\r\n\r\n    centerOnCaret() {\r\n        this.centerOnLine(this.buffer._rowcol.row);\r\n    }\r\n\r\n    centerOnLine(row) {\r\n        var line = this.getLineDivElement(row), div = this.getOverlaysContainer();\r\n        div.scrollTop = Math.round(line.offsetTop - div.clientHeight / 2 + line.offsetHeight / 2);\r\n        // this._redrawBuffer();\r\n    }\r\n\r\n    setModelineContent(html) {\r\n        this.getModelineElement().innerHTML = html;\r\n    }\r\n\r\n    deleteOtherFrames() {\r\n        this.ymacs.keepOnlyFrame(this);\r\n    }\r\n\r\n    deleteFrame() {\r\n        this.ymacs.deleteFrame(this);\r\n    }\r\n\r\n    _split(horiz) {\r\n        let ovdiv = this.getOverlaysContainer();\r\n        let scroll = ovdiv.scrollTop;\r\n        let fr = this.ymacs.createFrame({ buffer: this.buffer });\r\n        let sc = new Ymacs_SplitCont({ horiz: horiz });\r\n        this.getElement().replaceWith(sc.getElement());\r\n        sc.setSplit(this, fr);\r\n        ovdiv.scrollTop = scroll;\r\n        fr.getOverlaysContainer().scrollTop = scroll;\r\n        this.focus(); // XXX: only if necessary\r\n        return fr;\r\n    }\r\n\r\n    vsplit() {\r\n        return this._split(true);\r\n    }\r\n\r\n    hsplit(percent) {\r\n        return this._split(false);\r\n    }\r\n\r\n    __showCaret() {\r\n        DOM.addClass(this.getCaretElement(), \"Ymacs-caret\");\r\n    }\r\n\r\n    redrawCaret(force) {\r\n        if (this.o.isMinibuffer) force = true;\r\n        var isActive = this.ymacs.getActiveFrame() === this;\r\n        if (!force && !isActive)\r\n            return;\r\n\r\n        if (isActive && !this.o.isMinibuffer && this.focusInside())\r\n            this.caretMarker.setPosition(this.buffer.caretMarker.getPosition());\r\n\r\n        var rc = this.buffer._rowcol;\r\n\r\n        // hide stale carets :-\\\r\n        // mess everywhere.\r\n        [...this.getElement().querySelectorAll(\".Ymacs-caret, #\" + this.__caretId)].forEach(el => {\r\n            el.id = \"\";\r\n            el.className = \"\";\r\n        });\r\n\r\n        // redraw the line where the caret was previously, so that it disappears from there\r\n        if (this.__prevCaretLine != null) {\r\n            this._on_bufferLineChange(this.__prevCaretLine);\r\n        }\r\n\r\n        // redraw current line if it's different\r\n        if (this.__prevCaretLine != rc.row) {\r\n            this.__prevCaretLine = rc.row;\r\n            this._on_bufferLineChange(rc.row);\r\n        }\r\n\r\n        this.callHooks(\"onPointChange\", rc.row, rc.col);\r\n        this.redrawModelineWithTimer(rc);\r\n    }\r\n\r\n    _getLineHTML(row) {\r\n        var html = this.buffer.formatLineHTML(row, this.caretMarker);\r\n        // taking advantage of the fact that a literal > entered by the user will never appear in\r\n        // the generated HTML, since special HTMl characters are escaped.\r\n        var pos = html.indexOf(\"Ymacs-caret'>\");\r\n        if (pos >= 0) {\r\n            html = html.substr(0, pos + 12)\r\n                + \" id='\" + this.__caretId + \"'\"\r\n                + html.substr(pos + 12);\r\n        }\r\n        return html;\r\n    }\r\n\r\n    _redrawBuffer() {\r\n        this.setContent(this.buffer.code.map((line, i) =>\r\n            `<div class=\"line\">${this._getLineHTML(i)}</div>`\r\n        ).join(\"\"));\r\n    }\r\n\r\n    coordinatesToRowCol(x, y) {\r\n        function findLine(r1, r2) {\r\n            if (r1 >= r2)\r\n                return r1;\r\n            var row = Math.floor((r1 + r2) / 2);\r\n            var div = self.getLineDivElement(row);\r\n            var y1  = div.offsetTop;\r\n            var y2  = y1 + div.offsetHeight;\r\n            if (y2 < y)\r\n                return findLine(row + 1, r2);\r\n            if (y < y1)\r\n                return findLine(r1, row - 1);\r\n            return row;\r\n        };\r\n        function findCol(c1, c2) {\r\n            if (c1 >= c2)\r\n                return c1;\r\n            var col = Math.floor((c1 + c2) / 2);\r\n            var p1 = self.coordinates(row, col),\r\n                p2 = self.coordinates(row, col + 1);\r\n            if (p2.x < x)\r\n                return findCol(col + 1, c2);\r\n            if (x < p1.x)\r\n                return findCol(c1, col - 1);\r\n            return col;\r\n        };\r\n        var self = this,\r\n            row = findLine(0, this.buffer.code.length - 1),\r\n            col = findCol(0, this.buffer.code[row].length);\r\n        return { row: row, col: col };\r\n    }\r\n\r\n    coordinates(row, col) {\r\n        var box = this.getContentElement().getBoundingClientRect();\r\n        var div = this.getLineDivElement(row);\r\n        return {\r\n            x: textColX(div, col) - box.left,\r\n            y: div.offsetTop,\r\n            h: div.offsetHeight\r\n        };\r\n    }\r\n\r\n    heightInLines() {\r\n        return Math.floor(this.getOverlaysContainer().clientHeight / this.getContentElement().firstChild.offsetHeight);\r\n    }\r\n\r\n    redrawModeline(rc) {\r\n        if (!rc) rc = this.caretMarker.getRowCol();\r\n        var maxline = this.buffer.code.length - 1;\r\n        var firstline = this.firstLineVisible();\r\n        var lastline = this.lastLineVisible();\r\n        var percent = firstline == 0\r\n            ? \"Top\"\r\n            : lastline == maxline\r\n            ? \"Bot\"\r\n            : Math.round(lastline / maxline * 100) + \"%\";\r\n        this.setModelineContent(this.buffer.renderModelineContent(rc, percent));\r\n    }\r\n\r\n    /* -----[ event handlers ]----- */\r\n\r\n    _on_bufferLineChange(row) {\r\n        var div = this.getLineDivElement(row);\r\n        if (div) {\r\n            //console.log(\"Redrawing line %d [%s]\", row, this.buffer.code[row]);\r\n            //console.log(new Error().stack);\r\n            div.innerHTML = this._getLineHTML(row);\r\n        }\r\n    }\r\n\r\n    _on_bufferInsertLine(row, drawIt) {\r\n        var div = LINE_DIV.cloneNode(true);\r\n        this.getContentElement().insertBefore(div, this.getLineDivElement(row));\r\n        if (drawIt) {\r\n            div.innerHTML = this._getLineHTML(row);\r\n        }\r\n    }\r\n\r\n    _on_bufferDeleteLine(row) {\r\n        DOM.trash(this.getLineDivElement(row));\r\n    }\r\n\r\n    _on_bufferPointChange(rc, pos) {\r\n        this.redrawCaret();\r\n    }\r\n\r\n    _on_bufferResetCode() {\r\n        this._redrawBuffer();\r\n    }\r\n\r\n    _on_bufferOverwriteMode(om) {\r\n        this.condClass(om, \"Ymacs-overwrite-mode\");\r\n    }\r\n\r\n    _on_bufferMessage(args) {\r\n        this.ymacs.popupMessage(args);\r\n    }\r\n\r\n    _on_bufferBeforeInteractiveCommand() {\r\n        this.__ensureCaretVisible = true;\r\n        this.ymacs.clearPopupMessage();\r\n    }\r\n\r\n    _on_bufferAfterInteractiveCommand() {}\r\n\r\n    _on_bufferModelineChange() {\r\n        this.redrawModelineWithTimer(null);\r\n    }\r\n\r\n    getOverlayId(name) {\r\n        return this.id + \"-ovl-\" + name;\r\n    }\r\n\r\n    getOverlayHTML(name, props) {\r\n        var str = \"\";\r\n        props.forEach(p => {\r\n            if (p.line1 == p.line2 && p.col1 == p.col2) {\r\n                return;\r\n            }\r\n            p = normalizeRect(p);\r\n            var p1 = this.coordinates(p.line1, p.col1);\r\n            var p2 = this.coordinates(p.line2, p.col2);\r\n            var p0 = p.col1 == 0 ? p1 : this.coordinates(p.line1, 0);\r\n            if (p.line1 == p.line2) {\r\n                str += `<div class=\"${name}\" style=\"\r\n                    top: ${p1.y}px;\r\n                    left: ${p1.x}px;\r\n                    height: ${p1.h}px;\r\n                    width: ${p2.x - p1.x}px;\r\n                \"></div>`;\r\n            } else {\r\n                str += `<div class=\"${name}\" style=\"\r\n                    top: ${p1.y}px;\r\n                    left: ${p1.x}px;\r\n                    height: ${p.col1 > 0 ? p1.h : p2.y - p1.y}px;\r\n                \"></div>`;\r\n                if (p.col1 > 0 && p.line2 - p.line1 > 1) {\r\n                    str += `<div class=\"${name}\" style=\"\r\n                        top: ${p1.y + p1.h}px;\r\n                        left: ${p0.x}px;\r\n                        height: ${p2.y - p1.y - p1.h}px;\r\n                    \"></div>`;\r\n                }\r\n                if (p.col2 > 0) {\r\n                    str += `<div class=\"${name}\" style=\"\r\n                        top: ${p2.y}px;\r\n                        left: ${p0.x}px;\r\n                        height: ${p2.h}px;\r\n                        width: ${p2.x - p0.x}px;\r\n                    \"></div>`;\r\n                }\r\n            }\r\n        });\r\n        return str ? `<div id=\"${this.getOverlayId(name)}\" data-ymacs-overlay=\"${name}\" class=\"Ymacs_Overlay ${name}\">${str}</div>` : null;\r\n    }\r\n\r\n    getOverlaysCount() {\r\n        return this.getOverlaysContainer().childNodes.length - 1; // XXX: subtract the div.content; we need to revisit this if we add new elements.\r\n    }\r\n\r\n    _on_bufferOverlayChange(name, props) {\r\n        let html = this.getOverlayHTML(name, Array.isArray(props) ? props : [ props ]);\r\n        if (html) {\r\n            let div = DOM.fromHTML(html);\r\n            let old = document.getElementById(this.getOverlayId(name));\r\n            old ? old.replaceWith(div) : this.getOverlaysContainer().appendChild(div);\r\n            this._setOverlayClasses();\r\n        } else {\r\n            this._on_bufferOverlayDelete(name);\r\n        }\r\n    }\r\n\r\n    _on_bufferOverlayDelete(name) {\r\n        DOM.trash(document.getElementById(this.getOverlayId(name)));\r\n        this._setOverlayClasses();\r\n    }\r\n\r\n    _setOverlayClasses() {\r\n        let names = [\r\n            ...this.getOverlaysContainer().querySelectorAll(\":scope > [data-ymacs-overlay]\")\r\n        ].map(el => el.dataset.ymacsOverlay);\r\n        this.condClass(names.length > 0, \"Ymacs_Frame-hasOverlays\");\r\n        this.getElement().dataset.ymacsOverlays = names.join(\" \");\r\n    }\r\n\r\n    /* -----[ self events ]----- */\r\n\r\n    _on_destroy() {\r\n        this.setBuffer(null);\r\n    }\r\n\r\n    _on_focus() {\r\n        this.ymacs.setActiveFrame(this, true);\r\n        if (!this.o.isMinibuffer) {\r\n            this.buffer.cmd(\"goto_char\", this.caretMarker.getPosition());\r\n        }\r\n        this.buffer.addEventListener(this._moreBufferEvents);\r\n    }\r\n\r\n    _on_blur() {\r\n        if (!this.o.isMinibuffer) {\r\n            this.caretMarker.setPosition(this.buffer.caretMarker.getPosition());\r\n        }\r\n        this.buffer.removeEventListener(this._moreBufferEvents);\r\n    }\r\n\r\n    _dragSelect_onMouseDown(ev) {\r\n        if (ev.ctrlKey && ev.shiftKey)\r\n            return;\r\n        if (ev.button != 0) {\r\n            setTimeout(() => this.focus());\r\n            return;\r\n        }\r\n        this.focus();\r\n        ev.stopPropagation();\r\n        ev.preventDefault();\r\n\r\n        clearTimeout(CLICK_COUNT_TIMER);\r\n        CLICK_COUNT++;\r\n        CLICK_COUNT_TIMER = setTimeout(CLEAR_CLICK_COUNT, DBL_CLICK_SPEED);\r\n\r\n        let pos = DOM.mousePos(ev, this.getContentElement());\r\n        let rc = this.coordinatesToRowCol(pos.x, pos.y);\r\n        let buf = this.buffer;\r\n\r\n        setTimeout(() => {\r\n            buf.clearTransientMark();\r\n            buf.cmd(\"goto_char\", buf._rowColToPosition(rc.row, rc.col));\r\n            buf.callInteractively(\"keyboard_quit\");\r\n            if (CLICK_COUNT == 1) {\r\n                buf.ensureTransientMark();\r\n                DOM.on(window, this._dragSelectHandlers);\r\n            }\r\n            else if (CLICK_COUNT == 2) {\r\n                buf.cmd(\"forward_word\");\r\n                buf.cmd(\"backward_word\");\r\n                buf.cmd(\"forward_word_mark\");\r\n            }\r\n            else if (CLICK_COUNT == 3) {\r\n                buf.cmd(\"beginning_of_line\");\r\n                buf.cmd(\"end_of_line_mark\");\r\n            }\r\n            else if (CLICK_COUNT == 4) {\r\n                buf.cmd(\"backward_paragraph\");\r\n                buf.cmd(\"forward_whitespace\");\r\n                buf.cmd(\"beginning_of_line\");\r\n                buf.cmd(\"forward_paragraph_mark\");\r\n            }\r\n        });\r\n    }\r\n\r\n    _dragSelect_onMouseMove(ev) {\r\n        let pos = DOM.mousePos(ev, this.getContentElement());\r\n        let rc = this.coordinatesToRowCol(pos.x, pos.y);\r\n        this.buffer.cmd(\"goto_char\", this.buffer._rowColToPosition(rc.row, rc.col));\r\n        this.buffer.ensureTransientMark();\r\n        this.ensureCaretVisible();\r\n    }\r\n\r\n    _dragSelect_onMouseUp(ev) {\r\n        DOM.off(window, this._dragSelectHandlers);\r\n    }\r\n\r\n    _on_keyDown(ev) {\r\n        if (!isModifier(ev.key)) {\r\n            if (this.ymacs.processKeyEvent(ev)) {\r\n                ev.preventDefault();\r\n                ev.stopPropagation();\r\n            }\r\n        }\r\n    }\r\n\r\n    _on_keyUp(ev) {\r\n    }\r\n\r\n    _on_scroll() {\r\n        this.redrawModelineWithTimer();\r\n    }\r\n\r\n    _on_mouseWheel(ev) {\r\n        ev.preventDefault();\r\n        this.buffer._handleKeyEvent(ev);\r\n    }\r\n\r\n    firstLineVisible() {\r\n        var div = this.getOverlaysContainer();\r\n        return this.coordinatesToRowCol(1, div.scrollTop + 1).row;\r\n    }\r\n\r\n    lastLineVisible() {\r\n        var div = this.getOverlaysContainer();\r\n        return this.coordinatesToRowCol(div.clientWidth - 2, div.scrollTop + div.clientHeight - 2).row;\r\n    }\r\n\r\n    scrollUp(lines) {\r\n        var div = this.getOverlaysContainer();\r\n        var line = Math.max(this.firstLineVisible() - lines, 0);\r\n        line = this.getLineDivElement(line);\r\n        div.scrollTop = line.offsetTop;\r\n        this.__ensureCaretVisible = false;\r\n    }\r\n\r\n    scrollDown(lines) {\r\n        var div = this.getOverlaysContainer();\r\n        var line = Math.min(this.firstLineVisible() + lines, this.buffer.code.length - 1);\r\n        line = this.getLineDivElement(line);\r\n        div.scrollTop = line.offsetTop;\r\n        this.__ensureCaretVisible = false;\r\n    }\r\n}\r\n\r\nfunction isModifier(key) {\r\n    return /^(?:Alt|AltGraph|CapsLock|Control|Fn|FnLock|Hyper|Meta|NumLock|ScrollLock|Shift|Super|Symbol|SymbolLock)$/.test(key);\r\n}\r\n\r\nexport class Ymacs_SplitCont extends Widget {\r\n    static options = {\r\n        horiz: false\r\n    };\r\n    #activeElement = null;\r\n    initClassName() {\r\n        return \"Ymacs_SplitCont \" + (this.o.horiz ? \"horiz\" : \"vert\");\r\n    }\r\n    createElement() {\r\n        super.createElement();\r\n        this._dragHandlers = {\r\n            mousemove : this._onMouseMove.bind(this),\r\n            mouseup   : this._onMouseUp.bind(this),\r\n        };\r\n        this._rb = DOM.fromHTML(`<div class=\"bar\" tabindex=\"0\"></div>`);\r\n        DOM.on(this._rb, \"mousedown\", this._onMouseDown.bind(this));\r\n    }\r\n    setSplit(a, b, frac) {\r\n        this.add(a);\r\n        this.add(this._rb);\r\n        this.add(b);\r\n        if (frac != null) {\r\n            let cont = this.getElement();\r\n            if (this.o.horiz) {\r\n                cont.style.gridTemplateRows = `${frac}fr auto ${1-frac}fr`;\r\n            } else {\r\n                cont.style.gridTemplateColumns = `${frac}fr auto ${1-frac}fr`;\r\n            }\r\n        }\r\n    }\r\n    _onMouseDown(ev) {\r\n        this.#activeElement = document.activeElement;\r\n        if (ev.target === this._rb) {\r\n            let first = this.getContentElement().children[0];\r\n            this._start = this.o.horiz ? ev.clientY : ev.clientX;\r\n            this._orig_sz = this.o.horiz ? first.offsetHeight : first.offsetWidth;\r\n            this.addClass(\"dragging\");\r\n            ev.stopPropagation();\r\n            DOM.on(window, this._dragHandlers);\r\n            DOM.overlayOn(this.o.horiz ? \"Ymacs_Resize_horiz\" : \"Ymacs_Resize_vert\");\r\n        } else if (this.#activeElement) {\r\n            this.#activeElement.focus();\r\n        }\r\n    }\r\n    _onMouseUp(ev) {\r\n        DOM.off(window, this._dragHandlers);\r\n        this.delClass(\"dragging\");\r\n        DOM.overlayOff();\r\n        if (this.#activeElement) {\r\n            this.#activeElement.focus();\r\n        }\r\n        this.#activeElement = null;\r\n    }\r\n    _onMouseMove(ev) {\r\n        let cont = this.getElement();\r\n        let max = this.o.horiz ? cont.offsetHeight : cont.offsetWidth;\r\n        let diff = (this.o.horiz ? ev.clientY : ev.clientX) - this._start;\r\n        let target = Math.min(max, Math.max(0, this._orig_sz + diff));\r\n        let frac = Math.min(0.9, Math.max(0.1, target / max));\r\n        if (this.o.horiz) {\r\n            cont.style.gridTemplateRows = `${frac}fr auto ${1-frac}fr`;\r\n        } else {\r\n            cont.style.gridTemplateColumns = `${frac}fr auto ${1-frac}fr`;\r\n        }\r\n    }\r\n}\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { delayed, EventProxy } from \"./ymacs-utils.js\";\r\n\r\nconst TOK_DELAY = 10;\r\n\r\nexport class Ymacs_Stream {\r\n\r\n    constructor({\r\n        buffer = null,\r\n        line = 0,\r\n        col = 0\r\n    } = {}) {\r\n        this.buffer = buffer;\r\n        this.line = line;\r\n        this.col = col;\r\n    }\r\n\r\n    nextLine() {\r\n        ++this.line;\r\n        this.col = 0;\r\n        return this.line < this.buffer.code.length;\r\n    }\r\n\r\n    prevLine() {\r\n        --this.line;\r\n        this.col = 0;\r\n        return this.line >= 0;\r\n    }\r\n\r\n    peek(n = 0) {\r\n        if (this.line < this.buffer.code.length) {\r\n            let pos = this.col + n;\r\n            let line = this.buffer.code[this.line];\r\n            if (pos < line.length) return line.charAt(pos);\r\n            if (pos == line.length) return \"\\n\";\r\n        }\r\n    }\r\n\r\n    lineText(row = this.line) {\r\n        return this.buffer.code[row];\r\n    }\r\n\r\n    lineIndentation(row = this.line) {\r\n        return /^\\s*/.exec(this.lineText(row))[0].length;\r\n    }\r\n\r\n    lookingAt(what) {\r\n        if (this.line < this.buffer.code.length) {\r\n            var line = this.buffer.code[this.line];\r\n            if (what instanceof RegExp) {\r\n                return what.exec(line.substr(this.col));\r\n            } else {\r\n                return line.substr(this.col, what.length) == what ? [ what ] : null;\r\n            }\r\n        }\r\n    }\r\n\r\n    textBefore(pos) {\r\n        if (pos == null)\r\n            pos = this.buffer._rowColToPosition(this.line, this.col);\r\n        return this.buffer.getCode().substr(0, pos);\r\n    }\r\n\r\n    textAfter(pos) {\r\n        if (pos == null)\r\n            pos = this.buffer._rowColToPosition(this.line, this.col);\r\n        return this.buffer.getCode().substr(pos);\r\n    }\r\n\r\n    substring(start, end) {\r\n        return this.buffer.getCode().substring(start, end);\r\n    }\r\n\r\n    substr(start, end) {\r\n        return this.buffer.getCode().substr(start, end);\r\n    }\r\n\r\n    eol() {\r\n        return this.col >= this.buffer.code[this.line].length;\r\n    }\r\n\r\n    eof() {\r\n        var n = this.buffer.code.length, l = this.line;\r\n        return l >= n || l == n - 1 && this.eol();\r\n    }\r\n\r\n    stopAt(line, col, stop = this.EOF) {\r\n        this.__stop = { line, col, stop };\r\n    }\r\n\r\n    length() {\r\n        return this.buffer.code.length;\r\n    }\r\n\r\n    lineLength(line) {\r\n        if (line == null)\r\n            line = this.line;\r\n        return this.buffer.code[line].length;\r\n    }\r\n\r\n    save() {\r\n        return { buffer: this.buffer, line: this.line, col: this.col };\r\n    }\r\n\r\n    restore(state) {\r\n        this.buffer = state.buffer;\r\n        this.line = state.line;\r\n        this.col = state.col;\r\n    }\r\n\r\n    checkStop() {\r\n        if (this.eof()) throw this.EOF;\r\n        if (this.eol()) throw this.EOL;\r\n        let stop = this.__stop;\r\n        if (stop) {\r\n            if (this.line > stop.line\r\n                || (this.line == stop.line && this.col >= stop.col)) {\r\n                this.__stop = null;\r\n                throw stop.stop ?? this.EOF;\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\nYmacs_Stream.prototype.EOL = {};\r\nYmacs_Stream.prototype.EOF = {};\r\n\r\nexport class Ymacs_Simple_Stream {\r\n\r\n    constructor({\r\n        buffer = null,\r\n        line = 0,\r\n        col = 0,\r\n        pos = null\r\n    } = {}) {\r\n        this.buffer = buffer;\r\n        this.line = line;\r\n        this.col = col;\r\n        this.pos = pos;\r\n\r\n        if (this.pos == null) {\r\n            this.pos = this.buffer._rowColToPosition(this.line, this.col);\r\n        } else {\r\n            var rc = this.buffer._positionToRowCol(this.pos);\r\n            this.line = rc.row;\r\n            this.col = rc.col;\r\n        }\r\n    }\r\n\r\n    static is_whitespace(ch) {\r\n        switch (ch) {\r\n          case \" \":\r\n          case \"\\n\":\r\n          case \"\\t\":\r\n          case \"\\x0C\":\r\n          case \"\\u2028\":\r\n          case \"\\u2029\":\r\n          case \"\\xA0\":\r\n            return true;\r\n        }\r\n    }\r\n\r\n    peek() {\r\n        var a = this.buffer.code;\r\n        var line = a[this.line];\r\n        if (line == null) return null;\r\n        if (this.col == line.length)\r\n            return this.line == a.length - 1 ? null : \"\\n\";\r\n        return line.charAt(this.col);\r\n    }\r\n\r\n    next() {\r\n        var ch = this.peek();\r\n        if (ch) {\r\n            ++this.pos;\r\n            ++this.col;\r\n            if (this.col > this.buffer.code[this.line].length) {\r\n                this.col = 0;\r\n                ++this.line;\r\n            }\r\n        }\r\n        return ch;\r\n    }\r\n\r\n    read_while(pred) {\r\n        var ret = \"\", ch;\r\n        while ((ch = this.peek()) && pred(ch))\r\n            ret += this.next();\r\n        return ret;\r\n    }\r\n\r\n    skip_ws() {\r\n        return this.read_while(this.is_whitespace);\r\n    }\r\n\r\n    looking_at(what) {\r\n        var line = this.buffer.code[this.line];\r\n        if (what instanceof RegExp) {\r\n            return what.exec(line.substr(this.col));\r\n        } else {\r\n            return line.substr(this.col, what.length) == what;\r\n        }\r\n    }\r\n\r\n}\r\n\r\nYmacs_Simple_Stream.prototype.is_whitespace = Ymacs_Simple_Stream.is_whitespace;\r\n\r\nlet LANGUAGES = Object.create(null);\r\n\r\nexport class Ymacs_Tokenizer extends EventProxy {\r\n\r\n    static define(name, func) {\r\n        LANGUAGES[name.toLowerCase()] = func;\r\n    }\r\n\r\n    constructor({ buffer, type }) {\r\n        super();\r\n\r\n        if (typeof type == \"string\") {\r\n            type = LANGUAGES[type.toLowerCase()];\r\n        }\r\n\r\n        this.buffer = buffer;\r\n        this.type = type;\r\n    }\r\n\r\n    reset() {\r\n        this.stream = new Ymacs_Stream({ buffer: this.buffer });\r\n        this.theParser = this.type(this.stream, this);\r\n        this.parsers = [ this.theParser.copy() ];\r\n        this.timerUpdate = null;\r\n        this.start();\r\n    }\r\n\r\n    stop() {\r\n        clearTimeout(this.timerUpdate);\r\n    }\r\n\r\n    getLanguage(name, options) {\r\n        return LANGUAGES[name](this.stream, this, options);\r\n    }\r\n\r\n    start() {\r\n        this.stop();\r\n        let stream = this.stream, p, a = this.parsers;\r\n        stream.line = a.length - 1;\r\n        stream.col = 0;\r\n        while (!(p = a[stream.line]))\r\n            stream.prevLine();\r\n        p = p();\r\n        let doit = () => {\r\n            this.buffer.preventUpdates();\r\n            let n = 100;\r\n            while (true) {\r\n                try {\r\n                    while (true) p.next();\r\n                }\r\n                catch(ex) {\r\n                    if (ex === stream.EOL) {\r\n                        stream.nextLine();\r\n                        a[stream.line] = p.copy();\r\n                        if  (--n == 0) {\r\n                            this.buffer.resumeUpdates();\r\n                            this.timerUpdate = setTimeout(doit, TOK_DELAY);\r\n                            return;\r\n                        }\r\n                    }\r\n                    else if (ex === stream.EOF) {\r\n                        this.buffer.resumeUpdates();\r\n                        break;\r\n                    }\r\n                    else throw ex;\r\n                }\r\n            }\r\n        };\r\n        doit();\r\n    }\r\n\r\n    quickInsertLine(row) {\r\n        this.truncate(row);\r\n    }\r\n\r\n    quickDeleteLine(row) {\r\n        this.truncate(row);\r\n    }\r\n\r\n    onToken(line, c1, c2, type) {\r\n        this.callHooks(\"onFoundToken\", line, c1, c2, type);\r\n    }\r\n\r\n    getParserForLine(row, col = 0) {\r\n        this.stop();\r\n        let stream = this.stream, p, a = this.parsers;\r\n        stream.line = row;\r\n        stream.col = 0;\r\n        while (!(p = a[stream.line]))\r\n            stream.prevLine();\r\n        if (col != null) {\r\n            stream.stopAt(row, col);\r\n        }\r\n        p = p();\r\n        try {\r\n            this.buffer.preventUpdates();\r\n            while (true) {\r\n                if (col == null && stream.line == row) {\r\n                    return p;\r\n                }\r\n                try {\r\n                    while (true) p.next();\r\n                } catch(ex) {\r\n                    if (ex === stream.EOL) {\r\n                        stream.nextLine();\r\n                        a[stream.line] = p.copy();\r\n                    }\r\n                    else if (ex === stream.EOF) {\r\n                        return p;\r\n                    }\r\n                    else {\r\n                        throw ex;\r\n                    }\r\n                }\r\n            }\r\n        } finally {\r\n            this.buffer.resumeUpdates();\r\n            if (stream.line < stream.length())\r\n                this.timerUpdate = setTimeout(this.start.bind(this, stream.line), TOK_DELAY);\r\n        }\r\n    }\r\n\r\n    parseUntil(row, col) {\r\n        return this.getParserForLine(row, col);\r\n    }\r\n\r\n    reparseAll() {\r\n        this.truncate(0);\r\n        return this.finishParsing();\r\n    }\r\n\r\n    finishParsing() {\r\n        this.getParserForLine(this.stream.length(), null);\r\n        return this.getLastParser();\r\n    }\r\n\r\n    getLastParser() {\r\n        return this.parsers.at(-1);\r\n    }\r\n\r\n    getIndentation(row, buffer) {\r\n        var p = this.getParserForLine(row, null);\r\n        if (p && p.indentation instanceof Function)\r\n            return p.indentation(buffer);\r\n    }\r\n\r\n    truncate(row) {\r\n        row++;\r\n        if (this.parsers.length > row) this.parsers.length = row;\r\n    }\r\n\r\n    getPP() {\r\n        let pp = this.theParser.passedParens;\r\n        if (pp instanceof Function) pp = pp();\r\n        return pp ? [...pp].sort(compareRowCol) : [];\r\n    }\r\n\r\n}\r\n\r\nexport function compareRowCol(p1, p2) {\r\n    return ((p1.row ?? p1.line) < (p2.row ?? p2.line))\r\n        ? -1\r\n        : (p1.row ?? p1.line) > (p2.row ?? p2.line)\r\n        ? 1\r\n        : (p1.col ?? p1.c1) - (p2.col ?? p2.c1);\r\n}\r\n\r\nexport function caretInside(caret, zone) {\r\n    return p => (p.closed &&\r\n                 zone == \"outer\" && p.outer ? (\r\n                     compareRowCol({ line: p.outer.l1, col: p.outer.c1 }, caret) < 0\r\n                         && compareRowCol({ line: p.outer.l2, col: p.outer.c2 }, caret) >= 0\r\n                 )\r\n                 : zone == \"inner\" && p.inner ? (\r\n                     compareRowCol({ line: p.inner.l1, col: p.inner.c1 }, caret) <= 0\r\n                         && compareRowCol({ line: p.inner.l2, col: p.inner.c2 }, caret) >= 0\r\n                 )\r\n                 : (\r\n                     compareRowCol(p, caret) < 0\r\n                         && compareRowCol(p.closed, caret) >= 0\r\n                 ));\r\n}\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { DOM, delayed, formatBytes } from \"./ymacs-utils.js\";\r\nimport { Ymacs_Keymap } from \"./ymacs-keymap.js\";\r\nimport { Ymacs_Keymap_UniversalArgument } from \"./ymacs-keymap-emacs.js\";\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Exception } from \"./ymacs-exception.js\";\r\nimport { Ymacs_Interactive, Ymacs_Interactive_X } from \"./ymacs-interactive.js\";\r\n\r\nfunction TMPL_CHAR_INFO({\r\n    ch, code, codeHex, point, sizeKB\r\n}) {\r\n    return `\r\n<table>\r\n  <tr><td style='text-align: right; font-weight: bold'>Char:</td><td><tt> ${ch} </tt></td></tr>\r\n  ${code != null ? `\r\n    <tr><td style='text-align: right; font-weight: bold'>Char code:</td><td> ${code} / 0x${codeHex} </td></tr>\r\n  ` : \"\"}\r\n  <tr><td style='text-align: right; font-weight: bold'>Position:</td><td> ${point} </td></tr>\r\n  <tr><td style='text-align: right; font-weight: bold'>Buffer size:</td><td> ${sizeKB} </td></tr>\r\n</table>`;\r\n}\r\n\r\nlet help_keymap = Ymacs_Keymap.define(\"help\", {\r\n    \"q\": \"bury_buffer\",\r\n});\r\n\r\nlet read_register_keymap = Ymacs_Keymap.define(\"read_register\", {\r\n    \"Escape && C-g\": function() {\r\n        this.popKeymap(read_register_keymap);\r\n        this.setMinibuffer(\"\");\r\n    }\r\n});\r\nread_register_keymap.defaultHandler = [ function(){\r\n    var ev = this.interactiveEvent();\r\n    var ch = ev.key;\r\n    if (ch.length != 1) {\r\n        this.signalError(\"Non-character input event\");\r\n    } else {\r\n        this.getq(\"read_register_callback\")(ch);\r\n        this.setq(\"read_register_callback\");\r\n    }\r\n    this.popKeymap(read_register_keymap);\r\n    this.setMinibuffer(\"\");\r\n    return true;\r\n} ];\r\n\r\nYmacs_Buffer.newCommands({\r\n\r\n    forward_char: Ymacs_Interactive(\"p\", function(x) {\r\n        if (x == null) x = 1;\r\n        return this.cmd(\"goto_char\", this.point() + x);\r\n    }),\r\n\r\n    backward_char: Ymacs_Interactive(\"p\", function(x) {\r\n        if (x == null) x = 1;\r\n        return this.cmd(\"forward_char\", -x);\r\n    }),\r\n\r\n    forward_line: Ymacs_Interactive(\"p\", function(x) {\r\n        if (x == null) x = 1;\r\n        var rc = this._rowcol;\r\n        if (!/^(forward|backward)_line$/.test(this.previousCommand)) {\r\n            this.setq(\"line_movement_requested_col\", rc.col);\r\n        }\r\n        var ret = this.cmd(\"goto_char\",\r\n                           this._rowColToPosition(rc.row + x,\r\n                                                  Math.max(rc.col,\r\n                                                           this.getq(\"line_movement_requested_col\"))));\r\n        if (!ret)\r\n            this.setq(\"line_movement_requested_col\", rc.col);\r\n        return ret;\r\n    }),\r\n\r\n    backward_line: Ymacs_Interactive(\"p\", function(x) {\r\n        if (x == null) x = 1;\r\n        return this.cmd(\"forward_line\", -x);\r\n    }),\r\n\r\n    forward_whitespace: Ymacs_Interactive(\"P\", function(noLine) {\r\n        var re = noLine ? /[^\\x20\\t\\xA0]/g : /[^\\s]/g;\r\n        if (this.cmd(\"search_forward_regexp\", re)) {\r\n            this.cmd(\"backward_char\");\r\n            return true;\r\n        } else if (!noLine)\r\n            return this.cmd(\"end_of_buffer\");\r\n    }),\r\n\r\n    backward_whitespace: Ymacs_Interactive(\"P\", function(noLine) {\r\n        var re = noLine ? /[^\\x20\\t\\xA0]/g : /[^\\s]/g;\r\n        if (this.cmd(\"search_backward_regexp\", re)) {\r\n            this.cmd(\"forward_char\");\r\n            return true;\r\n        } else if (!noLine)\r\n            return this.cmd(\"beginning_of_buffer\");\r\n    }),\r\n\r\n    beginning_of_line: Ymacs_Interactive(function() {\r\n        return this.cmd(\"goto_char\", this._rowColToPosition(this._rowcol.row, 0));\r\n    }),\r\n\r\n    back_to_indentation: Ymacs_Interactive(function() {\r\n        var rc = this._rowcol, line = this.code[rc.row], m = /\\S/.exec(line);\r\n        if (m)\r\n            return this.cmd(\"goto_char\", this._rowColToPosition(rc.row, m.index));\r\n    }),\r\n\r\n    beginning_of_indentation_or_line: Ymacs_Interactive(function() {\r\n        return this.cmd(\"back_to_indentation\") || this.cmd(\"beginning_of_line\");\r\n    }),\r\n\r\n    end_of_line: Ymacs_Interactive(function() {\r\n        var rc = this._rowcol;\r\n        return this.cmd(\"goto_char\", this._rowColToPosition(rc.row, this.code[rc.row].length));\r\n    }),\r\n\r\n    beginning_of_buffer: Ymacs_Interactive(function() {\r\n        return this.cmd(\"goto_char\", 0);\r\n    }),\r\n\r\n    end_of_buffer: Ymacs_Interactive(function() {\r\n        return this.cmd(\"goto_char\", this.getCodeSize());\r\n    }),\r\n\r\n    eob_p: function() {\r\n        return this.point() == this.getCodeSize();\r\n    },\r\n\r\n    bob_p: function() {\r\n        return this.point() == 0;\r\n    },\r\n\r\n    eol_p: function() {\r\n        var rc = this._positionToRowCol(this.point());\r\n        return rc.col == this.code[rc.line].length;\r\n    },\r\n\r\n    bol_p: function() {\r\n        return this._positionToRowCol(this.point()).col == 0;\r\n    },\r\n\r\n    backward_delete_char: Ymacs_Interactive(\"^p\", function(n){\r\n        if (!this.deleteTransientRegion()) {\r\n            if (n == null) n = 1;\r\n            var pos = this.point();\r\n            if (pos > 0)\r\n                this._deleteText(pos - n, pos);\r\n        }\r\n    }),\r\n\r\n    delete_char: Ymacs_Interactive(\"^p\", function(n){\r\n        if (!this.deleteTransientRegion()) {\r\n            if (n == null) n = 1;\r\n            var pos = this.point();\r\n            this._deleteText(pos, pos + n);\r\n        }\r\n    }),\r\n\r\n    delete_whitespace: Ymacs_Interactive(\"^P\", function(noLine) {\r\n        if (!this.deleteTransientRegion()) {\r\n            var p = this.point();\r\n            if (this.cmd(\"forward_whitespace\", noLine)) {\r\n                this._deleteText(p, this.point());\r\n                return true;\r\n            }\r\n        }\r\n    }),\r\n\r\n    backward_delete_whitespace: Ymacs_Interactive(\"^P\", function(noLine) {\r\n        if (!this.deleteTransientRegion()) {\r\n            var p = this.point();\r\n            if (this.cmd(\"backward_whitespace\", noLine)) {\r\n                this._deleteText(this.point(), p);\r\n                return true;\r\n            }\r\n        }\r\n    }),\r\n\r\n    delete_indentation: Ymacs_Interactive(\"P\", function(nextLine) {\r\n        if (nextLine)\r\n            this.cmd(\"forward_line\");\r\n        this.cmd(\"back_to_indentation\");\r\n        this.cmd(\"backward_delete_whitespace\");\r\n        this.cmd(\"insert\", \" \");\r\n    }),\r\n\r\n    universal_argument: Ymacs_Interactive(\"^\", function(){\r\n        this.pushKeymap(Ymacs_Keymap_UniversalArgument);\r\n        if (!this.isMinibuffer)\r\n            this.setMinibuffer(\"C-u\");\r\n    }),\r\n\r\n    overwrite_mode: Ymacs_Interactive(function() {\r\n        this.resetOverwriteMode();\r\n    }),\r\n\r\n    self_insert_command: Ymacs_Interactive(\"^p\", function(repeat) {\r\n        var ev = this.interactiveEvent();\r\n        var ch = ev.key;\r\n        var rc = this._rowcol;\r\n        if (ch.length == 1 && !ev.altKey && !ev.ctrlKey) {\r\n            this.deleteTransientRegion();\r\n            if (repeat != null)\r\n                ch = ch.repeat(repeat);\r\n            if (this.overwriteMode) {\r\n                var line = this.code[rc.row], left = line.length - rc.col;\r\n                if (left > 0)\r\n                    this.cmd(\"delete_char\", Math.min(left, repeat || 1));\r\n            }\r\n            this.cmd(\"insert\", ch);\r\n            return true;\r\n        }\r\n        return false;\r\n    }),\r\n\r\n    newline: Ymacs_Interactive(\"^p\", function(n){\r\n        if (n == null) n = 1;\r\n        this.deleteTransientRegion();\r\n        this.cmd(\"insert\", \"\\n\".repeat(n));\r\n    }),\r\n\r\n    newline_and_indent: Ymacs_Interactive(\"^p\", function(n){\r\n        if (n) {\r\n            this.cmd(\"newline\", n);\r\n        } else {\r\n            this.cmd(\"backward_delete_whitespace\", true);\r\n            this.cmd(\"newline\");\r\n            this.cmd(\"indent_line\");\r\n        }\r\n    }),\r\n\r\n    stupid_indent: Ymacs_Interactive(function(){\r\n\r\n    }),\r\n\r\n    indent_line: Ymacs_Interactive(\"P\", function(noEmpty) {\r\n        if (!this.tokenizer) {\r\n            this.cmd(\"insert\", \" \".repeat(this.getq(\"indent_line\")));\r\n        } else {\r\n            let indent = this.tokenizer.getIndentation(this._rowcol.row, this);\r\n            if (indent != null) {\r\n                let line = this.getLine();\r\n                if (!noEmpty || /\\S/.test(line)) {\r\n                    let rc = this._rowcol;\r\n                    let pos = this.point() - rc.col;\r\n                    let ci = /[^\\S\\r\\n]*/.exec(line)[0].length;\r\n                    if (ci > indent) {\r\n                        this._deleteText(pos, pos + ci - indent);\r\n                    } else if (indent > ci) {\r\n                        this._insertText(\" \".repeat(indent - ci), pos);\r\n                    }\r\n                    if (rc.col <= ci) {\r\n                        this.cmd(\"goto_char\", pos + indent);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }),\r\n\r\n    indent_region: Ymacs_Interactive(\"r\", function(begin, end) {\r\n        if (end < begin) [ begin, end ] = [ end, begin ];\r\n        this.cmd(\"save_excursion\", function() {\r\n            var m = this.createMarker(end);\r\n            this.cmd(\"goto_char\", begin);\r\n            while (this.point() < m.getPosition()) {\r\n                this.cmd(\"indent_line\", true);\r\n                this.cmd(\"beginning_of_line\");\r\n                if (!this.cmd(\"forward_line\"))\r\n                    break;\r\n            };\r\n            m.destroy();\r\n        });\r\n    }),\r\n\r\n    make_marker: function(pos) {\r\n        return this.createMarker(pos);\r\n    },\r\n\r\n    looking_at: function() {\r\n        return this.looking_at.apply(this, arguments);\r\n    },\r\n\r\n    looking_back: function() {\r\n        return this.looking_back.apply(this, arguments);\r\n    },\r\n\r\n    search_forward: Ymacs_Interactive(\"sSearch: \", function(str, bound) {\r\n        var code = this.getCode(), point = this.point();\r\n        if (this.getq(\"case_fold_search\")) {\r\n            code = code.toLowerCase();\r\n            str = str.toLowerCase();\r\n        }\r\n        var pos = code.indexOf(str, point);\r\n        if (pos >= 0 && (bound == null || pos <= bound)) {\r\n            return this.cmd(\"goto_char\", pos + str.length);\r\n        }\r\n    }),\r\n\r\n    search_backward: Ymacs_Interactive(\"sSearch backward: \", function(str, bound) {\r\n        var code = this.getCode(), point = this.point();\r\n        if (this.getq(\"case_fold_search\")) {\r\n            code = code.toLowerCase();\r\n            str = str.toLowerCase();\r\n        }\r\n        var pos = code.lastIndexOf(str, point);\r\n        if (pos == point)\r\n            pos = code.lastIndexOf(str, point - 1);\r\n        if (pos >= 0 && pos != point && (bound == null || pos >= bound)) {\r\n            return this.cmd(\"goto_char\", pos);\r\n        }\r\n    }),\r\n\r\n    make_regexp: function(rx) {\r\n        if (!(rx instanceof RegExp)) {\r\n            var matchCase = !this.getq(\"case_fold_search\");\r\n            try {\r\n                rx = new RegExp(rx, matchCase ? \"mug\" : \"mugi\");\r\n            } catch(ex) {\r\n                throw new Ymacs_Exception(\"Invalid regexp\");\r\n            }\r\n        }\r\n        return rx;\r\n    },\r\n\r\n    search_forward_regexp: Ymacs_Interactive(\"sRegExp search: \", function(rx) {\r\n        rx = this.cmd(\"make_regexp\", rx);\r\n        let pos = rx.lastIndex = this.point();\r\n        let m = rx.exec(this.getCode());\r\n        if (m && rx.lastIndex != pos) {\r\n            m.after = rx.lastIndex;\r\n            this.matchData = m;\r\n            this.cmd(\"goto_char\", rx.lastIndex);\r\n            return true;\r\n        }\r\n    }),\r\n\r\n    search_backward_regexp: Ymacs_Interactive(\"sBackward RegExp search: \", function(rx) {\r\n        rx = this.cmd(\"make_regexp\", rx);\r\n        var m = this.lastIndexOfRegexp(this.getCode(), rx, this.point());\r\n        if (m && m.index != this.point()) {\r\n            this.cmd(\"goto_char\", m.index);\r\n            return true;\r\n        }\r\n    }),\r\n\r\n    forward_word: Ymacs_Interactive_X(function(){\r\n        var syntax_word = this.getq(\"syntax_word\"), end = false;\r\n        while (!end && !syntax_word.test(this.charAt()))\r\n            if (!this.cmd(\"forward_char\"))\r\n                end = true;\r\n        while (!end && syntax_word.test(this.charAt()))\r\n            if (!this.cmd(\"forward_char\"))\r\n                end = true;\r\n    }),\r\n\r\n    backward_word: Ymacs_Interactive_X(function(){\r\n        var syntax_word = this.getq(\"syntax_word\"), end = false;\r\n        while (!end && !syntax_word.test(this.charAt(-1)))\r\n            if (!this.cmd(\"backward_char\"))\r\n                end = true;\r\n        while (!end && syntax_word.test(this.charAt(-1)))\r\n            if (!this.cmd(\"backward_char\"))\r\n                end = true;\r\n    }),\r\n\r\n    forward_paragraph: Ymacs_Interactive_X(function(){\r\n        let rx = this.getq(\"syntax_paragraph_sep\");\r\n        this.cmd(\"beginning_of_line\");\r\n        this.cmd(\"backward_char\");\r\n        if (this.cmd(\"looking_at\", rx)) {\r\n            this.cmd(\"goto_char\", this.cmd(\"match_end\"));\r\n        }\r\n        if (this.cmd(\"search_forward_regexp\", rx)) {\r\n            this.cmd(\"goto_char\", this.cmd(\"match_beginning\") + 1);\r\n        } else {\r\n            this.cmd(\"end_of_buffer\");\r\n        }\r\n    }),\r\n\r\n    backward_paragraph: Ymacs_Interactive_X(function(){\r\n        let point = this.point();\r\n        let rx = this.getq(\"syntax_paragraph_sep\");\r\n        this.cmd(\"beginning_of_line\");\r\n        if (this.cmd(\"looking_back\", rx)) {\r\n            let pos = this.cmd(\"match_end\");\r\n            if (pos == point) {\r\n                pos = this.cmd(\"match_beginning\");\r\n            }\r\n            this.cmd(\"goto_char\", pos);\r\n        }\r\n        if (this.cmd(\"search_backward_regexp\", rx)) {\r\n            this.cmd(\"goto_char\", this.cmd(\"match_end\"));\r\n        } else {\r\n            this.cmd(\"beginning_of_buffer\");\r\n        }\r\n    }),\r\n\r\n    mark_paragraph: Ymacs_Interactive(\"^r\", function(begin, end){\r\n        if (!this.transientMarker) {\r\n            this.cmd(\"forward_paragraph\");\r\n            this.setMark(this.point());\r\n            this.ensureTransientMark();\r\n            this.cmd(\"backward_paragraph\");\r\n        }\r\n        else this.cmd(\"save_excursion\", function(){\r\n            if (this.transientMarker)\r\n                this.cmd(\"goto_char\", end);\r\n            this.ensureTransientMark();\r\n            this.cmd(\"forward_paragraph\");\r\n            this.setMark(this.point());\r\n            this.transientMarker.swap(this.caretMarker);\r\n        });\r\n        this.ensureTransientMark();\r\n        this.setq(\"sticky_mark\", true);\r\n    }),\r\n\r\n    transpose_words: Ymacs_Interactive_X(function() {\r\n        // if we're in the middle of a word, some\r\n        // weird things happen; better skip it, just\r\n        // like Emacs does.\r\n        this.cmd(\"backward_char\");\r\n        if (this.getq(\"syntax_word\").test(this.charAt()))\r\n            this.cmd(\"forward_word\");\r\n\r\n        var a = [];\r\n        this.cmd(\"forward_word\"); a.push(this.point());\r\n        this.cmd(\"backward_word\"); a.push(this.point());\r\n        this.cmd(\"backward_word\"); a.push(this.point());\r\n        this.cmd(\"forward_word\"); a.push(this.point());\r\n        this.cmd(\"goto_char\", this._swapAreas(a));\r\n    }),\r\n\r\n    transpose_lines: Ymacs_Interactive_X(function() {\r\n        var a = [];\r\n        this.cmd(\"backward_line\");\r\n        this.cmd(\"beginning_of_line\"); a.push(this.point());\r\n        this.cmd(\"end_of_line\"); a.push(this.point());\r\n        this.cmd(\"forward_char\"); a.push(this.point());\r\n        this.cmd(\"end_of_line\"); a.push(this.point());\r\n        this.cmd(\"goto_char\", this._swapAreas(a) + 1);\r\n    }),\r\n\r\n    transpose_chars: Ymacs_Interactive_X(function() {\r\n        var pos = this.point();\r\n        if (this.cmd(\"backward_char\"))\r\n            this.cmd(\"goto_char\", this._swapAreas([ pos - 1, pos, pos, pos + 1 ]));\r\n    }),\r\n\r\n    kill_word: Ymacs_Interactive(\"^p\", function(prefix) {\r\n        if (this.transientMarker) {\r\n            var r = this.getRegion();\r\n            this.cmd(\"kill_region\", r.begin, r.end);\r\n            this.clearTransientMark();\r\n        } else {\r\n            var pos = this.point();\r\n            this.cmd(\"forward_word\", prefix == null ? 1 : prefix);\r\n            var pos2 = this.point();\r\n            this._killingAction(pos, pos2, false);\r\n        }\r\n    }),\r\n\r\n    backward_kill_word: Ymacs_Interactive_X(function() {\r\n        var pos = this.point();\r\n        this.cmd(\"backward_word\");\r\n        var pos2 = this.point();\r\n        this._killingAction(pos, pos2, true);\r\n    }),\r\n\r\n    _apply_operation_on_word: function (op, cc) {\r\n        var pos = this.point();\r\n        if (this.getq(\"syntax_word\").test(this.charAt())) {\r\n            var pos2 = this.cmd(\"save_excursion\", function(){\r\n                this.cmd(\"forward_word\");\r\n                return this.point();\r\n            });\r\n            var word = op.call(this._bufferSubstring(pos, pos2));\r\n            this._deleteText(pos, pos2);\r\n            this._insertText(word);\r\n        } else {\r\n            this.cmd(\"forward_word\");\r\n            this.cmd(\"backward_word\");\r\n            if (pos != this.point())\r\n                this.cmd(cc);\r\n        }\r\n    },\r\n\r\n    capitalize_word: Ymacs_Interactive_X(function() {\r\n        this.cmd(\"_apply_operation_on_word\", function() {\r\n            return this.charAt(0).toUpperCase() + this.substr(1).toLowerCase();\r\n        }, \"capitalize_word\");\r\n    }),\r\n\r\n    downcase_word: Ymacs_Interactive_X(function() {\r\n        this.cmd(\"_apply_operation_on_word\", String.prototype.toLowerCase, \"downcase_word\");\r\n    }),\r\n\r\n    upcase_word: Ymacs_Interactive_X(function() {\r\n        this.cmd(\"_apply_operation_on_word\", String.prototype.toUpperCase, \"upcase_word\");\r\n    }),\r\n\r\n    goto_char: Ymacs_Interactive(\"NGoto char: \", function(pos){\r\n        return this._repositionCaret(pos);\r\n    }),\r\n\r\n    goto_line: Ymacs_Interactive(\"NGoto line: \", function(row){\r\n        var pos = this._rowColToPosition(row - 1, 0);\r\n        return this.cmd(\"goto_char\", pos);\r\n    }),\r\n\r\n    move_to_column: Ymacs_Interactive(\"NMove to column: \", function(col, force){\r\n        var rc = this._positionToRowCol(this.point());\r\n        var text = this.code[rc.row];\r\n        if (text.length < col) {\r\n            if (force) {\r\n                this.cmd(\"end_of_line\");\r\n                this.cmd(\"insert\", \" \".repeat(col - text.length));\r\n            } else {\r\n                this.cmd(\"end_of_line\");\r\n            }\r\n        } else {\r\n            this.cmd(\"goto_char\", this._rowColToPosition(rc.row, col));\r\n        }\r\n    }),\r\n\r\n    delete_region: Ymacs_Interactive(\"r\", function(begin, end){\r\n        this._deleteText(begin, end);\r\n    }),\r\n\r\n    insert: Ymacs_Interactive(\"sInsert text: \", function(...args){\r\n        return this._insertText(args.join(\"\"));\r\n    }),\r\n\r\n    keyboard_quit: Ymacs_Interactive(function(){\r\n        this.clearTransientMark();\r\n        this.setPrefixArg(undefined);\r\n        this.setMinibuffer(\"\");\r\n    }),\r\n\r\n    buffer_substring: function(begin, end) {\r\n        if (arguments.length == 0) {\r\n            var r = this.getRegion();\r\n            begin = r.begin;\r\n            end = r.end;\r\n        }\r\n        return this._bufferSubstring(begin, end);\r\n    },\r\n\r\n    kill_line: Ymacs_Interactive(\"^p\", function(prefix) {\r\n        if (this.transientMarker) {\r\n            var r = this.getRegion();\r\n            this.cmd(\"kill_region\", r.begin, r.end);\r\n            this.clearTransientMark();\r\n        } else if (prefix != null) {\r\n            this._killingAction(\r\n                this.point(),\r\n                this.cmd(\"save_excursion\", () => {\r\n                    this.cmd(\"forward_line\", prefix);\r\n                    this.cmd(\"beginning_of_line\");\r\n                    return this.point();\r\n                })\r\n            );\r\n        } else {\r\n            var pos = this.point(),\r\n                rc = this._rowcol,\r\n                line = this.code[rc.row],\r\n                end = pos + line.length - rc.col;\r\n            if (rc.row < this.code.length - 1 && this.cmd(\"looking_at\", /\\s*$/my))\r\n                end++;\r\n            this._killingAction(pos, end);\r\n        }\r\n    }),\r\n\r\n    save_excursion: function() {\r\n        return this._saveExcursion.apply(this, arguments);\r\n    },\r\n\r\n    prevent_undo: function() {\r\n        return this._disableUndo.apply(this, arguments);\r\n    },\r\n\r\n    point: function() {\r\n        return this.caretMarker.getPosition();\r\n    },\r\n\r\n    kill_region: Ymacs_Interactive(\"r\", function(begin, end){\r\n        this._killingAction(begin, end);\r\n    }),\r\n\r\n    copy_region_as_kill: Ymacs_Interactive(\"r\", function(begin, end){\r\n        this._killingAction(begin, end, false, true);\r\n    }),\r\n\r\n    yank: Ymacs_Interactive(\"^P\", function(atStart){\r\n        this.deleteTransientRegion();\r\n        var point = this.point();\r\n        this._insertText(this.ymacs.killRingText());\r\n        this.setMark(point);\r\n        if (atStart)\r\n            this.caretMarker.swap(this.markMarker);\r\n    }),\r\n\r\n    yank_from_operating_system: Ymacs_Interactive(async function() {\r\n        try {\r\n            let code = await navigator.clipboard.readText();\r\n            this._saveKilledText(code);\r\n            this.callInteractively(\"yank\");\r\n        } catch(ex) {\r\n            console.error(ex);\r\n            this.signalError(\"Cannot read the system clipboard. Error in devtools console.\");\r\n        }\r\n    }),\r\n\r\n    copy_for_operating_system: Ymacs_Interactive(\"r\", async function(begin, end) {\r\n        try {\r\n            let code = this.cmd(\"buffer_substring\", begin, end);\r\n            await navigator.clipboard.writeText(code);\r\n        } catch(ex) {\r\n            console.error(ex);\r\n            this.signalError(\"Cannot write to system clipboard. Error in devtools console.\");\r\n        }\r\n    }),\r\n\r\n    yank_pop: Ymacs_Interactive(function() {\r\n        if (/^yank/.test(this.previousCommand)) {\r\n            this.ymacs.rotateKillRing(false);\r\n            this._deleteText(this.caretMarker, this.markMarker);\r\n            this.cmd(\"yank\");\r\n        } else {\r\n            this.signalError(\"Previous command was not a yank\");\r\n        }\r\n    }),\r\n\r\n    yank_shift: Ymacs_Interactive(function() {\r\n        if (/^yank/.test(this.previousCommand)) {\r\n            this.ymacs.rotateKillRing(true);\r\n            this._deleteText(this.caretMarker, this.markMarker);\r\n            this.cmd(\"yank\");\r\n        } else {\r\n            this.signalError(\"Previous command was not a yank\");\r\n        }\r\n    }),\r\n\r\n    mark: function() {\r\n        return this.markMarker.getPosition();\r\n    },\r\n\r\n    set_mark_command: Ymacs_Interactive(\"d\", function(x){\r\n        this.clearTransientMark();\r\n        this.setMark(x);\r\n        if (this.currentCommand == \"set_mark_command\") {\r\n            this.signalInfo(\"Mark set\", null, 1000);\r\n            this.setq(\"sticky_mark\", true);\r\n        }\r\n    }),\r\n\r\n    exchange_point_and_mark: Ymacs_Interactive(\"^\", function(){\r\n        this.transientMarker = this.createMarker();\r\n        this.caretMarker.swap(this.markMarker);\r\n        this.ensureTransientMark();\r\n        this.setq(\"sticky_mark\", true);\r\n    }),\r\n\r\n    mark_whole_buffer: Ymacs_Interactive(function(){\r\n        this.clearTransientMark();\r\n        this.cmd(\"end_of_buffer\");\r\n        this.ensureTransientMark();\r\n        this.cmd(\"beginning_of_buffer\");\r\n        this.ensureTransientMark();\r\n    }),\r\n\r\n    recenter_top_bottom: Ymacs_Interactive(\"^\", function() {\r\n        this.whenActiveFrame(function(frame){\r\n            frame.recenterTopBottom(this.sameCommandCount() % 3);\r\n        });\r\n    }),\r\n\r\n    recenter: Ymacs_Interactive(\"^\", function() {\r\n        this.whenActiveFrame(function(frame){\r\n            frame.centerOnCaret();\r\n        });\r\n    }),\r\n\r\n    ensure_caret_visible: Ymacs_Interactive(function() {\r\n        this.whenActiveFrame(function(frame){\r\n            if (frame.ensureCaretVisible())\r\n                frame.centerOnCaret();\r\n        });\r\n    }),\r\n\r\n    /* -----[ paragraphs ]----- */\r\n\r\n    get_fill_paragraph_region: function() {\r\n        let r1 = this.cmd(\"save_excursion\", () => {\r\n            if (!this.cmd(\"looking_at\", this.getq(\"syntax_paragraph_sep\")))\r\n                this.cmd(\"forward_paragraph\");\r\n            let end = this.point() - 1;\r\n            this.cmd(\"backward_paragraph\");\r\n            let begin = this.point();\r\n            return { begin, end };\r\n        });\r\n        let r2 = this.cmd(\"base_limit_fill_paragraph_region\")\r\n            || this.cmd(\"xml_limit_fill_paragraph_region\");\r\n        if (r2) {\r\n            return { begin: Math.max(r1.begin, r2.begin),\r\n                     end: Math.min(r1.end, r2.end) };\r\n        }\r\n        return r1;\r\n    },\r\n\r\n    fill_paragraph: Ymacs_Interactive(\"^rP\", function(begin, end, noPrefix) {\r\n        this.cmd(\"save_excursion\", function(){\r\n            if (!this.transientMarker) {\r\n                let r = this.cmd(\"get_fill_paragraph_region\");\r\n                begin = r.begin;\r\n                end = r.end;\r\n            } else {\r\n                this.clearTransientMark();\r\n            }\r\n\r\n            this.cmd(\"goto_char\", begin);\r\n            var eop = this.createMarker(end);\r\n\r\n            // identify the prefix to use for each line\r\n            var prefix = \"\", del = /\\s+/y;\r\n            if (this.cmd(\"looking_at\", /\\s*\\/\\/+\\s*/y)) {\r\n                prefix = this.matchData[0];\r\n                del = /\\s*\\/\\/+\\s*/y;\r\n            }\r\n            else if (this.cmd(\"looking_at\", /\\s*\\/\\*\\s*/y)) {\r\n                prefix = \" \".repeat(this.matchData[0].length);\r\n                del = /\\s*\\**\\s*/y;\r\n            }\r\n            else if (this.cmd(\"looking_at\", /\\s*[#>;\\s]+\\s*/y)) {\r\n                prefix = this.matchData[0];\r\n                del = /\\s*[#>;\\s]*\\s*/y;\r\n            }\r\n            else if (this.cmd(\"looking_at\", /\\s*([-*]|[0-9]+\\.|\\(?[a-z][\\).])?\\s+/iy)) {\r\n                prefix = \" \".repeat(this.matchData[0].length);\r\n                del = /\\s*[#>;\\s]*\\s*/y;\r\n            }\r\n\r\n            if (noPrefix) {\r\n                this._deleteText(this.point(), this.point() + this.matchData[0].length);\r\n                prefix = \"\";\r\n            }\r\n\r\n            // remove newlines first\r\n            while (true) {\r\n                this.cmd(\"end_of_line\");\r\n                this.cmd(\"backward_delete_whitespace\");\r\n                if (this.point() >= eop.getPosition())\r\n                    break;\r\n                this._replaceText(this.point(), this.point() + 1, \" \");\r\n                if (del && this.cmd(\"looking_at\", del)) {\r\n                    this._deleteText(this.point(), this.point() + this.matchData[0].length);\r\n                }\r\n            }\r\n\r\n            this.cmd(\"beginning_of_line\");\r\n\r\n            // main operation\r\n            var bol = this.point(), done = false;\r\n            while (!done) {\r\n                var p = this.point();\r\n                if (!this.cmd(\"search_forward_regexp\", /\\s/g)) {\r\n                    done = true;\r\n                }\r\n                if (this.point() >= eop.getPosition()) {\r\n                    this.cmd(\"goto_char\", eop);\r\n                    done = true;\r\n                }\r\n                if (this._rowcol.col > this.getq(\"fill_column\") + 1) {\r\n                    if (p > bol) {\r\n                        this.cmd(\"goto_char\", p);\r\n                    }\r\n                    this.cmd(\"backward_delete_whitespace\");\r\n                    this.cmd(\"newline\");\r\n                    this.cmd(\"insert\", prefix);\r\n                    bol = this.point();\r\n                }\r\n            }\r\n\r\n            eop.destroy();\r\n        });\r\n    }),\r\n\r\n    // this looks at the style of the current paragraph and starts\r\n    // a similar one, i.e. using same indentation level and prefix\r\n    // (list-like prefixes are incremented)\r\n    start_next_paragraph: Ymacs_Interactive(function() {\r\n        this.cmd(\"backward_paragraph\");\r\n\r\n        // identify the prefix to use for each line\r\n        var prefix = \"\";\r\n        if (this.cmd(\"looking_at\", /(\\s*)([0-9]+)(\\.\\s+)/y)) {\r\n            prefix = this.matchData[1] +\r\n                (parseInt(this.matchData[2], 10) + 1) +\r\n                this.matchData[3];\r\n        }\r\n        else if (this.cmd(\"looking_at\", /(\\s*\\(?)([a-z])([\\.\\)]\\s+)/iy)) {\r\n            prefix = this.matchData[1] +\r\n                String.fromCharCode(this.matchData[2].charCodeAt(0) + 1) +\r\n                this.matchData[3];\r\n        }\r\n        else if (this.cmd(\"looking_at\", /\\s*[#>;*\\s-]+\\s*/y)) {\r\n            prefix = this.matchData[0];\r\n        }\r\n\r\n        this.cmd(\"forward_paragraph\");\r\n        if (this.cmd(\"eob_p\"))\r\n            this.cmd(\"newline\");\r\n\r\n        this.cmd(\"insert\", \"\\n\", prefix);\r\n\r\n        if (!this.cmd(\"looking_at\", /\\n\\n/y)) {\r\n            this.cmd(\"newline\");\r\n            this.cmd(\"backward_char\");\r\n        };\r\n    }),\r\n\r\n    scroll_down_half: Ymacs_Interactive_X(function() {\r\n        this.whenActiveFrame(function(frame){\r\n            var hl = frame.heightInLines();\r\n            this.cmd(\"forward_line\", Math.round(hl / 1.33));\r\n            this.cmd(\"recenter\");\r\n        });\r\n    }),\r\n\r\n    scroll_up_half: Ymacs_Interactive_X(function() {\r\n        this.whenActiveFrame(function(frame){\r\n            var hl = frame.heightInLines();\r\n            this.cmd(\"backward_line\", Math.round(hl / 1.33));\r\n            this.cmd(\"recenter\");\r\n        });\r\n    }),\r\n\r\n    scroll_up: Ymacs_Interactive(\"p\", function(arg){\r\n        if (arg == null) arg = 3;\r\n        this.whenActiveFrame(function(frame){\r\n            frame.scrollUp(arg);\r\n        });\r\n    }),\r\n\r\n    scroll_down: Ymacs_Interactive(\"p\", function(arg){\r\n        if (arg == null) arg = 3;\r\n        this.whenActiveFrame(function(frame){\r\n            frame.scrollDown(arg);\r\n        });\r\n    }),\r\n\r\n    nuke_trailing_whitespace: Ymacs_Interactive(function() {\r\n        this.cmd(\"save_excursion\", function(){\r\n            this.cmd(\"goto_char\", 0);\r\n            while (this._rowcol.row < this.code.length) {\r\n                var line = this.code[this._rowcol.row],\r\n                m = /\\s+$/.exec(line);\r\n                if (m) {\r\n                    this.cmd(\"beginning_of_line\");\r\n                    this._deleteText(this.point() + m.index, this.point() + line.length);\r\n                }\r\n                if (!this.cmd(\"forward_line\"))\r\n                    break;\r\n            }\r\n        });\r\n    }),\r\n\r\n    match_string: function(n) {\r\n        return this.matchData[n];\r\n    },\r\n\r\n    match_beginning: function() {\r\n        return this.matchData.index;\r\n    },\r\n\r\n    match_end: function() {\r\n        return this.matchData.index + this.matchData[0].length;\r\n    },\r\n\r\n    undo: Ymacs_Interactive_X(function() {\r\n        this._placeUndoBoundary();\r\n        if (!this._playbackUndo()) {\r\n            this.signalError(\"No further undo information\");\r\n        }\r\n    }),\r\n\r\n    goto_last_change: Ymacs_Interactive(function() {\r\n        let a = [], pos = this.point();\r\n        this.__undoQueue.forEach(x => {\r\n            if (x.type == 3) {\r\n                let m = x.markers.find(m => m[0] === this.caretMarker);\r\n                if (m) a.push(m[1]);\r\n            }\r\n        });\r\n        if (a.length) {\r\n            a = a.reverse();\r\n            let i = this.sameCommandCount() % a.length;\r\n            this.cmd(\"goto_char\", a[i]);\r\n        }\r\n    }),\r\n\r\n    center_line: Ymacs_Interactive(\"p\", function(n){\r\n        if (n == null) n = 1;\r\n        for (let i = 0; i < n; ++i) {\r\n            if (i > 0) this.cmd(\"forward_line\");\r\n            this.cmd(\"save_excursion\", function(){\r\n                this.cmd(\"end_of_line\");\r\n                this.cmd(\"backward_delete_whitespace\", true);\r\n                this.cmd(\"beginning_of_line\");\r\n                this.cmd(\"delete_whitespace\", true);\r\n                var line = this.code[this._rowcol.row];\r\n                var indent = Math.floor((this.getq(\"fill_column\") - line.length) / 2);\r\n                this.cmd(\"insert\", \" \".repeat(indent));\r\n            });\r\n        }\r\n    }),\r\n\r\n    /* -----[ dabbrev ]----- */\r\n\r\n    dabbrev_expand: Ymacs_Interactive_X(function() {\r\n        if (this.previousCommand != \"dabbrev_expand\")\r\n            this.setq(\"dabbrev_context\", null);\r\n\r\n        var ctx = this.getq(\"dabbrev_context\");\r\n        if (!ctx) {\r\n            ctx = this.setq(\"dabbrev_context\", {});\r\n            var p1 = this.cmd(\"save_excursion\", function(){\r\n                this.cmd(\"bind_variables\", {\r\n                    syntax_word: this.getq(\"syntax_word_dabbrev\")\r\n                }, \"backward_word\");\r\n                return this.point();\r\n            });\r\n            if (p1 == this.point())\r\n                return this.signalError(\"Nothing to expand\");\r\n            ctx.search = this.cmd(\"buffer_substring\", p1, this.point());\r\n            ctx.point = p1;\r\n            ctx.length = this.point() - p1;\r\n            ctx.lastSearch = p1;\r\n            ctx.encountered = Object.create(null);\r\n            ctx.forward = false;\r\n            ctx.buffer = this;\r\n            ctx.seenBuffers = [ this ];\r\n            ctx.startBuffer = this;\r\n        }\r\n        var expansion;\r\n\r\n        // in the following excursion, *this* is ctx.buffer,\r\n        // not necessarily the currently active buffer.  It's\r\n        // purpose is to determine the next expansion and\r\n        // setup the context so that the next invocation would\r\n        // continue.\r\n        ctx.buffer.cmd(\"save_excursion\", function repeat(){\r\n            var word = this.getq(\"syntax_word_dabbrev\");\r\n            var p1;\r\n            var found = false;\r\n            this.cmd(\"goto_char\", ctx.lastSearch);\r\n            // console.log(\"last at: %d\", ctx.lastSearch);\r\n            if (!ctx.forward) {\r\n                while (this.cmd(\"search_backward\", ctx.search)) {\r\n                    if (!word.test(this.charAt(-1))) {\r\n                        found = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (found) {\r\n                    p1 = this.point();\r\n                    ctx.lastSearch = p1;\r\n                    this.cmd(\"goto_char\", p1 + ctx.search.length);\r\n                } else {\r\n                    ctx.forward = true;\r\n                    ctx.lastSearch = ctx.point + ctx.length;\r\n                    repeat.call(this);\r\n                    return;\r\n                }\r\n            } else {\r\n                while (this.cmd(\"search_forward\", ctx.search))\r\n                    if (!word.test(this.charAt(-ctx.search.length - 1))) {\r\n                        found = true;\r\n                        break;\r\n                    }\r\n                if (found) {\r\n                    ctx.lastSearch = this.point();\r\n                    p1 = this.point() - ctx.search.length;\r\n                } else {\r\n                    ctx.buffer = this.whenYmacs(\"getNextBuffer\", this);\r\n                    if (ctx.seenBuffers.includes(ctx.buffer)) {\r\n                        expansion = ctx.search;\r\n                        ctx.startBuffer.signalError(\"No more completions\");\r\n                        ctx.lastSearch = ctx.point + ctx.length;\r\n                        ctx.startBuffer.setq(\"dabbrev_context\", null);\r\n                        return;\r\n                    } else {\r\n                        ctx.seenBuffers.push(ctx.buffer);\r\n                        ctx.lastSearch = 0;\r\n                        ctx.buffer.cmd(\"save_excursion\", repeat);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            if (p1 != null) {\r\n                // console.log(\"%s at %d, next from %d\", ctx.search, p1, ctx.lastSearch);\r\n                this.cmd(\"bind_variables\", {\r\n                    syntax_word: this.getq(\"syntax_word_dabbrev\")\r\n                }, \"forward_word\");\r\n                expansion = this.cmd(\"buffer_substring\", p1, this.point());\r\n                if (ctx.encountered[expansion])\r\n                    repeat.call(this);\r\n            }\r\n        });\r\n        if (expansion != null) {\r\n            this._replaceText(ctx.point, ctx.point + ctx.length, expansion);\r\n            ctx.length = expansion.length;\r\n            ctx.encountered[expansion] = true;\r\n        }\r\n    }),\r\n\r\n    /* -----[ frames and buffers ]----- */\r\n\r\n    split_frame_vertically: Ymacs_Interactive(\"p\", function(percent) {\r\n        if (percent == null) percent = \"50%\";\r\n        else percent += \"%\";\r\n        this.whenActiveFrame(\"vsplit\", percent);\r\n    }),\r\n\r\n    split_frame_horizontally: Ymacs_Interactive(\"p\", function(percent) {\r\n        if (percent == null) percent = \"50%\";\r\n        else percent += \"%\";\r\n        this.whenActiveFrame(\"hsplit\", percent);\r\n    }),\r\n\r\n    delete_other_frames: Ymacs_Interactive(function() {\r\n        this.whenActiveFrame(\"deleteOtherFrames\");\r\n    }),\r\n\r\n    delete_frame: Ymacs_Interactive(function() {\r\n        this.whenActiveFrame(\"deleteFrame\");\r\n    }),\r\n\r\n    other_frame: Ymacs_Interactive(function() {\r\n        this.whenYmacs(\"focusOtherFrame\");\r\n    }),\r\n\r\n    windmove: function(dir) {\r\n        this.whenYmacs(function(ymacs){\r\n            var f = ymacs.getFrameInDirection(dir);\r\n            if (f) f.focus();\r\n        });\r\n    },\r\n\r\n    next_buffer: Ymacs_Interactive(function() {\r\n        this.whenYmacs(\"switchToNextBuffer\", this.sameCommandCount() + 1);\r\n    }),\r\n\r\n    previous_buffer: Ymacs_Interactive(function() {\r\n        this.whenYmacs(\"switchToPreviousBuffer\", this.sameCommandCount() + 1);\r\n    }),\r\n\r\n    switch_to_buffer: Ymacs_Interactive(\"BSwitch to buffer: \", function(buffer) {\r\n        this.whenYmacs(function(ymacs){\r\n            if (!/\\S/.test(buffer)) {\r\n                if (ymacs.buffers.length < 2) return;\r\n                buffer = ymacs.buffers[1];\r\n            }\r\n            ymacs.switchToBuffer(buffer);\r\n        });\r\n    }),\r\n\r\n    kill_buffer: Ymacs_Interactive(function() {\r\n        var self = this;\r\n        function kill() {\r\n            self.whenYmacs(function(ymacs){\r\n                ymacs.switchToNextBuffer();\r\n                ymacs.killBuffer(self);\r\n            });\r\n        }\r\n        if (self.dirty()) {\r\n            var msg = \"Buffer \" + self.name + \" modified; kill anyway?\";\r\n            self.cmd(\"minibuffer_yn\", msg, function(yes){\r\n                if (yes) kill();\r\n            });\r\n        } else {\r\n            kill();\r\n        }\r\n    }),\r\n\r\n    rename_buffer: Ymacs_Interactive(\"sRename current buffer to: \", function(name){\r\n        this.whenYmacs(function(ymacs){\r\n            ymacs.renameBuffer(this, name);\r\n        });\r\n    }),\r\n\r\n    /* -----[ other ]----- */\r\n\r\n    delete_region_or_line: Ymacs_Interactive(\"^\", function() {\r\n        if (!this.deleteTransientRegion()) {\r\n            this.cmd(\"beginning_of_line\");\r\n            var pos = this.point();\r\n            this.cmd(\"end_of_line\");\r\n            this.cmd(\"forward_char\");\r\n            if (this.point() != pos) {\r\n                this._deleteText(pos, this.point());\r\n                return true;\r\n            }\r\n        }\r\n    }),\r\n\r\n    // http://mihai.bazon.net/blog/close-last-xml-tag-emacs\r\n    close_last_xml_tag: Ymacs_Interactive_X(function() {\r\n        var tag, quote;\r\n        this.cmd(\"save_excursion\", function() {\r\n            var skip = 1;\r\n            while (skip != 0 && this.cmd(\"search_backward_regexp\", /<\\x2f?([a-zA-Z0-9:_-]+)/g)) {\r\n                tag = this.cmd(\"match_string\", 1);\r\n                if (this.cmd(\"looking_at\", /<\\x2f/y)) {\r\n                    ++skip;\r\n                }\r\n                else if (!this.cmd(\"looking_at\", /<[^\\x2f][^>]*?\\x2f>/y)) {\r\n                    --skip;\r\n                }\r\n            }\r\n            if (skip != 0)\r\n                tag = null;\r\n        });\r\n        if (tag) {\r\n            this.cmd(\"insert\", \"</\", tag, \">\");\r\n        } else {\r\n            throw new Ymacs_Exception(\"Couldn't find a tag to close\");\r\n        }\r\n    }),\r\n\r\n    bind_variables: function() {\r\n        return this.withVariables.apply(this, arguments);\r\n    },\r\n\r\n    for_region: Ymacs_Interactive(\"^r\\nCExecute command within region: \", function(begin, end, func) {\r\n        if (end < begin) { var tmp = begin; begin = end; end = tmp; } // MACROS!  I WANT MACROS!  EVAL SUCKS. x-(\r\n        if (!(func instanceof Function))\r\n            func = this.COMMANDS[func];\r\n        this.clearTransientMark();\r\n        this.cmd(\"goto_char\", begin);\r\n        begin = this.createMarker(begin, true);\r\n        end = this.createMarker(end);\r\n        this.withCommands(\r\n            {\r\n                goto_char: function(pos){\r\n                    if (pos >= begin.getPosition() && pos <= end.getPosition())\r\n                        return this._repositionCaret(pos);\r\n                    throw \"YMACS_RESTRICT\";\r\n                }\r\n            },\r\n            function() {\r\n                try {\r\n                    while (true) {\r\n                        var tmp = this.point();\r\n                        func.call(this);\r\n                        if (this.point() == tmp && !this.cmd(\"forward_line\"))\r\n                            break;\r\n                    }\r\n                } catch(ex) {\r\n                    if (ex !== \"YMACS_RESTRICT\")\r\n                        throw ex;\r\n                } finally {\r\n                    begin.destroy();\r\n                    end.destroy();\r\n                }\r\n            }\r\n        );\r\n    }),\r\n\r\n    comment_region: Ymacs_Interactive(\"^r\", function(begin, end){\r\n        var cmmt = this.getq(\"syntax_comment_line\") || this.getq(\"syntax_comment_multi\");\r\n        if (!cmmt) return;\r\n        this.clearTransientMark();\r\n        this.cmd(\"save_excursion\", function(){\r\n            end = this.createMarker(end);\r\n            this.cmd(\"goto_char\", begin);\r\n            var min = 100000;\r\n            out: while (this.point() < end.getPosition()) {\r\n                while (this.cmd(\"looking_at\", /\\s*$/my)) {\r\n                    if (!this.cmd(\"forward_line\")) break out;\r\n                }\r\n                var col = this._rowcol.col;\r\n                while (this.cmd(\"looking_at\", /\\s/y) && col < min) {\r\n                    if (!this.cmd(\"forward_char\")) break out;\r\n                    ++col;\r\n                }\r\n                if (col < min) min = col;\r\n                if (Array.isArray(cmmt.ch)) {\r\n                    this.cmd(\"insert\", cmmt.ch[0], \" \");\r\n                    this.cmd(\"end_of_line\");\r\n                    this.cmd(\"insert\", \" \", cmmt.ch[1]);\r\n                } else {\r\n                    this.cmd(\"insert\", cmmt.ch, \" \");\r\n                }\r\n                this.cmd(\"beginning_of_line\");\r\n                if (!this.cmd(\"forward_line\")) break out;\r\n            }\r\n            this.cmd(\"goto_char\", end);\r\n            if (this._rowcol.col > 0 && !this.cmd(\"looking_at\", /\\s*$/my))\r\n                this.cmd(\"newline_and_indent\");\r\n        });\r\n    }),\r\n\r\n    uncomment_region: Ymacs_Interactive(\"r\", function(begin, end){\r\n        var cmmt1 = this.getq(\"syntax_comment_line\");\r\n        var cmmt2 = this.getq(\"syntax_comment_multi\");\r\n        if (!cmmt1 && !cmmt2) return;\r\n        this.clearTransientMark();\r\n        this.cmd(\"save_excursion\", function(){\r\n            end = this.createMarker(end);\r\n            this.cmd(\"goto_char\", begin);\r\n            while (this.point() < end.getPosition()) {\r\n                this.cmd(\"forward_whitespace\");\r\n                if (cmmt1 && this.cmd(\"looking_at\", cmmt1.rx)) {\r\n                    this.cmd(\"delete_char\", this.matchData[0].length);\r\n                } else if (cmmt2 && this.cmd(\"looking_at\", cmmt2.rx)) {\r\n                    this._replaceText(this.point(), this.point() + this.matchData[0].length, this.matchData[1]);\r\n                }\r\n                this.cmd(\"beginning_of_line\");\r\n                if (!this.cmd(\"forward_line\")) break;\r\n            }\r\n        });\r\n    }),\r\n\r\n    comment_dwim: Ymacs_Interactive(\"^r\", function(begin, end){\r\n        var cmmt1 = this.getq(\"syntax_comment_line\");\r\n        var cmmt2 = this.getq(\"syntax_comment_multi\");\r\n        if (!cmmt1 && !cmmt2) return;\r\n        if (this.transientMarker) {\r\n            this.cmd(\"save_excursion\", function(){\r\n                this.cmd(\"goto_char\", begin);\r\n                var already_comment =\r\n                    (cmmt1 && this.cmd(\"looking_at\", cmmt1.rx))\r\n                    ||\r\n                    (cmmt2 && this.cmd(\"looking_at\", cmmt2.rx));\r\n                if (already_comment) {\r\n                    this.cmd(\"uncomment_region\", begin, end);\r\n                } else {\r\n                    this.cmd(\"comment_region\", begin, end);\r\n                }\r\n            });\r\n        } else {\r\n            this.cmd(\"end_of_line\");\r\n            if (cmmt1) {\r\n                this.cmd(\"insert\", \" \", cmmt1.ch, \" \");\r\n            } else {\r\n                this.cmd(\"insert\", \" \", cmmt2.ch[0], cmmt2.ch[1]);\r\n                this.cmd(\"backward_char\", cmmt2.ch[1].length);\r\n            }\r\n            this.cmd(\"indent_line\");\r\n        }\r\n    }),\r\n\r\n    what_cursor_position: Ymacs_Interactive(\"^\", function(){\r\n        var ch = this.charAt(), chname = ch;\r\n        if (ch == null)\r\n            chname = \"EOF\";\r\n        else if (ch == \" \")\r\n            chname = \"Space\";\r\n        else if (ch == \"\\n\")\r\n            chname = \"Newline\";\r\n        this.popupMessage({\r\n            isHtml: true,\r\n            atCaret: true,\r\n            text: TMPL_CHAR_INFO({\r\n                ch      : DOM.htmlEscape(chname),\r\n                code    : ch ? ch.charCodeAt(0) : null,\r\n                codeHex : ch ? ch.charCodeAt().toString(16).toUpperCase() : null,\r\n                point   : this.point(),\r\n                size    : this.getCodeSize(),\r\n                sizeKB  : formatBytes(this.getCodeSize(), 2)\r\n            }),\r\n        });\r\n    }),\r\n\r\n    set_fill_column: Ymacs_Interactive(\"p\", function(value){\r\n        let next = value => {\r\n            let prev = this.getq(\"fill_column\");\r\n            this.setq(\"fill_column\", +value);\r\n            this.signalInfo(`Fill column set to ${value} (was ${prev})`, false, 5000);\r\n        };\r\n        if (value == null) {\r\n            this.whenMinibuffer(mb => {\r\n                this.cmd(\"minibuffer_prompt\", \"Set fill column to: \");\r\n                mb.setMark();\r\n                mb.transientMarker = mb.createMarker(mb.point(), true);\r\n                mb.cmd(\"insert\", String(this._rowcol.col));\r\n                mb.ensureTransientMark();\r\n                this.cmd(\"minibuffer_read_number\", next);\r\n            });\r\n        } else {\r\n            next(value);\r\n        }\r\n    }),\r\n\r\n    bury_buffer: Ymacs_Interactive(function(){\r\n        let ymacs = this.ymacs;\r\n        ymacs.switchToNextBuffer();\r\n    }),\r\n\r\n    describe_mode: Ymacs_Interactive(function(){\r\n        let ymacs = this.ymacs;\r\n        let buf = ymacs.switchToBuffer(\"*Help*\");\r\n        ymacs.switchToBuffer(buf);\r\n        buf.pushKeymap(help_keymap);\r\n        buf._disableUndo(() => {\r\n            buf.setCode(`Active keymaps in buffer \"${this.name}\".\\nPress \\`q\\` to go back.\\n\\n`);\r\n            buf.cmd(\"end_of_buffer\");\r\n            let dumpKeymap = (prefix, definitions) => {\r\n                for (let [ key, val ] of Object.entries(definitions)) {\r\n                    let def = (prefix ? prefix + \" \" : \"\") + key;\r\n                    if (Array.isArray(val)) {\r\n                        let txt = \"  \";\r\n                        txt += def;\r\n                        for (let n = 20 - def.length; n-- >= 0;) txt += \" \";\r\n                        txt += \" : \" + (\r\n                            typeof val[0] == \"function\" ? \"(lambda)\" : JSON.stringify(val)\r\n                        );\r\n                        buf.cmd(\"insert\", txt);\r\n                        buf.cmd(\"newline\");\r\n                    } else if (val && typeof val == \"object\") {\r\n                        dumpKeymap(def, val);\r\n                    }\r\n                }\r\n            };\r\n            [...this.keymap].reverse().forEach((keymap, index) => {\r\n                if (index > 0) buf.cmd(\"insert\", \"\\n\");\r\n                buf.cmd(\"insert\", `Keymap: ${keymap.name || \"(unnamed)\"}\\n`);\r\n                buf.cmd(\"newline\");\r\n                dumpKeymap(\"\", keymap.definitions);\r\n            });\r\n        });\r\n        buf.dirty(false);\r\n        buf.cmd(\"goto_char\", 0);\r\n    }),\r\n\r\n    window_configuration_to_register: Ymacs_Interactive(function(){\r\n        this.whenMinibuffer(mb => {\r\n            mb.prompt(\"Window configuration to register:\");\r\n            this.setq(\"read_register_callback\", (reg) => {\r\n                let ymacs = this.ymacs;\r\n                ymacs.registers[reg] = { frames: ymacs.getFrameConfig() };\r\n                this.signalInfo(`Saved to register \"${reg}\"`, null, 2000);\r\n            });\r\n            this.pushKeymap(read_register_keymap);\r\n        });\r\n    }),\r\n\r\n    jump_to_register: Ymacs_Interactive(function(){\r\n        this.whenMinibuffer(mb => {\r\n            mb.prompt(\"Jump to register:\");\r\n            this.setq(\"read_register_callback\", (reg) => this.ymacs.jumpToRegister(reg));\r\n            this.pushKeymap(read_register_keymap);\r\n        });\r\n    }),\r\n\r\n});\r\n\r\n/* -----[ rectangle functions (vertical editing) ]----- */\r\n\r\n(function(){\r\n\r\n    function apply_on_rectangle(buffer, begin, end, func) {\r\n        buffer.cmd(\"save_excursion\", function(){\r\n            var p1 = this._positionToRowCol(begin),\r\n            p2 = this._positionToRowCol(end),\r\n            width = Math.abs(p2.col - p1.col);\r\n            for (var line = p1.row; line <= p2.row; ++line) {\r\n                this.cmd(\"goto_char\", this._rowColToPosition(line, 0));\r\n                var text = this.code[line],\r\n                c1 = p1.col,\r\n                c2 = p2.col,\r\n                p = this.point(), ws = 0;\r\n                if (c1 > c2) {\r\n                    var tmp = c1;\r\n                    c1 = c2;\r\n                    c2 = tmp;\r\n                }\r\n                if (c1 > text.length) {\r\n                    ws = c1 - text.length;\r\n                    c1 = text.length;\r\n                }\r\n                if (c2 > text.length) {\r\n                    c2 = text.length;\r\n                }\r\n                func.call(this, p + c1, p + c2, ws, width);\r\n            }\r\n        }, begin == buffer.point());\r\n    };\r\n\r\n    Ymacs_Buffer.newCommands({\r\n\r\n        string_rectangle: Ymacs_Interactive(\"r\\nsString rectangle: \", function(begin, end, string) {\r\n            apply_on_rectangle(this, begin, end, function(c1, c2, ws){\r\n                if (ws > 0) {\r\n                    this._insertText(\" \".repeat(ws), c1);\r\n                } else {\r\n                    this._deleteText(c1, c2);\r\n                }\r\n                this._insertText(string, c1 + ws);\r\n            });\r\n        }),\r\n\r\n        kill_rectangle: Ymacs_Interactive(\"r\", function(begin, end){\r\n            var text = [];\r\n            apply_on_rectangle(this, begin, end, function(c1, c2, ws, width){\r\n                var str = this._bufferSubstring(c1, c2);\r\n                if (c2 - c1 < width)\r\n                    str += \" \".repeat(width - c2 + c1);\r\n                text.push(str);\r\n                this._deleteText(c1, c2);\r\n            });\r\n            this.setq(\"killed_rectangle\", text);\r\n        }),\r\n\r\n        clear_rectangle: Ymacs_Interactive(\"r\", function(begin, end){\r\n            this.cmd(\"string_rectangle\", begin, end,\r\n                     \" \".repeat(Math.abs(this._positionToRowCol(end).col -\r\n                                         this._positionToRowCol(begin).col)));\r\n        }),\r\n\r\n        insert_rectangle: function(point, rect) {\r\n            var col = this._positionToRowCol(point).col;\r\n            this.setMark(point);\r\n            rect.forEach((text, i) => {\r\n                if (i > 0) {\r\n                    if (!this.cmd(\"forward_line\")) {\r\n                        this.cmd(\"end_of_line\");\r\n                        this.cmd(\"newline\");\r\n                    }\r\n                    this.cmd(\"move_to_column\", col, true);\r\n                }\r\n                this.cmd(\"insert\", text);\r\n            });\r\n        },\r\n\r\n        yank_rectangle: Ymacs_Interactive(\"d\", function(point){\r\n            var kr = this.getq(\"killed_rectangle\");\r\n            if (kr == null)\r\n                throw new Ymacs_Exception(\"No killed rectangle\");\r\n            this.cmd(\"insert_rectangle\", point, kr);\r\n        }),\r\n\r\n        _next_is_meta: function() {\r\n            if (!this.__nextIsMeta) {\r\n                this.__nextIsMeta = true;\r\n                this.currentKeys.pop();\r\n            }\r\n        },\r\n\r\n    });\r\n\r\n})();\r\n\r\n(function(){\r\n    Ymacs_Buffer.newCommands({\r\n        kmacro_start_macro: Ymacs_Interactive(\"p\", function(arg) {\r\n            if (this.ymacs.isRunningMacro()) {\r\n                return;\r\n            }\r\n            if (this.ymacs.isRecordingMacro()) {\r\n                this.signalError(\"Already defining keyboard macro.\");\r\n                return;\r\n            }\r\n            this.signalInfo(\"Defining keyboard macro\");\r\n            this.ymacs.startMacro(arg !== null);\r\n        }),\r\n        kmacro_end_macro: Ymacs_Interactive(function() {\r\n            if (this.ymacs.isRunningMacro()) {\r\n                return;\r\n            }\r\n            if (!this.ymacs.isRecordingMacro()) {\r\n                this.signalInfo(\"Not defining kbd macro\");\r\n                return;\r\n            }\r\n            this.signalInfo(\"Keyboard macro defined\");\r\n            this.ymacs.stopMacro();\r\n        }),\r\n        kmacro_end_and_call_macro: Ymacs_Interactive(\"p\", function(arg) {\r\n            this.ymacs.stopMacro();\r\n            if (arg === null)\r\n                arg = 1;\r\n            var macro = this.ymacs.getLastMacro();\r\n            this.interactiveEvent(null);\r\n            this.ymacs.runMacro(arg, macro);\r\n        })\r\n    });\r\n})();\r\n\r\n/* -----[ transient mark extension commands ]----- */\r\n\r\n[\r\n    \"forward_char\",\r\n    \"forward_word\",\r\n    \"forward_line\",\r\n    \"forward_paragraph\",\r\n    \"forward_sexp\",\r\n    \"beginning_of_line\",\r\n    \"beginning_of_indentation_or_line\",\r\n    \"beginning_of_buffer\",\r\n    \"backward_char\",\r\n    \"backward_word\",\r\n    \"backward_line\",\r\n    \"backward_paragraph\",\r\n    \"backward_sexp\",\r\n    \"end_of_line\",\r\n    \"end_of_buffer\"\r\n\r\n].forEach(function(cmd) {\r\n    Ymacs_Buffer.COMMANDS[cmd + \"_mark\"] = Ymacs_Interactive(\"^\", function(){\r\n        this.ensureTransientMark();\r\n        this.cmdApply(cmd, arguments);\r\n        this.ensureTransientMark();\r\n    });\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { zeroPad, getYmacsThemes } from \"./ymacs-utils.js\";\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Interactive } from \"./ymacs-interactive.js\";\r\nimport { read_with_continuation } from \"./ymacs-minibuffer.js\";\r\n\r\nYmacs_Buffer.newCommands({\r\n\r\n    get_region: function() {\r\n        return this.getRegion();\r\n    },\r\n\r\n    figure_out_mode: function(code) {\r\n        if (!code)\r\n            code = this.getCode();\r\n        var lines = code.split(/\\n/);\r\n        if (lines.length > 4)\r\n            lines.splice(2, lines.length - 4);\r\n        for (let line of lines) {\r\n            let m = /-\\*-\\s*(.*?)\\s*-\\*-/i.exec(line);\r\n            if (m) return m[1];\r\n        }\r\n    },\r\n\r\n    // TODO: the mapping from extension to mode should be defined\r\n    // with each mode.\r\n    mode_from_name: function(name) {\r\n        if (!name) name = this.name;\r\n        var ext = (/\\.[^.]+$/.exec(name) || [\"\"])[0];\r\n        switch (ext) {\r\n          case \".css\":\r\n            return \"css\";\r\n\r\n          case \".js\":\r\n            return \"javascript\";\r\n\r\n          case \".lisp\":\r\n          case \".scm\":\r\n          case \".el\":\r\n            return \"lisp\";\r\n\r\n          case \".md\":\r\n            return \"markdown\";\r\n\r\n          case \".xml\":\r\n            return \"xml\";\r\n\r\n          case \".html\":\r\n            return \"html\";\r\n\r\n          case \".twig\":\r\n            return \"twig_html\";\r\n        }\r\n        return null;\r\n    },\r\n\r\n    set_buffer_mode: function(mode) {\r\n        if (!mode)\r\n            mode = this.cmd(\"figure_out_mode\") || this.cmd(\"mode_from_name\");\r\n        if (mode) {\r\n            if (this.COMMANDS[mode]) {\r\n                this.cmd(mode, true);\r\n            } else if (this.COMMANDS[mode + \"_mode\"]) {\r\n                this.cmd(mode + \"_mode\", true);\r\n            }\r\n        }\r\n    },\r\n\r\n    cperl_lineup: Ymacs_Interactive(\"r\", function(begin, end){\r\n        this.cmd(\"save_excursion\", function(){\r\n            var rcend = this._positionToRowCol(end), max = 0, lines = [];\r\n            this.cmd(\"goto_char\", begin);\r\n            this.cmd(\"forward_whitespace\", true);\r\n            var ch = this.charAt();\r\n            if (ch.toLowerCase() != ch.toUpperCase()) {\r\n                this.signalError(\"Cannot lineup here\");\r\n                return;\r\n            }\r\n            while (this._rowcol.row <= rcend.row) {\r\n                var pos = this.getLine().indexOf(ch);\r\n                if (pos >= 0) {\r\n                    if (pos > max)\r\n                        max = pos;\r\n                    lines.push([ this._rowcol.row, pos ]);\r\n                }\r\n                if (!this.cmd(\"forward_line\"))\r\n                    break;\r\n            }\r\n            ++max;\r\n            lines.forEach(l => {\r\n                this.cmd(\"goto_char\", this._rowColToPosition(l[0], l[1]));\r\n                this.cmd(\"insert\", \" \".repeat(max - l[1]));\r\n            });\r\n        });\r\n    }),\r\n\r\n    htmlize_region: Ymacs_Interactive(\"r\\nP\", function(begin, end, lineNum) {\r\n        this.tokenizer.finishParsing();\r\n        var row = this._positionToRowCol(begin).row;\r\n        var html = \"\";\r\n        var line = row;\r\n        var pad;\r\n        if (lineNum && !lineNum.empty)\r\n            line = parseInt(lineNum, 10);\r\n        end = this._positionToRowCol(end).row;\r\n        pad = String(end).length;\r\n        while (row <= end) {\r\n            html += \"<div class='line'>\";\r\n            if (lineNum)\r\n                html += \"<span class='line-number'>\" + zeroPad(line, pad, \" \") + \"</span>\";\r\n            ++line;\r\n            html += this._textProperties.getLineHTML(row, this.code[row], null) + \"</div>\\n\";\r\n            ++row;\r\n        }\r\n        var tmp = this.ymacs.switchToBuffer(\"*Htmlize*\");\r\n        tmp.setCode(html);\r\n        tmp.cmd(\"xml_mode\", true);\r\n    }),\r\n\r\n    execute_extended_command: Ymacs_Interactive(\"^CM-x \", function(cmd) {\r\n        this.callInteractively(cmd);\r\n    }),\r\n\r\n    set_variable: Ymacs_Interactive(\"vSet variable: \\nsTo value: \", function(variable, value) {\r\n        var tmp = parseFloat(value);\r\n        if (!isNaN(tmp))\r\n            value = tmp;\r\n        this.setq(variable, value);\r\n    }),\r\n\r\n    eval_string: Ymacs_Interactive(\"^MEval string: \", function(code){\r\n        try {\r\n            var variables = [\r\n                this,      // buffer\r\n                this.ymacs // ymacs\r\n            ];\r\n            code = new Function(\"buffer\", \"ymacs\", code);\r\n            code.apply(this, variables);\r\n            this.clearTransientMark();\r\n        } catch(ex) {\r\n            this.signalError(ex.type + \": \" + ex.message);\r\n            if (window.console)\r\n                console.log(ex);\r\n        }\r\n    }),\r\n\r\n    eval_region: Ymacs_Interactive(\"^r\", function(begin, end) {\r\n        this.cmd(\"eval_string\", this.cmd(\"buffer_substring\", begin, end));\r\n    }),\r\n\r\n    eval_buffer: Ymacs_Interactive(function(){\r\n        this.cmd(\"eval_string\", this.getCode());\r\n    }),\r\n\r\n    toggle_line_numbers: Ymacs_Interactive(\"^\", function(){\r\n        this.ymacs.toggleClass(\"Ymacs-line-numbers\");\r\n    }),\r\n\r\n    save_file: Ymacs_Interactive(\"FWrite file: \", function(name){\r\n        this.ymacs.ls_setFileContents(name, this.getCode());\r\n        this.signalInfo(\"Saved in local storage\");\r\n    }),\r\n\r\n    load_file: Ymacs_Interactive(\"fFind file: \", function(name){\r\n        var code = this.ymacs.ls_getFileContents(name);\r\n        var buffer = this.ymacs.createBuffer({ name: name });\r\n        buffer.setCode(code);\r\n        buffer.cmd(\"set_buffer_mode\");\r\n        buffer.cmd(\"switch_to_buffer\", name);\r\n    }),\r\n\r\n    find_file: Ymacs_Interactive(\"FFind file: \", function(name) {\r\n        var self = this;\r\n        name = self.ymacs.fs_normalizePath(name);\r\n        self.ymacs.fs_fileType(name, function (type) {\r\n            if (type == \"directory\") {\r\n                self.signalInfo(\"Can't open directory\");\r\n            } else {\r\n                self.ymacs.fs_getFileContents(name, true, function (code, stamp) {\r\n                    var buffer = self.ymacs.getBuffer(name);\r\n\r\n                    function find_file() {\r\n                        buffer.setCode(code || \"\");\r\n                        buffer.stamp = stamp;\r\n                        buffer.dirty(false);\r\n                        buffer.cmd(\"set_buffer_mode\");\r\n                        buffer.cmd(\"switch_to_buffer\", name);\r\n                    }\r\n\r\n                    if (buffer) {\r\n                        if (stamp == null) {\r\n                            find_file();\r\n                        } else if (buffer.stamp == stamp) {\r\n                            buffer.cmd(\"switch_to_buffer\", name);\r\n                        } else {\r\n                            var msg = \"File \" + name + \" changed on disk.  \"\r\n                                + (buffer.dirty() ? \"Discard your edits?\" : \"Reread from disk?\");\r\n                            buffer.cmd(\"minibuffer_yn\", msg, function (yes) {\r\n                                if (yes)\r\n                                    find_file();\r\n                            });\r\n                        }\r\n                    } else {\r\n                        buffer = self.ymacs.createBuffer({ name: name, stamp: stamp });\r\n                        if (code == null)\r\n                            self.signalInfo(\"New file\");\r\n                        find_file();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }),\r\n\r\n    write_file: Ymacs_Interactive(\"FWrite file: \", function(name){\r\n        var self = this;\r\n\r\n        function write_file() {\r\n            self.ymacs.fs_setFileContents(name, self.getCode(), null, function (stamp) {\r\n                self.cmd(\"rename_buffer\", name);\r\n                self.dirty(false);\r\n                self.stamp = stamp; // refresh stamp\r\n                self.signalInfo(\"Wrote \"+name);\r\n            });\r\n        }\r\n\r\n        var buffer = self.ymacs.getBuffer(name);\r\n        if (!buffer)\r\n            write_file();\r\n        else {\r\n            var msg = \"A buffer is visiting \"+name+\"; proceed?\";\r\n            buffer.cmd(\"minibuffer_yn\", msg, function (yes) {\r\n                if (yes) {\r\n                    self.ymacs.killBuffer(buffer);\r\n                    write_file();\r\n                }\r\n            });\r\n        }\r\n    }),\r\n\r\n    save_some_buffers: function () {\r\n        this.cmd(\"save_some_buffers_with_continuation\", true, function () { });\r\n    },\r\n\r\n    save_some_buffers_with_continuation: function (ask, cont) {\r\n\r\n        var bufs = this.ymacs.buffers.slice(); // get copy of buffers\r\n\r\n        function loop(saved) {\r\n            if (bufs.length > 0)\r\n                bufs.shift().cmd(\"save_buffer_with_continuation\", ask, loop);\r\n            else\r\n                cont();\r\n        }\r\n\r\n        loop(false);\r\n    },\r\n\r\n    save_buffer_with_continuation: function (ask, cont) {\r\n\r\n        var self = this;\r\n\r\n        function did_save(stamp) {\r\n            self.dirty(false);\r\n            self.stamp = stamp; // refresh stamp\r\n            cont(true);\r\n        }\r\n\r\n        function do_save() {\r\n            self.ymacs.fs_setFileContents(self.name, self.getCode(), self.stamp, function (stamp) {\r\n                if (stamp != null) {\r\n                    did_save(stamp);\r\n                } else {\r\n                    self.cmd(\"minibuffer_yn\", self.name + \" has changed since visited or saved.  Save anyway?\", function (yes) {\r\n                        if (!yes) {\r\n                            cont(false);\r\n                        } else {\r\n                            self.ymacs.fs_setFileContents(self.name, self.getCode(), null, function (stamp) {\r\n                                did_save(stamp);\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        if (!self.dirty() || (ask && self.name.match(/^\\*.*\\*$/))) {\r\n            cont(false);\r\n        } else if (!ask) {\r\n            do_save();\r\n        } else {\r\n            self.cmd(\"minibuffer_yn\", \"Save file \" + self.name + \"?\", function (yes) {\r\n                if (!yes) {\r\n                    cont(false);\r\n                } else {\r\n                    do_save();\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    save_buffer: Ymacs_Interactive(\"\", function () {\r\n        var self = this;\r\n        if (self.dirty())\r\n            self.cmd(\"save_buffer_with_continuation\", false, function (saved) {\r\n                if (saved)\r\n                    self.signalInfo(\"Wrote \"+self.name);\r\n            });\r\n        else\r\n            self.signalInfo(\"No changes need to be saved\");\r\n    }),\r\n\r\n    delete_file: Ymacs_Interactive(\"fDelete file: \", function(name){\r\n        var self = this;\r\n        self.ymacs.fs_deleteFile(name, function () {\r\n            self.signalInfo(\"Deleted \"+name);\r\n        });\r\n    }),\r\n\r\n    eval_file: Ymacs_Interactive(\"fEval file: \", function(name){\r\n        var self = this;\r\n        self.ymacs.fs_getFileContents(name, false, function (code, stamp) {\r\n            self.cmd(\"eval_string\", code);\r\n        });\r\n    }),\r\n\r\n    request_full_screen: Ymacs_Interactive(async function(){\r\n        try {\r\n            this.ymacs.requestFullScreen();\r\n        } catch(ex) {\r\n            console.error(ex);\r\n            this.signalError(\"Full-screen denied\", false, 3000);\r\n        }\r\n    }),\r\n\r\n    set_color_theme: Ymacs_Interactive(function(theme){\r\n        if (theme) {\r\n            this.ymacs.setColorTheme(theme);\r\n        } else {\r\n            let names = getYmacsThemes().sort();\r\n            this.cmd(\"minibuffer_prompt\", \"Color theme: \");\r\n            read_with_continuation.call(this, names, theme => {\r\n                this.ymacs.setColorTheme(theme);\r\n            }, (mb, theme, cont) => {\r\n                theme = theme.trim();\r\n                if (!theme) {\r\n                    mb.cmd(\"minibuffer_complete\");\r\n                } else if (names.indexOf(theme) < 0) {\r\n                    mb.signalError(\"No such theme\");\r\n                    return cont(false);\r\n                } else {\r\n                    return cont(true);\r\n                }\r\n            });\r\n        }\r\n    }),\r\n\r\n    toggle_bar_cursor: Ymacs_Interactive(function(){\r\n        this.ymacs.toggleBarCursor();\r\n    }),\r\n\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Keymap } from \"./ymacs-keymap.js\";\r\nimport { DOM, common_prefix, fuzzy_filter, delayed } from \"./ymacs-utils.js\";\r\nimport { Ymacs_Popup } from \"./ymacs-popup.js\";\r\nimport { Ymacs_Interactive } from \"./ymacs-interactive.js\";\r\n\r\nvar $menu = null, $selectedIndex = null, $selectedItem = null;\r\nfunction popupCompletionMenu(frame, list, { noError = false, noPrefix = false } = {}) {\r\n    killMenu();\r\n    let activeElement = document.activeElement;\r\n    let ymacs = this.ymacs; // `this` is the minibuffer\r\n    $menu = new Ymacs_Popup();\r\n    $menu.addClass(\"with-arrow\");\r\n    list.forEach((label, index) => {\r\n        let value = label;\r\n        if (typeof label != \"string\") {\r\n            value = label.value;\r\n            label = label.label;\r\n        }\r\n        let el = DOM.fromHTML(`<div class=\"Ymacs_Menu_Item\" data-value=\"${DOM.htmlEscape(value)}\"\r\n                                          data-index=\"${index}\">${DOM.htmlEscape(label)}</div>`);\r\n        $menu.add(el);\r\n    });\r\n    DOM.on($menu.getContentElement(), {\r\n        click: ev => {\r\n            activeElement.focus();\r\n            let item = ev.target;\r\n            if (!DOM.hasClass(item, \"Ymacs_Menu_Item\")) return;\r\n            select(+item.dataset.index);\r\n            handle_enter.call(this);\r\n        },\r\n    });\r\n    ymacs._popupAtCaret($menu.getElement());\r\n    select(0);\r\n\r\n    // XXX: this is some more aggressive, ivy-like completion, but\r\n    // it's not working very well with filename completion.\r\n    let onChange = this.getq(\"ivy_completion\") && delayed(() => {\r\n        killMenu();\r\n        this.cmd(\"minibuffer_complete\", { noError, noPrefix });\r\n    }, 1);\r\n\r\n    this.pushKeymap(KEYMAP_POPUP_ACTIVE);\r\n    if (onChange) this.addEventListener(\"onChange\", onChange);\r\n    $menu.addEventListener(\"onDestroy\", () => {\r\n        this.popKeymap(KEYMAP_POPUP_ACTIVE);\r\n        if (onChange) this.removeEventListener(\"onChange\", onChange);\r\n    });\r\n}\r\n\r\nfunction killMenu() {\r\n    if ($menu) $menu.destroy();\r\n    $menu = null;\r\n    $selectedItem = null;\r\n    $selectedIndex = null;\r\n}\r\n\r\nfunction select(idx) {\r\n    let cont = $menu.getContentElement();\r\n    let items = [...cont.querySelectorAll(\".Ymacs_Menu_Item\")];\r\n    let n = items.length;\r\n    $selectedIndex = ((idx % n) + n) % n;\r\n    items.forEach(el => {\r\n        let current = el.dataset.index == $selectedIndex;\r\n        if (current) $selectedItem = el;\r\n        DOM.condClass(el, current, \"selected\");\r\n    });\r\n    $selectedItem.scrollIntoView({ block: \"nearest\" });\r\n}\r\n\r\nexport function read_with_continuation(completions, cont, validate) {\r\n    this.whenMinibuffer(function(mb){\r\n        let ivy = completions !== filename_completion;\r\n        var changed_vars = mb.setq({\r\n            ivy_completion: ivy,\r\n            completion_list: completions,\r\n            minibuffer_validation: (what, cont2) => {\r\n                if (what == null)\r\n                    what = mb.cmd(\"minibuffer_contents\");\r\n                if (validate)\r\n                    validate.call(this, mb, what, cont2);\r\n                else\r\n                    cont2(true); // accept anything by default\r\n            },\r\n            minibuffer_continuation: what => {\r\n                mb.setq(changed_vars);\r\n                if (cont)\r\n                    cont.call(this, what);\r\n            },\r\n        });\r\n        mb.cmd(\"minibuffer_complete\", { noError: true, noPrefix: !ivy });\r\n    });\r\n}\r\n\r\nfunction filename_completion(mb, str, cont, { noPrefix = false } = {}) {\r\n    var self = this;\r\n    var lastslash = str.lastIndexOf(\"/\");\r\n    var dir = str.slice(0, lastslash+1);\r\n    var partial = str.slice(lastslash+1);\r\n    self.ymacs.fs_getDirectory(dir, function (files) {\r\n        function add_trailing_slash_to_dir(name) {\r\n            if (files[name].type == \"directory\") {\r\n                return name + \"/\";\r\n            } else {\r\n                return name;\r\n            }\r\n        }\r\n        if (!files) {\r\n            mb.signalError(\"Not found\");\r\n            cont(null);\r\n        } else {\r\n            var completions = [];\r\n            for (let f of Object.keys(files)) {\r\n                if (f.indexOf(partial) == 0) {\r\n                    completions.push(add_trailing_slash_to_dir(f));\r\n                }\r\n            }\r\n            if (completions.length == 0) {\r\n                cont([]);\r\n            } else {\r\n                var prefix = common_prefix(completions);\r\n                if (prefix != partial && !noPrefix) {\r\n                    mb.cmd(\"minibuffer_replace_input\", dir + prefix);\r\n                    cont(completions.map(name => ({ label: name, value: dir + name })));\r\n                } else if (completions.length == 1) {\r\n                    cont([ str ]);\r\n                } else {\r\n                    cont(completions.map(name => ({ label: name, value: dir + name })));\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nYmacs_Buffer.newCommands({\r\n\r\n    minibuffer_prompt: function(prompt, nofocus) {\r\n        this.whenMinibuffer(function(mb){\r\n            var f = this.getMinibufferFrame();\r\n            this.ymacs.setInputFrame(f);\r\n            mb.prompt(prompt);\r\n            if (!nofocus)\r\n                f.focus();\r\n        });\r\n    },\r\n\r\n    minibuffer_yn: function(prompt, cont) {\r\n        this.cmd(\"minibuffer_prompt\", prompt + \" (yes or no) \");\r\n        this.cmd(\"minibuffer_read_yn\", function (text) {\r\n            cont(text == \"yes\");\r\n        });\r\n    },\r\n\r\n    minibuffer_read_yn: function(cont) {\r\n        read_with_continuation.call(this, [ \"yes\", \"no\" ], cont, function(mb, text, cont2){\r\n            if (text == \"yes\" || text == \"no\")\r\n                cont2(true);\r\n            else\r\n                mb.signalError(\"Please enter yes or no\");\r\n        });\r\n    },\r\n\r\n    minibuffer_read_number: function(cont) {\r\n        read_with_continuation.call(this, null, cont, function(mb, text, cont2){\r\n            var n = parseInt(text, 10);\r\n            if (isNaN(n))\r\n                mb.signalError(\"Please enter a number\");\r\n            cont2(!isNaN(n));\r\n        });\r\n    },\r\n\r\n    minibuffer_read_command: function(cont) {\r\n        var completions = Object.keys(this.COMMANDS).filter(cmd => this.COMMANDS[cmd].ymacsInteractive).sort();\r\n        read_with_continuation.call(this, completions, cont, function(mb, name, cont2){\r\n            var cmd = this.COMMANDS[name],\r\n                ret = cmd && cmd.ymacsInteractive;\r\n            if (!ret) {\r\n                mb.signalError(\"No such command: \" + name);\r\n            }\r\n            cont2(ret);\r\n        });\r\n    },\r\n\r\n    minibuffer_read_function: function(cont) {\r\n        var commandNames = Array.hashKeys(Ymacs_Buffer.COMMANDS).sort();\r\n        read_with_continuation.call(this, commandNames, cont, function(mb, name, cont2){\r\n            var cmd = this.COMMANDS[name],\r\n                ret = !!cmd;\r\n            if (!ret)\r\n                mb.signalError(\"No such function: \" + name);\r\n            cont2(ret);\r\n        });\r\n    },\r\n\r\n    minibuffer_read_buffer: function(cont) {\r\n        this.whenYmacs(function(ymacs){\r\n            var bufferNames = ymacs.buffers.map(b => b.name);\r\n            bufferNames.push(bufferNames.shift());\r\n            read_with_continuation.call(this, bufferNames, cont);\r\n            //handle_tab.call(this);\r\n        });\r\n    },\r\n\r\n    minibuffer_read_string: function(completions, cont, validate) {\r\n        read_with_continuation.call(this, completions, cont, validate);\r\n    },\r\n\r\n    minibuffer_read_variable: function(cont) {\r\n        var tmp = Object.assign({}, this.globalVariables, this.variables);\r\n        var completions = Object.keys(tmp).filter(name => !/^\\*/.test(name)).sort();\r\n        read_with_continuation.call(this, completions, function(name) {\r\n            let val = this.getq(name);\r\n            this.signalInfo(`Current value of <b>${DOM.htmlEscape(name)}</b> = <b>${DOM.htmlEscape(val)}</b>`, true, 3000);\r\n            return cont.apply(this, arguments);\r\n        });\r\n    },\r\n\r\n    minibuffer_read_existing_file: function(cont) {\r\n        var self = this;\r\n        self.cmd(\"minibuffer_replace_input_by_current_dir\", function () {\r\n            read_with_continuation.call(self, filename_completion, cont, function(mb, name, cont2){\r\n                self.ymacs.fs_fileType(name, function (type){\r\n                    if (type != \"file\") {\r\n                        mb.signalError(\"No such file: \" + name);\r\n                        cont2(false);\r\n                    } else {\r\n                        cont2(true);\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    },\r\n\r\n    minibuffer_read_file: function(cont) {\r\n        var self = this;\r\n        self.cmd(\"minibuffer_replace_input_by_current_dir\", function () {\r\n            read_with_continuation.call(self, filename_completion, cont, function(mb, name, cont2){\r\n                self.ymacs.fs_fileType(name, function (type){\r\n                    cont2(type != \"directory\");\r\n                });\r\n            });\r\n        });\r\n    },\r\n\r\n    minibuffer_read_file_or_directory: function(cont) {\r\n        var self = this;\r\n        self.cmd(\"minibuffer_replace_input_by_current_dir\", function () {\r\n            read_with_continuation.call(self, filename_completion, cont);\r\n        });\r\n    },\r\n\r\n    minibuffer_read_directory: function(cont) {\r\n        var self = this;\r\n        self.cmd(\"minibuffer_replace_input_by_current_dir\", function () {\r\n            read_with_continuation.call(self, filename_completion, cont);\r\n        });\r\n    },\r\n\r\n    minibuffer_prompt_end: function() {\r\n        return this.whenMinibuffer(function(mb){\r\n            return mb.promptMarker.getPosition();\r\n        });\r\n    },\r\n\r\n    minibuffer_contents: function() {\r\n        return this.whenMinibuffer(function(mb){\r\n            return mb._bufferSubstring(mb.promptMarker);\r\n        });\r\n    },\r\n\r\n    minibuffer_replace_input: function(value) {\r\n        this.whenMinibuffer(function(mb){\r\n            mb._replaceText(mb.promptMarker, mb.getCodeSize(), value);\r\n            this.getMinibufferFrame().redrawCaret(true);\r\n        });\r\n    },\r\n\r\n    minibuffer_replace_input_by_current_dir: function (cont) {\r\n        this.whenYmacs(function(ymacs){\r\n            var self = this;\r\n            var name = ymacs.getActiveBuffer().name;\r\n            var dir = name.slice(0, name.lastIndexOf(\"/\")+1);\r\n            ymacs.fs_getDirectory(dir, function (info){\r\n                if (info && Object.keys(info).length > 0) {\r\n                    ymacs.fs_remapDir(dir, function (dir) {\r\n                        self.cmd(\"minibuffer_replace_input\", dir);\r\n                        self.cmd(\"minibuffer_complete\", { noError: true, noPrefix: true });\r\n                        cont();\r\n                    });\r\n                } else {\r\n                    self.cmd(\"minibuffer_replace_input\", \"\");\r\n                    cont();\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    minibuffer_complete: function({ noError = false, noPrefix = false } = {}) {\r\n        var self = this;\r\n        self.whenMinibuffer(function(mb){\r\n            let str = mb.cmd(\"minibuffer_contents\");\r\n            let a = mb.getq(\"completion_list\");\r\n\r\n            function complete(a) {\r\n                if (!a || a.length == 0) {\r\n                    if (!noError) mb.signalError(\"No completions\", false, 2000);\r\n                } else {\r\n                    popupCompletionMenu.call(mb, self.getMinibufferFrame(), a, { noError, noPrefix });\r\n                }\r\n            }\r\n\r\n            if (a instanceof Function) {\r\n                a.call(self, mb, str, function (a) {\r\n                    if (a) complete(a);\r\n                }, { noPrefix });\r\n            }\r\n            else if (a && a.length > 0) {\r\n                complete(fuzzy_filter(a, str));\r\n            }\r\n            else\r\n                complete(a);\r\n        });\r\n    },\r\n\r\n    minibuffer_complete_and_exit: function() {\r\n        this.whenMinibuffer(mb => {\r\n            mb.getq(\"minibuffer_validation\").call(mb, null, valid => {\r\n                if (valid)\r\n                    mb.cmd(\"minibuffer_keyboard_quit\", this.getq(\"minibuffer_continuation\"));\r\n                else\r\n                    mb.cmd(\"minibuffer_complete\");\r\n            });\r\n        });\r\n    },\r\n\r\n    minibuffer_keyboard_quit: function(cont) {\r\n        this.whenMinibuffer(function(mb){\r\n            var text = this.cmd(\"minibuffer_contents\");\r\n            mb.setCode(\"\");\r\n            this.ymacs.setInputFrame(this.ymacs.getActiveFrame());\r\n            this.ymacs.getActiveFrame().focus();\r\n            if (!cont) {\r\n                mb.callHooks(\"abort\");\r\n            }\r\n            setTimeout(() => {\r\n                if (cont)\r\n                    cont.call(this, text);\r\n                this.getPrefixArg();\r\n            }, 1);\r\n        });\r\n        killMenu();\r\n    }\r\n\r\n});\r\n\r\nfunction handle_arrow_down() {\r\n    if ($menu) {\r\n        select($selectedIndex + 1);\r\n    }\r\n}\r\n\r\nfunction handle_arrow_up() {\r\n    if ($menu) {\r\n        select($selectedIndex - 1);\r\n    }\r\n}\r\n\r\nfunction handle_popup_home() {\r\n    if ($menu) {\r\n        select(0);\r\n    }\r\n}\r\n\r\nfunction handle_popup_end() {\r\n    if ($menu) {\r\n        select(-1);\r\n    }\r\n}\r\n\r\nfunction handle_enter() {\r\n    if ($menu) {\r\n        let item = $selectedItem;\r\n        if (item) {\r\n            killMenu();\r\n            this.cmd(\"minibuffer_replace_input\", item.dataset.value);\r\n            this.cmd(\"minibuffer_complete_and_exit\");\r\n        } else {\r\n            this.signalError(\"Select something...\");\r\n        }\r\n    } else {\r\n        this.cmd(\"minibuffer_complete_and_exit\");\r\n    }\r\n}\r\n\r\nfunction handle_tab() {\r\n    if (!$menu)\r\n        this.cmd(\"minibuffer_complete\");\r\n    else\r\n        handle_arrow_down.call(this);\r\n}\r\n\r\nfunction handle_s_tab() {\r\n    handle_arrow_up.call(this);\r\n}\r\n\r\nfunction handle_home() {\r\n    this.cmd(\"goto_char\", this.promptMarker);\r\n}\r\n\r\nfunction handle_home_mark() {\r\n    this.ensureTransientMark();\r\n    this.cmd(\"goto_char\", this.promptMarker);\r\n    this.ensureTransientMark();\r\n}\r\n\r\nfunction handle_tilde() {\r\n    if (this.getq(\"completion_list\") === filename_completion) {\r\n        if (this.cmd(\"looking_back\", \"/\")) {\r\n            killMenu();\r\n            this.cmd(\"minibuffer_replace_input\", \"~/\");\r\n            this.cmd(\"minibuffer_complete\", { noError: true, noPrefix: true });\r\n            return;\r\n        }\r\n    }\r\n    this.cmd(\"self_insert_command\");\r\n}\r\n\r\nvar DEFAULT_KEYS = {\r\n    \"Tab\"                                : handle_tab,\r\n    \"Enter\"                              : handle_enter,\r\n    \"Home && C-a\"                        : handle_home,\r\n    \"~\"                                  : handle_tilde,\r\n    \"S-Home && S-C-a\"                    : Ymacs_Interactive(\"^\", handle_home_mark),\r\n};\r\n\r\nvar KEYMAP_MB_ACTIVE = Ymacs_Keymap.define(null, Object.assign({\r\n    \"C-g && Escape\" : \"minibuffer_keyboard_quit\"\r\n}, DEFAULT_KEYS));\r\n\r\nvar KEYMAP_POPUP_ACTIVE = Ymacs_Keymap.define(null, Object.assign({\r\n    \"S-Tab\"                                 : handle_s_tab,\r\n    \"ArrowDown && ArrowRight && C-n && C-f\" : handle_arrow_down,\r\n    \"ArrowUp && ArrowLeft && C-p && C-b\"    : handle_arrow_up,\r\n    \"PageDown\"                              : handle_arrow_down,\r\n    \"PageUp\"                                : handle_arrow_up,\r\n    \"C-End && M->\"                          : handle_popup_end,\r\n    \"C-Home && M-<\"                         : handle_popup_home,\r\n    \"Escape\"                                : function() {\r\n        killMenu();\r\n    }\r\n}, DEFAULT_KEYS));\r\nKEYMAP_POPUP_ACTIVE.defaultHandler = [ function() {\r\n    if (!this.getq(\"ivy_completion\")) killMenu();\r\n    return false; // say it's not handled though\r\n} ];\r\n\r\nYmacs_Buffer.newMode(\"minibuffer_mode\", function(){\r\n    this.pushKeymap(KEYMAP_MB_ACTIVE);\r\n    return function() {\r\n        this.popKeymap(KEYMAP_MB_ACTIVE);\r\n    };\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Keymap } from  \"./ymacs-keymap.js\";\r\nimport { Ymacs_Interactive } from \"./ymacs-interactive.js\";\r\n\r\nlet Ymacs_Keymap_ISearch = Ymacs_Keymap.define(\"isearch\", {\r\n    \"Escape\"                : [ \"isearch_abort\", true ],\r\n    \"C-g\"                   : \"isearch_reset_or_abort\",\r\n    \"C-w && C-S-s\"          : \"isearch_yank_word_or_char\",\r\n    \"C-s\"                   : \"isearch_forward\",\r\n    \"C-r\"                   : \"isearch_backward\",\r\n    \"M-%\"                   : \"query_replace\",\r\n    \"C-M-%\"                 : \"query_replace_regexp\",\r\n    \"M-s w && M-w\"          : \"isearch_toggle_word\",\r\n    \"M-s c && M-c\"          : \"isearch_toggle_case_fold\",\r\n    \"M-s Space && M-Space\"  : \"isearch_toggle_lax_whitespace\",\r\n    \"Enter\"                 : \"isearch_abort\",\r\n    \"C-l\"                   : \"recenter_top_bottom\",\r\n    \"Backspace\"             : function() {\r\n        if (this.getMinibuffer().point() > this._isearchContext.mbMark.getPosition()) {\r\n            this.getMinibuffer().cmd(\"backward_delete_char\");\r\n            this.cmd(\"goto_char\", this._isearchContext.livepoint);\r\n            isearchText.call(this);\r\n            updateIsearch.call(this);\r\n        }\r\n    },\r\n});\r\nYmacs_Keymap_ISearch.defaultHandler = [ \"isearch_printing_char\" ];\r\n\r\nfunction initIsearch({\r\n    forward = true,\r\n    regexp = false,\r\n    lax = true,\r\n    word = false,\r\n    case_fold = this.getq(\"case_fold_search\"),\r\n    case_replace = this.getq(\"case_replace\"),\r\n    qreplace = false,\r\n    region = null,\r\n} = {}) {\r\n    if (!this._isearchContext) {\r\n        this._isearchContext = {\r\n            forward      : forward,\r\n            regexp       : regexp,\r\n            lax          : lax,\r\n            word         : word,\r\n            case_fold    : case_fold,\r\n            case_replace : case_replace,\r\n            livepoint    : this.point(),\r\n            origpoint    : this.point(),\r\n            current      : { begin: this.point(), end: this.point() },\r\n            mbMark       : this.getMinibuffer().promptMarker,\r\n            query        : \"\",\r\n            qreplace     : qreplace,\r\n            region       : region,\r\n        };\r\n        if (!qreplace) {\r\n            this.pushKeymap(Ymacs_Keymap_ISearch);\r\n            resetPrompt.call(this);\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction isearchText() {\r\n    return this._isearchContext.query = this.getMinibuffer()._bufferSubstring(this._isearchContext.mbMark);\r\n}\r\n\r\nfunction updateIsearch({ forward } = {}) {\r\n    var query = this._isearchContext.query;\r\n    if (!/\\S/.test(query) && this.getq(\"isearch_last_context\")) {\r\n        this._isearchContext = this.getq(\"isearch_last_context\");\r\n        query = this._isearchContext.query;\r\n        this.getMinibuffer()._placeUndoBoundary();\r\n        this.getMinibuffer().cmd(\"insert\", query);\r\n        this._isearchContext.origpoint = this.point();\r\n        this._isearchContext.current = { begin: this.point(), end: this.point() };\r\n    }\r\n    this._isearchContext.livepoint = this.point();\r\n    if (forward != null) {\r\n        this._isearchContext.forward = forward;\r\n    }\r\n    return doSearch.call(this);\r\n}\r\n\r\nfunction caseFold() {\r\n    let ctx = this._isearchContext;\r\n    let query = ctx.query;\r\n    return ctx.case_fold ?? (\r\n        (ctx.regexp ? (query = query.replace(/\\\\./g, \"\")) : query) == query.toLowerCase()\r\n    );\r\n}\r\n\r\nfunction lazyHighlight(qrx, prompt) {\r\n    let cursor = this._rowcol;\r\n    let minpos = this._rowColToPosition(cursor.row - 50, 0);\r\n    let maxpos = this._rowColToPosition(cursor.row + 50, Infinity);\r\n    let code = this.getCode();\r\n    let hl = [];\r\n    let ctx = this._isearchContext;\r\n    let point = this.point();\r\n    let count = 0;\r\n    let crnt = 0;\r\n    qrx.lastIndex = ctx.region?.begin || 0;\r\n    while (true) {\r\n        let m = qrx.exec(code);\r\n        if (m && m[0].length) {\r\n            if (ctx.region && qrx.lastIndex > ctx.region.end) {\r\n                break;\r\n            }\r\n            count++;\r\n            if (m.index >= minpos && m.index <= maxpos) {\r\n                let p1 = this._positionToRowCol(m.index);\r\n                let p2 = this._positionToRowCol(qrx.lastIndex);\r\n                hl.push({\r\n                    line1: p1.row, col1: p1.col,\r\n                    line2: p2.row, col2: p2.col\r\n                });\r\n            }\r\n            if (point >= m.index && point < qrx.lastIndex || (point == qrx.lastIndex && ctx.forward)) {\r\n                crnt = count;\r\n            }\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n    resetPrompt.call(this, count, crnt, prompt);\r\n    this.setOverlay(\"isearch-lazy\", hl);\r\n}\r\n\r\nfunction resetPrompt(count, crnt, prompt) {\r\n    let ctx = this._isearchContext;\r\n    this.whenMinibuffer(mb => {\r\n        if (prompt) {\r\n            mb.prompt(prompt.call(this, count, crnt, ctx));\r\n        } else {\r\n            let pos = ctx.qreplace && count ? `[${count}] `\r\n                : (count && crnt) ? `[${crnt}/${count}] `\r\n                : \"\";\r\n            mb.prompt(`${pos}${\r\n  ctx.qreplace ? \"Query replace\" : \"I-search\"}${\r\n  ctx.regexp ? \" regexp\" : ctx.word ? \" word\" : \"\"}${\r\n  ctx.forward ? \"\" : \" backward\"}:`);\r\n        }\r\n        let start = ctx.mbMark;\r\n        let mid = start + ctx.lastFoundQuery?.length;\r\n        if (mid != null) {\r\n            mb.forEachLine((line, c1, c2) => {\r\n                mb._textProperties.removeLineProps(line, c1, c2, \"css\");\r\n            }, start, mid);\r\n            mb.forEachLine((line, c1, c2) => {\r\n                mb._textProperties.addLineProps(line, c1, c2, \"css\", \"isearch-fail\");\r\n            }, mid);\r\n        }\r\n    });\r\n}\r\n\r\nfunction doSearch({ forward } = this._isearchContext) {\r\n    let ctx = this._isearchContext;\r\n    let query = ctx.query;\r\n    let found = false;\r\n    try {\r\n        let rx = searchRegExp.call(this);\r\n        found = this.cmd(forward ? \"search_forward_regexp\" : \"search_backward_regexp\", rx);\r\n        if (found) {\r\n            ctx.lastFoundQuery = query;\r\n            this.cmd(\"ensure_caret_visible\");\r\n            let p1 = this.point();\r\n            let p2 = p1 + (forward ? -1 : 1) * this.matchData[0].length;\r\n            if (forward) [ p1, p2 ] = [ p2, p1 ];\r\n            ctx.current = { begin: p1, end: p2 };\r\n            let p1rc = this._positionToRowCol(p1);\r\n            let p2rc = this._positionToRowCol(p2);\r\n            this.setOverlay(\"isearch\", {\r\n                line1: p1rc.row, col1: p1rc.col,\r\n                line2: p2rc.row, col2: p2rc.col,\r\n            });\r\n        }\r\n        lazyHighlight.call(this, rx);\r\n    } catch {};\r\n    return found;\r\n}\r\n\r\nfunction searchRegExp({\r\n    query = null,\r\n    regexp = false,\r\n    lax = true,\r\n    case_fold = true,\r\n    word = false,\r\n} = (this._isearchContext || {})) {\r\n    let searchRX = query;\r\n    if (!regexp) {\r\n        searchRX = query.replace(/[\\]\\[\\}\\{\\)\\(\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\r\n        if (word) {\r\n            // XXX: I guess it would be nice to use syntax_word / syntax_word_dabbrev\r\n            searchRX = \"\\\\b\" + searchRX + \"\\\\b\";\r\n        }\r\n    }\r\n    if (lax) {\r\n        searchRX = searchRX.replace(/\\s+/g, \"\\\\s+\");\r\n    }\r\n    return new RegExp(searchRX, caseFold.call(this) ? \"mugi\" : \"mug\");\r\n}\r\n\r\nYmacs_Buffer.newCommands({\r\n\r\n    isearch_forward: Ymacs_Interactive(function() {\r\n        let arg = { forward: true };\r\n        if (!initIsearch.call(this, arg)) {\r\n            if (!updateIsearch.call(this, arg))\r\n                this.signalError(\"No more forward occurrences of the search text\");\r\n        }\r\n    }),\r\n\r\n    isearch_backward: Ymacs_Interactive(function() {\r\n        let arg = { forward: false };\r\n        if (!initIsearch.call(this, arg)) {\r\n            if (!updateIsearch.call(this, arg)) {\r\n                this.signalError(\"No more backward occurrences of the search text\");\r\n            }\r\n        }\r\n    }),\r\n\r\n    isearch_forward_regexp: Ymacs_Interactive(function() {\r\n        let arg = { forward: true, regexp: true };\r\n        if (!initIsearch.call(this, arg)) {\r\n            if (!updateIsearch.call(this, arg))\r\n                this.signalError(\"No more forward occurrences of the search text\");\r\n        }\r\n    }),\r\n\r\n    isearch_backward_regexp: Ymacs_Interactive(function() {\r\n        let arg = { forward: false, regexp: true };\r\n        if (!initIsearch.call(this, arg)) {\r\n            if (!updateIsearch.call(this, arg))\r\n                this.signalError(\"No more forward occurrences of the search text\");\r\n        }\r\n    }),\r\n\r\n    isearch_yank_word_or_char: Ymacs_Interactive(function() {\r\n        if (!this._isearchContext) {\r\n            initIsearch.call(this, { forward: true });\r\n        }\r\n        let ctx = this._isearchContext;\r\n        var pos = ctx.current.end;\r\n        var pos2 = this.cmd(\"save_excursion\", function(){\r\n            this.cmd(\"goto_char\", pos);\r\n            this.cmd(\"forward_word\");\r\n            return this.point();\r\n        });\r\n        if (pos2 != pos) {\r\n            var word = this._bufferSubstring(pos, pos2);\r\n            this.getMinibuffer()._placeUndoBoundary();\r\n            this.getMinibuffer().cmd(\"insert\", word.toLowerCase());\r\n            word = isearchText.call(this);\r\n            this.cmd(\"goto_char\", ctx.current.begin);\r\n            doSearch.call(this, { forward: true });\r\n        }\r\n    }),\r\n\r\n    isearch_toggle_word: Ymacs_Interactive(function(){\r\n        let ctx = this._isearchContext;\r\n        ctx.word = !ctx.word;\r\n        if (ctx.word) ctx.regexp = false;\r\n        this.signalInfo(`Search word: ${ctx.word ? \"ON\" : \"OFF\"}`, false, 2000);\r\n        this.cmd(\"goto_char\", this._isearchContext.current.begin);\r\n        doSearch.call(this);\r\n    }),\r\n\r\n    isearch_toggle_case_fold: Ymacs_Interactive(function(){\r\n        let ctx = this._isearchContext;\r\n        if (ctx.case_fold == null) ctx.case_fold = false;\r\n        else if (ctx.case_fold === false) ctx.case_fold = true;\r\n        else if (ctx.case_fold === true) ctx.case_fold = null;\r\n        this.signalInfo(`Case sensitive: ${ctx.case_fold == null ? \"AUTO\" : ctx.case_fold ? \"OFF\" : \"ON\"}`, false, 2000);\r\n        this.cmd(\"goto_char\", this._isearchContext.current.begin);\r\n        doSearch.call(this);\r\n    }),\r\n\r\n    isearch_toggle_lax_whitespace: Ymacs_Interactive(function(){\r\n        let ctx = this._isearchContext;\r\n        ctx.lax = !ctx.lax;\r\n        this.signalInfo(`Loose whitespace: ${ctx.lax ? \"ON\" : \"OFF\"}`, false, 2000);\r\n        this.cmd(\"goto_char\", this._isearchContext.current.begin);\r\n        doSearch.call(this);\r\n    }),\r\n\r\n    isearch_printing_char: Ymacs_Interactive(function() {\r\n        let ctx = this._isearchContext;\r\n        var ev = this.interactiveEvent();\r\n        if (ev?.key?.length == 1 && !ev.ctrlKey && !ev.altKey) {\r\n            this.whenMinibuffer(mb => {\r\n                mb.cmd(\"self_insert_command\");\r\n                this.cmd(\"goto_char\", ctx.livepoint);\r\n                isearchText.call(this);\r\n                doSearch.call(this);\r\n            });\r\n            return true;\r\n        } else {\r\n            this.cmd(\"isearch_abort\");\r\n            return false;\r\n        }\r\n    }),\r\n\r\n    isearch_abort: Ymacs_Interactive(function(cancelled) {\r\n        if (!cancelled)\r\n            this.setGlobal(\"isearch_last_context\", this._isearchContext);\r\n        this.setMinibuffer(\"\");\r\n        this.popKeymap(Ymacs_Keymap_ISearch);\r\n        if (cancelled) {\r\n            this.cmd(\"goto_char\", this._isearchContext.origpoint);\r\n        } else {\r\n            this.markMarker.setPosition(this._isearchContext.origpoint);\r\n        }\r\n        this._isearchContext = null;\r\n        this.deleteOverlay(\"isearch\");\r\n        this.deleteOverlay(\"isearch-lazy\");\r\n        return true;\r\n    }),\r\n\r\n    isearch_reset_or_abort: Ymacs_Interactive(function(){\r\n        let ctx = this._isearchContext;\r\n        if (!ctx.lastFoundQuery || ctx.query == ctx.lastFoundQuery) {\r\n            this.cmd(\"isearch_abort\", true);\r\n        } else {\r\n            this.whenMinibuffer(mb => {\r\n                mb._replaceText(ctx.mbMark, mb.getCode().length, ctx.lastFoundQuery);\r\n                ctx.query = ctx.lastFoundQuery;\r\n                doSearch.call(this);\r\n            });\r\n        }\r\n    }),\r\n});\r\n\r\n/* -----[ query-replace ]----- */\r\n\r\nlet Ymacs_Keymap_Query_Replace = Ymacs_Keymap.define(\"query_replace\", {\r\n    \"y && Space\"               : \"query_replace_yes_this_occurrence\",\r\n    \".\"                        : \"query_replace_yes_this_occurrence_and_stop\",\r\n    \"n && Delete && Backspace\" : \"query_replace_no_this_occurrence\",\r\n    \"u\"                        : \"query_replace_undo_previous\",\r\n    \"!\"                        : \"query_replace_yes_all_occurrences\",\r\n    \"q && Enter\"               : [ \"query_replace_abort\", true ],\r\n    \"C-l\"                      : \"recenter_top_bottom\",\r\n});\r\nYmacs_Keymap_Query_Replace.defaultHandler = [ \"query_replace_abort\" ];\r\n\r\nfunction query_replace_1(args = {}) {\r\n    this.whenMinibuffer(mb => {\r\n        initIsearch.call(this, { ...args, qreplace: true });\r\n        let ctx = this._isearchContext;\r\n        this.cmd(\"minibuffer_prompt\", `Query replace${ctx.regexp ? \" regexp\" : ctx.word ? \" word\" : \"\"}: `);\r\n        let hlOrig = () => {\r\n            isearchText.call(this);\r\n            try {\r\n                lazyHighlight.call(this, searchRegExp.call(this));\r\n            } catch {};\r\n        };\r\n        mb.addEventListener(\"afterInteractiveCommand\", hlOrig);\r\n        let onQuit = (continued) => {\r\n            mb.removeEventListener(\"afterInteractiveCommand\", hlOrig);\r\n            mb.removeEventListener(\"abort\", onQuit);\r\n            if (!continued) {\r\n                this.deleteOverlay(\"isearch\");\r\n                this.deleteOverlay(\"isearch-lazy\");\r\n                this._isearchContext = null;\r\n            }\r\n        };\r\n        mb.addEventListener(\"abort\", onQuit);\r\n        this.cmd(\"minibuffer_read_string\", null, orig => {\r\n            this._isearchContext.query = orig;\r\n            query_replace_2.call(this);\r\n            onQuit(true);\r\n        }, (buf, query, cont) => {\r\n            ctx.query = query;\r\n            try {\r\n                lazyHighlight.call(this, searchRegExp.call(this));\r\n                cont(query);\r\n            } catch {\r\n                buf.popupMessage({ type: \"error\", text: \"Incomplete regexp\", atCaret: true });\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction query_replace_2() {\r\n    let mb = this.getMinibuffer();\r\n    let ctx = this._isearchContext;\r\n    let query = ctx.query;\r\n    let rxorig = searchRegExp.call(this);\r\n    lazyHighlight.call(this, rxorig);\r\n    if (rxorig) {\r\n        this.cmd(\"minibuffer_prompt\", `Replace ${ctx.regexp ? \"regexp \" : \"\"}${query} with: `);\r\n        let onQuit = () => {\r\n            this.deleteOverlay(\"isearch\");\r\n            this.deleteOverlay(\"isearch-lazy\");\r\n            this._isearchContext = null;\r\n            mb.removeEventListener(\"abort\", onQuit);\r\n        };\r\n        mb.addEventListener(\"abort\", onQuit);\r\n        this.cmd(\"minibuffer_read_string\", null, replacement => {\r\n            this.clearTransientMark();\r\n            query_replace_3.call(this, mb, rxorig, replacement);\r\n        });\r\n    }\r\n}\r\n\r\nfunction similarCase(rplc) {\r\n    let ctx = this._isearchContext;\r\n    if (ctx.case_replace && rplc == rplc.toLowerCase()) {\r\n        let orig = this.matchData[0];\r\n        if (orig == orig.toUpperCase()) return rplc.toUpperCase();\r\n        if (orig == this.capitalize(orig)) return this.capitalize(rplc);\r\n    }\r\n    return rplc;\r\n}\r\n\r\nfunction query_replace_3(mb, rxorig, replacement) {\r\n    let ctx = this._isearchContext;\r\n    this.pushKeymap(Ymacs_Keymap_Query_Replace);\r\n    let cmds, stop, curr, count = 0;\r\n    let queue = [];\r\n    let end = ctx.region && this.createMarker(ctx.region.end);\r\n    this.cmd(\"goto_char\", ctx.region ? ctx.region.begin : ctx.current.begin);\r\n\r\n    let domatch = replacement => {\r\n        if (ctx.regexp) {\r\n            // look ma, I can write code like this.\r\n            replacement = replacement.replace(\r\n                /(?:\\\\([\\\\\\&\\#]|\\d+|<.+?>))/g,\r\n                (s, p) => p == \"\\\\\" ? \"\\\\\"\r\n                    :     p == \"#\" ? count\r\n                    :     p == \"&\" ? this.matchData[0]\r\n                    :     p[0] == \"<\" ? this.matchData.groups[p.substr(1, p.length - 2)]\r\n                    : this.matchData[+p]\r\n            );\r\n        }\r\n        return similarCase.call(this, replacement);\r\n    };\r\n\r\n    let gotoNext = (all) => {\r\n        let point = this.point();\r\n        let found = this.cmd(\"search_forward_regexp\", rxorig);\r\n        if (found) {\r\n            let m = this.matchData;\r\n            if (ctx.region && (m.index < ctx.region.begin || m.after > end)) {\r\n                if (!all) {\r\n                    this.cmd(\"goto_char\", point);\r\n                }\r\n                return null;\r\n            }\r\n            let begin = this.matchData.index;\r\n            found = { begin: begin, end: this.point() };\r\n            if (!all) {\r\n                this.cmd(\"ensure_caret_visible\");\r\n                let rc_begin = this._positionToRowCol(begin);\r\n                this.setOverlay(\"isearch\", {\r\n                    line1: rc_begin.row, col1: rc_begin.col,\r\n                    line2: this._rowcol.row, col2: this._rowcol.col\r\n                });\r\n            }\r\n        }\r\n        if (!all) {\r\n            lazyHighlight.call(this, rxorig, (count, crnt) =>\r\n                `[${count}] Replace with ${domatch(replacement)}? (y/n/u/!)`);\r\n        }\r\n        return found;\r\n    };\r\n\r\n    cmds = this.replaceCommands({\r\n        query_replace_yes_this_occurrence: Ymacs_Interactive(() => {\r\n            queue.push(curr);\r\n            this._replaceText(curr.begin, curr.end, domatch(replacement));\r\n            count++;\r\n            curr = gotoNext();\r\n            if (!curr) stop();\r\n        }),\r\n        query_replace_yes_this_occurrence_and_stop: Ymacs_Interactive(() => {\r\n            queue.push(curr);\r\n            this._replaceText(curr.begin, curr.end, domatch(replacement));\r\n            count++;\r\n            stop();\r\n        }),\r\n        query_replace_no_this_occurrence: Ymacs_Interactive(() => {\r\n            curr = gotoNext();\r\n            if (!curr) stop();\r\n        }),\r\n        query_replace_yes_all_occurrences: Ymacs_Interactive(() => {\r\n            let last;\r\n            while (curr) {\r\n                last = curr;\r\n                this._replaceText(curr.begin, curr.end, domatch(replacement));\r\n                count++;\r\n                curr = gotoNext(true);\r\n            }\r\n            if (last) {\r\n                this.cmd(\"goto_char\", last.begin);\r\n                this.cmd(\"ensure_caret_visible\");\r\n            }\r\n            stop();\r\n        }),\r\n        query_replace_undo_previous: Ymacs_Interactive(() => {\r\n            let prev = queue.pop();\r\n            if (prev) {\r\n                count--;\r\n                this.cmd(\"undo\");\r\n\r\n                // XXX: this is ugly, but oh well.. We'd like to\r\n                // pretend this edit/undo operation never exist.\r\n                let uptr = this.__undoPointer;\r\n                let uq = this.__undoQueue.slice(0, uptr);\r\n                setTimeout(() => {\r\n                    this.__undoPointer = uptr;\r\n                    this.__undoQueue = uq;\r\n                });\r\n\r\n                this.cmd(\"goto_char\", prev.begin);\r\n                curr = gotoNext();\r\n            } else {\r\n                this.signalError(\"No more undo\");\r\n            }\r\n        }),\r\n        query_replace_abort: Ymacs_Interactive(enter => {\r\n            stop();\r\n            return enter;\r\n        }),\r\n    });\r\n    stop = () => {\r\n        if (end) end.destroy();\r\n        mb.removeEventListener(\"abort\", stop);\r\n        this.newCommands(cmds);\r\n        this.deleteOverlay(\"isearch\");\r\n        this.deleteOverlay(\"isearch-lazy\");\r\n        this._isearchContext = null;\r\n        this.popKeymap(Ymacs_Keymap_Query_Replace);\r\n        mb.cmd(\"minibuffer_keyboard_quit\");\r\n        this.signalInfo(`Replaced ${count} occurrences`);\r\n    };\r\n    curr = gotoNext();\r\n    if (!curr) {\r\n        stop();\r\n    } else {\r\n        mb.addEventListener(\"abort\", stop);\r\n    }\r\n}\r\n\r\nfunction query_replace(regexp) {\r\n    return Ymacs_Interactive(\"^P\", function(word){\r\n        let ctx = this._isearchContext;\r\n        let args = {\r\n            qreplace: true,\r\n            regexp: regexp == null && ctx ? ctx.regexp : !!regexp,\r\n            word: ctx ? ctx.word : !!word,\r\n            region: this.transientMarker && this.getRegion(),\r\n        };\r\n        if (ctx) {\r\n            this.cmd(\"isearch_abort\");\r\n            this._isearchContext = Object.assign({}, ctx, args);\r\n            query_replace_2.call(this);\r\n        } else {\r\n            query_replace_1.call(this, args);\r\n        }\r\n    });\r\n}\r\n\r\nYmacs_Buffer.newCommands({\r\n    query_replace: query_replace(null),\r\n    query_replace_regexp: query_replace(true),\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Tokenizer } from \"./ymacs-tokenizer.js\";\r\nimport { Ymacs_BaseLang } from \"./ymacs-baselang.js\";\r\n\r\nclass Ymacs_Lang_CSS extends Ymacs_BaseLang {\r\n    readCustom() {\r\n        let s = this._stream, m;\r\n        for (let [ rx, ...types ] of this.CSSRX) {\r\n            if ((m = s.lookingAt(rx))) {\r\n                types.forEach((cls, i) =>\r\n                    cls && m[i] && this.t(cls, m[i].length));\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    CSSRX = [\r\n        [ /^(-?(?:\\d*\\.)?\\d+)(px|pt|em|ex|in|cm|mm|rem|vw|vh|fr|s|%)?/u,, \"number\", \"type\" ],\r\n        [ /^((?:--+|\\$)[\\p{L}\\p{N}-]+)(:)?/u,, \"variable-name\", \"operator\" ],\r\n        [ /^([\\p{L}\\p{N}-]+)(:)/u,, \"keyword\", \"operator\" ],\r\n        [ /^\\.[\\p{L}\\p{N}_:-]+/u, \"function-name\" ],\r\n        [ /^#[\\p{L}\\p{N}_:-]+/u, \"constant\" ],\r\n        [ /^@[\\p{L}\\p{N}_:-]+/u, \"builtin\" ],\r\n        [ /^(?:url|none|auto|bold|italic|underline|normal|inherit|print|screen|all|important|calc|var)/, \"builtin\" ],\r\n    ];\r\n}\r\n\r\nYmacs_Tokenizer.define(\"css\", (stream, tok) => new Ymacs_Lang_CSS({ stream, tok }));\r\n\r\nYmacs_Buffer.newMode(\"css_mode\", function(){\r\n    var tok = this.tokenizer;\r\n    this.setTokenizer(new Ymacs_Tokenizer({ buffer: this, type: \"css\" }));\r\n    var was_paren_match = this.cmd(\"paren_match_mode\", true);\r\n    var changed_vars = this.setq({\r\n        syntax_paragraph_sep: /\\n(?:[ \\t\\/\\*]*\\n)+/g,\r\n        syntax_comment_line: {\r\n            rx: /[^\\S\\r\\n]*\\/\\/+ ?/ygu,\r\n            ch: \"//\"\r\n        },\r\n        syntax_comment_multi: {\r\n            rx: /[^\\S\\r\\n]*\\/\\*+(.*?)\\*+\\//ygu,\r\n            ch: [ \"/*\", \"*/\" ]\r\n        },\r\n    });\r\n\r\n    return function() {\r\n        this.setTokenizer(tok);\r\n        if (!was_paren_match)\r\n            this.cmd(\"paren_match_mode\", false);\r\n        this.setq(changed_vars);\r\n    };\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Cons, NIL } from \"./ymacs-utils.js\";\r\nimport { Ymacs_Tokenizer, compareRowCol, caretInside } from \"./ymacs-tokenizer.js\";\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\n\r\nexport class Ymacs_BaseLang {\r\n    _cont = NIL;\r\n    _inParens = NIL;\r\n    _parens = NIL;\r\n    _inComment = null;\r\n    _inString = false;\r\n    _pmeta = null;\r\n\r\n    COMMENT = [ \"//\", [ \"/*\", \"*/\", \"*\" ] ];\r\n    STRING = [ '\"', \"'\" ];\r\n    NUMBER = /^[+-]?(?:0x[0-9a-fA-F]+|(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)/u;\r\n    NAME = /^[\\p{L}_$][\\p{L}0-9_$]*/iu;\r\n    WHITESPACE = /^[ \\u00a0\\n\\r\\t\\f\\u000b\\u200b\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\uFEFF]+/;\r\n    OPEN_PAREN = {\r\n        \"(\"  : \")\",\r\n        \"{\"  : \"}\",\r\n        \"[\"  : \"]\",\r\n    };\r\n    CLOSE_PAREN = {\r\n        \")\" : \"(\",\r\n        \"}\" : \"{\",\r\n        \"]\" : \"[\",\r\n    };\r\n\r\n    constructor({ stream, tok }) {\r\n        this._stream = stream;\r\n        this._tok = tok;\r\n    }\r\n\r\n    next() {\r\n        this._stream.checkStop();\r\n        if (this._cont !== NIL) {\r\n            this._cont.car.call(this);\r\n        } else {\r\n            this.read();\r\n        }\r\n    }\r\n\r\n    copy() {\r\n        let _cont = this._cont;\r\n        let _inParens = this._inParens;\r\n        let _parens = this._parens;\r\n        let _inComment = this._inComment;\r\n        let _inString = this._inString;\r\n        let _pmeta = this._pmeta;\r\n        return () => {\r\n            this._cont = _cont;\r\n            this._inParens = _inParens;\r\n            this._parens = _parens;\r\n            this._inComment = _inComment;\r\n            this._inString = _inString;\r\n            this._pmeta = _pmeta;\r\n            return this;\r\n        };\r\n    }\r\n\r\n    maybeSave() {\r\n        let s = this._stream;\r\n        if (s.eol() && s.nextLine()) {\r\n            this._tok.parsers[s.line] = this.copy();\r\n            return true;\r\n        }\r\n    }\r\n\r\n    skipWS(skipLines = true) {\r\n        let s = this._stream, m;\r\n        while (true) {\r\n            if ((m = s.lookingAt(this.WHITESPACE))) {\r\n                this.t(null, m[0].length);\r\n            }\r\n            if (skipLines) {\r\n                if (!this.maybeSave()) break;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    read() {\r\n        (this.readComment() ||\r\n         this.readString() ||\r\n         this.readOpenParen() ||\r\n         this.readCloseParen() ||\r\n         this.readCustom() ||\r\n         this.readTrailingWhitespace() ||\r\n         this.t());\r\n    }\r\n\r\n    readComment() {\r\n        for (let syn of this.COMMENT) {\r\n            if (Array.isArray(syn) && this.readCommentMulti(...syn)) return true;\r\n            if (this.readCommentLine(syn)) return true;\r\n        }\r\n    }\r\n\r\n    readCommentLine(start) {\r\n        let s = this._stream;\r\n        let p = null, end = null;\r\n        while (s.lookingAt(start)) {\r\n            if (!p) {\r\n                p = {\r\n                    line: s.line, col: s.col, c1: s.col, c2: s.col, comment: true, type: \"\",\r\n                    inner: { l1: s.line, c1: s.col },\r\n                    outer: { l1: s.line, c1: s.col },\r\n                };\r\n            }\r\n            this.t(\"comment-starter\", start.length);\r\n            this.token({ line: s.line, c1: s.col, c2: s.col = s.lineLength() }, \"comment\");\r\n            end = { line: s.line, col: s.col, c1: s.col, c2: s.col, type: \"\", opened: p };\r\n\r\n            // XXX: this screws up the parse state after a line comment.\r\n            // this.maybeSave();\r\n            // this.skipWS(false);\r\n        }\r\n        if (p) {\r\n            p.closed = end;\r\n            p.inner.l2 = p.outer.l2 = end.line;\r\n            p.inner.c2 = p.outer.c2 = end.c1;\r\n            this.doneParen(p);\r\n        }\r\n        return p;\r\n    }\r\n\r\n    readCommentMulti(start, stop, inner,\r\n                     tok1 = \"mcomment-starter\",\r\n                     tok2 = \"mcomment\",\r\n                     tok3 = \"mcomment-stopper\")\r\n    {\r\n        let s = this._stream, m;\r\n        if (this._inComment) {\r\n            if ((m = s.lookingAt(stop))) {\r\n                let p = this.popInParen(start, m[0].length, tok3);\r\n                p.inner.l2 = p.closed.line;\r\n                p.inner.c2 = p.closed.c1;\r\n                p.outer.l2 = p.closed.line;\r\n                p.outer.c2 = p.closed.c2;\r\n                this.popCont();\r\n                this._inComment = null;\r\n            } else {\r\n                this.t(tok2);\r\n            }\r\n        } else if (s.lookingAt(start)) {\r\n            this._inComment = { line: s.line, c1: s.col, inner: inner };\r\n            let p = this.pushInParen(start, tok1);\r\n            p.comment = true;\r\n            p.inner = { l1: p.line, c1: p.c2 };\r\n            p.outer = { l1: p.line, c1: p.c1 };\r\n            this.pushCont(this.readCommentMulti.bind(this, start, stop, inner, tok1, tok2, tok3));\r\n            return true;\r\n        }\r\n    }\r\n\r\n    readString(start, stop, expStart, expStop, tokType) {\r\n        let s = this._stream;\r\n        if (this._inString) {\r\n            if (s.lookingAt(\"\\\\\")) {\r\n                this.t(tokType);\r\n                this.t(tokType);\r\n            } else if (s.lookingAt(stop)) {\r\n                this.popCont();\r\n                this._inString = false;\r\n                this.popInParen(start, stop.length, `${tokType}-stopper`);\r\n            } else if (expStart && s.lookingAt(expStart)) {\r\n                this._inString = false;\r\n                let op = this.pushInParen(expStart);\r\n                this.pushCont(() => {\r\n                    if (s.lookingAt(expStop) && this._inParens.car === op) {\r\n                        this.popInParen(expStart, expStop.length);\r\n                        this.popCont();\r\n                        this._inString = true;\r\n                    } else {\r\n                        this.read();\r\n                    }\r\n                });\r\n            } else {\r\n                this.t(tokType);\r\n            }\r\n        } else for (let syn of this.STRING) {\r\n            let start = syn, stop = syn, expStart, expStop, tokType = \"string\";\r\n            if (Array.isArray(syn)) [ start, stop, expStart, expStop, tokType = \"string\" ] = syn;\r\n            if (s.lookingAt(start)) {\r\n                this.pushInParen(start, `${tokType}-starter`);\r\n                this._inString = true;\r\n                this.pushCont(this.readString.bind(this, start, stop, expStart, expStop, tokType));\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n\r\n    readCustom() {\r\n        return this.readNumber();\r\n    }\r\n\r\n    readName() {\r\n        let s = this._stream, m = s.lookingAt(this.NAME);\r\n        if (m) {\r\n            return { line: s.line, c1: s.col, c2: s.col += m[0].length, id: m[0] };\r\n        }\r\n    }\r\n\r\n    maybeName(type = null) {\r\n        let name = this.readName();\r\n        if (name) this.token(name, name.type = type);\r\n        return name;\r\n    }\r\n\r\n    readNumber() {\r\n        let m = this._stream.lookingAt(this.NUMBER);\r\n        if (m) {\r\n            this.t(\"number\", m[0].length);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    setParenMeta(info) {\r\n        this._pmeta = info;\r\n    }\r\n\r\n    readOpenParen() {\r\n        let ch = this._stream.peek();\r\n        if (this.OPEN_PAREN[ch]) {\r\n            this.pushInParen(ch).meta = this._pmeta;\r\n            this._pmeta = null;\r\n            return true;\r\n        }\r\n    }\r\n\r\n    readCloseParen() {\r\n        let type = this.CLOSE_PAREN[this._stream.peek()];\r\n        if (type) {\r\n            this.popInParen(type, 1);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    readTrailingWhitespace() {\r\n        let m = this._stream.lookingAt(/^\\s+$/);\r\n        if (m) {\r\n            this.t(\"trailing-whitespace\", m[0].length);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    t(type = null, len = 1) {\r\n        this.token({\r\n            line: this._stream.line,\r\n            c1: this._stream.col,\r\n            c2: this._stream.col += len,\r\n        }, type);\r\n    }\r\n\r\n    token(tok, type = tok.type) {\r\n        this._tok.onToken(tok.line, tok.c1, tok.c2, type);\r\n    }\r\n\r\n    pushInParen(type, tokType = \"open-paren\") {\r\n        let s = this._stream;\r\n        let n = type.length;\r\n        let p = { line: s.line, col: s.col, c1: s.col, c2: s.col + n, type: type };\r\n        this._inParens = new Cons(p, this._inParens);\r\n        if (n) this.t(tokType, n);\r\n        return p;\r\n    }\r\n\r\n    popInParen(start, n = start.length, tokType = \"close-paren\") {\r\n        let s = this._stream;\r\n        if (this._inParens !== NIL) {\r\n            let paren = this._inParens.car;\r\n            this._inParens = this._inParens.cdr;\r\n            if (start != paren.type) {\r\n                //debugger;\r\n                if (n) this.t(\"error\", n);\r\n            } else {\r\n                paren.closed = { line: s.line, col: s.col, c1: s.col, c2: s.col + n, opened: paren };\r\n                this.doneParen(paren);\r\n                if (n) this.t(tokType, n);\r\n            }\r\n            return paren;\r\n        } else {\r\n            if (n) this.t(\"error\", n);\r\n        }\r\n    }\r\n\r\n    inParen() {\r\n        return this._inParens.car;\r\n    }\r\n\r\n    doneParen(p) {\r\n        this._parens = new Cons(p, this._parens);\r\n    }\r\n\r\n    pushCont(cont) {\r\n        this._cont = new Cons(cont, this._cont);\r\n    }\r\n\r\n    popCont() {\r\n        this._cont = this._cont.cdr;\r\n    }\r\n\r\n    // copied from JS mode; should be decent for C-like langs\r\n    indentation() {\r\n        let s = this._stream;\r\n        let row = s.line;\r\n        let currentLine = s.lineText();\r\n        let indent = 0;\r\n\r\n        let INDENT_LEVEL = () => this._stream.buffer.getq(\"indent_level\");\r\n\r\n        if (this._inString) {\r\n            // inside string literal\r\n            if (row > 0 && !/\\S/.test(currentLine)) {\r\n                // on an empty line, set indentation from previous line\r\n                return s.lineIndentation(row - 1);\r\n            }\r\n            // otherwise keep existing indentation\r\n            return null;\r\n        }\r\n\r\n        if (this._inComment) {\r\n            let commentStartLine = s.lineText(this._inComment.line);\r\n            indent = this._inComment.c1 + 1;\r\n            if (this._inComment.inner == \"*\" && !/^\\s*\\*/.test(currentLine)) {\r\n                // align with the first non-whitespace and non-asterisk character in the comment\r\n                let re = /[^\\s*]/g;\r\n                re.lastIndex = this._inComment.c1 + 1;\r\n                let m = re.exec(commentStartLine);\r\n                if (m) indent = m.index;\r\n            }\r\n            return indent;\r\n        }\r\n\r\n        let p = this._inParens.car;\r\n        if (p) {\r\n            // check if the current line closes the paren\r\n            let re = new RegExp(\"^\\\\s*\\\\\" + this.OPEN_PAREN[p.type]);\r\n            let thisLineCloses = re.test(currentLine);\r\n\r\n            // Check if there is text after the opening paren.  If so, indent to that column.\r\n            re = /\\S/g;\r\n            re.lastIndex = p.col + 1;\r\n            let m = re.exec(s.lineText(p.line));\r\n            if (m) {\r\n                // but if this line closes the paren, better use the column of the open paren\r\n                indent = thisLineCloses ? p.col : m.index;\r\n            }\r\n            else {\r\n                // Otherwise we should indent to one level more than the indentation of the line\r\n                // containing the opening paren. Except that if another paren is closed on that line\r\n                // before `p`, then we'd like to use that paren's opening line instead. Oh well.\r\n                let line = p.line;\r\n                if (this._parens.car?.closed?.line == line) {\r\n                    line = this._parens.car.line;\r\n                }\r\n                indent = s.lineIndentation(line) + INDENT_LEVEL();\r\n\r\n                // but if this line closes the paren, then back one level\r\n                if (thisLineCloses) {\r\n                    indent -= INDENT_LEVEL();\r\n                } else if (this.C_STATEMENTS && /^\\s*(?:[.:?*=&|]|\\+[^+]|-[^-])/.test(currentLine)) {\r\n                    indent += INDENT_LEVEL();\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            let i = row, m;\r\n            while (i-- > 0) if ((m = /\\S/.exec(s.lineText(i)))) {\r\n                let p = this._tok.getParserForLine(i);\r\n                if (!(p._inString || p._inComment)) break;\r\n            }\r\n            if (m) indent = m.index;\r\n        }\r\n\r\n        // Some more adjustments for continued statements.  Since we\r\n        // don't really have a rigorous parser, we have to rely on\r\n        // other regexps here, which sucks but will do for now.\r\n\r\n        if (row > 0) {\r\n            let before = s.textBefore();\r\n            if (/\\)\\s*$/.test(before) && this._parens !== NIL) {\r\n                // Ends in a paren, could be an if, while or for which demands smart\r\n                // indentation on the current line, let's check it out.\r\n\r\n                // Note that the passedParen saved for that close paren is actually\r\n                // the opening one, which suits us greatly.\r\n                p = this._parens.car;\r\n                let stmtLine = s.lineText(p.line);\r\n                if (/^\\s*(?:if|for|while)\\W/.test(stmtLine) && !/^\\s*\\{/.test(currentLine))\r\n                    indent += INDENT_LEVEL();\r\n            }\r\n            else if (/\\Welse\\s*$/.test(before) && !/^\\s*\\{/.test(currentLine)) {\r\n                indent += INDENT_LEVEL();\r\n            }\r\n        }\r\n\r\n        // switch labels use half the indent level, which is my favorite\r\n        if (/^\\s*(?:case|default)\\W/.test(currentLine))\r\n            indent -= INDENT_LEVEL() / 2;\r\n\r\n        return indent;\r\n    }\r\n\r\n    get passedParens() {\r\n        return [...this._parens];\r\n    }\r\n\r\n    get buffer() {\r\n        return this._stream.buffer;\r\n    }\r\n\r\n    get caret() {\r\n        return this.buffer._rowcol;\r\n    }\r\n}\r\n\r\nYmacs_Buffer.newCommands({\r\n    base_limit_fill_paragraph_region: function() {\r\n        if (!this.tokenizer) return;\r\n        let findComment = () => this.tokenizer.getPP()\r\n            .filter(caretInside(this._rowcol))\r\n            .findLast(p => p.comment);\r\n        let comment = findComment() || this.cmd(\"save_excursion\", () => {\r\n            this.cmd(\"end_of_line\");\r\n            return findComment();\r\n        });\r\n        if (comment?.closed) {\r\n            let r = {\r\n                begin: this._rowColToPosition(comment.outer.l1, comment.outer.c1),\r\n                end: this._rowColToPosition(comment.outer.l2, comment.outer.c2)\r\n            };\r\n            this.cmd(\"save_excursion\", () => {\r\n                this.cmd(\"goto_char\", r.begin);\r\n                this.cmd(\"backward_whitespace\", true);\r\n                r.begin = this.point();\r\n            });\r\n            return r;\r\n        }\r\n    }\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Tokenizer } from \"./ymacs-tokenizer.js\";\r\nimport { Ymacs_BaseLang } from \"./ymacs-baselang.js\";\r\nimport { Ymacs_Keymap } from \"./ymacs-keymap.js\";\r\nimport { toHash } from \"./ymacs-utils.js\";\r\n\r\nconst KEYWORDS = toHash(`abstract break case catch class const async await\r\ncontinue debugger default delete do else enum export final finally for\r\nfunction goto if implements import in instanceof interface native new package\r\nprivate protected public return super switch synchronized throw throws\r\ntransient try typeof var void let yield volatile while with`);\r\n\r\nconst KEYWORDS_TYPE = toHash(`boolean byte char double float int long short\r\nvoid Array Date Function Math Number Object RegExp String`);\r\n\r\nconst KEYWORDS_CONST = toHash(`false null undefined Infinity NaN true`);\r\n\r\nconst KEYWORDS_BUILTIN = toHash(`this Packages decodeURI decodeURIComponent\r\nencodeURI encodeURIComponent eval isFinite isNaN parseFloat parseInt window\r\ndocument alert arguments fetch`);\r\n\r\nconst ALLOW_REGEXP_AFTER = /[\\[({,;+\\-*=?&|!:>][\\x20\\t\\n\\xa0]*$|(?:return|typeof|case)\\s+$/;\r\n\r\nclass Ymacs_Lang_JS extends Ymacs_BaseLang {\r\n    STRING = [ '\"', \"'\", [ \"`\", \"`\", \"${\", \"}\" ] ];\r\n    _isProp = null;\r\n\r\n    copy() {\r\n        let _super = super.copy();\r\n        let _isProp = this._isProp;\r\n        return () => {\r\n            let self = _super();\r\n            self._isProp = _isProp;\r\n            return self;\r\n        };\r\n    }\r\n\r\n    readCustom() {\r\n        let s = this._stream;\r\n        if (s.peek() == \"/\" && ALLOW_REGEXP_AFTER.test(s.textBefore())) {\r\n            let op = { line: s.line, col: s.col, type: \"/\" };\r\n            this.t(\"regexp-starter\");\r\n            this.pushCont(this.readLiteralRegexp.bind(this, op));\r\n            return true;\r\n        }\r\n        if (s.lookingAt(\"...\")) {\r\n            this.t(\"operator\", 3);\r\n            return true;\r\n        }\r\n        let isProp = this._isProp;\r\n        this._isProp = s.peek() == \".\";\r\n        let tok = this.readName();\r\n        if (tok) {\r\n            this.skipWS();\r\n            if (isProp) {\r\n                tok.type = s.lookingAt(\"(\") ? \"function-name\" : null;\r\n                this.token(tok);\r\n            } else if (s.lookingAt(\":\")) {\r\n                tok.type = tok.id == \"default\" ? \"keyword\" : null;\r\n                this.token(tok);\r\n            } else if (!this.parseALittle(tok)) {\r\n                tok.type = tok.id in KEYWORDS ? \"keyword\"\r\n                    : s.lookingAt(\"(\") ? \"function-name\"\r\n                    : tok.id in KEYWORDS_TYPE ? \"type\"\r\n                    : tok.id in KEYWORDS_CONST ? \"constant\"\r\n                    : tok.id in KEYWORDS_BUILTIN ? \"builtin\"\r\n                    : null;\r\n                this.token(tok);\r\n            }\r\n            return true;\r\n        }\r\n        return this.readNumber();\r\n    }\r\n\r\n    parseALittle(tok) {\r\n        let s = this._stream;\r\n        let paren = this.inParen();\r\n        let name;\r\n\r\n        switch (tok.id) {\r\n          case \"class\":\r\n            if (s.lookingAt(\"{\") || (name = this.maybeName(\"type\"))) {\r\n                this.token(tok, \"keyword\");\r\n                this.skipWS();\r\n                let ext = this.readName();\r\n                if (ext) {\r\n                    if (ext.id == \"extends\") {\r\n                        this.token(ext, ext.type = \"keyword\");\r\n                        this.skipWS();\r\n                        this.maybeName(\"type\");\r\n                    } else {\r\n                        this.token(ext, null);\r\n                    }\r\n                }\r\n                this.setParenMeta({ class: tok, name: name });\r\n            }\r\n            return true;\r\n\r\n          case \"for\":\r\n            this.token(tok, \"keyword\");\r\n            this.setParenMeta({ for: tok });\r\n            return true;\r\n\r\n          case \"of\":\r\n            if (paren?.meta?.for) {\r\n                this.token(tok, \"keyword\");\r\n                return true;\r\n            }\r\n            break;\r\n\r\n          case \"function\":\r\n            this.token(tok, \"keyword\");\r\n            this.maybeName(\"function-name\");\r\n            return true;\r\n\r\n          case \"new\":\r\n            this.token(tok, \"keyword\");\r\n            if (!s.lookingAt(/^class/)) {\r\n                this.maybeName(\"type\");\r\n            }\r\n            return true;\r\n\r\n          case \"get\":\r\n          case \"set\":\r\n          case \"static\":\r\n          case \"constructor\":\r\n            if (paren?.meta?.class) {\r\n                this.token(tok, \"keyword\");\r\n                return true;\r\n            }\r\n            break;\r\n        }\r\n\r\n        if (paren?.meta?.class && s.lookingAt(/^\\s*\\(/)) {\r\n            // method definition\r\n            this.token(tok, \"function-name\");\r\n            return true;\r\n        }\r\n    }\r\n\r\n    readLiteralRegexp(op) {\r\n        let s = this._stream;\r\n        let ch, esc = false, inset = 0, start = s.col;\r\n        while (!s.eol()) {\r\n            ch = s.peek();\r\n            if (ch == \"[\" && !esc && !inset) inset++;\r\n            if (ch == \"]\" && !esc && inset) inset--;\r\n            if (ch == \"/\" && !esc && !inset) {\r\n                let c1 = s.col;\r\n                this.popCont();\r\n                this.token({ line: s.line, c1: start, c2: s.col }, \"regexp\");\r\n                this.t(\"regexp-stopper\");\r\n                let m = s.lookingAt(/^[dgimsuvy]+/);\r\n                if (m) this.t(\"regexp-modifier\", m[0].length);\r\n                op.closed = { line: s.line, c1: c1, c2: s.col, opened: op };\r\n                this.doneParen(op);\r\n                return;\r\n            }\r\n            esc = !esc && ch === \"\\\\\";\r\n            ++s.col;\r\n        }\r\n        this.token({ line: s.line, c1: start, c2: s.col }, \"regexp\");\r\n    }\r\n}\r\n\r\nYmacs_Lang_JS.prototype.C_STATEMENTS = true;\r\n\r\nYmacs_Tokenizer.define(\"js\", (stream, tok) => new Ymacs_Lang_JS({ stream, tok }));\r\n\r\nlet Ymacs_Keymap_JS = Ymacs_Keymap.define(\"js\", {\r\n    \"`\"   : [ \"paredit_open_pair\", \"`\", \"`\", /[\\`\\\\]/g ],\r\n    \"'\"   : [ \"paredit_open_pair\", \"'\", \"'\", /[\\'\\\\]/g ],\r\n    \"M-`\" : [ \"paredit_wrap_round\", \"`\", \"`\", /[\\`\\\\]/g ],\r\n    \"M-'\" : [ \"paredit_wrap_round\", \"'\", \"'\", /[\\'\\\\]/g ],\r\n});\r\n\r\nYmacs_Buffer.newMode(\"javascript_mode\", function() {\r\n    let tok = this.tokenizer;\r\n    this.setTokenizer(new Ymacs_Tokenizer({ buffer: this, type: \"js\" }));\r\n    let was_paren_match = this.cmd(\"paren_match_mode\", true);\r\n    this.pushKeymap(Ymacs_Keymap_JS);\r\n    let changed_vars = this.setq({\r\n        syntax_paragraph_sep: /\\n(?:[ \\t\\/\\*]*\\n)+/g,\r\n        syntax_comment_line: {\r\n            rx: /[^\\S\\r\\n]*\\/\\/+ ?/ygu,\r\n            ch: \"//\"\r\n        },\r\n        syntax_comment_multi: {\r\n            rx: /[^\\S\\r\\n]*\\/\\*+(.*?)\\*+\\//ygu,\r\n            ch: [ \"/*\", \"*/\" ]\r\n        },\r\n    });\r\n\r\n    return function() {\r\n        this.setTokenizer(tok);\r\n        if (!was_paren_match)\r\n            this.cmd(\"paren_match_mode\", false);\r\n        this.popKeymap(Ymacs_Keymap_JS);\r\n        this.setq(changed_vars);\r\n    };\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Tokenizer, Ymacs_Simple_Stream } from \"./ymacs-tokenizer.js\";\r\nimport { Ymacs_Keymap } from \"./ymacs-keymap.js\";\r\nimport { Ymacs_Interactive } from \"./ymacs-interactive.js\";\r\nimport { toHash, regexp_opt, Cons, NIL } from \"./ymacs-utils.js\";\r\nimport { Ymacs_BaseLang } from \"./ymacs-baselang.js\";\r\n\r\n(function(){\r\n\r\n    function Partial(value) {\r\n        this.value = value;\r\n    }\r\n\r\n    function QuickParser(buffer, pos) {\r\n        var input = new Ymacs_Simple_Stream({ buffer: buffer, pos: pos });\r\n        function peek() { return input.peek() }\r\n        function next() { return input.next() }\r\n        function skip_ws() {\r\n            return input.read_while(function(ch){\r\n                if (!caret_token && caret != null && input.pos == caret) return false;\r\n                return input.is_whitespace(ch);\r\n            });\r\n        }\r\n        function skip(ch) { next() }\r\n        function read_while(pred) { return input.read_while(pred) }\r\n        function read_escaped(start, end, inces) {\r\n            skip(start);\r\n            var escaped = false;\r\n            var str = \"\";\r\n            while (true) {\r\n                var ch = next();\r\n                if (!ch) throw new Partial(str);\r\n                if (escaped) {\r\n                    str += ch;\r\n                    escaped = false;\r\n                } else if (ch == \"\\\\\") {\r\n                    if (inces) str += ch;\r\n                    escaped = true;\r\n                } else if (ch == end) {\r\n                    break;\r\n                } else {\r\n                    str += ch;\r\n                }\r\n            }\r\n            return str;\r\n        }\r\n        function read_comment() {\r\n            return read_while(function(ch){ return ch && ch != \"\\n\" });\r\n        }\r\n        function read_multiline_comment() {\r\n            var comment = read_while(function(){\r\n                return !input.looking_at(\"|#\");\r\n            });\r\n            skip(); skip();\r\n            return comment;\r\n        }\r\n        function read_string() {\r\n            return read_escaped(\"\\\"\", \"\\\"\");\r\n        }\r\n        function read_list(beg, end) {\r\n            var save_list_index = list_index;\r\n            list_index = 0;\r\n            try {\r\n                var ret = [], p;\r\n                skip(beg);\r\n                out: while (true) {\r\n                    skip_ws();\r\n                    switch (peek()) {\r\n                      case end: break out;\r\n                      case null: throw new Partial(ret);\r\n                      default:\r\n                        ret.push(read_token());\r\n                        ++list_index;\r\n                    }\r\n                }\r\n                skip(end);\r\n                return ret;\r\n            } finally {\r\n                list_index = save_list_index;\r\n            }\r\n        }\r\n        function read_regexp() {\r\n            var str = read_escaped(\"/\", \"/\", true);\r\n            var mods = read_while(function(ch){\r\n                if (ch) switch (ch.toLowerCase()) {\r\n                  case \"y\":\r\n                  case \"m\":\r\n                  case \"g\":\r\n                  case \"i\":\r\n                    return true;\r\n                }\r\n            }).toLowerCase();\r\n            return { pattern: str, modifiers: mods };\r\n        }\r\n        function is_symbol_char(ch) {\r\n            switch (ch) {\r\n              case null:\r\n              case \"(\":\r\n              case \")\":\r\n              case \"{\":\r\n              case \"}\":\r\n              case \"[\":\r\n              case \"]\":\r\n              case \"#\":\r\n              case \";\":\r\n              case \"`\":\r\n              case \"'\":\r\n              case \"\\\"\":\r\n              case \"|\":\r\n              case \" \":\r\n              case \"\\n\":\r\n              case \"\\t\":\r\n              case \"\\x0C\":\r\n              case \"\\u2028\":\r\n              case \"\\u2029\":\r\n              case \"\\xA0\":\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        function read_symbol() {\r\n            return read_while(is_symbol_char);\r\n        }\r\n        function read_char() {\r\n            return next() + read_while(function(ch){\r\n                return (ch >= \"a\" && ch <= \"z\") ||\r\n                    (ch >= \"A\" && ch <= \"z\") ||\r\n                    (ch >= \"0\" && ch <= \"9\") ||\r\n                    ch == \"-\" || ch == \"_\";\r\n            });\r\n        }\r\n        function read_elisp_char() {\r\n            skip(\"?\");\r\n            if (peek() == \"\\\\\") next();\r\n            return next();\r\n        }\r\n        function read_sharp() {\r\n            skip(\"#\");\r\n            switch (peek()) {\r\n              case \"\\\\\": next(); return token(\"char\", read_char);\r\n              case \"/\": return token(\"regexp\", read_regexp);\r\n              case \"(\": return token(\"vector\", read_list.bind(null, \"(\", \")\"));\r\n              case \"'\": next(); return token(\"function\", read_token);\r\n              case \"|\": next(); return token(\"comment\", read_multiline_comment);\r\n              default:\r\n                return token(\"unknown\", read_token);\r\n            }\r\n        }\r\n        function read_token() {\r\n            skip_ws();\r\n            if (!caret_token && caret != null && input.pos == caret && (!parent || parent.type == \"list\")) {\r\n                return caret_token = token(\"caret\");\r\n            }\r\n            switch (peek()) {\r\n              case \";\"  : return token(\"comment\", read_comment);\r\n              case \"\\\"\" : return token(\"string\", read_string);\r\n              case \"(\"  : return token(\"list\", read_list.bind(null, \"(\", \")\"));\r\n              case \"{\"  : return token(\"list\", read_list.bind(null, \"{\", \"}\"));\r\n              case \"[\"  : return token(\"list\", read_list.bind(null, \"[\", \"]\"));\r\n              case \"#\"  : return token(\"sharp\", read_sharp);\r\n              case \"?\"  : return token(\"char\", read_elisp_char);\r\n              case \"`\"  : next(); return token(\"qq\", read_token, -1);\r\n              case \",\"  :\r\n                next();\r\n                if (peek() == \"@\") {\r\n                    next();\r\n                    return token(\"splice\", read_token, -2);\r\n                }\r\n                return token(\"unquote\", read_token, -1);\r\n              case \"'\"  : next(); return token(\"quote\", read_token, -1);\r\n              case \")\"  : return null;\r\n              case null : return null; // EOF\r\n            }\r\n            return token(\"symbol\", read_symbol);\r\n        }\r\n        function read_all() {\r\n            var ret = [];\r\n            while (peek() != null) {\r\n                var tok = read_token();\r\n                if (tok == null) break;\r\n                ret.push(tok);\r\n                ++list_index;\r\n            }\r\n            return ret;\r\n        }\r\n        var caret_token = null;\r\n        var list_index = 0;\r\n        var caret = null;\r\n        var parent = null;\r\n        var cont_exp = null;\r\n        function token(type, reader, adjust_start) {\r\n            if (adjust_start == null) adjust_start = 0;\r\n            var save_parent = parent;\r\n            try {\r\n                var tok = {\r\n                    value   : null,\r\n                    index   : list_index,\r\n                    type    : type,\r\n                    start   : input.pos + adjust_start,\r\n                    parent  : parent,\r\n                    depth   : parent ? parent.depth + 1 : 0,\r\n                    partial : false\r\n                };\r\n                if (type == \"list\") parent = tok;\r\n                try {\r\n                    if (reader) {\r\n                        tok.value = reader();\r\n                        if (tok.value === \"\" && type != \"string\") {\r\n                            // couldn't figure this out, but let's not crash the browser.\r\n                            next();\r\n                        }\r\n                    }\r\n                } catch(ex) {\r\n                    if (ex instanceof Partial) {\r\n                        tok.value = ex.value;\r\n                        tok.partial = true;\r\n                    } else {\r\n                        throw ex;\r\n                    }\r\n                }\r\n                tok.end = input.pos;\r\n                if (caret != null) {\r\n                    if (tok.start <= caret && tok.end >= caret) {\r\n                        if (!cont_exp) cont_exp = tok;\r\n                    }\r\n                }\r\n                return tok;\r\n            } finally {\r\n                parent = save_parent;\r\n            }\r\n        }\r\n        return {\r\n            parse: function(pos) {\r\n                caret = pos;\r\n                return token(\"list\", read_all);\r\n            },\r\n            read: function() {\r\n                return read_token();\r\n            },\r\n            prev_exp: function() {\r\n                if (caret_token) {\r\n                    return caret_token.parent.value[caret_token.index - 1];\r\n                } else if (cont_exp) {\r\n                    if (cont_exp.type == \"list\" && cont_exp.end == caret + 1)\r\n                        return cont_exp.value.at(-1);\r\n                    return cont_exp.parent.value[cont_exp.index];\r\n                }\r\n            },\r\n            caret_token: function() {\r\n                return caret_token;\r\n            },\r\n            cont_exp: function() {\r\n                return cont_exp;\r\n            },\r\n            sexp: function() {\r\n                var tok = cont_exp;\r\n                while (tok && (!/^(?:list|string)$/.test(tok.type) || tok.end == caret))\r\n                    tok = tok.parent;\r\n                return tok;\r\n            }\r\n        };\r\n    }\r\n\r\n    Ymacs_Buffer.newCommands({\r\n\r\n        test_lisp_parse: Ymacs_Interactive(function(){\r\n            try {\r\n                var p = QuickParser(this);\r\n                var ast = p.parse(this.point());\r\n                console.log(ast);\r\n                console.log(p.caret_token());\r\n                console.log(p.cont_exp());\r\n                console.log(p.prev_exp());\r\n            } catch(ex) {\r\n                console.log(ex);\r\n            }\r\n        }),\r\n\r\n        lisp_make_quick_parser: function() {\r\n            return QuickParser.apply(this, [this, ...arguments]);\r\n        },\r\n\r\n        lisp_forward_sexp: Ymacs_Interactive(function(){\r\n            var p = QuickParser(this, this.point());\r\n            var tok = p.read();\r\n            if (tok) this.cmd(\"goto_char\", tok.end);\r\n        }),\r\n\r\n        lisp_backward_sexp: Ymacs_Interactive(function(){\r\n            var p = QuickParser(this);\r\n            p.parse(this.point());\r\n            var tok = p.prev_exp();\r\n            if (tok) this.cmd(\"goto_char\", tok.start);\r\n        }),\r\n\r\n        lisp_backward_up_list: Ymacs_Interactive(function(){\r\n            var p = QuickParser(this);\r\n            p.parse(this.point());\r\n            var list = p.sexp();\r\n            if (list && list.parent) this.cmd(\"goto_char\", list.start);\r\n        }),\r\n\r\n        lisp_handle_string_quote: Ymacs_Interactive(function(){\r\n            var p = QuickParser(this);\r\n            p.parse(this.point());\r\n            var tok = p.prev_exp();\r\n            if (tok && tok.type == \"string\" && this.point() < tok.end) {\r\n                if (this.cmd(\"looking_at\", /\\\"/y))\r\n                    this.cmd(\"forward_char\");\r\n                else if (!this.cmd(\"looking_back\", /\\\\/g))\r\n                    this.cmd(\"insert\", \"\\\\\\\"\");\r\n                else\r\n                    this.cmd(\"insert\", \"\\\"\");\r\n            } else {\r\n                this.cmd(\"insert\", '\"\"');\r\n                this.cmd(\"backward_char\");\r\n            }\r\n        })\r\n\r\n    });\r\n\r\n})();\r\n\r\nconst SPECIAL_FORMS = regexp_opt(\"\\\r\n  define defvar defparameter declaim proclaim declare type inline \\\r\n  optimize speed safety space debug defconstant \\\r\n  deftype defstruct defclass defsetf destructuring-bind \\\r\n  defmacro defun defmethod defgeneric defpackage in-package defreadtable in-readtable \\\r\n  when cond unless [ec]?typecase e?case \\\r\n  lambda  let load-time-value quote macrolet \\\r\n  progn begin prog1 prog2 progv go flet the \\\r\n  if throw eval-when multiple-value-prog1 multiple-value-bind unwind-protect let\\\\* \\\r\n  ignore-errors handler-case handler-bind invoke-restart restart-case restart-bind \\\r\n  labels function symbol-macrolet block tagbody catch locally \\\r\n  inc! dec! cons c[ad]{1,4}r list list\\\\* eq eql equal equalp and or not null null\\\\? \\\r\n  loop do while dotimes \\\r\n  return return-from setq set! set-car! set-cdr! setf multiple-value-call values\", \"i\");\r\n\r\nconst LOOP_KEYWORDS = regexp_opt(\"\\\r\n  for with and = as in on of then across by while until \\\r\n  from downfrom upfrom to upto below downto above \\\r\n  being each the hash-keys? using hash-values? \\\r\n  collect(?:ing)? nconc(?:ing)? sum(?:ming)? append(?:ing)? into \\\r\n  minimize minimizing maximize maximizing count counting \\\r\n  symbol symbols external-symbol external-symbols present-symbol present-symbols \\\r\n  named always never thereis \\\r\n  of-type \\\r\n  find maximizes minimizes that which \\\r\n  repeat finally initially return \\\r\n  if else when unless do doing\");\r\n\r\nconst ERROR_FORMS = toHash(\"error warn assert\");\r\n\r\nconst CONSTANTS = toHash(\"t nil\");\r\n\r\nconst DEFINES_FUNCTION = toHash(\"defun defmacro defgeneric defmethod\");\r\n\r\nconst DEFINES_TYPE = toHash(\"deftype defclass defstruct\");\r\n\r\nconst DEFINES_VARIABLE = toHash(\"defvar defparameter defconstant defconst\");\r\n\r\nconst FORM_ARGS = {\r\n    \"if\"                   : \"3+\",\r\n    \"aif\"                  : \"3+\",\r\n    \"when\"                 : \"1*\",\r\n    \"awhen\"                : \"1*\",\r\n    \"once-only\"            : \"1*\",\r\n    \"lambda\"               : \"1*\",\r\n    \"unless\"               : \"1*\",\r\n    \"defun\"                : \"2*\",\r\n    \"defpackage\"           : \"1*\",\r\n    \"deftest\"              : \"1*\",\r\n    \"defgeneric\"           : \"2*\",\r\n    \"defmethod\"            : \"2*\",\r\n    \"defclass\"             : \"2*\",\r\n    \"defstruct\"            : \"1*\",\r\n    \"defmacro\"             : \"2*\",\r\n    \"progn\"                : \"0+\",\r\n    \"begin\"                : \"0+\",\r\n    \"prog1\"                : \"1*\",\r\n    \"multiple-value-prog1\" : \"1*\",\r\n    \"prog2\"                : \"2*\",\r\n    \"let\"                  : \"1*\",\r\n    \"labels\"               : \"1*\",\r\n    \"flet\"                 : \"1*\",\r\n    \"macrolet\"             : \"1*\",\r\n    \"symbol-macrolet\"      : \"1*\",\r\n    \"unwind-protect\"       : \"1*\",\r\n    \"catch\"                : \"1*\",\r\n    \"case\"                 : \"1*\",\r\n    \"ecase\"                : \"1*\",\r\n    \"typecase\"             : \"1*\",\r\n    \"etypecase\"            : \"1*\",\r\n    \"cond\"                 : \"0+\",\r\n    \"handler-bind\"         : \"1*\",\r\n    \"handler-case\"         : \"1*\",\r\n    \"restart-bind\"         : \"1*\",\r\n    \"restart-case\"         : \"1*\",\r\n    \"return-from\"          : \"1*\",\r\n    \"block\"                : \"1*\",\r\n    \"dotimes\"              : \"1*\",\r\n    \"dolist\"               : \"1*\",\r\n    \"destructuring-bind\"   : \"2*\",\r\n    \"multiple-value-bind\"  : \"2*\",\r\n    \":method\"              : \"1*\",\r\n    \"eval-when\"            : \"1*\",\r\n};\r\n\r\nconst LOCAL_BODYDEF = toHash(\"labels flet macrolet\");\r\n\r\nexport class Ymacs_Lang_Lisp extends Ymacs_BaseLang {\r\n    _formStack = NIL;\r\n    _formSym = null;\r\n    _formLen = 0;\r\n    _rxSpecial = null;\r\n\r\n    COMMENT = [ \";\", [ \"#|\", \"|#\" ] ];\r\n    STRING = [ '\"' ];\r\n    NUMBER = /^[+-]?(?:#x[0-9a-fA-F]+|#\\d+r[0-9a-zA-Z]+|#o[0-7]+|#b[01]+|(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?|\\d+\\/\\d+)$/u;\r\n    NAME = /^[-_$\\p{L}0-9|!#$%&*+./:<=>?@\\^~]+/iu;\r\n    OPEN_PAREN = {\r\n        \"(\" : \")\",\r\n        \"{\" : \"}\",\r\n        \"[\" : \"]\",\r\n        \"\" : \"\",\r\n        \"\" : \"\",\r\n    };\r\n    CLOSE_PAREN = {\r\n        \")\" : \"(\",\r\n        \"}\" : \"{\",\r\n        \"]\" : \"[\",\r\n        \"\" : \"\",\r\n        \"\" : \"\",\r\n    };\r\n\r\n    constructor({ stream, tok, rx_special }) {\r\n        super({ stream, tok });\r\n        this._rxSpecial = rx_special;\r\n    }\r\n\r\n    isNameChar(ch) {\r\n        return this.NAME.test(ch) && !this._rxSpecial?.test(ch);\r\n    }\r\n    readName() {\r\n        if (!this._rxSpecial) return super.readName();\r\n        let s = this._stream, name = s.peek();\r\n        if (this.isNameChar(name)) {\r\n            let col = s.col++, ch;\r\n            while (this.isNameChar(ch = s.peek())) {\r\n                name += ch;\r\n                s.col++;\r\n            }\r\n            return { line: s.line, c1: col, c2: s.col, id: name };\r\n        }\r\n    }\r\n\r\n    copy() {\r\n        let _super = super.copy();\r\n        let _formStack = this._formStack;\r\n        let _formSym = this._formSym;\r\n        let _formLen = this._formLen;\r\n        let _rxSpecial = this._rxSpecial;\r\n        return () => {\r\n            let self = _super();\r\n            self._formStack = _formStack;\r\n            self._formSym = _formSym;\r\n            self._formLen = _formLen;\r\n            self._rxSpecial = _rxSpecial;\r\n            return self;\r\n        };\r\n    }\r\n\r\n    newArg(arg) {\r\n        if (arg?.id && !this._formLen) this._formSym = arg;\r\n        this._formLen++;\r\n    }\r\n\r\n    isForm(form) {\r\n        var f = this._formSym && this._formSym.id;\r\n        if (f) {\r\n            f = f.toLowerCase();\r\n            if (form == null) return f;\r\n            return typeof form == \"string\" ? f == form\r\n                :  form instanceof RegExp ? form.test(f)\r\n                :  f in form;\r\n        }\r\n    }\r\n\r\n    readCustom() {\r\n        let s = this._stream, m;\r\n        if ((m = s.lookingAt(/^#\\\\.[a-z0-9_-]*/i))) {\r\n            this.newArg();\r\n            this.t(\"constant\", m[0].length);\r\n            return true;\r\n        }\r\n        if (s.lookingAt(\"#:\") && this.isNameChar(s.peek(+2))) {\r\n            this.newArg();\r\n            s.col += 2;\r\n            this.maybeName(\"lisp-keyword\");\r\n            return true;\r\n        }\r\n        if (s.lookingAt(\"#'\") && this.isNameChar(s.peek(+2))) {\r\n            this.newArg();\r\n            s.col += 2;\r\n            let c = this.maybeName(\"function-name\");\r\n            return true;\r\n        }\r\n        if ((m = s.lookingAt(/^#\\/((?:\\\\.|[^\\/])*)\\/([dgimsuvy]+)?/))) {\r\n            this.newArg();\r\n            this.t(\"regexp-starter\", 2);\r\n            this.t(\"regexp\", m[1].length);\r\n            this.t(\"regexp-stopper\");\r\n            if (m[2]) this.t(\"regexp-modifier\", m[2].length);\r\n            return true;\r\n        }\r\n        if ((m = s.lookingAt(/^\\?(?:\\\\?.)/u))) {\r\n            // elisp char syntax\r\n            this.newArg();\r\n            this.t(\"constant\", m[0].length);\r\n            return true;\r\n        }\r\n        if ((m = this.readName())) {\r\n            let ch = m.id.charAt(0), type = null;\r\n\r\n            // message to future me: good luck figuring this out.\r\n            if (/^e?(?:type)?case$/i.test(this._formStack.cdr?.car?.id) && this._formStack.car > 2 && this._formLen == 0) {\r\n                type = \"constant\";\r\n            }\r\n            else if (/^e?(?:type)?case$/i.test(this._formStack.cdr?.cdr?.cdr?.car?.id) && this._formStack.cdr?.cdr?.car > 2 && this._formStack.car == 1) {\r\n                type = \"constant\";\r\n            }\r\n            else if (/^let\\*?$/i.test(this._formStack.cdr?.cdr?.cdr?.car?.id) && this._formStack.cdr?.cdr?.car == 2 && this._formLen == 0) {\r\n                type = \"variable-name\";\r\n            }\r\n            else if (/^let\\*?$/i.test(this._formStack.cdr?.car?.id) && this._formStack.car == 2) {\r\n                type = \"variable-name\";\r\n            }\r\n            else if (/^(?:flet|labels)$/i.test(this._formStack.cdr?.cdr?.cdr?.car?.id) && this._formStack.cdr?.cdr?.car == 2 && this._formLen == 0) {\r\n                type = \"function-name\";\r\n            }\r\n            else if (/^(?:flet|labels)$/i.test(this._formStack.cdr?.car?.id) && this._formStack.car == 2) {\r\n                type = \"function-name\";\r\n            }\r\n\r\n            if (!type) type = ch == \":\" ? \"lisp-keyword\"\r\n                : ch == \"&\" ? \"type\"\r\n                : m.id in ERROR_FORMS ? \"error\"\r\n                : m.id in CONSTANTS ? \"constant\"\r\n                : this.NUMBER.test(m.id) ? \"number\"\r\n                : null;\r\n            if (!type && this._formStack.car == 2) {\r\n                let pform = this._formStack.cdr?.car?.id;\r\n                if (pform == \"define\" && this._formLen == 0) {\r\n                    type = \"function-name\";\r\n                }\r\n                else if (/^def(?!un|ine|test)/.test(pform)) {\r\n                    type = \"function-name\";\r\n                }\r\n            }\r\n            if (!type) {\r\n                if (this._formLen == 0 && SPECIAL_FORMS.test(m.id)) {\r\n                    type = \"keyword\";\r\n                }\r\n                else if (this._formLen == 0 && /^(?::?with(out)?[-\\x2f]|def)/i.test(m.id)) {\r\n                    type = \"keyword\";\r\n                }\r\n                else if (this._formLen == 1 && this.isForm(DEFINES_FUNCTION)) {\r\n                    type = \"function-name\";\r\n                }\r\n                else if (this._formLen == 1 && this.isForm(DEFINES_TYPE)) {\r\n                    type = \"type\";\r\n                }\r\n                else if (this._formLen == 1 && this.isForm(\"let\")) {\r\n                    type = \"function-name\";\r\n                }\r\n                else if (this._formLen == 1 && this.isForm(DEFINES_VARIABLE)) {\r\n                    type = \"variable-name\";\r\n                }\r\n                else if (this._formLen == 1 && this.isForm(/^def/)) {\r\n                    type = \"function-name\";\r\n                }\r\n                else if (this._formLen == 2 && this.isForm(/^def/)) {\r\n                    type = \"type\";\r\n                }\r\n                else if (this.isForm(\"loop\") && LOOP_KEYWORDS.test(m.id)) {\r\n                    type = \"directive\";\r\n                }\r\n            }\r\n            m.type = type;\r\n            this.newArg(m);\r\n            this.token(m, type);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    readString(...args) {\r\n        if (super.readString(...args)) {\r\n            this.newArg();\r\n            return true;\r\n        }\r\n    }\r\n\r\n    readOpenParen() {\r\n        if (super.readOpenParen()) {\r\n            this.newArg();\r\n            this.pushFormStack(this._formSym);\r\n            this.pushFormStack(this._formLen);\r\n            this._formSym = null;\r\n            this._formLen = 0;\r\n            return true;\r\n        }\r\n    }\r\n\r\n    readCloseParen() {\r\n        if (super.readCloseParen()) {\r\n            if (this._backList !== NIL) {\r\n                this._formLen = this.popFormStack();\r\n                this._formSym = this.popFormStack();\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n\r\n    pushFormStack(val) {\r\n        this._formStack = new Cons(val, this._formStack);\r\n    }\r\n    popFormStack() {\r\n        let val = this._formStack.car;\r\n        this._formStack = this._formStack.cdr;\r\n        return val;\r\n    }\r\n\r\n    indentation() {\r\n        if (this._inString || this._inComment) {\r\n            return super.indentation();\r\n        }\r\n\r\n        let s = this._stream;\r\n        let INDENT_LEVEL = () => this._stream.buffer.getq(\"indent_level\");\r\n\r\n        var indent = 0;\r\n\r\n        // XXX: rewrite this mess.\r\n\r\n        var p = this._inParens.car;\r\n        if (p) {\r\n            var line = s.lineText(p.line);\r\n            indent = p.col + 1;\r\n            if (/[\\#\\']/.test(line.charAt(p.col - 1))) { // XXX: what's this for?\r\n                return indent;\r\n            }\r\n            var nextNonSpace;\r\n            if (this.isNameChar(line.charAt(indent))) {\r\n                var re = /\\s\\S/g;\r\n                re.lastIndex = p.col;\r\n                nextNonSpace = re.exec(line);\r\n                if (nextNonSpace) {\r\n                    indent = nextNonSpace = nextNonSpace.index + 1;\r\n                }\r\n            }\r\n            if (this._formLen) {\r\n                var currentForm = this.isForm();\r\n                if (currentForm) {\r\n                    currentForm = currentForm.replace(/\\*$/, \"\");\r\n                    var formArgs = FORM_ARGS[currentForm];\r\n                    if (!formArgs && /^with|:with/.test(currentForm)) {\r\n                        // \"with\" macros usually take one argument, then &body\r\n                        formArgs = \"0*\";\r\n                    }\r\n                    if (!formArgs && /^def/.test(currentForm)) {\r\n                        // definitions usually take two arguments, then &body\r\n                        if (nextNonSpace && /[\\(\\[\\{]/.test(line.charAt(nextNonSpace)))\r\n                            formArgs = \"1*\";\r\n                        else\r\n                            formArgs = \"2*\";\r\n                    }\r\n                    if (!formArgs) try {\r\n                        if (this._formStack.cdr?.car?.id == \"handler-case\") {\r\n                            formArgs = \"1*\";\r\n                        }\r\n                        else if (LOCAL_BODYDEF[this._formStack.cdr.cdr.cdr.car.id] &&\r\n                            this._formStack.cdr.cdr.car == 2) {\r\n                            formArgs = \"1*\";\r\n                        }\r\n                    } catch(ex){}\r\n                    if (formArgs) {\r\n                        var n = parseInt(formArgs, 10);\r\n                        var hasRest = /\\+/.test(formArgs);\r\n                        var hasBody =/\\*/.test(formArgs);\r\n                        indent = p.col + INDENT_LEVEL();\r\n                        if (hasRest && nextNonSpace) {\r\n                            indent = nextNonSpace;\r\n                        }\r\n                        else if ((n > 0 && this._formLen - 1 < n)) {\r\n                            // still in the arguments\r\n                            if (nextNonSpace)\r\n                                indent = nextNonSpace;\r\n                            else\r\n                                indent += INDENT_LEVEL();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return indent;\r\n    }\r\n}\r\n\r\nYmacs_Tokenizer.define(\"lisp\", (stream, tok, options = {}) =>\r\n    new Ymacs_Lang_Lisp({ stream, tok, ...options }));\r\n\r\nlet Ymacs_Keymap_LispMode = Ymacs_Keymap.define(\"lisp\", {\r\n    '\"' : [ \"lisp_handle_string_quote\" ], // XXX: keep this?\r\n});\r\n\r\nYmacs_Buffer.newMode(\"lisp_mode\", function() {\r\n\r\n    var tok = this.tokenizer;\r\n    this.setTokenizer(new Ymacs_Tokenizer({ buffer: this, type: \"lisp\" }));\r\n    var changed_vars = this.setq({\r\n        indent_level: 2,\r\n        syntax_paragraph_sep: /\\n(?:[ \\t;]*\\n)+/g,\r\n        syntax_comment_line: {\r\n            rx: /[^\\S\\r\\n]*;+ ?/gu,\r\n            ch: \";;\"\r\n        },\r\n        syntax_word_dabbrev: /^[-0-9_*%+/@&$.=~\\p{L}]$/u,\r\n        paredit_space_before() {\r\n            return !this.looking_back(/[\\s\\(\\)\\[\\]\\{\\},.@'`#\\\\\"]/g);\r\n        },\r\n    });\r\n    var was_paren_match = this.cmd(\"paren_match_mode\", true);\r\n    this.pushKeymap(Ymacs_Keymap_LispMode);\r\n\r\n    var changed_commands = this.replaceCommands({\r\n        \"forward_sexp\"            : \"lisp_forward_sexp\",\r\n        \"backward_sexp\"           : \"lisp_backward_sexp\",\r\n        \"backward_up_list\"        : \"lisp_backward_up_list\"\r\n    });\r\n\r\n    return function() {\r\n        this.setTokenizer(tok);\r\n        this.setq(changed_vars);\r\n        this.newCommands(changed_commands);\r\n        if (!was_paren_match)\r\n            this.cmd(\"paren_match_mode\", false);\r\n        this.popKeymap(Ymacs_Keymap_LispMode);\r\n    };\r\n\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Tokenizer } from \"./ymacs-tokenizer.js\";\r\nimport { Ymacs_BaseLang } from \"./ymacs-baselang.js\";\r\nimport { Ymacs_Keymap } from \"./ymacs-keymap.js\";\r\n\r\nlet RX_URL = /^\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?]))/i;\r\n\r\nclass Ymacs_Lang_Markdown extends Ymacs_BaseLang {\r\n    COMMENT = [];\r\n    STRING = [\r\n        [ \"`\", \"`\", null, null, \"markdown-code\" ],\r\n        [ \"**\", \"**\", null, null, \"bold\" ],\r\n        [ \"__\", \"__\", null, null, \"bold\" ],\r\n        [ \"*\", \"*\", null, null, \"italic\" ],\r\n    ];\r\n    OPEN_PAREN = {\r\n        \"(\" : \")\",\r\n        \"{\" : \"}\",\r\n        \"[\" : \"]\",\r\n        \"\" : \"\",\r\n        \"\" : \"\",\r\n        \"\" : \"\",\r\n    };\r\n    CLOSE_PAREN = {\r\n        \")\" : \"(\",\r\n        \"}\" : \"{\",\r\n        \"]\" : \"[\",\r\n        \"\" : \"\",\r\n        \"\" : \"\",\r\n        \"\" : \"\",\r\n    };\r\n\r\n    _block = null;\r\n\r\n    copy() {\r\n        let _super = super.copy();\r\n        let _block = this._block;\r\n        return () => {\r\n            let self = _super();\r\n            self._block = _block;\r\n            return self;\r\n        };\r\n    }\r\n\r\n    t(type = null, len = 1) {\r\n        if (this._block != null) {\r\n            type = this._block + (type != null ? \" \" + type : \"\");\r\n        }\r\n        this.token({\r\n            line: this._stream.line,\r\n            c1: this._stream.col,\r\n            c2: this._stream.col += len,\r\n        }, type);\r\n    }\r\n\r\n    next() {\r\n        if (this._stream.eol()) this._block = null;\r\n        return super.next();\r\n    }\r\n\r\n    read() {\r\n        ((this._block != \"markdown-pre\" && this.readInline()) ||\r\n         this.readCustom() ||\r\n         this.readOpenParen() ||\r\n         this.readCloseParen() ||\r\n         this.readTrailingWhitespace() ||\r\n         this.t());\r\n    }\r\n\r\n    readInline() {\r\n        return this.readString();\r\n    }\r\n\r\n    readCustom() {\r\n        let s = this._stream, m;\r\n        if (s.col == 0 && (m = s.lookingAt(/^#+/))) {\r\n            this._block = \"heading\" + m[0].length;\r\n        }\r\n        else if (s.col == 0 && (m = s.lookingAt(/^    /))) {\r\n            this._block = \"markdown-pre\";\r\n        }\r\n        else if (s.col == 0 && (m = s.lookingAt(/^>[>\\s]*/))) {\r\n            let level = m[0].replace(/\\s+/g, \"\").length - 1;\r\n            level = Math.min(3, level);\r\n            this._block = \"markdown-blockquote\" + (level > 0 ? level : \"\");\r\n        }\r\n        else if ((m = s.lookingAt(RX_URL))) {\r\n            this.t(`hyperlink :href-${m[0]}`, m[0].length);\r\n            return true;\r\n        }\r\n        else if ((m = s.lookingAt(/^\\[[a-zA-Z0-9_-]+\\]/))) {\r\n            this.t(\"markdown-ref\", m[0].length);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    indentation() {\r\n        let s = this._stream;\r\n        let row = s.line;\r\n        return row > 0 && s.lineIndentation(row - 1) || s.lineIndentation(row);\r\n    }\r\n}\r\n\r\nlet Ymacs_Keymap_Markdown = Ymacs_Keymap.define(\"markdown\", {\r\n    \"`\"   : [ \"paredit_open_pair\", \"`\", \"`\", /[\\`\\\\]/g ],\r\n    \"M-`\" : [ \"paredit_wrap_round\", \"`\", \"`\", /[\\`\\\\]/g ],\r\n});\r\n\r\nYmacs_Tokenizer.define(\"markdown\", (stream, tok) => new Ymacs_Lang_Markdown({ stream, tok }));\r\n\r\nYmacs_Buffer.newMode(\"markdown_mode\", function() {\r\n\r\n    var tok = this.tokenizer;\r\n    this.setTokenizer(new Ymacs_Tokenizer({ buffer: this, type: \"markdown\" }));\r\n    var was_paren_match = this.cmd(\"paren_match_mode\", true);\r\n    this.pushKeymap(Ymacs_Keymap_Markdown);\r\n    return function() {\r\n        this.setTokenizer(tok);\r\n        if (!was_paren_match)\r\n            this.cmd(\"paren_match_mode\", false);\r\n        this.popKeymap(Ymacs_Keymap_Markdown);\r\n    };\r\n\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { delayed } from \"./ymacs-utils.js\";\r\nimport { Ymacs_Keymap } from \"./ymacs-keymap.js\";\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Exception } from \"./ymacs-exception.js\";\r\nimport { Ymacs_Interactive } from \"./ymacs-interactive.js\";\r\nimport { compareRowCol, caretInside } from \"./ymacs-tokenizer.js\";\r\n\r\nlet Ymacs_Keymap_ParenMatch = Ymacs_Keymap.define(\"parenmatch\", {\r\n    \"C-M-x\"                        : \"goto_matching_paren\",\r\n    \"C-M-q\"                        : \"indent_sexp\",\r\n    \"C-M-f && C-M-n\"               : \"forward_sexp\",\r\n    \"C-M-b && C-M-p\"               : \"backward_sexp\",\r\n    \"C-M-u && M-a && C-M-ArrowUp\"  : \"backward_up_list\",\r\n    \"C-M-a\"                        : \"beginning_of_defun\",\r\n    \"C-M-e\"                        : \"end_of_defun\",\r\n    \"M-e\"                          : \"up_list\",\r\n    \"C-M-ArrowDown\"                : \"down_list\",\r\n    \"M-C-k\"                        : \"kill_sexp\",\r\n    \"M-C-Space\"                    : \"mark_sexp\",\r\n    \"M-C-t\"                        : \"transpose_sexps\",\r\n\r\n    \"(\"                            : [ \"paredit_open_pair\", \"(\", \")\" ],\r\n    \"[\"                            : [ \"paredit_open_pair\", \"[\", \"]\" ],\r\n    \"{\"                            : [ \"paredit_open_pair\", \"{\", \"}\" ],\r\n    \"\"                            : [ \"paredit_open_pair\", \"\", \"\" ],\r\n    \"\"                            : [ \"paredit_open_pair\", \"\", \"\" ],\r\n    \"\"                            : [ \"paredit_open_pair\", \"\", \"\" ],\r\n    '\"'                            : [ \"paredit_open_pair\", '\"', '\"', /[\\\"\\\\]/g ],\r\n\r\n    \")\"                            : [ \"paredit_close_pair\", \"(\", \")\" ],\r\n    \"]\"                            : [ \"paredit_close_pair\", \"[\", \"]\" ],\r\n    \"}\"                            : [ \"paredit_close_pair\", \"{\", \"}\" ],\r\n    \"\"                            : [ \"paredit_close_pair\", \"\", \"\" ],\r\n    \"\"                            : [ \"paredit_close_pair\", \"\", \"\" ],\r\n    \"\"                            : [ \"paredit_close_pair\", \"\", \"\" ],\r\n\r\n    \"M-(\"                          : [ \"paredit_wrap_round\", \"(\", \")\" ],\r\n    \"M-[\"                          : [ \"paredit_wrap_round\", \"[\", \"]\" ],\r\n    \"M-{\"                          : [ \"paredit_wrap_round\", \"{\", \"}\" ],\r\n    \"M-\"                          : [ \"paredit_wrap_round\", \"\", \"\" ],\r\n    \"M-\"                          : [ \"paredit_wrap_round\", \"\", \"\" ],\r\n    \"M-\"                          : [ \"paredit_wrap_round\", \"\", \"\" ],\r\n    'M-\"'                          : [ \"paredit_wrap_round\", '\"', '\"', /[\\\"\\\\]/g ],\r\n\r\n    \"M-r\"                          : \"paredit_raise_sexp\",\r\n    \"M-s\"                          : \"paredit_splice_sexp\",\r\n    \"Backspace\"                    : \"paredit_backward_delete_char\",\r\n    //\"Delete && C-d\"                : \"paredit_delete_char\",\r\n    \"Enter\"                        : \"paredit_newline_and_indent\",\r\n    \"; && : && , && .\"             : \"paredit_electric_char\",\r\n});\r\n\r\nvar PARENS = {\r\n    \"(\" : \")\",\r\n    \"[\" : \"]\",\r\n    \"{\" : \"}\",\r\n    \"\" : \"\",\r\n    \"\" : \"\",\r\n    \"\" : \"\",\r\n    '\"' : '\"',\r\n    \"'\" : \"'\",\r\n    '`' : '`',\r\n};\r\n\r\nvar R_PARENS = {\r\n    \")\" : \"(\",\r\n    \"]\" : \"[\",\r\n    \"}\" : \"{\",\r\n    \"\" : \"\",\r\n    \"\" : \"\",\r\n    \"\" : \"\",\r\n    '\"' : '\"',\r\n    \"'\" : \"'\",\r\n    '`' : '`',\r\n};\r\n\r\nfunction ERROR(o) {\r\n    throw new Ymacs_Exception(\"Balanced expression not found\");\r\n};\r\n\r\nfunction startOf(paren) {\r\n    return paren.c1 ?? paren.col;\r\n}\r\n\r\nfunction endOf(paren) {\r\n    return paren.c2 ?? (paren.col + 1);\r\n}\r\n\r\nfunction typeOf(paren) {\r\n    if (paren.opened) return paren.opened.type || \"\";\r\n    return paren.type || \"\";\r\n}\r\n\r\nfunction touches(paren, caret) {\r\n    return paren.line == caret.row\r\n        && startOf(paren) <= caret.col\r\n        && caret.col <= endOf(paren);\r\n}\r\n\r\nYmacs_Buffer.newCommands({\r\n\r\n    get_paren_at_point() {\r\n        let rc = this._rowcol;\r\n        let parens = this.tokenizer.getPP();\r\n        let a = [];\r\n        for (let op of parens) {\r\n            if (!op.type) continue;\r\n            let cp = op.closed;\r\n            if (!cp) continue;\r\n            if (touches(op, rc)) a.push(op);\r\n            if (touches(cp, rc)) a.push(cp);\r\n        }\r\n        if (!a.length)\r\n            return null;\r\n        if (a.length == 1)\r\n            return a[0].opened || a[0];\r\n        if (/\\w/.test(typeOf(a[0])) && !/\\w/.test(typeOf(a[1])))\r\n            return a[0].opened || a[0];\r\n        if (/\\w/.test(typeOf(a[1])) && !/\\w/.test(typeOf(a[0])))\r\n            return a[1].opened || a[1];\r\n        a = a.sort(compareRowCol);\r\n        a = a[0].opened ? a[0] : a[1];\r\n        return a.opened || a;\r\n    },\r\n\r\n    matching_paren() {\r\n        this.tokenizer.finishParsing();\r\n        let rc = this._rowcol;\r\n        let p = this.cmd(\"get_paren_at_point\");\r\n        if (p) {\r\n            if (touches(p, rc))\r\n                return this._rowColToPosition(p.closed.line, endOf(p.closed));\r\n            return this._rowColToPosition(p.line, startOf(p));\r\n        }\r\n    },\r\n\r\n    indent_sexp: Ymacs_Interactive(function() {\r\n        var pos = this.cmd(\"matching_paren\");\r\n        if (pos != null) {\r\n            this.cmd(\"indent_region\", this.point(), pos);\r\n        } else {\r\n            ERROR(this);\r\n        }\r\n    }),\r\n\r\n    goto_matching_paren: Ymacs_Interactive(function() {\r\n        var pos = this.cmd(\"matching_paren\");\r\n        if (pos != null) {\r\n            this.cmd(\"goto_char\", pos);\r\n            return true;\r\n        }\r\n    }),\r\n\r\n    forward_sexp: Ymacs_Interactive(function() {\r\n        this.tokenizer.finishParsing();\r\n        let next;\r\n        let rc = this._rowcol;\r\n        let parens = this.tokenizer.getPP();\r\n        for (let i = 0; i < parens.length; ++i) {\r\n            let p = parens[i];\r\n            if (p.line > rc.row || (p.line == rc.row && startOf(p) >= rc.col)) {\r\n                next = p;\r\n                break;\r\n            }\r\n        }\r\n        this.withVariables({\r\n            syntax_word: this.getq(\"syntax_word_sexp\"),\r\n        }, \"forward_word\");\r\n        if (next && next.closed && compareRowCol(this._rowcol, next) > 0) {\r\n            this.cmd(\"goto_char\", this._rowColToPosition(next.closed.line, endOf(next.closed)));\r\n        }\r\n    }),\r\n\r\n    backward_sexp: Ymacs_Interactive(function() {\r\n        this.tokenizer.finishParsing();\r\n        let prev;\r\n        let rc = this._rowcol;\r\n        let parens = this.tokenizer.getPP().filter(p => p.closed).map(p => p.closed).sort(compareRowCol);\r\n        for (let i = parens.length; --i >= 0;) {\r\n            let p = parens[i];\r\n            if (p.line < rc.row\r\n                || (p.line == rc.row\r\n                    && (startOf(p) < rc.col\r\n                        || (p.c1 == p.c2 && startOf(p) == rc.col)))) {\r\n                prev = p;\r\n                break;\r\n            }\r\n        }\r\n        this.withVariables({\r\n            syntax_word: this.getq(\"syntax_word_sexp\"),\r\n        }, \"backward_word\");\r\n        if (prev && prev.opened && compareRowCol(this._rowcol, { line: prev.line, col: endOf(prev) }) < 0) {\r\n            this.cmd(\"goto_char\", this._rowColToPosition(prev.opened.line, startOf(prev.opened)));\r\n        }\r\n    }),\r\n\r\n    mark_sexp: Ymacs_Interactive(\"^r\", function(begin, end){\r\n        this.tokenizer.finishParsing();\r\n        let paren = this.cmd(\"get_paren_at_point\");\r\n        if (paren?.outer) {\r\n            this.cmd(\"goto_char\", this._rowColToPosition(paren.outer.l1, paren.outer.c1));\r\n            this.ensureTransientMark();\r\n            this.cmd(\"goto_char\", this._rowColToPosition(paren.outer.l2, paren.outer.c2));\r\n            this.setMark(this.point());\r\n            this.transientMarker.swap(this.caretMarker);\r\n        }\r\n        else this.cmd(\"save_excursion\", function(){\r\n            if (this.transientMarker)\r\n                this.cmd(\"goto_char\", end);\r\n            this.ensureTransientMark();\r\n            this.cmd(\"forward_sexp\");\r\n            this.setMark(this.point());\r\n            this.transientMarker.swap(this.caretMarker);\r\n        });\r\n        this.ensureTransientMark();\r\n        this.setq(\"sticky_mark\", true);\r\n    }),\r\n\r\n    kill_sexp: Ymacs_Interactive(function() {\r\n        this._killingAction(\r\n            this.point(),\r\n            this.cmd(\"save_excursion\", function() {\r\n                this.cmd(\"forward_sexp\");\r\n                return this.point();\r\n            })\r\n        );\r\n    }),\r\n\r\n    transpose_sexps: Ymacs_Interactive(function() {\r\n        var a = [];\r\n        this.cmd(\"forward_sexp\"); a.push(this.point());\r\n        this.cmd(\"backward_sexp\"); a.push(this.point());\r\n        this.cmd(\"backward_sexp\"); a.push(this.point());\r\n        this.cmd(\"forward_sexp\"); a.push(this.point());\r\n        this.cmd(\"goto_char\", this._swapAreas(a));\r\n    }),\r\n\r\n    down_list: Ymacs_Interactive(function(){\r\n        this.tokenizer.finishParsing();\r\n        let rc = this._rowcol;\r\n        let lc = { line: rc.row, col: rc.col };\r\n        let p = this.tokenizer.getPP().filter(p => p.closed).find(p => compareRowCol(p, lc) >= 0);\r\n        if (p != null) {\r\n            this.cmd(\"goto_char\", this._rowColToPosition(p.line, endOf(p)));\r\n        } else {\r\n            ERROR(this);\r\n        }\r\n    }),\r\n\r\n    backward_up_list: Ymacs_Interactive(function(){\r\n        this.tokenizer.finishParsing();\r\n        let rc = this._rowcol;\r\n        let p = this.tokenizer.getPP().filter(caretInside(rc)).at(-1);\r\n        if (p != null) {\r\n            this.cmd(\"goto_char\", this._rowColToPosition(p.line, startOf(p)));\r\n        } else {\r\n            ERROR(this);\r\n        }\r\n    }),\r\n\r\n    up_list: Ymacs_Interactive(function(){\r\n        this.cmd(\"backward_up_list\");\r\n        this.cmd(\"forward_sexp\");\r\n    }),\r\n\r\n    beginning_of_defun: Ymacs_Interactive(function(){\r\n        this.tokenizer.finishParsing();\r\n        let rc = this._rowcol;\r\n        let p = this.tokenizer.getPP().filter(caretInside(rc))[0];\r\n        if (p != null) {\r\n            this.cmd(\"goto_char\", this._rowColToPosition(p.line, startOf(p)));\r\n        } else {\r\n            this.cmd(\"backward_sexp\");\r\n        }\r\n        this.cmd(\"back_to_indentation\");\r\n    }),\r\n\r\n    end_of_defun: Ymacs_Interactive(function(){\r\n        this.tokenizer.finishParsing();\r\n        let rc = this._rowcol;\r\n        let p = this.tokenizer.getPP().filter(caretInside(rc))[0];\r\n        if (p != null) {\r\n            p = p.closed;\r\n            this.cmd(\"goto_char\", this._rowColToPosition(p.line, endOf(p)));\r\n        } else {\r\n            this.cmd(\"forward_sexp\");\r\n        }\r\n    }),\r\n\r\n    paredit_raise_sexp: Ymacs_Interactive(function(){\r\n        this.tokenizer.finishParsing();\r\n        let p = this.tokenizer.getPP()\r\n            .filter(caretInside(this._rowcol, \"inner\")).at(-1);\r\n        if (!p) {\r\n            this.signalError(\"No containing expression\");\r\n            return;\r\n        }\r\n        this.cmd(\"forward_sexp\");\r\n        this.cmd(\"backward_sexp\");\r\n        var start = this.point();\r\n        this.cmd(\"forward_sexp\");\r\n        var end = this.point();\r\n        this.cmd(\"backward_up_list\");\r\n        var kstart = this.point();\r\n        this.cmd(\"forward_sexp\");\r\n        var kend = this.point();\r\n        var sexp = this.cmd(\"buffer_substring\", start, end);\r\n        this._replaceText(kstart, kend, sexp);\r\n        this.cmd(\"goto_char\", kstart);\r\n        this.cmd(\"indent_region\", kstart, kstart + sexp.length);\r\n    }),\r\n\r\n    paredit_splice_sexp: Ymacs_Interactive(function(){\r\n        this.tokenizer.finishParsing();\r\n        let p = this.tokenizer.getPP()\r\n            .filter(caretInside(this._rowcol, \"inner\")).at(-1);\r\n        if (!p) {\r\n            this.signalError(\"No containing expression\");\r\n            return;\r\n        }\r\n        if (p.inner && p.outer) {\r\n            this.cmd(\"save_excursion\", function(){\r\n                let outer_begin = this._rowColToPosition(p.outer.l1, p.outer.c1);\r\n                let outer_end = this._rowColToPosition(p.outer.l2, p.outer.c2);\r\n                let inner_begin = this._rowColToPosition(p.inner.l1, p.inner.c1);\r\n                let inner_end = this._rowColToPosition(p.inner.l2, p.inner.c2);\r\n                this.withMarkers((m1, m2) => {\r\n                    this._deleteText(inner_end, outer_end);\r\n                    this._deleteText(outer_begin, inner_begin);\r\n                    this.cmd(\"indent_region\", m1, m2);\r\n                }, inner_begin, inner_end);\r\n            });\r\n        } else {\r\n            this.cmd(\"save_excursion\", function(){\r\n                this.cmd(\"backward_up_list\");\r\n                var start = this.point();\r\n                this.cmd(\"forward_sexp\");\r\n                this.cmd(\"backward_delete_char\");\r\n                var end = this.point();\r\n                this.cmd(\"goto_char\", start);\r\n                this.cmd(\"delete_char\");\r\n                this.cmd(\"indent_region\", start, end - 1);\r\n            });\r\n        }\r\n    }),\r\n\r\n    paredit_backward_delete_char: Ymacs_Interactive(\"^p\", function(n){\r\n        if (n != null) return this.cmd(\"backward_delete_char\", n);\r\n        if (!this.deleteTransientRegion()) {\r\n            if (this.cmd(\"looking_back\", /[\\(\\[\\{\\\"\\\\\\`\\']/g)) {\r\n                var close = PARENS[this.matchData[0]];\r\n                if (close) {\r\n                    var rx = new RegExp(\"\\\\s*\\\\\" + close, \"my\");\r\n                    if (this.cmd(\"looking_at\", rx)) this.cmd(\"save_excursion\", function(){\r\n                        this.cmd(\"delete_whitespace\");\r\n                        this.cmd(\"delete_char\");\r\n                    });\r\n                }\r\n            }\r\n            this.cmd(\"backward_delete_char\");\r\n        }\r\n    }),\r\n\r\n    paredit_delete_char: Ymacs_Interactive(\"^p\", function(n){\r\n        if (n != null) return this.cmd(\"delete_char\", n);\r\n        if (!this.deleteTransientRegion()) {\r\n            if (this.cmd(\"looking_at\", /[\\]\\}\\)\\\"\\\\\\`\\']/y)) {\r\n                var open = R_PARENS[this.matchData[0]];\r\n                if (open) {\r\n                    var rx = new RegExp(\"\\\\\" + open + \"\\\\s*\", \"mg\");\r\n                    if (this.cmd(\"looking_back\", rx)) this.cmd(\"save_excursion\", function(){\r\n                        this.cmd(\"backward_delete_whitespace\");\r\n                        this.cmd(\"backward_delete_char\");\r\n                    });\r\n                }\r\n            }\r\n            this.cmd(\"delete_char\");\r\n        }\r\n    }),\r\n\r\n    paredit_open_pair: Ymacs_Interactive(\"^\", function(pair_a, pair_b, backslash) {\r\n        if (this.transientMarker) {\r\n            this.cmd(\"paredit_wrap_round\", pair_a, pair_b, backslash);\r\n            return;\r\n        }\r\n        if (pair_a == pair_b && this.looking_at(pair_a)) {\r\n            // presumably close; it's already there, just skip it\r\n            this.cmd(\"forward_char\");\r\n        } else {\r\n            let maybe_space = this.getq(\"paredit_space_before\");\r\n            if (typeof maybe_space == \"function\") {\r\n                maybe_space = maybe_space.apply(this, arguments);\r\n            }\r\n            if (maybe_space) {\r\n                this.cmd(\"insert\", \" \");\r\n            }\r\n            this.cmd(\"insert\", pair_a);\r\n            this.cmd(\"insert\", pair_b);\r\n            this.cmd(\"backward_char\", pair_b.length);\r\n        }\r\n        this.cmd(\"paredit_maybe_indent\");\r\n    }),\r\n\r\n    paredit_close_pair: Ymacs_Interactive(\"^\", function(pair_a, pair_b) {\r\n        if (this.transientMarker) {\r\n            this.cmd(\"paredit_wrap_round\", pair_a, pair_b);\r\n            return;\r\n        }\r\n        var re = new RegExp(\"\\\\s*\\\\\" + pair_b, \"iy\");\r\n        if (this.cmd(\"looking_at\", re))\r\n            this._deleteText(this.point(), this.matchData.after);\r\n        this.cmd(\"insert\", pair_b);\r\n        this.cmd(\"paredit_maybe_indent\");\r\n    }),\r\n\r\n    paredit_wrap_round: Ymacs_Interactive(\"^\", function(paren, closing, backslash) {\r\n        let r = this.transientMarker\r\n            ? this.getRegion()\r\n            : this.cmd(\"save_excursion\", function(){\r\n                let begin = this.point();\r\n                this.cmd(\"forward_sexp\");\r\n                return { begin: begin, end: this.point() };\r\n            });\r\n        let txt = this._bufferSubstring(r.begin, r.end);\r\n        let before = this.point() < r.end;\r\n        if (backslash) {\r\n            txt = txt.replace(backslash, s => \"\\\\\" + s);\r\n        }\r\n        let m = this.createMarker(r.end);\r\n        this.cmd(\"save_excursion\", function(){\r\n            this._replaceText(r.begin, r.end, paren + txt + closing);\r\n        }, before);\r\n        if (before) {\r\n            this.cmd(\"forward_char\");\r\n        }\r\n        this.clearTransientMark();\r\n        this.cmd(\"indent_region\", r.begin, m.getPosition());\r\n        m.destroy();\r\n    }),\r\n\r\n    paredit_newline_and_indent: Ymacs_Interactive(function(){\r\n        var inparens = this.looking_at(/[ \\t]*([\\]\\}])/y)\r\n            && this.looking_back(new RegExp(\"\\\\\" + R_PARENS[this.matchData[1]] + \"[ \\\\t]*\", \"g\"));\r\n        this.cmd(\"newline_and_indent\");\r\n        if (inparens) {\r\n            this.cmd(\"newline_and_indent\");\r\n            this.cmd(\"backward_line\");\r\n            this.cmd(\"indent_line\");\r\n        }\r\n    }),\r\n\r\n    paredit_maybe_indent: function() {\r\n        if (this.getq(\"electric_indent\")) {\r\n            this.cmd(\"indent_line\");\r\n        }\r\n    },\r\n\r\n    paredit_electric_char: Ymacs_Interactive(function(){\r\n        this.cmd(\"self_insert_command\");\r\n        this.cmd(\"paredit_maybe_indent\");\r\n    }),\r\n\r\n});\r\n\r\nYmacs_Buffer.newMode(\"paren_match_mode\", function(){\r\n\r\n    this.pushKeymap(Ymacs_Keymap_ParenMatch);\r\n\r\n    var clearOvl = function() {\r\n        this.deleteOverlay(\"match-paren\");\r\n    }.bind(this);\r\n\r\n    let events = {\r\n        beforeInteractiveCommand: function() {\r\n            clearOvl();\r\n        },\r\n        afterInteractiveCommand: delayed(() => {\r\n            let rc = this._rowcol;\r\n            let hl = [];\r\n            let p = this.cmd(\"get_paren_at_point\");\r\n            if (p) {\r\n                hl.push({\r\n                    line1: p.line, col1: p.c1,\r\n                    line2: p.line, col2: p.c2\r\n                }, {\r\n                    line1: p.closed.line, col1: p.closed.c1,\r\n                    line2: p.closed.line, col2: p.closed.c2\r\n                });\r\n            }\r\n            this.setOverlay(\"match-paren\", hl);\r\n        }, 100)\r\n    };\r\n    this.addEventListener(events);\r\n\r\n    if (this.getq(\"electric_indent\") == null) {\r\n        this.setq(\"electric_indent\", true);\r\n    }\r\n\r\n    return function() {\r\n        clearOvl();\r\n        this.popKeymap(Ymacs_Keymap_ParenMatch);\r\n        this.removeEventListener(events);\r\n    };\r\n\r\n});\r\n","/// This file is part of Ymacs - www.ymacs.org\r\n/// Copyright (c) 2009-2024 Mihai Bazon <mihai.bazon@gmail.com>\r\n/// License: MIT\r\n\r\nimport { Ymacs_Buffer } from \"./ymacs-buffer.js\";\r\nimport { Ymacs_Tokenizer, compareRowCol, caretInside } from \"./ymacs-tokenizer.js\";\r\nimport { Ymacs_BaseLang } from \"./ymacs-baselang.js\";\r\nimport { Cons, NIL, toHash } from \"./ymacs-utils.js\";\r\nimport { Ymacs_Exception } from \"./ymacs-exception.js\";\r\nimport { Ymacs_Keymap } from \"./ymacs-keymap.js\";\r\nimport { Ymacs_Interactive } from \"./ymacs-interactive.js\";\r\n\r\nconst RX_EMPTY_TAG = /^(?:area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)$/i;\r\nconst RX_BLOCK_TAG = /^(?:article|aside|blockquote|body|button|caption|col|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h[1-6]|header|hgroup|li|ol|p|pre|section|table|tbody|textarea|tfoot|th|thead|td|tr|ul)$/i;\r\n\r\nlet Ymacs_Keymap_XML = Ymacs_Keymap.define(\"xml\", {\r\n    \"C-c /\"   : \"xml_close_tag\",\r\n    \"/\"       : \"xml_slash_complete_tag\",\r\n    \">\"       : \"xml_gt_complete_tag\",\r\n    \"%\"       : \"twig_insert_percent\",\r\n    \"M--\"     : \"twig_block_toggle_whitespace\",\r\n    \"C-Enter\" : \"xml_zen_expand\",\r\n    \"Enter\"   : \"xml_newline_and_indent\"\r\n});\r\n\r\nlet markup_mode = tok_type => function(){\r\n    var tok = this.tokenizer;\r\n    this.setTokenizer(new Ymacs_Tokenizer({ buffer: this, type: tok_type }));\r\n    var was_paren_match = this.cmd(\"paren_match_mode\", true);\r\n    this.pushKeymap(Ymacs_Keymap_XML);\r\n    var changed_vars = this.setq({\r\n        indent_level: 2,\r\n        syntax_comment_multi: {\r\n            rx: /[^\\S\\r\\n]*<!--+[^\\S\\r\\n]*(.*?)[^\\S\\r\\n]*-->/ygu,\r\n            ch: [ \"<!--\", \"-->\" ]\r\n        },\r\n        syntax_word_dabbrev: /^[\\p{N}_$\\p{L}:#-]$/u,\r\n        syntax_word_sexp: /^[\\p{N}_$\\p{L}:#-]$/u,\r\n    });\r\n    return function() {\r\n        if (!was_paren_match)\r\n            this.cmd(\"paren_match_mode\", false);\r\n        this.popKeymap(Ymacs_Keymap_XML);\r\n        this.setq(changed_vars);\r\n        this.setTokenizer(tok);\r\n    };\r\n};\r\n\r\nYmacs_Buffer.newMode(\"xml_mode\", markup_mode(\"xml\"));\r\nYmacs_Buffer.newMode(\"html_mode\", markup_mode(\"html\"));\r\nYmacs_Buffer.newMode(\"twig_html_mode\", markup_mode(\"twig_html\"));\r\n\r\nclass Ymacs_Lang_XML extends Ymacs_BaseLang {\r\n    _tags = NIL;\r\n    _inTag = null;\r\n    _inline = 0;\r\n\r\n    COMMENT = [\r\n        [ \"<!--\", \"-->\", \"-\" ],\r\n        [ \"<![CDATA[\", \"]]>\", null,\r\n          \"xml-cdata-starter\", \"xml-cdata\", \"xml-cdata-stopper\" ]\r\n    ];\r\n    NAME = /^[\\p{L}:_$-][\\p{L}0-9:_$-]*/iu;\r\n    OPEN_PAREN = {\r\n        \"(\" : \")\",\r\n        \"{\" : \"}\",\r\n        \"[\" : \"]\",\r\n        \"\" : \"\",\r\n        \"\" : \"\",\r\n        \"\" : \"\",\r\n    };\r\n    CLOSE_PAREN = {\r\n        \")\" : \"(\",\r\n        \"}\" : \"{\",\r\n        \"]\" : \"[\",\r\n        \"\" : \"\",\r\n        \"\" : \"\",\r\n        \"\" : \"\",\r\n    };\r\n\r\n    constructor({ stream, tok, emptyTags, inline }) {\r\n        super({ stream, tok });\r\n        this.emptyTags = emptyTags;\r\n        this.inline = inline;\r\n    }\r\n\r\n    copy() {\r\n        let _super = super.copy();\r\n        let _tags = this._tags;\r\n        let _inTag = this._inTag;\r\n        let _inline = this._inline;\r\n        return () => {\r\n            let self = _super();\r\n            self._tags = _tags;\r\n            self._inTag = _inTag;\r\n            self._inline = _inline;\r\n            return self;\r\n        };\r\n    }\r\n\r\n    read() {\r\n        (this.readComment() ||\r\n         this.readDeclaration() ||\r\n         this.readCloseTag() ||\r\n         this.readOpenTag() ||\r\n         this.readOpenParen() ||\r\n         this.readCloseParen() ||\r\n         this.readTrailingWhitespace() ||\r\n         this.t(null, 1, this._stream.peek() != \" \"));\r\n    }\r\n\r\n    t(type = null, len = 1, addInline) {\r\n        if (addInline && this.inline) {\r\n            let cls = this.inline.cls(this._inline);\r\n            if (cls != null) {\r\n                type = cls + (type != null ? \" \" + type : \"\");\r\n            }\r\n        }\r\n        this.token({\r\n            line: this._stream.line,\r\n            c1: this._stream.col,\r\n            c2: this._stream.col += len,\r\n        }, type);\r\n    }\r\n\r\n    readDeclaration() {\r\n        let s = this._stream, m = s.lookingAt(/^<[?!]/);\r\n        if (m) {\r\n            let sp = m[0];\r\n            this.pushInParen(sp, \"xml-open-bracket\");\r\n            this.pushCont(() => {\r\n                let m = s.lookingAt(/^\\??>/);\r\n                if (m) {\r\n                    this.popInParen(sp, m[0].length, \"xml-close-bracket\");\r\n                    this.popCont();\r\n                } else {\r\n                    this.readString() || this.readTrailingWhitespace() || this.t(\"directive\");\r\n                }\r\n            });\r\n            return true;\r\n        }\r\n    }\r\n\r\n    readOpenTag() {\r\n        let s = this._stream;\r\n        if (s.lookingAt(\"<\") && this.NAME.test(s.peek(+1))) {\r\n            let outer = { l1: s.line, c1: s.col };\r\n            this.pushInParen(\"<\", \"xml-open-bracket\");\r\n            let tag = this.maybeName(\"xml-open-tag\");\r\n            tag.outer = outer;\r\n            this._inTag = tag;\r\n            this.pushCont(this.contOpenTag);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    contOpenTag() {\r\n        let s = this._stream;\r\n        let ch = s.peek(), name;\r\n        if (s.lookingAt(\"/>\")) {\r\n            this.popInParen(\"<\", 2, \"xml-close-bracket\");\r\n            this.popCont();\r\n            this._inTag = null;\r\n        }\r\n        else if (ch === \">\") {\r\n            this.popInParen(\"<\", 1, \"xml-close-bracket\");\r\n            this.popCont();\r\n            if (!this.emptyTags?.test(this._inTag.id)) {\r\n                this._inTag.inner = { l1: s.line, c1: s.col };\r\n                this.pushTag(this._inTag);\r\n                if (this.inline) {\r\n                    this._inline ^= this.inline.code(this._inTag.id);\r\n                }\r\n            }\r\n            this._inTag = null;\r\n        }\r\n        else if ((name = this.maybeName(\"xml-attribute\"))) {\r\n        }\r\n        else if (ch === '\"' || ch === \"'\") {\r\n            this.readString();\r\n        }\r\n        else {\r\n            this.readTrailingWhitespace() || this.t();\r\n        }\r\n    }\r\n\r\n    readCloseTag() {\r\n        let s = this._stream;\r\n        if (s.lookingAt(\"</\") && this.NAME.test(s.peek(+2))) {\r\n            let otag = this.popTag();\r\n            if (otag) {\r\n                otag.inner.l2 = s.line;\r\n                otag.inner.c2 = s.col;\r\n                if (this.inline) {\r\n                    this._inline ^= this.inline.code(otag.id);\r\n                }\r\n            }\r\n            this.pushInParen(\"</\", \"xml-open-bracket\");\r\n            let ctag = this.readName();\r\n            this.token(ctag, otag?.id == ctag.id ? \"xml-close-tag\" : \"error\");\r\n            if (otag) {\r\n                let popen = { line: otag.line, c1: otag.c1, c2: otag.c2, type: otag.id,\r\n                              inner: otag.inner, outer: otag.outer };\r\n                let pclose = { line: ctag.line, c1: ctag.c1, c2: ctag.c2, opened: popen };\r\n                popen.closed = pclose;\r\n                this.doneParen(popen);\r\n            }\r\n            this.pushCont(this.contCloseTag.bind(this, otag));\r\n            return true;\r\n        }\r\n    }\r\n\r\n    contCloseTag(otag) {\r\n        let s = this._stream, m = s.lookingAt(/^([\\s\\xA0]*)(>?)/);\r\n        if (m && m[0]) {\r\n            if (m[1]) this.t(null, m[1].length);\r\n            if (m[2]) {\r\n                this.popInParen(\"</\", 1, \"xml-close-bracket\");\r\n                this.popCont();\r\n                if (otag) {\r\n                    otag.outer.l2 = s.line;\r\n                    otag.outer.c2 = s.col;\r\n                }\r\n            }\r\n        } else {\r\n            this.readTrailingWhitespace() || this.t(\"error\");\r\n        }\r\n    }\r\n\r\n    indentation() {\r\n        let s = this._stream;\r\n        var indent, lastTag;\r\n\r\n        let INDENT_LEVEL = () => this._stream.buffer.getq(\"indent_level\");\r\n\r\n        if (this._inComment) {\r\n            indent = s.lineIndentation(this._inComment.line) + INDENT_LEVEL();\r\n        }\r\n        else if (this._inTag) {\r\n            var txt = s.lineText(this._inTag.line);\r\n            if (/^\\s*$/.test(txt.substr(0, this._inTag.c1 - 1))) {\r\n                indent = this._inTag.c1 + this._inTag.id.length + 1;\r\n            } else {\r\n                indent = s.lineIndentation(this._inTag.line);\r\n            }\r\n        }\r\n        else if ((lastTag = this._tags.car)) {\r\n            indent = s.lineIndentation(lastTag.line);\r\n            if (!/^\\s*<\\x2f/.test(s.lineText()))\r\n                indent += INDENT_LEVEL();\r\n        }\r\n\r\n        if (indent == null) {\r\n            let line = s.line;\r\n            while (line > 0 && !/\\S/.test(s.lineText(line))) line--;\r\n            indent = s.lineIndentation(line);\r\n        }\r\n\r\n        return indent;\r\n    }\r\n\r\n    pushTag(tag) {\r\n        this._tags = new Cons(tag, this._tags);\r\n    }\r\n    popTag() {\r\n        let tag = this._tags.car;\r\n        this._tags = this._tags.cdr;\r\n        return tag;\r\n    }\r\n    get tag() {\r\n        return this._tags.car;\r\n    }\r\n}\r\n\r\nclass Ymacs_Lang_HTML extends Ymacs_Lang_XML {\r\n    _mode = this;\r\n    _js = this._tok.getLanguage(\"js\");\r\n    _css = this._tok.getLanguage(\"css\");\r\n\r\n    get passedParens() {\r\n        return [\r\n            ...super.passedParens,\r\n            ...this._js.passedParens,\r\n            ...this._css.passedParens,\r\n        ];\r\n    }\r\n\r\n    next() {\r\n        let s = this._stream;\r\n        if (this._mode === this && this.tag) {\r\n            if (this.tag.id == \"script\") this._mode = this._js;\r\n            if (this.tag.id == \"style\") this._mode = this._css;\r\n        }\r\n        if (this._mode === this._js && s.lookingAt(\"</script\")) {\r\n            this._mode = this;\r\n        }\r\n        if (this._mode === this._css && s.lookingAt(\"</style\")) {\r\n            this._mode = this;\r\n        }\r\n        this._mode === this ? super.next() : this._mode.next();\r\n    }\r\n\r\n    copy() {\r\n        let _super = super.copy();\r\n        let _js = this._js.copy();\r\n        let _css = this._css.copy();\r\n        let _mode = this._mode;\r\n        return () => {\r\n            let self = _super();\r\n            self._js =_js();\r\n            self._css = _css();\r\n            self._mode = _mode;\r\n            return self;\r\n        };\r\n    }\r\n\r\n    indentation() {\r\n        let s = this._stream;\r\n        let INDENT_LEVEL = () => this._stream.buffer.getq(\"indent_level\");\r\n        if ((this._mode === this) || (!this._mode._inString && /^\\s*<\\//.test(s.lineText()))) {\r\n            let indent = super.indentation();\r\n            let tag = this._tags.car;\r\n            if (tag) {\r\n                let txt = s.lineText(tag.outer.l1).substr(0, tag.outer.c1);\r\n                if (/\\S/.test(txt)) {\r\n                    // there is text before the innermost tag, let's assume\r\n                    // it's inline text and back one level\r\n                    indent -= INDENT_LEVEL();\r\n                }\r\n            }\r\n            return indent > 0 ? indent : 0;\r\n        } else {\r\n            let tag = this.tag;\r\n            if (tag) {\r\n                let line = s.line;\r\n                while (--line > tag.line && !/\\S/.test(s.lineText(line)));\r\n                if (line == tag.line)\r\n                    return s.lineIndentation(line) + this._stream.buffer.getq(\"indent_level\");\r\n            }\r\n            return this._mode.indentation();\r\n        }\r\n    }\r\n}\r\n\r\nconst TWIG_BUILTIN = toHash(`in or and not is defined constant divisible empty\r\neven iterable null true false odd same from as starts with only ends matches`);\r\n\r\nclass Ymacs_Lang_Twig extends Ymacs_BaseLang {\r\n    STRING = [ \"'\", [ '\"', '\"', \"#{\", \"}\" ] ];\r\n    _blocks = NIL;\r\n    _inBlock = null;\r\n    _alt = this._tok.getLanguage(\"html\");\r\n    _mode = this._alt;\r\n\r\n    get passedParens() {\r\n        return [\r\n            ...super.passedParens,\r\n            ...this._alt.passedParens,\r\n        ];\r\n    }\r\n\r\n    copy() {\r\n        let _super = super.copy();\r\n        let _alt = this._alt.copy();\r\n        let _mode = this._mode;\r\n        let _blocks = this._blocks;\r\n        let _inBlock = this._inBlock;\r\n        return () => {\r\n            let self = _super();\r\n            self._alt =_alt();\r\n            self._mode = _mode;\r\n            self._blocks = _blocks;\r\n            self._inBlock = _inBlock;\r\n            return self;\r\n        };\r\n    }\r\n\r\n    next() {\r\n        let s = this._stream, m;\r\n        if (this._mode === this._alt) {\r\n            if ((m = s.lookingAt(/^\\{%-?/))) {\r\n                this._mode = this;\r\n                this.pushCont(this.readBlock.bind(this, m[0]));\r\n            } else if ((m = s.lookingAt(/^\\{\\{-?/))) {\r\n                this._mode = this;\r\n                this.pushInParen(m[0], \"exp-starter\");\r\n                return;\r\n            } else if ((m = s.lookingAt(/^\\{#-?/))) {\r\n                this._alt.readCommentMulti(m[0], /^-?#\\}/, \"#\");\r\n                return this.next();\r\n            }\r\n        } else if ((m = s.lookingAt(/^-?\\}\\}/)) && /^\\{\\{/.test(this._inParens.car?.type)) {\r\n            this.popInParen(this._inParens.car?.type, m[0].length, \"exp-stopper\");\r\n            this._mode = this._alt;\r\n            return this.next();\r\n        }\r\n        this._mode === this ? super.next() : this._alt.next();\r\n    }\r\n\r\n    readCustom() {\r\n        let s = this._stream;\r\n        let filter = /\\|\\s*$/.test(s.textBefore());\r\n        let tok = this.readName();\r\n        if (tok) {\r\n            this.skipWS();\r\n            tok.type = filter || s.lookingAt(\"(\") ? \"function-name\"\r\n                : tok.id in TWIG_BUILTIN ? \"builtin\"\r\n                : null;\r\n            this.token(tok);\r\n            return true;\r\n        }\r\n        return this.readNumber();\r\n    }\r\n\r\n    readBlock(start) {\r\n        let s = this._stream, m;\r\n        if (this._inBlock) {\r\n            this.skipWS();\r\n            if ((m = s.lookingAt(/^-?%\\}/))) {\r\n                this.popInParen(start, m[0].length, \"block-stopper\");\r\n                this._mode = this._alt;\r\n                this.popCont();\r\n                if (this._inBlock.hasBody) {\r\n                    this._inBlock.inner = { l1: s.line, c1: s.col };\r\n                    this.pushBlock(this._inBlock);\r\n                } else if (this._inBlock.outer) {\r\n                    this._inBlock.outer.l2 = s.line;\r\n                    this._inBlock.outer.c2 = s.col;\r\n                }\r\n                this._inBlock = null;\r\n            } else {\r\n                this.read();\r\n            }\r\n        } else {\r\n            let outer = { l1: s.line, c1: s.col };\r\n            this.pushInParen(start, \"block-starter\");\r\n            this.skipWS();\r\n            let ctag = this.readName();\r\n            if (ctag) {\r\n                let isEndTag = /^end/.test(ctag.id);\r\n                if (isEndTag) {\r\n                    let otag = this.popBlock();\r\n                    let name = ctag.id.substr(3);\r\n                    this.token(ctag, otag?.id == name ? \"keyword\" : \"error\");\r\n                    if (otag) {\r\n                        if (otag.inner) {\r\n                            otag.inner.l2 = outer.l1;\r\n                            otag.inner.c2 = outer.c1;\r\n                        }\r\n                        let popen = { line: otag.line, c1: otag.c1, c2: otag.c2, type: otag.id,\r\n                                      inner: otag.inner, outer: otag.outer };\r\n                        let pclose = { line: ctag.line, c1: ctag.c1, c2: ctag.c2, opened: popen };\r\n                        popen.closed = pclose;\r\n                        this.doneParen(popen);\r\n                        this._inBlock = otag; // waiting for %}\r\n                        delete otag.hasBody; // no more body to parse\r\n                    }\r\n                    this.skipWS();\r\n                    if (/^(?:macro|block)$/.test(name)) {\r\n                        let fname = this.readName();\r\n                        if (fname) {\r\n                            this.token(fname, fname.id == otag?.fname?.id ? \"function-name\" : \"error\");\r\n                        }\r\n                        this.skipWS();\r\n                    }\r\n                } else {\r\n                    this.token(ctag, \"keyword\");\r\n                    ctag.outer = outer;\r\n                    this._inBlock = ctag;\r\n                    this.littleParseTag(ctag);\r\n                }\r\n            } else if ((m = s.lookingAt(/^-?%\\}/))) {\r\n                // incomplete input but auto-completed end paren\r\n                this.popInParen(start, m[0].length, \"error\");\r\n                this._mode = this._alt;\r\n                this.popCont();\r\n            } else {\r\n                this.t(\"error\");\r\n                this._inBlock = { hasBody: false };\r\n            }\r\n        }\r\n    }\r\n\r\n    littleParseTag(ctag) {\r\n        let s = this._stream;\r\n        ctag.hasBody = !/^(import|do|from|include|extends|use|else(?:if)?)$/.test(ctag.id);\r\n        this.skipWS();\r\n        if (ctag.id == \"set\") {\r\n            while (this.maybeName(\"variable-name\")) {\r\n                this.skipWS();\r\n                if (s.lookingAt(\",\")) {\r\n                    s.col++;\r\n                    this.skipWS();\r\n                } else break;\r\n            }\r\n            this.skipWS();\r\n            ctag.hasBody = s.lookingAt(/^-?%\\}/);\r\n        } else if (ctag.id == \"block\" || ctag.id == \"macro\") {\r\n            ctag.fname = this.maybeName(\"function-name\");\r\n        }\r\n    }\r\n\r\n    indentation() {\r\n        let s = this._stream;\r\n        let INDENT_LEVEL = () => this._stream.buffer.getq(\"indent_level\");\r\n        if (this._mode === this) {\r\n            return super.indentation();\r\n        } else if (this.block) {\r\n            if (this._mode._inTag) return this._mode.indentation();\r\n            let indent = s.lineIndentation(this.block.line);\r\n            let closing = /^\\s*\\{%-?\\s*(?:end|else)/.test(s.lineText());\r\n            if (closing) return indent;\r\n            if (!this._mode.tag || this._mode.tag.line <= this.block.line)\r\n                return indent + INDENT_LEVEL();\r\n        }\r\n        return this._mode.indentation();\r\n    }\r\n\r\n    pushBlock(block) {\r\n        this._blocks = new Cons(block, this._blocks);\r\n    }\r\n    popBlock() {\r\n        let block = this._blocks.car;\r\n        this._blocks = this._blocks.cdr;\r\n        return block;\r\n    }\r\n    get block() {\r\n        return this._blocks.car;\r\n    }\r\n    get tag() {\r\n        return this._alt.tag;\r\n    }\r\n}\r\n\r\nfunction inlineCode(tag) {\r\n    return (tag == \"i\" || tag == \"em\" ? 1 :\r\n            tag == \"b\" || tag == \"strong\" ? 2 :\r\n            tag == \"a\" ? 4 :\r\n            tag == \"h1\" ? 8 :\r\n            tag == \"h2\" ? 16 :\r\n            tag == \"h3\" ? 32 :\r\n            tag == \"h4\" ? 64 :\r\n            0);\r\n}\r\n\r\nfunction inlineCls(inline) {\r\n    let out = \"\";\r\n    if (inline & 1) out += \" italic\";\r\n    if (inline & 2) out += \" bold\";\r\n    if (inline & 4) out += \" link\";\r\n    if (inline & 8) out += \" heading1\";\r\n    if (inline & 16) out += \" heading2\";\r\n    if (inline & 32) out += \" heading3\";\r\n    if (inline & 64) out += \" heading4\";\r\n    return out.trim() || null;\r\n}\r\n\r\nYmacs_Tokenizer.define(\"xml\", (stream, tok) => new Ymacs_Lang_XML({ stream, tok }));\r\n\r\nYmacs_Tokenizer.define(\"html\", (stream, tok) => new Ymacs_Lang_HTML({\r\n    stream, tok,\r\n    emptyTags: RX_EMPTY_TAG,\r\n    inline: { code: inlineCode, cls: inlineCls },\r\n}));\r\n\r\nYmacs_Tokenizer.define(\"twig_html\", (stream, tok) => new Ymacs_Lang_Twig({ stream, tok }));\r\n\r\nYmacs_Buffer.newCommands({\r\n    xml_limit_fill_paragraph_region: function() {\r\n        // XXX: this function should somehow be a property of the language (for mixed modes),\r\n        // rather than a top-level method. Not yet decided how to best handle this...\r\n        if (!this.tokenizer) return;\r\n        this.tokenizer.finishParsing();\r\n        let blk = this.tokenizer.getPP()\r\n            .filter(caretInside(this._rowcol, \"outer\"))\r\n            .findLast(p => RX_BLOCK_TAG.test(p.type));\r\n        if (blk) {\r\n            let r = {\r\n                begin: this._rowColToPosition(blk.inner.l1, blk.inner.c1),\r\n                end: this._rowColToPosition(blk.inner.l2, blk.inner.c2)\r\n            };\r\n            this.cmd(\"save_excursion\", () => {\r\n                this.cmd(\"goto_char\", r.begin);\r\n                if (this.cmd(\"looking_at\", /[^\\S\\r\\n]*\\n/gy)) {\r\n                    this.cmd(\"goto_char\", this.matchData.after);\r\n                    r.begin = this.point();\r\n                }\r\n                this.cmd(\"goto_char\", r.end);\r\n                if (this.cmd(\"looking_back\", /\\n[^\\S\\r\\n]*/g)) {\r\n                    this.cmd(\"backward_whitespace\");\r\n                    r.end = this.point();\r\n                }\r\n            });\r\n            return r;\r\n        }\r\n    },\r\n    xml_close_tag: Ymacs_Interactive(function() {\r\n        let rc = this._rowcol;\r\n        this.tokenizer.parseUntil(rc.row, rc.col);\r\n        let tag = this.tokenizer.theParser.tag; // XML\r\n        let block = this.tokenizer.theParser.block; // Twig\r\n        let closeTwig = () => {\r\n            this.cmd(\"insert\", `{% end${block.id} %}`);\r\n            this.cmd(\"indent_line\");\r\n        };\r\n        let closeXML = () => {\r\n            this.cmd(\"insert\", `</${tag.id}>`);\r\n            this.cmd(\"indent_line\");\r\n        };\r\n        if (!tag && !block) return;\r\n        if (!tag && block) return closeTwig();\r\n        if (!block && tag) return closeXML();\r\n        if (compareRowCol(block, tag) < 0) return closeXML();\r\n        closeTwig();\r\n    }),\r\n    xml_slash_complete_tag: Ymacs_Interactive(function() {\r\n        this.cmd(\"self_insert_command\");\r\n        if (this.looking_back(\"</\")) {\r\n            let rc = this._rowcol;\r\n            this.tokenizer.parseUntil(rc.row, rc.col);\r\n            let tag = this.tokenizer.theParser.tag;\r\n            if (tag) {\r\n                this._placeUndoBoundary();\r\n                this.cmd(\"insert\", tag.id, \">\");\r\n                this.cmd(\"indent_line\");\r\n            }\r\n        }\r\n    }),\r\n    xml_gt_complete_tag: Ymacs_Interactive(function() {\r\n        this.cmd(\"self_insert_command\");\r\n        let rc = this._rowcol;\r\n        this.tokenizer.parseUntil(rc.row, rc.col);\r\n        let tag = this.tokenizer.theParser.tag;\r\n        if (tag?.inner?.l1 == rc.row && tag.inner.c1 == rc.col) {\r\n            this._placeUndoBoundary();\r\n            let pos = this.point();\r\n            this.cmd(\"insert\", \"</\", tag.id, \">\");\r\n            this.cmd(\"goto_char\", pos);\r\n        }\r\n    }),\r\n    xml_newline_and_indent: Ymacs_Interactive(function(){\r\n        let inparens = this.looking_at(\"</\") && this.looking_back(\">\");\r\n        this.cmd(\"newline_and_indent\");\r\n        if (inparens) {\r\n            this.cmd(\"newline_and_indent\");\r\n            this.cmd(\"backward_line\");\r\n            this.cmd(\"indent_line\");\r\n        }\r\n    }),\r\n    twig_insert_percent: Ymacs_Interactive(function(){\r\n        this.cmd(\"self_insert_command\");\r\n        let rc = this._rowcol;\r\n        this.tokenizer.parseUntil(rc.row, rc.col);\r\n        let mode = this.tokenizer.theParser._mode;\r\n        if (mode instanceof Ymacs_Lang_Twig && this.looking_back(\"{%\")) {\r\n            this._placeUndoBoundary();\r\n            this.cmd(\"insert\", \"  %\");\r\n            this.cmd(\"backward_char\", 2);\r\n        }\r\n    }),\r\n    twig_block_toggle_whitespace: Ymacs_Interactive(function(){\r\n        this.tokenizer.finishParsing();\r\n        let p = this.tokenizer.getPP()\r\n            .filter(caretInside(this._rowcol))\r\n            .filter(x => /^\\{[{%#]/.test(x.type)).at(-1);\r\n        if (p?.closed) {\r\n            let doFront = () => {\r\n                if (this.looking_back(\"-\")) {\r\n                    this.cmd(\"backward_delete_char\");\r\n                } else {\r\n                    this.cmd(\"insert\", \"-\");\r\n                }\r\n            };\r\n            let doBack = () => {\r\n                if (this.looking_at(\"-\")) {\r\n                    this.cmd(\"delete_char\");\r\n                } else {\r\n                    this.cmd(\"insert\", \"-\");\r\n                }\r\n            };\r\n            this.cmd(\"save_excursion\", () => {\r\n                this.cmd(\"goto_char\", this._rowColToPosition(p.closed.line, p.closed.c1));\r\n                doBack();\r\n                this.cmd(\"goto_char\", this._rowColToPosition(p.line, p.c2));\r\n                doFront();\r\n            });\r\n        }\r\n    }),\r\n});\r\n\r\n/*------------- zen mode -------------*/\r\n\r\n// not sure \"zen mode\" is of any interest these days, but let's leave it for now.\r\nlet Ymacs_Keymap_XML_Zen = Ymacs_Keymap.define(\"xml_zen\", {\r\n    \"Tab\"   : \"xml_zen_next_poi\",\r\n    \"S-Tab\" : \"xml_zen_prev_poi\",\r\n    \"C-g\"   : \"xml_zen_stop\"\r\n});\r\n\r\nlet MODE_TYPE = 1, MODE_CLASS = 2, MODE_ID = 3, MODE_REPEAT = 4, MODE_ATTR = 5;\r\n\r\nfunction zen_render(el, html) {\r\n    var n = el.repeat || 1;\r\n    for (var i = 1; i <= n; ++i) {\r\n        if (i > 1)\r\n            html(\"\\n\");\r\n        html(\"<\", el.type);\r\n        if (el.id) {\r\n            html(' id=\"', el.id.replace(/\\$/g, i), '\"');\r\n        }\r\n        if (el.klass) {\r\n            html(' class=\"', el.klass.replace(/\\$/g, i), '\"');\r\n        }\r\n        if (el.attributes) {\r\n            el.attributes.forEach(attr => html(\" \", attr, '=\"|\"'));\r\n        }\r\n        html(\">\");\r\n        if (el.child) {\r\n            html(\"\\n\");\r\n            zen_render(el.child, html);\r\n            html(\"\\n\");\r\n        } else {\r\n            html(\"|\");\r\n        }\r\n        html(\"</\", el.type, \">\");\r\n        if (el.next) {\r\n            html(\"\\n\");\r\n            zen_render(el.next, html);\r\n        }\r\n    }\r\n};\r\n\r\nfunction zen_parse(str, i) {\r\n    var el = { type: \"\" }, mode = MODE_TYPE;\r\n    OUTER: while (i < str.length) {\r\n        var ch = str.charAt(i++);\r\n        switch (ch) {\r\n\r\n          case \"#\":\r\n            mode = MODE_ID;\r\n            el.id = \"\";\r\n            break;\r\n\r\n          case \".\":\r\n            mode = MODE_CLASS;\r\n            if (el.klass != null) {\r\n                el.klass += \" \";\r\n            } else {\r\n                el.klass = \"\";\r\n            }\r\n            break;\r\n\r\n          case \":\":\r\n            mode = MODE_ATTR;\r\n            if (el.attributes == null)\r\n                el.attributes = [];\r\n            el.attributes.push(\"\");\r\n            break;\r\n\r\n          case \"*\":\r\n            mode = MODE_REPEAT;\r\n            el.repeat = \"\";\r\n            break;\r\n\r\n          case \">\":\r\n            el.child = zen_parse(str, i);\r\n            i = el.child.i;\r\n            break OUTER;\r\n\r\n          case \"(\":\r\n            el.child = zen_parse(str, i);\r\n            i = el.child.i;\r\n            break;\r\n\r\n          case \")\":\r\n            break OUTER;\r\n\r\n          case \"+\":\r\n            el.next = zen_parse(str, i);\r\n            i = el.next.i;\r\n            break OUTER;\r\n\r\n          default:\r\n            switch (mode) {\r\n              case MODE_TYPE:\r\n                el.type += ch;\r\n                break;\r\n              case MODE_CLASS:\r\n                el.klass += ch;\r\n                break;\r\n              case MODE_ID:\r\n                el.id += ch;\r\n                break;\r\n              case MODE_REPEAT:\r\n                el.repeat = parseInt(String(el.repeat) + ch, 10);\r\n                break;\r\n              case MODE_ATTR:\r\n                el.attributes.push(el.attributes.pop() + ch);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    el.i = i;\r\n    return el;\r\n};\r\n\r\nfunction maybe_stop_zen() {\r\n    var point = this.point(),\r\n    a = this.getq(\"xml_zen_markers\"),\r\n    start = a[0],\r\n    end = a.at(-1);\r\n    if (point < start.getPosition() || point > end.getPosition() || end.getPosition() == a.at(-2).getPosition()) {\r\n        this.cmd(\"xml_zen_stop\");\r\n    }\r\n};\r\n\r\nYmacs_Buffer.newCommands({\r\n\r\n    xml_zen_expand: Ymacs_Interactive(function() {\r\n        this.cmd(\"xml_zen_stop\");\r\n        var html = \"\";\r\n        var start = this.cmd(\"save_excursion\", function() {\r\n            this.cmd(\"backward_whitespace\");\r\n            while (!this.cmd(\"looking_back\", /[\\x20\\xa0\\s\\t\\n;&]/g))\r\n                if (!this.cmd(\"backward_char\")) break;\r\n            return this.point();\r\n        });\r\n        var point = this.point();\r\n\r\n        try {\r\n            zen_render(\r\n                zen_parse(\r\n                    this.cmd(\"buffer_substring\", start, point).trim(), 0\r\n                ),\r\n                (...args) => html += args.join(\"\")\r\n            );\r\n        } catch(ex) {\r\n            throw new Ymacs_Exception(\"The Zen is not strong today :-/\");\r\n        }\r\n\r\n        this.cmd(\"delete_region\", start, point);\r\n        this.cmd(\"insert\", html);\r\n        start = this.createMarker(start, false, \"xml_zen\");\r\n\r\n        // locate points of interest\r\n        var end = this.createMarker(this.point(), true, \"xml_zen\"), markers = [];\r\n        this.cmd(\"goto_char\", start.getPosition());\r\n        while (this.cmd(\"search_forward\", \"|\", end.getPosition())) {\r\n            this.cmd(\"backward_delete_char\");\r\n            markers.push(this.createMarker(this.point(), true, \"xml_zen_start\"));\r\n            markers.push(this.createMarker(this.point(), false, \"xml_zen_end\"));\r\n        }\r\n\r\n        this.cmd(\"indent_region\", start.getPosition(), end.getPosition());\r\n\r\n        var count = markers.length;\r\n        if (count > 0) {\r\n            // move to first POI\r\n            this.cmd(\"goto_char\", markers[0]);\r\n            markers.unshift(start);\r\n            markers.push(end);\r\n            this.setq(\"xml_zen_markers\", markers);\r\n            this.pushKeymap(Ymacs_Keymap_XML_Zen);\r\n            this.addEventListener(\"afterInteractiveCommand\", maybe_stop_zen);\r\n        } else {\r\n            start.destroy();\r\n            end.destroy();\r\n        }\r\n    }),\r\n\r\n    xml_zen_stop: Ymacs_Interactive(function(){\r\n        var tmp = this.getq(\"xml_zen_markers\");\r\n        if (tmp) {\r\n            tmp.map(m => m.destroy());\r\n            this.setq(\"xml_zen_markers\", null);\r\n        }\r\n        this.popKeymap(Ymacs_Keymap_XML_Zen);\r\n        this.removeEventListener(\"afterInteractiveCommand\", maybe_stop_zen);\r\n    }),\r\n\r\n    xml_zen_next_poi: Ymacs_Interactive(function(){\r\n        let markers = this.getq(\"xml_zen_markers\"), pos = this.point();\r\n        for (let i = 0; i < markers.length; ++i) {\r\n            let m = markers[i];\r\n            if (m.getPosition() > pos) {\r\n                this.cmd(\"goto_char\", m.getPosition());\r\n                break;\r\n            }\r\n        }\r\n    }),\r\n\r\n    xml_zen_prev_poi: Ymacs_Interactive(function(){\r\n        let markers = this.getq(\"xml_zen_markers\"), pos = this.point();\r\n        for (let i = markers.length; --i >= 0;) {\r\n            let m = markers[i];\r\n            if (m.getPosition() < pos) {\r\n                this.cmd(\"goto_char\", m.getPosition());\r\n                break;\r\n            }\r\n        }\r\n    }),\r\n\r\n});\r\n"],"names":["$08a06a2e99accb03$var$OVERLAY","$08a06a2e99accb03$var$TEMPLATE","document","createElement","$08a06a2e99accb03$var$Raw","constructor","value","_value","toString","valueOf","$08a06a2e99accb03$export$cb0933279c36a66b","fromHTML","html","innerHTML","trim","cont","content","children","length","addClass","el","cls","classList","add","delClass","RegExp","className","replace","remove","hasClass","contains","condClass","cond","clsTrue","clsFalse","toggle","toggleClass","args","trash","on","element","event","handler","options","addEventListener","Object","keys","forEach","ev","off","removeEventListener","overlayOn","body","appendChild","overlayOff","mousePos","box","getBoundingClientRect","x","clientX","left","y","clientY","top","relPos","src","tgt","offsetParent","srcbox","tgtbox","htmlEscape","str","htmlSafe","$08a06a2e99accb03$var$nextDone","next","done","$08a06a2e99accb03$export$d5414a779ebfba6b","car","cdr","Symbol","iterator","$08a06a2e99accb03$export$74c44e616647f5c0","p","count","$08a06a2e99accb03$export$76712d54f90f7348","_ev_handlers","create","o","assign","a","_getHandlers","$08a06a2e99accb03$export$cd7f480d6b8286c3","push","listenOnce","fn","apply","callHooks","f","destroy","$08a06a2e99accb03$export$a829527ff4e4114a","initClassName","_ymacs_object","name","getContentElement","getElement","thing","setContent","setStyle","prop","val","style","getBox","arguments","array","pos","indexOf","splice","$08a06a2e99accb03$export$ad41d882ec94ba04","timeout","obj","bind","timer","clearTimeout","setTimeout","$08a06a2e99accb03$export$e1a3971de07c83b5","number","fixed","spec","r","sz","$08a06a2e99accb03$var$$1K","$08a06a2e99accb03$var$$1M","$08a06a2e99accb03$var$$1G","Math","round","toFixed","$08a06a2e99accb03$export$3d93c1b4c8f9bdcb","split","$08a06a2e99accb03$export$da43f679ba2e9167","reduce","key","i","$08a06a2e99accb03$export$90e79c6ee773013e","mods","join","$c35b14db10f870d1$export$57a830c2aa4f8317","editor","before","position","markers","rowcol","onChange","editorChange","diff","min","arg","call","getPosition","setPosition","noHooks","force","getRowCol","_positionToRowCol","swap","other","tmp","$d9a61832b63ddf79$var$KEYMAPS","$d9a61832b63ddf79$export$6b6e17e3540cb3d2","definitions","defineKeys","define","get","parseKey","orig","m","exec","ctrlKey","metaKey","shiftKey","substr","toLowerCase","unparseKey","wheelDelta","code","altKey","ymacsMeta","toUpperCase","sort","defineKey","func","Array","slice","dfn","pop","map","getHandler","def","isArray","attached","detached","$541ef653595620bf$export$c411e7bd03572a3a","why","message","$92bab0a532b3076f$export$1c2a1b3d78098030","documentation","Function","ymacsDoc","ymacsInteractive","ymacsMarkExtend","ymacsWarnReadonly","ymacsSelectFrame","collect","execute","rest","concat","callInteractively","$92bab0a532b3076f$var$createArgumentFunction","reader","$92bab0a532b3076f$var$ARG_READERS","charAt","ymacsCallInteractively","$92bab0a532b3076f$export$8c34793404b3efcb","n","prototype","$92bab0a532b3076f$var$$TRUE","$92bab0a532b3076f$var$prompt","pr","getPrefixArg","cmd","$92bab0a532b3076f$var$read_arbitrary_text","$92bab0a532b3076f$var$read_number","empty","console","log","b","B","c","C","d","point","e","k","K","markMarker","M","N","parseInt","isNaN","P","getRegion","begin","end","s","U","v","F","G","D","$2a60837ab2b03436$var$minibuffer_keys","$2a60837ab2b03436$var$emacs_keys","$2a60837ab2b03436$export$649e07e86b62d08f","defaultHandler","$2a60837ab2b03436$export$e144e07a20daa9d","$2a60837ab2b03436$export$7f1c7eed09402475","interactiveEvent","ch","prefix","test","popKeymap","setPrefixArg","isMinibuffer","whenMinibuffer","mb","buffer","$9e9d7d2dbe50ab17$export$bdebb5ddaa01123f","reset","props","insertLine","row","deleteLine","replaceLine","text","addLineProps","j","changed","removeLineProps","spliceLineProps","getLineHTML","caret","last","ret","css","prev","$5e779a545e33325b$var$GLOBAL_VARS","case_fold_search","case_replace","line_movement_requested_col","fill_column","tab_width","indent_level","sticky_mark","syntax_word","syntax_capitalize_word","syntax_word_dabbrev","syntax_word_sexp","syntax_paragraph_sep","$5e779a545e33325b$var$setq","undefined","ymacsCommand","$5e779a545e33325b$var$MRK","$5e779a545e33325b$export$df331bdfc76955b4","ymacs","tokenizer","COMMANDS","newCommands","replaceCommands","cmds","replacements","oldcmd","newcmd","newMode","activate","modevar","hookvar","setGlobal","status","getq","hook","setq","modes","getVariable","setVariable","$5e779a545e33325b$export$36a0d48d1b18d0fa","__savingExcursion","__preventUpdates","__preventUndo","__undoInProgress","__dirtyLines","__undoQueue","__undoPointer","caretMarker","createMarker","matchData","previousCommand","currentCommand","currentKeys","variables","globalVariables","_rowcol","_tokenizerEvents","_on_tokenizerFoundToken","_textProperties","_on_textPropertiesChange","keymap","pushKeymap","makeDefaultKeymap","setCode","_lastCommandWasKill","addModeHook","pushUnique","removeModeHook","withVariables","vars","saved","cmdApply","withCommands","lastIndexOfRegexp","rx","bound","match","global","source","flags","lastIndex","after","skipOne","signalError","isHtml","indicateError","type","signalInfo","popupMessage","dirty","__isDirty","updateModeline","__code","__size","forAllFrames","frame","ensureCaretVisible","redrawModelineWithTimer","setTokenizer","tok","getCode","getCodeSize","size","getLine","charAtRowCol","col","line","rc","finalArgs","sameCommandCount","_placeUndoBoundary","preventUpdates","clearTransientMark","ex","ensureTransientMark","resumeUpdates","start","resetOverwriteMode","om","overwriteMode","getMinibuffer","whenYmacs","minibuffer","getMinibufferFrame","minibuffer_frame","setMinibuffer","forEachLine","c1","c2","getActiveFrame","when","what","whenActiveFrame","fr","activeFrame","getBufferFrames","withMarkers","max","redrawDirtyLines","draw","setOverlay","deleteOverlay","setMark","tm","transientMarker","line1","col1","line2","col2","deleteTransientRegion","_deleteText","noDiscard","renderModelineContent","percent","ml","custom","_recordChange","len","q","shift","at","_playbackUndo","action","didit","_insertText","_replaceLine","_deleteLine","quickDeleteLine","_insertLine","quickInsertLine","drawIt","lines","ln","_updateMarkers","_boundPosition","_bufferSubstring","brc","erc","_replaceText","_swapAreas","b1","e1","b2","e2","t1","t2","substring","_killingAction","p1","p2","prepend","noDelete","_saveKilledText","killRingToMaster","pushToKillRing","navigator","clipboard","writeText","killRingText","_rowColToPosition","_repositionCaret","offset","delta","truncate","_saveExcursion","markerBefore","_disableUndo","_handleKeyEvent","handled","lcwk","__nextIsMeta","cc","foundPrefix","km","h","bold","formatLineHTML","looking_at","needle","haystack","index","looking_back","capitalize","_","promptMarker","whatever","prompt","$ec4394da1a74075f$var$MENU","$ec4394da1a74075f$export$731251e1d39d8621","_cont","$ec4394da1a74075f$var$KEYMAP_MENU_ACTIVE","$ec4394da1a74075f$var$handle_arrow_down","$ec4394da1a74075f$var$handle_arrow_up","$ec4394da1a74075f$var$select","$ec4394da1a74075f$var$handle_enter","menu","kill","selectedIndex","onSelect","elements","widget","querySelectorAll","current","dataset","selectedItem","scrollIntoView","block","popup_menu","$ec4394da1a74075f$export$7b89d1d66e79a77c","items","menuWidget","label","activeElement","click","focus","item","target","_popupAtCaret","$9526afefc19b5eea$var$CLICK_COUNT","$9526afefc19b5eea$var$CLICK_COUNT_TIMER","$9526afefc19b5eea$var$CLEAR_CLICK_COUNT","$9526afefc19b5eea$var$LINE_DIV","$9526afefc19b5eea$var$COUNT","$9526afefc19b5eea$export$3230e5a51f22d844","id","__caretId","redrawModeline","tabIndex","onDestroy","_on_destroy","_dragSelectHandlers","mousemove","_dragSelect_onMouseMove","mouseup","_dragSelect_onMouseUp","_bufferEvents","onLineChange","_on_bufferLineChange","onInsertLine","_on_bufferInsertLine","onDeleteLine","_on_bufferDeleteLine","onPointChange","_on_bufferPointChange","onResetCode","_on_bufferResetCode","onOverwriteMode","_on_bufferOverwriteMode","onModelineChange","_on_bufferModelineChange","beforeInteractiveCommand","_on_bufferBeforeInteractiveCommand","afterInteractiveCommand","_on_bufferAfterInteractiveCommand","onOverlayChange","_on_bufferOverlayChange","onOverlayDelete","_on_bufferOverlayDelete","_moreBufferEvents","onMessage","_on_bufferMessage","__ensureCaretVisible","setBuffer","getOverlaysContainer","_on_scroll","mousedown","_dragSelect_onMouseDown","_on_focus","blur","_on_blur","keydown","_on_keyDown","keyup","_on_keyUp","wheel","_on_mouseWheel","exitAllowed","firstChild","getModelineElement","childNodes","getCaretElement","getElementById","getLineDivElement","div","st","scrollTop","redrawCaret","inline","offsetLeft","clientWidth","scrollLeft","focusInside","_redrawBuffer","centerOnCaret","recenterTopBottom","center","offsetTop","clientHeight","offsetHeight","bottom","centerOnLine","setModelineContent","deleteOtherFrames","keepOnlyFrame","deleteFrame","_split","horiz","ovdiv","scroll","createFrame","sc","$9526afefc19b5eea$export$7b0e4d18ade0c4c9","replaceWith","setSplit","vsplit","hsplit","__showCaret","isActive","__prevCaretLine","_getLineHTML","coordinatesToRowCol","self","findLine","r1","r2","floor","y1","y2","findCol","coordinates","$9526afefc19b5eea$var$textColX","range","createRange","selectNodeContents","treeWalker","createTreeWalker","NodeFilter","SHOW_TEXT","nextNode","node","currentNode","clen","nodeValue","setStart","setEnd","right","heightInLines","maxline","firstline","firstLineVisible","lastline","lastLineVisible","cloneNode","insertBefore","clearPopupMessage","getOverlayId","getOverlayHTML","p0","getOverlaysCount","old","_setOverlayClasses","names","ymacsOverlay","ymacsOverlays","setActiveFrame","button","stopPropagation","preventDefault","buf","window","processKeyEvent","scrollUp","scrollDown","_dragHandlers","_onMouseMove","_onMouseUp","_rb","_onMouseDown","frac","gridTemplateRows","gridTemplateColumns","first","_start","_orig_sz","offsetWidth","$2f9db344d0795d0e$var$minElement","minEl","minValue","minIndex","$2f9db344d0795d0e$var$selectClosestFrameX","byx","abs","height","$2f9db344d0795d0e$var$selectClosestFrameY","byy","width","$2f9db344d0795d0e$export$e2cc12c8ba83ca65","buffers","frames","cf_frameStyle","ls_keyName","registers","_addBufferListeners","killRing","killMasterOfRings","__macro_recording","__macro_finished","__error_thrown","__running_macro","__macro_times","__macro_step","__macro_timer","__input_frame","hidden","createBuffer","getActiveBuffer","nextHiddenBuffer","unshift","rotateKillRing","getBuffer","find","killBuffer","renameBuffer","_do_switchToBuffer","switchToBuffer","maybeName","cur","filter","switchToNextBuffer","switchToPreviousBuffer","getNextBuffer","getPrevBuffer","setFrameStyle","parentNode","parent","querySelector","focusOtherFrame","getMainElement","getFrameConfig","dig","scrollHeight","active","layout","getComputedStyle","setFrameConfig","config","bufferName","getFrame","findIndex","ops","main","frame1","frame2","firstElementChild","reverse","setInputFrame","nofocus","setColorTheme","themeId","cursorBar","cursorBlock","toggleBarCursor","getFrameInDirection","dir","_get_frameInDir_left","_get_frameInDir_right","_get_frameInDir_up","_get_frameInDir_down","ls_get","ls_store","JSON","parse","localStorage","getItem","ls_set","setItem","stringify","ls_getFileContents","nothrow","info","ls_getFileDirectory","ls_setFileContents","files","store","back","path","part","hasOwn","full","ls_deleteFile","fs_normalizePath","fs_fileType","fs_getFileContents","fs_setFileContents","stamp","fs_sortDirectoryEntries","adir","bdir","aobj","fs_isObjectFileName","bobj","filename","fs_getDirectory","dirname","fs_deleteFile","fs_remapDir","isRunningMacro","isRecordingMacro","startMacro","do_append","stopMacro","getLastMacro","stepMacro","runMacro","times","macro","atCaret","popup","__popup","removeProperty","requestFullScreen","requestFullscreen","visibility","mybox","cbox","cbox_center","mybox_center","transform","jumpToRegister","reg","makeDialog","dlg","$2f9db344d0795d0e$export$d74b4745301088ce","$2f9db344d0795d0e$var$cssSize","draggable","resizable","closable","centered","resize","_closeClick","_dragMouseMove","_dragMouseUp","_dragMouseDown","close","_dragging","mouse","drg","dx","dy","$c749180882ef16eb$export$2f1022027d35d1bb","nextLine","prevLine","peek","lineText","lineIndentation","lookingAt","textBefore","textAfter","eol","eof","l","stopAt","stop","EOF","__stop","lineLength","save","restore","state","checkStop","EOL","$c749180882ef16eb$export$825fc0b420d392c1","is_whitespace","read_while","pred","skip_ws","$c749180882ef16eb$var$LANGUAGES","$c749180882ef16eb$export$3964ae1c660db960","stream","theParser","parsers","copy","timerUpdate","getLanguage","doit","onToken","getParserForLine","parseUntil","reparseAll","finishParsing","getLastParser","getIndentation","indentation","getPP","pp","passedParens","$c749180882ef16eb$export$2b0c642afb0ae4ca","$c749180882ef16eb$export$f6a9bcac20db9551","zone","closed","outer","l1","l2","inner","$c7731ae7d5abaea3$var$help_keymap","$c7731ae7d5abaea3$var$read_register_keymap","apply_on_rectangle","ws","forward_char","backward_char","forward_line","backward_line","forward_whitespace","noLine","backward_whitespace","beginning_of_line","back_to_indentation","beginning_of_indentation_or_line","end_of_line","beginning_of_buffer","end_of_buffer","eob_p","bob_p","eol_p","bol_p","backward_delete_char","delete_char","delete_whitespace","backward_delete_whitespace","delete_indentation","universal_argument","overwrite_mode","self_insert_command","repeat","newline","newline_and_indent","stupid_indent","indent_line","noEmpty","indent","ci","indent_region","make_marker","search_forward","search_backward","lastIndexOf","make_regexp","matchCase","search_forward_regexp","search_backward_regexp","forward_word","backward_word","forward_paragraph","backward_paragraph","mark_paragraph","transpose_words","transpose_lines","transpose_chars","kill_word","pos2","backward_kill_word","_apply_operation_on_word","op","word","capitalize_word","downcase_word","String","upcase_word","goto_char","goto_line","move_to_column","delete_region","insert","keyboard_quit","buffer_substring","kill_line","save_excursion","prevent_undo","kill_region","copy_region_as_kill","yank","atStart","yank_from_operating_system","readText","error","copy_for_operating_system","yank_pop","yank_shift","mark","set_mark_command","exchange_point_and_mark","mark_whole_buffer","recenter_top_bottom","recenter","ensure_caret_visible","get_fill_paragraph_region","fill_paragraph","noPrefix","eop","del","bol","start_next_paragraph","fromCharCode","charCodeAt","scroll_down_half","hl","scroll_up_half","scroll_up","scroll_down","nuke_trailing_whitespace","match_string","match_beginning","match_end","undo","goto_last_change","center_line","dabbrev_expand","expansion","ctx","search","lastSearch","encountered","forward","seenBuffers","startBuffer","found","includes","split_frame_vertically","split_frame_horizontally","delete_other_frames","delete_frame","other_frame","windmove","next_buffer","previous_buffer","switch_to_buffer","kill_buffer","msg","yes","rename_buffer","delete_region_or_line","close_last_xml_tag","tag","skip","bind_variables","for_region","comment_region","cmmt","out","uncomment_region","cmmt1","cmmt2","comment_dwim","what_cursor_position","chname","$c7731ae7d5abaea3$var$TMPL_CHAR_INFO","codeHex","sizeKB","set_fill_column","bury_buffer","describe_mode","dumpKeymap","entries","txt","window_configuration_to_register","jump_to_register","string_rectangle","string","kill_rectangle","clear_rectangle","insert_rectangle","rect","yank_rectangle","kr","_next_is_meta","kmacro_start_macro","kmacro_end_macro","kmacro_end_and_call_macro","$64ad30bda24c420e$var$$menu","$64ad30bda24c420e$var$$selectedIndex","$64ad30bda24c420e$var$$selectedItem","$64ad30bda24c420e$var$popupCompletionMenu","list","noError","$64ad30bda24c420e$var$killMenu","$64ad30bda24c420e$var$select","$64ad30bda24c420e$var$handle_enter","$64ad30bda24c420e$var$KEYMAP_POPUP_ACTIVE","idx","$64ad30bda24c420e$export$9cb120f8f6032a76","completions","validate","ivy","$64ad30bda24c420e$var$filename_completion","changed_vars","ivy_completion","completion_list","minibuffer_validation","cont2","minibuffer_continuation","lastslash","partial","$08a06a2e99accb03$export$b43564a9f178c38c","strings","$64ad30bda24c420e$var$handle_arrow_down","$64ad30bda24c420e$var$handle_arrow_up","minibuffer_prompt","minibuffer_yn","minibuffer_read_yn","minibuffer_read_number","minibuffer_read_command","minibuffer_read_function","commandNames","hashKeys","minibuffer_read_buffer","bufferNames","minibuffer_read_string","minibuffer_read_variable","minibuffer_read_existing_file","minibuffer_read_file","minibuffer_read_file_or_directory","minibuffer_read_directory","minibuffer_prompt_end","minibuffer_contents","minibuffer_replace_input","minibuffer_replace_input_by_current_dir","minibuffer_complete","complete","candidates","query","query_rx","word_rx","results","score","hil","indices","li_beg","li_end","fi_beg","fi_end","some","minibuffer_complete_and_exit","valid","minibuffer_keyboard_quit","$64ad30bda24c420e$var$DEFAULT_KEYS","$64ad30bda24c420e$var$KEYMAP_MB_ACTIVE","get_region","figure_out_mode","mode_from_name","set_buffer_mode","mode","cperl_lineup","rcend","htmlize_region","lineNum","pad","zero","execute_extended_command","set_variable","variable","parseFloat","eval_string","eval_region","eval_buffer","toggle_line_numbers","save_file","load_file","find_file","write_file","save_some_buffers","save_some_buffers_with_continuation","ask","bufs","loop","save_buffer_with_continuation","did_save","do_save","save_buffer","delete_file","eval_file","request_full_screen","set_color_theme","theme","themes","styleSheets","digStyle","rule","cssRules","digRule","CSSImportRule","styleSheet","selectorText","toggle_bar_cursor","$f129722536e13624$var$Ymacs_Keymap_ISearch","_isearchContext","mbMark","livepoint","$f129722536e13624$var$isearchText","$f129722536e13624$var$updateIsearch","$f129722536e13624$var$initIsearch","regexp","lax","case_fold","qreplace","region","origpoint","$f129722536e13624$var$resetPrompt","$f129722536e13624$var$doSearch","$f129722536e13624$var$caseFold","$f129722536e13624$var$lazyHighlight","qrx","cursor","minpos","maxpos","Infinity","crnt","mid","lastFoundQuery","$f129722536e13624$var$searchRegExp","p1rc","p2rc","searchRX","isearch_forward","isearch_backward","isearch_forward_regexp","isearch_backward_regexp","isearch_yank_word_or_char","isearch_toggle_word","isearch_toggle_case_fold","isearch_toggle_lax_whitespace","isearch_printing_char","isearch_abort","cancelled","isearch_reset_or_abort","$f129722536e13624$var$Ymacs_Keymap_Query_Replace","$f129722536e13624$var$query_replace_1","hlOrig","onQuit","continued","$f129722536e13624$var$query_replace_2","rxorig","replacement","$f129722536e13624$var$query_replace_3","$f129722536e13624$var$similarCase","rplc","curr","queue","domatch","groups","gotoNext","all","rc_begin","query_replace_yes_this_occurrence","query_replace_yes_this_occurrence_and_stop","query_replace_no_this_occurrence","query_replace_yes_all_occurrences","query_replace_undo_previous","uptr","uq","query_replace_abort","enter","$f129722536e13624$var$query_replace","query_replace","query_replace_regexp","$1414b989ef7d55bc$export$96ac030efd09f62d","_inParens","_parens","_inComment","_inString","_pmeta","COMMENT","STRING","NUMBER","NAME","WHITESPACE","OPEN_PAREN","CLOSE_PAREN","_stream","_tok","read","maybeSave","skipWS","skipLines","t","readComment","readString","readOpenParen","readCloseParen","readCustom","readTrailingWhitespace","syn","readCommentMulti","readCommentLine","comment","token","opened","doneParen","tok1","tok2","tok3","popInParen","popCont","pushInParen","pushCont","expStart","expStop","tokType","readNumber","readName","setParenMeta","meta","paren","inParen","currentLine","INDENT_LEVEL","commentStartLine","re","thisLineCloses","C_STATEMENTS","stmtLine","base_limit_fill_paragraph_region","findComment","findLast","$965e83e35c4dfcff$var$Ymacs_Lang_CSS","types","CSSRX","was_paren_match","syntax_comment_line","syntax_comment_multi","$8e1bdec65509308b$var$KEYWORDS","$8e1bdec65509308b$var$KEYWORDS_TYPE","$8e1bdec65509308b$var$KEYWORDS_CONST","$8e1bdec65509308b$var$KEYWORDS_BUILTIN","$8e1bdec65509308b$var$ALLOW_REGEXP_AFTER","$8e1bdec65509308b$var$Ymacs_Lang_JS","_isProp","_super","readLiteralRegexp","isProp","parseALittle","ext","class","for","esc","inset","$8e1bdec65509308b$var$Ymacs_Keymap_JS","Partial","QuickParser","input","caret_token","read_escaped","inces","escaped","read_comment","read_multiline_comment","read_string","read_list","beg","save_list_index","list_index","read_token","read_regexp","pattern","modifiers","is_symbol_char","read_symbol","read_char","read_elisp_char","read_sharp","read_all","cont_exp","adjust_start","save_parent","depth","prev_exp","sexp","defineProperty","$cd9400013ca46db2$export$b112841041e97d65","set","enumerable","configurable","test_lisp_parse","ast","lisp_make_quick_parser","lisp_forward_sexp","lisp_backward_sexp","lisp_backward_up_list","lisp_handle_string_quote","$cd9400013ca46db2$var$SPECIAL_FORMS","$cd9400013ca46db2$var$LOOP_KEYWORDS","$cd9400013ca46db2$var$ERROR_FORMS","$cd9400013ca46db2$var$CONSTANTS","$cd9400013ca46db2$var$DEFINES_FUNCTION","$cd9400013ca46db2$var$DEFINES_TYPE","$cd9400013ca46db2$var$DEFINES_VARIABLE","$cd9400013ca46db2$var$FORM_ARGS","$cd9400013ca46db2$var$LOCAL_BODYDEF","_formStack","_formSym","_formLen","_rxSpecial","rx_special","isNameChar","newArg","isForm","form","pform","pushFormStack","_backList","popFormStack","nextNonSpace","currentForm","formArgs","hasRest","$cd9400013ca46db2$var$Ymacs_Keymap_LispMode","paredit_space_before","changed_commands","$10729c6f32778394$var$RX_URL","$10729c6f32778394$var$Ymacs_Lang_Markdown","_block","readInline","level","$10729c6f32778394$var$Ymacs_Keymap_Markdown","$0d1e4b05bb7aaeb3$var$Ymacs_Keymap_ParenMatch","$0d1e4b05bb7aaeb3$var$PARENS","$0d1e4b05bb7aaeb3$var$R_PARENS","$0d1e4b05bb7aaeb3$var$ERROR","$0d1e4b05bb7aaeb3$var$startOf","$0d1e4b05bb7aaeb3$var$endOf","$0d1e4b05bb7aaeb3$var$typeOf","$0d1e4b05bb7aaeb3$var$touches","get_paren_at_point","parens","cp","matching_paren","indent_sexp","goto_matching_paren","forward_sexp","backward_sexp","mark_sexp","kill_sexp","transpose_sexps","down_list","lc","backward_up_list","up_list","beginning_of_defun","end_of_defun","paredit_raise_sexp","kstart","kend","paredit_splice_sexp","outer_begin","outer_end","inner_begin","inner_end","m1","m2","paredit_backward_delete_char","paredit_delete_char","open","paredit_open_pair","pair_a","pair_b","backslash","maybe_space","paredit_close_pair","paredit_wrap_round","closing","paredit_newline_and_indent","inparens","paredit_maybe_indent","paredit_electric_char","clearOvl","events","$3aa295d5c8d5089e$var$RX_EMPTY_TAG","$3aa295d5c8d5089e$var$RX_BLOCK_TAG","$3aa295d5c8d5089e$var$Ymacs_Keymap_XML","$3aa295d5c8d5089e$var$markup_mode","tok_type","$3aa295d5c8d5089e$var$Ymacs_Lang_XML","_tags","_inTag","_inline","emptyTags","readDeclaration","readCloseTag","readOpenTag","addInline","sp","contOpenTag","pushTag","otag","popTag","ctag","popen","pclose","contCloseTag","lastTag","$3aa295d5c8d5089e$var$Ymacs_Lang_HTML","_mode","_js","_css","$3aa295d5c8d5089e$var$TWIG_BUILTIN","$3aa295d5c8d5089e$var$Ymacs_Lang_Twig","_blocks","_inBlock","_alt","readBlock","hasBody","pushBlock","popBlock","fname","littleParseTag","$3aa295d5c8d5089e$var$inlineCode","$3aa295d5c8d5089e$var$inlineCls","xml_limit_fill_paragraph_region","blk","xml_close_tag","closeTwig","xml_slash_complete_tag","xml_gt_complete_tag","xml_newline_and_indent","twig_insert_percent","twig_block_toggle_whitespace","doFront","doBack","$3aa295d5c8d5089e$var$Ymacs_Keymap_XML_Zen","$3aa295d5c8d5089e$var$maybe_stop_zen","xml_zen_expand","$3aa295d5c8d5089e$var$zen_render","klass","attributes","attr","child","$3aa295d5c8d5089e$var$zen_parse","OUTER","xml_zen_stop","xml_zen_next_poi","xml_zen_prev_poi","Ymacs","Ymacs_Buffer","Ymacs_Keymap","Ymacs_Keymap_Emacs","Ymacs_Tokenizer","Ymacs_Interactive","Ymacs_Exception","Ymacs_Lang_Lisp"],"version":3,"file":"ymacs.mjs.map"}